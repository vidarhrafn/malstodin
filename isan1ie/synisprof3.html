<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>√Üfingapr√≥f ‚Äì L√Ωsingaror√∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif; background:linear-gradient(to bottom,#f8f7f4 0%,#e8e6e1 100%); min-height:100vh; }
    .drop-zone { display:inline-flex;align-items:center;justify-content:center;min-width:110px;height:34px;border:2px dashed #d1d5db;border-radius:8px;background:#f9fafb;vertical-align:middle;margin:0 2px;padding:0 8px;transition:border-color .15s,background .15s,transform .15s; }
    .drop-zone.has-word { border-style:solid;border-color:#3b82f6;background:#eff6ff;cursor:grab; }
    .drop-zone.drag-over { border-color:#2563eb;background:#dbeafe;transform:scale(1.04); }
    .drop-zone.correct { border-style:solid;border-color:#22c55e;background:#f0fdf4;color:#15803d;font-weight:500;pointer-events:none; }
    .drop-zone.wrong { border-color:#ef4444;background:#fef2f2;animation:shake .4s ease; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-5px)} 40%{transform:translateX(5px)} 60%{transform:translateX(-4px)} 80%{transform:translateX(3px)} }
    .drop-zone .word-label { font-size:.88rem;pointer-events:none;white-space:nowrap; }
    .word-chip { display:inline-flex;align-items:center;gap:4px;font-size:.88rem;background:#eff6ff;border:1.5px solid #93c5fd;color:#1e3a5f;padding:5px 12px;border-radius:999px;cursor:grab;user-select:none;touch-action:none;transition:transform .15s,box-shadow .15s,opacity .2s; }
    .word-chip:hover { box-shadow:0 2px 8px rgba(59,130,246,.25);transform:translateY(-1px); }
    .word-chip.dragging { opacity:.4; }
    .word-chip .gt { font-size:.68rem;color:#3b82f6;font-style:italic; }
    .wb-drop { transition:border-color .15s,background .15s; }
    .wb-drop.dob { border-color:#93c5fd !important;background:#eff6ff !important; }
    .drag-ghost { position:fixed;pointer-events:none;z-index:9999;font-size:.88rem;background:#eff6ff;border:1.5px solid #93c5fd;padding:5px 12px;border-radius:999px;opacity:.9;transform:translate(-50%,-50%);white-space:nowrap;display:none; }
    .ans-input { border:2px solid #e5e7eb;border-radius:8px;padding:6px 12px;font-size:.9rem;width:100%;outline:none;transition:border-color .15s;background:white; }
    .ans-input:focus { border-color:#3b82f6; }
    .ans-input.correct-inp { border-color:#22c55e !important;background:#f0fdf4;color:#15803d; }
    .ans-input.wrong-inp { border-color:#ef4444 !important;background:#fef2f2; }
    .sec-badge { display:inline-block;background:#eff6ff;color:#2563eb;font-size:.75rem;font-weight:600;padding:2px 10px;border-radius:20px;border:1px solid #bfdbfe;margin-bottom:8px; }
    .fb-ok { background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:12px 16px;color:#15803d; }
    .fb-bad { background:#fef9c3;border:2px solid #fde047;border-radius:10px;padding:12px 16px;color:#854d0e; }
    .prog-dot { width:12px;height:12px;border-radius:50%;transition:background .3s; }
    .tbl-input { border:2px solid #e5e7eb;border-radius:6px;padding:4px 8px;font-size:.85rem;width:100%;outline:none;transition:border-color .15s;background:white;text-align:center; }
    .tbl-input:focus { border-color:#3b82f6; }
    .tbl-input.correct-inp { border-color:#22c55e !important;background:#f0fdf4;color:#15803d; }
    .tbl-input.wrong-inp { border-color:#ef4444 !important;background:#fef2f2; }
    .match-sel { border:2px solid #e5e7eb;border-radius:8px;padding:6px 10px;font-size:.88rem;outline:none;transition:border-color .15s;background:white;width:80px; }
    .match-sel:focus { border-color:#3b82f6; }
    .match-sel.correct-inp { border-color:#22c55e !important;background:#f0fdf4;color:#15803d; }
    .match-sel.wrong-inp { border-color:#ef4444 !important;background:#fef2f2; }
    .dnd-dot { width:10px;height:10px;border-radius:50%;transition:background .2s; }
  </style>
</head>
<body class="pb-20">

<header class="bg-white shadow-sm border-b border-gray-200">
  <div class="max-w-3xl mx-auto px-6 py-6">
    <button onclick="window.history.back()" class="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">‚Üê Til baka</button>
    <h1 class="text-3xl font-light text-gray-800 mb-1">√Üfingapr√≥f ‚Äì L√Ωsingaror√∞</h1>
    <p class="text-gray-500 text-sm font-light">Gagnvirkt pr√≥f ¬∑ Heildareinkunn birtist √æegar allt er kl√°ra√∞</p>
  </div>
</header>

<div class="sticky top-0 z-40 bg-white border-b border-gray-200 shadow-sm">
  <div class="max-w-3xl mx-auto px-6 py-3">
    <div class="flex items-center gap-3">
      <span class="text-xs font-light text-gray-500 whitespace-nowrap">Framvinda:</span>
      <div class="flex gap-1.5" id="progDots"></div>
      <div class="flex-1 h-2 bg-gray-100 rounded-full overflow-hidden ml-2">
        <div id="progBar" class="h-full bg-blue-500 transition-all duration-500" style="width:0%"></div>
      </div>
      <span class="text-xs font-normal text-gray-700 whitespace-nowrap" id="progText">0/8</span>
    </div>
  </div>
</div>

<main class="max-w-3xl mx-auto px-6 mt-6 space-y-8">

<!-- 1. STIGBREYTING -->
<section id="sec1" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">1. Stigbreyting ¬∑ 8%</div>
  <h2 class="text-xl font-light text-gray-800 mb-2">Stigbreyttu l√Ωsingaror√∞unum</h2>
  <p class="text-sm text-gray-500 font-light mb-6">D√¶mi: <em>latur ‚Üí latari ‚Üí latastur</em></p>
  <div class="space-y-6">
    <div class="border-2 border-gray-100 rounded-lg p-5">
      <p class="text-base font-normal text-gray-800 mb-4">Grunnstig: <strong class="text-blue-600">heitur</strong></p>
      <div class="grid grid-cols-2 gap-4">
        <div><label class="text-xs text-gray-500 font-light mb-1 block">Mi√∞stig</label><input class="ans-input" data-correct="heitari" placeholder="..." id="s1_1a"/></div>
        <div><label class="text-xs text-gray-500 font-light mb-1 block">Efsta stig</label><input class="ans-input" data-correct="heitastur" placeholder="..." id="s1_1b"/></div>
      </div>
    </div>
    <div class="border-2 border-gray-100 rounded-lg p-5">
      <p class="text-base font-normal text-gray-800 mb-4">Grunnstig: <strong class="text-blue-600">st√≥r</strong></p>
      <div class="grid grid-cols-2 gap-4">
        <div><label class="text-xs text-gray-500 font-light mb-1 block">Mi√∞stig</label><input class="ans-input" data-correct="st√¶rri" placeholder="..." id="s1_2a"/></div>
        <div><label class="text-xs text-gray-500 font-light mb-1 block">Efsta stig</label><input class="ans-input" data-correct="st√¶rstur" placeholder="..." id="s1_2b"/></div>
      </div>
    </div>
  </div>
  <div id="sec1-fb" class="mt-5 hidden"></div>
  <button onclick="checkSec1()" class="mt-5 bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn1">Athuga sv√∂r</button>
</section>

<!-- 2. DRAG AND DROP ‚Äì ONE AT A TIME -->
<section id="sec2" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">2. Fylla √≠ ey√∞ur ¬∑ 10%</div>
  <h2 class="text-xl font-light text-gray-800 mb-2">Settu r√©tt l√Ωsingaror√∞ inn √≠ setninguna</h2>
  <p class="text-sm text-gray-500 font-light mb-5">Ein setning √≠ einu ‚Äì drag√∞u r√©tt or√∞ √≠ ey√∞una.</p>
  <div class="flex items-center justify-between mb-3">
    <span class="text-xs text-gray-400 font-light" id="dnd-counter">Setning 1 af 8</span>
    <div class="flex gap-1.5" id="dnd-dots"></div>
  </div>
  <div class="bg-gray-50 border-2 border-gray-100 rounded-xl p-6 mb-5 text-gray-700 font-light leading-10 text-base min-h-[80px] flex items-center flex-wrap gap-1" id="dnd-card"></div>
  <p class="text-sm font-light text-gray-500 mb-2 uppercase tracking-wide">Or√∞alisti</p>
  <div id="wordBank2" class="wb-drop flex flex-wrap gap-2 min-h-[48px] rounded-lg border-2 border-dashed border-gray-200 p-4 mb-5"></div>
  <div id="sec2-fb" class="hidden mb-4"></div>
  <div class="flex gap-3 flex-wrap items-center">
    <button id="btn2" onclick="checkSec2()" disabled class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">Athuga svar</button>
    <button id="btn2r" onclick="resetSec2()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Byrja aftur</button>
  </div>
</section>

<!-- 3. TENGJA SAMAN -->
<section id="sec3" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">3. Tengja saman ¬∑ 8%</div>
  <h2 class="text-xl font-light text-gray-800 mb-6">Tengdu saman or√∞ og r√©tta merkingu</h2>
  <div class="space-y-4" id="matchArea">
    <div class="flex items-center gap-4">
      <div class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-lg px-4 py-3 font-normal text-gray-800">1. Vinalegur</div>
      <select class="match-sel" id="m1" onchange="updateBtn3()"><option value="">‚Äî</option><option value="c">c</option><option value="d">d</option><option value="a">a</option><option value="b">b</option></select>
      <div class="text-xs text-gray-400 w-40 font-light hidden md:block" id="mlbl1"></div>
    </div>
    <div class="flex items-center gap-4">
      <div class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-lg px-4 py-3 font-normal text-gray-800">2. Skipulag√∞ur</div>
      <select class="match-sel" id="m2" onchange="updateBtn3()"><option value="">‚Äî</option><option value="c">c</option><option value="d">d</option><option value="a">a</option><option value="b">b</option></select>
      <div class="text-xs text-gray-400 w-40 font-light hidden md:block" id="mlbl2"></div>
    </div>
    <div class="flex items-center gap-4">
      <div class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-lg px-4 py-3 font-normal text-gray-800">3. Kurteis</div>
      <select class="match-sel" id="m3" onchange="updateBtn3()"><option value="">‚Äî</option><option value="c">c</option><option value="d">d</option><option value="a">a</option><option value="b">b</option></select>
      <div class="text-xs text-gray-400 w-40 font-light hidden md:block" id="mlbl3"></div>
    </div>
    <div class="flex items-center gap-4">
      <div class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-lg px-4 py-3 font-normal text-gray-800">4. √Åbyrgur</div>
      <select class="match-sel" id="m4" onchange="updateBtn3()"><option value="">‚Äî</option><option value="c">c</option><option value="d">d</option><option value="a">a</option><option value="b">b</option></select>
      <div class="text-xs text-gray-400 w-40 font-light hidden md:block" id="mlbl4"></div>
    </div>
  </div>
  <div class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm font-light text-gray-600 space-y-1">
    <p><strong>a.</strong> Fylgir reglum og gerir √æa√∞ sem √° a√∞ gera</p>
    <p><strong>b.</strong> S√Ωnir vir√∞ingu og segir ‚Äûtakk" og ‚Äûgj√∂r√∞u svo vel"</p>
    <p><strong>c.</strong> Brosir, talar fallega og hj√°lpar √∂√∞rum</p>
    <p><strong>d.</strong> Hefur allt √° s√≠num sta√∞ og veit hva√∞ √° a√∞ gera</p>
  </div>
  <div id="sec3-fb" class="mt-4 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button id="btn3" onclick="checkSec3()" disabled class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">Athuga sv√∂r</button>
    <button id="btn3r" onclick="resetSec3()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- 4. KYN ‚Äì 3 OR√ê -->
<section id="sec4" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">4. Kyn l√Ωsingaror√∞a ¬∑ 20%</div>
  <h2 class="text-xl font-light text-gray-800 mb-6">Skrifa√∞u r√©tt form √≠ karlkyni, kvenkyni og hvorugkyni</h2>
  <div class="overflow-x-auto">
    <table class="w-full text-sm border-collapse">
      <thead>
        <tr class="border-b-2 border-gray-200">
          <th class="text-left py-3 px-3 font-normal text-gray-600">Karlkyn (Hann er‚Ä¶)</th>
          <th class="text-left py-3 px-3 font-normal text-gray-600">Kvenkyn (H√∫n er‚Ä¶)</th>
          <th class="text-left py-3 px-3 font-normal text-gray-600">Hvorugkyn (√ûa√∞ er‚Ä¶)</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-b border-gray-100 bg-blue-50">
          <td class="py-3 px-3 font-semibold text-blue-700">sterkur</td>
          <td class="py-3 px-3 font-semibold text-blue-700">sterk</td>
          <td class="py-3 px-3 font-semibold text-blue-700">sterkt</td>
        </tr>
        <!-- kaldur ‚Äì given kk -->
        <tr class="border-b border-gray-100">
          <td class="py-2 px-3 font-normal text-gray-700">kaldur</td>
          <td class="py-2 px-3"><input class="tbl-input" data-correct="k√∂ld" placeholder="..."/></td>
          <td class="py-2 px-3"><input class="tbl-input" data-correct="kalt" placeholder="..."/></td>
        </tr>
        <!-- √æungur ‚Äì given kk -->
        <tr class="border-b border-gray-100">
          <td class="py-2 px-3 font-normal text-gray-700">√æungur</td>
          <td class="py-2 px-3"><input class="tbl-input" data-correct="√æung" placeholder="..."/></td>
          <td class="py-2 px-3"><input class="tbl-input" data-correct="√æungt" placeholder="..."/></td>
        </tr>
        <!-- r√≥legur ‚Äì given hk r√≥legt -->
        <tr class="border-b border-gray-100">
          <td class="py-2 px-3"><input class="tbl-input" data-correct="r√≥legur" placeholder="..."/></td>
          <td class="py-2 px-3"><input class="tbl-input" data-correct="r√≥leg" placeholder="..."/></td>
          <td class="py-2 px-3 font-normal text-gray-700">r√≥legt</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div id="sec4-fb" class="mt-4 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button onclick="checkSec4()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn4">Athuga sv√∂r</button>
    <button id="btn4r" onclick="resetSec4()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- 5. ANDHEITI ‚Äì 2 OR√ê -->
<section id="sec5" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">5. Andheiti ¬∑ 5%</div>
  <h2 class="text-xl font-light text-gray-800 mb-6">Skrifa√∞u andheiti</h2>
  <div class="space-y-4">
    <div class="flex items-center gap-4">
      <span class="w-28 font-normal text-gray-800">1. Heitur</span>
      <input class="ans-input flex-1" id="and1" placeholder="Andheiti..."/>
    </div>
    <div class="flex items-center gap-4">
      <span class="w-28 font-normal text-gray-800">2. L√©ttur</span>
      <input class="ans-input flex-1" id="and2" placeholder="Andheiti..."/>
    </div>
  </div>
  <div id="sec5-fb" class="mt-5 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button onclick="checkSec5()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn5">Athuga sv√∂r</button>
    <button id="btn5r" onclick="resetSec5()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- 6. SKILNINGUR -->
<section id="sec6" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">6. Skilningur ¬∑ 21%</div>
  <h2 class="text-xl font-light text-gray-800 mb-4">Lesi√∞ s√∂guna og svari√∞ spurningunum</h2>
  <div class="bg-amber-50 border-2 border-amber-100 rounded-xl p-6 mb-6 text-gray-700 font-light leading-relaxed text-sm">
    Einu sinni var kona fr√° Selfossi. H√∫n √°tti heima √° Akranesi og vann √≠ litlum matv√∂ruverslun. √Å √æri√∞judagsmorgni vakna√∞i h√∫n snemma og s√° a√∞ √æa√∞ var sk√Ωja√∞ √∫ti en samt hl√Ωtt. H√∫n vann venjulega fr√° n√≠u til fimm, en √æennan √æri√∞judag f√≥r h√∫n klukkan fj√∂gur √∫r vinnunni. H√∫n √¶tla√∞i a√∞ heims√¶kja vinkonu s√≠na √≠ Borgarnesi og koma me√∞ sm√° gj√∂f.<br/><br/>
    H√∫n keyr√∞i af sta√∞ eftir vinnu og stoppa√∞i √≠ b√∫√∞ til a√∞ kaupa bl√≥m. S√≠√∞an f√≥r h√∫n √°fram og kom til vinkonunnar. √û√¶r drukku te, spj√∂llu√∞u lengi og hl√≥gu miki√∞. Um kv√∂ldi√∞ f√≥r konan heim, bj√≥ s√©r einfaldan kv√∂ldmat og f√≥r snemma a√∞ sofa.
  </div>
  <div class="space-y-4">
    <div><p class="text-sm font-normal text-gray-700 mb-1">1. Hvar √°tti konan heima?</p><input class="ans-input" id="q6_1" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">2. Hva√∞an var konan?</p><input class="ans-input" id="q6_2" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">3. Hva√∞a dag gerist sagan?</p><input class="ans-input" id="q6_3" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">4. Hvert √¶tla√∞i konan a√∞ fara eftir vinnu?</p><input class="ans-input" id="q6_4" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">5. Hven√¶r f√≥r h√∫n √∫r vinnunni √æennan dag?</p><input class="ans-input" id="q6_5" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">6. Hva√∞ keypti h√∫n √≠ b√∫√∞inni?</p><input class="ans-input" id="q6_6" placeholder="Svar..."/></div>
    <div><p class="text-sm font-normal text-gray-700 mb-1">7. Hva√∞ ger√∞u √æ√¶r vinkonurnar saman?</p><input class="ans-input" id="q6_7" placeholder="Svar..."/></div>
  </div>
  <div id="sec6-fb" class="mt-5 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button onclick="checkSec6()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn6">Athuga sv√∂r</button>
    <button id="btn6r" onclick="resetSec6()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- 7. FINNA L√ùSINGAROR√ê ‚Äì STYTTRI TEXTI, 3 OR√ê -->
<section id="sec7" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">7. Finna l√Ωsingaror√∞ ¬∑ 18%</div>
  <h2 class="text-xl font-light text-gray-800 mb-4">Skrifa√∞u l√Ωsingaror√∞in upp og seg√∞u kyni√∞</h2>
  <div class="bg-amber-50 border-2 border-amber-100 rounded-xl p-6 mb-5 text-gray-700 font-light leading-relaxed text-sm">
    Er √æetta n√Ωr b√≠ll? J√° en h√∫si√∞ er gamalt. B√≥kin er skemmtileg.
  </div>
  <p class="text-sm text-gray-500 font-light mb-4">√û√∫ m√°tt nota kk. / kvk. / hk. e√∞a karlkyn / kvenkyn / hvorugkyn</p>
  <div class="grid grid-cols-1 gap-3" id="sec7rows"></div>
  <div id="sec7-fb" class="mt-5 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button onclick="checkSec7()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn7">Athuga sv√∂r</button>
    <button id="btn7r" onclick="resetSec7()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- 8. SKRIFA UM MYND ‚Äì 2 SETNINGAR -->
<section id="sec8" class="bg-white rounded-xl shadow-md p-8">
  <div class="sec-badge">8. Skrifa um mynd ¬∑ 10%</div>
  <h2 class="text-xl font-light text-gray-800 mb-2">Skrifa√∞u 2 setningar um myndina</h2>
  <p class="text-sm text-gray-500 font-light mb-5">Nota√∞u <strong>a√∞ minnsta kosti 2 l√Ωsingaror√∞</strong>. Hver setning √æarf a√∞ vera a√∞ minnsta kosti 4 or√∞.</p>
  <img src="media/herbergi.jpg" alt="Herbergi" class="w-full rounded-xl mb-6 border-2 border-gray-100 object-cover max-h-80" onerror="this.style.display='none';document.getElementById('imgPlaceholder').style.display='flex'"/>
  <div id="imgPlaceholder" class="hidden w-full h-48 rounded-xl mb-6 border-2 border-dashed border-gray-200 bg-gray-50 items-center justify-center text-gray-400 font-light text-sm flex">üì∑ media/herbergi.jpg</div>
  <div class="space-y-3">
    <div><label class="text-xs text-gray-400 font-light">Setning 1</label><input class="ans-input mt-1" id="s8_1" placeholder="Skrifa√∞u setningu..."/></div>
    <div><label class="text-xs text-gray-400 font-light">Setning 2</label><input class="ans-input mt-1" id="s8_2" placeholder="Skrifa√∞u setningu..."/></div>
  </div>
  <div id="sec8-fb" class="mt-5 hidden"></div>
  <div class="flex gap-3 mt-5 flex-wrap">
    <button onclick="checkSec8()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors" id="btn8">Athuga sv√∂r</button>
    <button id="btn8r" onclick="resetSec8()" class="hidden bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
  </div>
</section>

<!-- HEILDARNI√êURSTA√êA -->
<div id="finalBox" class="hidden bg-white rounded-xl shadow-md p-8 text-center">
  <p class="text-3xl font-light text-gray-800 mb-2">üéâ Pr√≥fi loki√∞!</p>
  <div id="finalScore" class="text-5xl font-light text-blue-600 my-4"></div>
  <div id="finalBreakdown" class="text-sm font-light text-gray-600 mt-4 space-y-1 text-left max-w-xs mx-auto"></div>
</div>

</main>
<div class="drag-ghost" id="dragGhost"></div>

<script>
// ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TOTAL_SECS=8;
const secDone=Array(TOTAL_SECS+1).fill(false);
const secScores=Array(TOTAL_SECS+1).fill(null);
const secMax=[0,8,10,8,20,5,21,18,10];

function norm(s){return s.trim().toLowerCase().replace(/[.,!?]/g,'');}

async function callAI(messages,max_tokens=400){
  const r=await fetch('/.netlify/functions/openai',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages,max_tokens,model:'gpt-4o',temperature:0.2})});
  const d=await r.json();
  if(!r.ok||d.error)throw new Error(d.error||`HTTP ${r.status}`);
  return d.content;
}

function setLoading(btnId,on){
  const b=document.getElementById(btnId);
  if(on){b.disabled=true;b.textContent='Athuga...';}
  else{b.disabled=false;b.textContent='Athuga sv√∂r';}
}

function showFb(id,html){
  const el=document.getElementById(id);el.innerHTML=html;el.classList.remove('hidden');
  el.scrollIntoView({behavior:'smooth',block:'nearest'});
}

function updateProgress(){
  const done=secDone.slice(1).filter(Boolean).length;
  document.getElementById('progBar').style.width=`${(done/TOTAL_SECS)*100}%`;
  document.getElementById('progText').textContent=`${done}/${TOTAL_SECS}`;
  const dots=document.getElementById('progDots');dots.innerHTML='';
  for(let i=1;i<=TOTAL_SECS;i++){
    const d=document.createElement('div');
    d.className='prog-dot '+(secDone[i]?'bg-green-500':'bg-gray-200');
    dots.appendChild(d);
  }
  if(secDone.slice(1).every(Boolean))showFinal();
}

function markDone(sec,score){
  secDone[sec]=true;secScores[sec]=score;
  const btn=document.getElementById('btn'+sec);
  if(btn){btn.disabled=true;btn.textContent='Loki√∞ ‚úì';btn.classList.remove('bg-blue-600','hover:bg-blue-700');btn.classList.add('bg-green-600');}
  const rbtn=document.getElementById('btn'+sec+'r');
  if(rbtn)rbtn.classList.remove('hidden');
  updateProgress();
}

function showFinal(){
  const box=document.getElementById('finalBox');box.classList.remove('hidden');
  let total=0,max=0,bd='';
  for(let i=1;i<=TOTAL_SECS;i++){total+=secScores[i]||0;max+=secMax[i];bd+=`<p>Verkefni ${i}: ${secScores[i]||0}/${secMax[i]} stig</p>`;}
  document.getElementById('finalScore').textContent=`${total}/${max} stig`;
  document.getElementById('finalBreakdown').innerHTML=bd;
  box.scrollIntoView({behavior:'smooth',block:'start'});
}

// ‚îÄ‚îÄ SEC 1: STIGBREYTING (AI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function checkSec1(){
  const fields=[{id:'s1_1a',w:'heitur',slot:'mi√∞stig'},{id:'s1_1b',w:'heitur',slot:'efsta stig'},{id:'s1_2a',w:'st√≥r',slot:'mi√∞stig'},{id:'s1_2b',w:'st√≥r',slot:'efsta stig'}];
  const answers=fields.map(f=>({slot:`${f.w} ‚Äì ${f.slot}`,answer:document.getElementById(f.id).value.trim()}));
  if(answers.some(a=>!a.answer)){showFb('sec1-fb','<p class="text-yellow-700 text-sm font-light">Vinsamlega fylltu √≠ allar ey√∞ur.</p>');return;}
  setLoading('btn1',true);
  try{
    const sys=`√û√∫ ert √≠slenskukennari. Nemandi er a√∞ stigbreyta √≠slensku l√Ωsingaror√∞um.
Sv√∂rin sem vi√∞ gerum r√°√∞ fyrir: heitur mi√∞stig: heitari, efsta stig: heitastur. st√≥r mi√∞stig: st√¶rri, efsta stig: st√¶rstur.
Gef√∞u 1 stig fyrir hvert r√©tt svar (h√°mark 4). Skala√∞u √≠ 8 (margfalda me√∞ 2).
SKILA√êU EINUNGIS JSON: {"score_8":N,"feedback":"stutt √≠slensk endurgj√∂f ‚Äì s√Ωndu r√©tt svar ef rangt"}`;
    const res=await callAI([{role:'system',content:sys},{role:'user',content:JSON.stringify(answers)}]);
    const obj=JSON.parse(res);
    const score=Math.min(8,Math.max(0,obj.score_8||0));
    showFb('sec1-fb',`<div class="${score>=6?'fb-ok':'fb-bad'}"><p class="font-normal mb-1">Einkunn: ${score}/8 stig</p><p class="text-sm font-light">${obj.feedback}</p></div>`);
    markDone(1,score);
  }catch(e){showFb('sec1-fb','<p class="text-red-600 text-sm">Villa vi√∞ tengingu. Reyndu aftur.</p>');setLoading('btn1',false);}
}

// ‚îÄ‚îÄ SEC 2: DRAG AND DROP ‚Äì ONE AT A TIME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DND_SENTENCES=[
  {before:'√âg er',answer:'√°n√¶g√∞ur',after:'af √æv√≠ a√∞ √©g f√©kk loksins fr√≠ √≠ dag.'},
  {before:'Br√≥√∞ir minn var',answer:'rei√∞ur',after:'√æegar hann missti s√≠mann sinn.'},
  {before:'√ç g√¶r keypti √©g',answer:'ferskt',after:'brau√∞ √≠ bakar√≠i.'},
  {before:'√âg er',answer:'lei√∞ur',after:'yfir √æv√≠ a√∞ √æ√∫ getir ekki komi√∞ √≠ heims√≥kn.'},
  {before:'Hundurinn minn er mj√∂g',answer:'fj√∂rugur',after:'og elskar a√∞ hlaupa.'},
  {before:'√ûegar √©g er me√∞ hausverk er √©g oft',answer:'√æreyttur',after:''},
  {before:'Kaffi√∞ er',answer:'heitt',after:'og √©g √æarf a√∞ b√≠√∞a a√∞eins.'},
  {before:'Vegurinn heim er',answer:'beinn',after:'og √©g labba hratt.'},
];
const WORDS2=[
  {word:'√°n√¶g√∞ur',gender:'kk'},{word:'rei√∞ur',gender:'kk'},{word:'ferskt',gender:'hk'},
  {word:'lei√∞ur',gender:'kk'},{word:'fj√∂rugur',gender:'kk'},{word:'√æreyttur',gender:'kk'},
  {word:'heitt',gender:'hk'},{word:'beinn',gender:'kk'}
];
function shuf(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

let dndCurrent=0; // current sentence index
let dndScores=[]; // per sentence: true/false
let dnd2Drag=null;
const ghost=document.getElementById('dragGhost');

function buildDndDots(){
  const c=document.getElementById('dnd-dots');c.innerHTML='';
  DND_SENTENCES.forEach((_,i)=>{
    const d=document.createElement('div');
    d.className='dnd-dot '+(i<dndCurrent?'bg-green-400':i===dndCurrent?'bg-blue-400':'bg-gray-200');
    c.appendChild(d);
  });
}

function renderDndCard(idx){
  const s=DND_SENTENCES[idx];
  const card=document.getElementById('dnd-card');
  card.innerHTML='';
  // before text
  if(s.before){const t=document.createTextNode(s.before+' ');card.appendChild(t);}
  // drop zone
  const dz=document.createElement('span');
  dz.className='drop-zone';dz.dataset.answer=s.answer;
  dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag-over');});
  dz.addEventListener('dragleave',()=>dz.classList.remove('drag-over'));
  dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('drag-over');if(!dnd2Drag)return;placeDnd(dz,dnd2Drag.word,dnd2Drag.chipId);dnd2Drag=null;});
  dz.addEventListener('touchstart',e=>{if(!dz.dataset.current)return;onTSDnd(e,dz);},{passive:false});
  dz.addEventListener('touchmove',onTMDnd,{passive:false});
  dz.addEventListener('touchend',e=>onTEDnd(e,dz));
  card.appendChild(dz);
  // after text
  if(s.after){const t=document.createTextNode(' '+s.after);card.appendChild(t);}
  document.getElementById('dnd-counter').textContent=`Setning ${idx+1} af ${DND_SENTENCES.length}`;
  buildDndDots();
  upd2();
}

function buildBank2(words){
  const wb=document.getElementById('wordBank2');wb.innerHTML='';
  words.forEach(e=>wb.appendChild(makeChip2(e)));
}

function makeChip2(e){
  const c=document.createElement('span');c.className='word-chip';
  c.dataset.word=e.word;c.dataset.chipId=e.id||e.word;
  c.innerHTML=`${e.word} <span class="gt">${e.gender}</span>`;
  c.draggable=true;
  c.addEventListener('dragstart',ev=>{dnd2Drag={word:c.dataset.word,chipId:c.dataset.chipId};c.classList.add('dragging');ev.dataTransfer.effectAllowed='move';});
  c.addEventListener('dragend',()=>c.classList.remove('dragging'));
  c.addEventListener('touchstart',onTSDnd,{passive:false});
  c.addEventListener('touchmove',onTMDnd,{passive:false});
  c.addEventListener('touchend',onTEDnd);
  return c;
}

const wb2=document.getElementById('wordBank2');
wb2.addEventListener('dragover',e=>{e.preventDefault();wb2.classList.add('dob');});
wb2.addEventListener('dragleave',()=>wb2.classList.remove('dob'));
wb2.addEventListener('drop',e=>{e.preventDefault();wb2.classList.remove('dob');});

function placeDnd(zone,word,chipId){
  // remove chip from bank
  const chip=wb2.querySelector(`[data-chip-id="${chipId}"]`);if(chip)chip.remove();
  zone.dataset.current=word;zone.dataset.chipId=chipId;
  zone.classList.add('has-word');zone.classList.remove('wrong','correct');
  zone.setAttribute('draggable','true');
  zone.innerHTML=`<span class="word-label">${word}</span>`;
  upd2();
}

function upd2(){
  const dz=document.querySelector('#dnd-card .drop-zone');
  document.getElementById('btn2').disabled=!dz||!dz.dataset.current;
}

function checkSec2(){
  const dz=document.querySelector('#dnd-card .drop-zone');
  if(!dz||!dz.dataset.current)return;
  const correct=dz.dataset.current===dz.dataset.answer;
  dndScores.push(correct);
  if(correct){
    dz.classList.add('correct');dz.classList.remove('has-word');
    dz.setAttribute('draggable','false');
    dz.innerHTML=`<span class="word-label">${dz.dataset.current}</span><span class="ml-1 text-green-500 text-sm">‚úì</span>`;
    // brief pause then next
    document.getElementById('btn2').disabled=true;
    setTimeout(()=>advanceDnd(),700);
  } else {
    dz.classList.add('wrong');
    // return chip to bank
    const word=dz.dataset.current;
    const gender=WORDS2.find(w=>w.word===word)?.gender||'';
    setTimeout(()=>{
      dz.dataset.current='';dz.dataset.chipId='';
      dz.classList.remove('wrong','has-word','correct');dz.setAttribute('draggable','false');dz.innerHTML='';
      wb2.appendChild(makeChip2({word,gender,id:word}));
      upd2();
    },600);
    showFb('sec2-fb','<div class="fb-bad"><p class="text-sm font-light">Ekki r√©tt ‚Äì reyndu aftur!</p></div>');
    setTimeout(()=>document.getElementById('sec2-fb').classList.add('hidden'),1500);
  }
}

function advanceDnd(){
  document.getElementById('sec2-fb').classList.add('hidden');
  dndCurrent++;
  if(dndCurrent>=DND_SENTENCES.length){
    // all done
    const correct=dndScores.filter(Boolean).length;
    const score=Math.round(correct/DND_SENTENCES.length*10);
    showFb('sec2-fb',`<div class="fb-ok"><p class="font-normal">Loki√∞! ${correct}/${DND_SENTENCES.length} r√©tt ‚Äì ${score}/10 stig üéâ</p></div>`);
    markDone(2,score);
    document.getElementById('btn2r').classList.remove('hidden');
    document.getElementById('dnd-card').innerHTML='<span class="text-green-600 font-normal">‚úì √ñllum setningum loki√∞!</span>';
    buildDndDots();
    return;
  }
  // rebuild bank for next sentence ‚Äì only show words not yet used
  const usedAnswers=DND_SENTENCES.slice(0,dndCurrent).map(s=>s.answer);
  const remaining=WORDS2.filter(w=>!usedAnswers.includes(w.word));
  buildBank2(shuf(remaining.map((w,i)=>({...w,id:w.word+'_'+i}))));
  renderDndCard(dndCurrent);
}

function resetSec2(){
  dndCurrent=0;dndScores=[];
  buildBank2(shuf(WORDS2.map((w,i)=>({...w,id:w.word+'_'+i}))));
  renderDndCard(0);
  document.getElementById('sec2-fb').classList.add('hidden');
  document.getElementById('btn2r').classList.add('hidden');
  secDone[2]=false;secScores[2]=null;updateProgress();
  const btn=document.getElementById('btn2');btn.textContent='Athuga svar';btn.classList.remove('bg-green-600');btn.classList.add('bg-blue-600','hover:bg-blue-700');
}

// Touch for DnD
let tcDnd={word:null,chipId:null};
function onTSDnd(e,zo){
  const el=zo||e.currentTarget;
  const isZ=el.classList.contains('drop-zone');
  const word=isZ?el.dataset.current:el.dataset.word;if(!word)return;
  e.preventDefault();tcDnd={word,chipId:el.dataset.chipId||el.dataset.word,sourceZone:isZ?el:null};
  ghost.textContent=word;ghost.style.display='block';
  const t=e.touches[0];ghost.style.left=t.clientX+'px';ghost.style.top=t.clientY+'px';
}
function onTMDnd(e){
  if(!tcDnd.word)return;e.preventDefault();
  const t=e.touches[0];ghost.style.left=t.clientX+'px';ghost.style.top=t.clientY+'px';
  document.querySelectorAll('#dnd-card .drop-zone').forEach(d=>d.classList.remove('drag-over'));
  document.elementFromPoint(t.clientX,t.clientY)?.closest('#dnd-card .drop-zone:not(.correct)')?.classList.add('drag-over');
}
function onTEDnd(e){
  if(!tcDnd.word)return;ghost.style.display='none';
  document.querySelectorAll('#dnd-card .drop-zone').forEach(d=>d.classList.remove('drag-over'));
  wb2.classList.remove('dob');
  const t=e.changedTouches[0];const el=document.elementFromPoint(t.clientX,t.clientY);
  const tz=el?.closest('#dnd-card .drop-zone:not(.correct)');
  if(tz)placeDnd(tz,tcDnd.word,tcDnd.chipId);
  tcDnd={word:null,chipId:null,sourceZone:null};
}

// ‚îÄ‚îÄ SEC 3: MATCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const matchCorrect={m1:'c',m2:'d',m3:'b',m4:'a'};
const matchLabels={c:'c. Brosir, talar fallega',d:'d. Hefur allt √° s√≠num sta√∞',b:'b. S√Ωnir vir√∞ingu',a:'a. Fylgir reglum'};
function updateBtn3(){document.getElementById('btn3').disabled=!['m1','m2','m3','m4'].every(id=>document.getElementById(id).value);}
function checkSec3(){
  let correct=0;
  ['m1','m2','m3','m4'].forEach((id,i)=>{
    const sel=document.getElementById(id);const lbl=document.getElementById('mlbl'+(i+1));
    if(sel.value===matchCorrect[id]){sel.classList.add('correct-inp');correct++;if(lbl)lbl.textContent='‚úì '+matchLabels[sel.value];}
    else{sel.classList.add('wrong-inp');if(lbl){lbl.textContent='‚úó R√©tt: '+matchLabels[matchCorrect[id]];lbl.classList.add('text-red-500');}}
    sel.disabled=true;
  });
  const score=Math.round(correct/4*8);
  showFb('sec3-fb',`<div class="${correct===4?'fb-ok':'fb-bad'}"><p class="font-normal">${correct}/4 r√©tt ‚Äì ${score}/8 stig</p></div>`);
  markDone(3,score);
}
function resetSec3(){
  ['m1','m2','m3','m4'].forEach((id,i)=>{
    const sel=document.getElementById(id);sel.value='';sel.className='match-sel';sel.disabled=false;
    const lbl=document.getElementById('mlbl'+(i+1));if(lbl){lbl.textContent='';lbl.className='text-xs text-gray-400 w-40 font-light hidden md:block';}
  });
  document.getElementById('sec3-fb').classList.add('hidden');document.getElementById('btn3r').classList.add('hidden');
  document.getElementById('btn3').disabled=true;secDone[3]=false;secScores[3]=null;updateProgress();
  const btn=document.getElementById('btn3');btn.textContent='Athuga sv√∂r';btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ SEC 4: KYN TAFLA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkSec4(){
  const inputs=document.querySelectorAll('#sec4 .tbl-input');
  let correct=0;
  inputs.forEach(inp=>{
    if(norm(inp.value)===norm(inp.dataset.correct)){inp.classList.add('correct-inp');inp.disabled=true;correct++;}
    else inp.classList.add('wrong-inp');
  });
  const total=inputs.length; // 5 ey√∞ur
  const score=Math.round(correct/total*20);
  showFb('sec4-fb',`<div class="${correct===total?'fb-ok':'fb-bad'}"><p class="font-normal">${correct}/${total} r√©tt ‚Äì ${score}/20 stig</p>${correct<total?'<p class="text-sm font-light mt-1">Rau√∞u reitirnir eru rangir.</p>':''}</div>`);
  if(correct===total)markDone(4,score);
  else document.querySelectorAll('#sec4 .tbl-input.wrong-inp').forEach(i=>i.classList.remove('wrong-inp'));
}
function resetSec4(){
  document.querySelectorAll('#sec4 .tbl-input').forEach(i=>{i.value='';i.className='tbl-input';i.disabled=false;});
  document.getElementById('sec4-fb').classList.add('hidden');document.getElementById('btn4r').classList.add('hidden');
  secDone[4]=false;secScores[4]=null;updateProgress();
  const btn=document.getElementById('btn4');btn.textContent='Athuga sv√∂r';btn.disabled=false;btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ SEC 5: ANDHEITI ‚Äì 2 OR√ê, BETRI AI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function checkSec5(){
  const pairs=[{word:'Heitur',ans:document.getElementById('and1').value.trim()},{word:'L√©ttur',ans:document.getElementById('and2').value.trim()}];
  if(pairs.some(p=>!p.ans)){showFb('sec5-fb','<p class="text-yellow-700 text-sm font-light">Fylltu √≠ b√¶√∞i sv√∂rin.</p>');return;}
  setLoading('btn5',true);
  try{
    const sys=`√û√∫ ert √≠slenskukennari. Nemandi √° a√∞ skrifa andheiti vi√∞ tv√∂ √≠slensk l√Ωsingaror√∞ √≠ karlkyni nefnifalli (kk. nf.).
Or√∞ 1: Heitur ‚Äì r√©tt andheiti: kaldur (e√∞a jafngildar l√∂gm√¶tar √≠slenskar andheitar)
Or√∞ 2: L√©ttur ‚Äì r√©tt andheiti: √æungur (e√∞a jafngildar l√∂gm√¶tar √≠slenskar andheitar)
Gef√∞u 1 stig fyrir hvert or√∞ √æar sem nemandinn skilar l√∂gm√¶tu √≠slensku andheiti (hvort sem √æa√∞ er √≠ n√°kv√¶mlega r√©ttri beygingarform e√∞a ekki, meta MERKINGUNA).
Ef svari√∞ er rangt, s√Ωndu r√©tt svar √≠ endurgj√∂finni.
SKILA√êU EINUNGIS JSON: {"score":N,"feedback_1":"endurgj√∂f √° √≠slensku um or√∞ 1","feedback_2":"endurgj√∂f √° √≠slensku um or√∞ 2"}`;
    const res=await callAI([{role:'system',content:sys},{role:'user',content:JSON.stringify(pairs)}]);
    const obj=JSON.parse(res);
    const score=Math.min(2,Math.max(0,obj.score||0));
    const pts=score===2?5:score===1?2:0;
    showFb('sec5-fb',`<div class="${score===2?'fb-ok':'fb-bad'}">
      <p class="font-normal mb-2">Einkunn: ${pts}/5 stig</p>
      <p class="text-sm font-light mb-1"><strong>1. Heitur:</strong> ${obj.feedback_1}</p>
      <p class="text-sm font-light"><strong>2. L√©ttur:</strong> ${obj.feedback_2}</p>
    </div>`);
    markDone(5,pts);
  }catch(e){showFb('sec5-fb','<p class="text-red-600 text-sm">Villa vi√∞ tengingu. Reyndu aftur.</p>');setLoading('btn5',false);}
}
function resetSec5(){
  ['and1','and2'].forEach(id=>{const el=document.getElementById(id);el.value='';el.className='ans-input flex-1';});
  document.getElementById('sec5-fb').classList.add('hidden');document.getElementById('btn5r').classList.add('hidden');
  secDone[5]=false;secScores[5]=null;updateProgress();
  const btn=document.getElementById('btn5');btn.textContent='Athuga sv√∂r';btn.disabled=false;btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ SEC 6: SKILNINGUR (AI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function checkSec6(){
  const qs=['Hvar √°tti konan heima?','Hva√∞an var konan?','Hva√∞a dag gerist sagan?','Hvert √¶tla√∞i konan a√∞ fara eftir vinnu?','Hven√¶r f√≥r h√∫n √∫r vinnunni √æennan dag?','Hva√∞ keypti h√∫n √≠ b√∫√∞inni?','Hva√∞ ger√∞u √æ√¶r vinkonurnar saman?'];
  const answers=qs.map((q,i)=>({question:q,answer:document.getElementById('q6_'+(i+1)).value.trim()}));
  if(answers.some(a=>!a.answer)){showFb('sec6-fb','<p class="text-yellow-700 text-sm font-light">Svara√∞u √∂llum spurningum.</p>');return;}
  setLoading('btn6',true);
  try{
    const sys=`√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ skilningsspurningum.
TEXTI: Konan er fr√° Selfossi. H√∫n √° heima √° Akranesi. Vinnur √≠ matv√∂ruverslun. √ûri√∞judagur. F√≥r klukkan fj√∂gur √∫r vinnu. F√≥r til vinkonunnar √≠ Borgarnesi. Keypti bl√≥m. √û√¶r drukku te, spj√∂llu√∞u og hl√≥gu.
Gef√∞u 1 stig fyrir hvert r√©tt svar (h√°mark 7). Hunsa sm√°v√¶gilegar m√°lfr√¶√∞ivillur ‚Äì meta INNIHALD.
SKILA√êU EINUNGIS JSON: {"score":N,"feedback":"stutt √≠slensk endurgj√∂f, bentu √° r√©tt og rangt"}`;
    const res=await callAI([{role:'system',content:sys},{role:'user',content:JSON.stringify(answers)}],500);
    const obj=JSON.parse(res);
    const score=Math.min(7,Math.max(0,obj.score||0));
    const pts=Math.round(score/7*21);
    showFb('sec6-fb',`<div class="${score>=6?'fb-ok':'fb-bad'}"><p class="font-normal mb-1">Einkunn: ${pts}/21 stig (${score}/7 sv√∂r r√©tt)</p><p class="text-sm font-light">${obj.feedback}</p></div>`);
    markDone(6,pts);
  }catch(e){showFb('sec6-fb','<p class="text-red-600 text-sm">Villa vi√∞ tengingu. Reyndu aftur.</p>');setLoading('btn6',false);}
}
function resetSec6(){
  for(let i=1;i<=7;i++){const el=document.getElementById('q6_'+i);el.value='';el.className='ans-input';}
  document.getElementById('sec6-fb').classList.add('hidden');document.getElementById('btn6r').classList.add('hidden');
  secDone[6]=false;secScores[6]=null;updateProgress();
  const btn=document.getElementById('btn6');btn.textContent='Athuga sv√∂r';btn.disabled=false;btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ SEC 7: FINNA L√ùSINGAROR√ê ‚Äì 3 OR√ê, SJ√ÅLFVIRKT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function buildSec7(){
  const rows=document.getElementById('sec7rows');
  for(let i=1;i<=3;i++){
    const div=document.createElement('div');div.className='flex items-center gap-3';
    div.innerHTML=`<span class="text-xs text-gray-400 font-light w-4">${i}.</span><input class="ans-input flex-1" id="s7w${i}" placeholder="L√Ωsingaror√∞..."/><input class="ans-input w-32" id="s7g${i}" placeholder="kyn..."/>`;
    rows.appendChild(div);
  }
})();

// Correct answers: n√Ωr(kk), gamalt(hk), skemmtileg(kvk)
const SEC7_ANSWERS=[
  {word:'n√Ωr',genders:['kk','karlkyn']},
  {word:'gamalt',genders:['hk','hvorugkyn']},
  {word:'skemmtileg',genders:['kvk','kvenkyn']},
];
function normG(s){return s.trim().toLowerCase().replace(/\./g,'');}

function checkSec7(){
  let correct=0;
  for(let i=1;i<=3;i++){
    const wEl=document.getElementById('s7w'+i);const gEl=document.getElementById('s7g'+i);
    const w=norm(wEl.value);const g=normG(gEl.value);
    const exp=SEC7_ANSWERS[i-1];
    const wOk=w===exp.word;
    const gOk=exp.genders.includes(g);
    if(wOk&&gOk){wEl.classList.add('correct-inp');gEl.classList.add('correct-inp');correct++;}
    else{
      if(!wOk)wEl.classList.add('wrong-inp');else wEl.classList.add('correct-inp');
      if(!gOk)gEl.classList.add('wrong-inp');else gEl.classList.add('correct-inp');
    }
  }
  const score=Math.round(correct/3*18);
  const allRight=correct===3;
  showFb('sec7-fb',`<div class="${allRight?'fb-ok':'fb-bad'}">
    <p class="font-normal mb-1">${correct}/3 r√©tt ‚Äì ${score}/18 stig</p>
    ${!allRight?`<p class="text-sm font-light mt-1">R√©tt sv√∂r: <strong>n√Ωr (kk)</strong>, <strong>gamalt (hk)</strong>, <strong>skemmtileg (kvk)</strong></p>`:''}
  </div>`);
  if(allRight){markDone(7,score);}
  else{
    setTimeout(()=>{
      document.querySelectorAll('#sec7rows .wrong-inp').forEach(el=>{el.classList.remove('wrong-inp');el.classList.remove('correct-inp');});
    },1500);
  }
}
function resetSec7(){
  for(let i=1;i<=3;i++){
    ['s7w','s7g'].forEach(pre=>{const el=document.getElementById(pre+i);el.value='';el.className=pre==='s7w'?'ans-input flex-1':'ans-input w-32';});
  }
  document.getElementById('sec7-fb').classList.add('hidden');document.getElementById('btn7r').classList.add('hidden');
  secDone[7]=false;secScores[7]=null;updateProgress();
  const btn=document.getElementById('btn7');btn.textContent='Athuga sv√∂r';btn.disabled=false;btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ SEC 8: SKRIFA UM MYND ‚Äì 2 SETNINGAR (AI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function checkSec8(){
  const sents=[document.getElementById('s8_1').value.trim(),document.getElementById('s8_2').value.trim()];
  if(sents.some(s=>!s)){showFb('sec8-fb','<p class="text-yellow-700 text-sm font-light">Skrifa√∞u b√°√∞ar setningar.</p>');return;}
  setLoading('btn8',true);
  try{
    const sys=`√û√∫ ert √≠slenskukennari sem metur ritun nemanda.
VERKEFNI: Nemandinn √°tti a√∞ skrifa 2 setningar um mynd af herbergi.
KR√ñFUR: (1) 2 setningar, (2) a.m.k. 2 l√Ωsingaror√∞ √≠ textanum alls, (3) hverri setningu a.m.k. 4 or√∞.
Gef√∞u einkunn 0-10 mi√∞a√∞ vi√∞ √æessar kr√∂fur og m√°lfr√¶√∞ilega n√°kv√¶mni.
SKILA√êU EINUNGIS JSON: {"score":N,"feedback":"hvetjandi endurgj√∂f √° √≠slensku, tilgreindu l√Ωsingaror√∞in sem notu√∞ voru og bentu √° villur ef einhverjar eru"}`;
    const res=await callAI([{role:'system',content:sys},{role:'user',content:sents.join('\n')}],400);
    const obj=JSON.parse(res);
    const score=Math.min(10,Math.max(0,obj.score||0));
    showFb('sec8-fb',`<div class="${score>=7?'fb-ok':'fb-bad'}"><p class="font-normal mb-1">Einkunn: ${score}/10 stig</p><p class="text-sm font-light">${obj.feedback}</p></div>`);
    markDone(8,score);
  }catch(e){showFb('sec8-fb','<p class="text-red-600 text-sm">Villa vi√∞ tengingu. Reyndu aftur.</p>');setLoading('btn8',false);}
}
function resetSec8(){
  ['s8_1','s8_2'].forEach(id=>{const el=document.getElementById(id);el.value='';el.className='ans-input mt-1';});
  document.getElementById('sec8-fb').classList.add('hidden');document.getElementById('btn8r').classList.add('hidden');
  secDone[8]=false;secScores[8]=null;updateProgress();
  const btn=document.getElementById('btn8');btn.textContent='Athuga sv√∂r';btn.disabled=false;btn.classList.add('bg-blue-600','hover:bg-blue-700');btn.classList.remove('bg-green-600');
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
buildBank2(shuf(WORDS2.map((w,i)=>({...w,id:w.word+'_'+i}))));
renderDndCard(0);
updateProgress();
</script>
</body>
</html>
