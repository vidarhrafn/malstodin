<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üÉè Flashcards - Kafli 5</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f0f9ff 0%, #e0f2fe 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    
    .flashcard {
      perspective: 1000px;
      cursor: pointer;
    }
    
    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .flashcard.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }
    
    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 2rem;
    }
    
    .flashcard-front {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .flashcard-back {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      transform: rotateY(180deg);
    }

    .card-enter {
      animation: cardEnter 0.5s ease-out;
    }

    @keyframes cardEnter {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .progress-bar {
      transition: width 0.5s ease-out;
    }

    .name-input {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .language-button {
      transition: all 0.2s;
    }

    .language-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Or√∞ √∫r kafla 5
    const VOCABULARY = [
      'fjall', 'foss', 'vatn', 'sk√≥gur', 'tr√©', 'gras', 'steinn', 'snj√≥r',
      's√≥l', 'vindur', 'rigning', 'snj√≥koma', 'rok', '√æoka', 'logn', 'regnbogi',
      'tjald', 'bakpoki', 'g√∂ngusk√≥r', 'vatnsflaska', 'nesti', 'g√∂ngustafir',
      'r√∫ta', 'b√≠ll', 'b√°tur', 'ferja', 'eyja', 'fj√∂r√∞ur', 'h√∂fn', 'selur',
      'hlaupahj√≥l', 's√≥lskin', 'fallegur', 'falleg', 'fallegt'
    ];

    // Tungum√°l sem √≠ bo√∞i eru
    const LANGUAGES = [
      { code: 'en', name: 'English', emoji: 'üá¨üáß' },
      { code: 'es', name: 'Espa√±ol', emoji: 'üá™üá∏' },
      { code: 'pl', name: 'Polski', emoji: 'üáµüá±' },
      { code: 'ar', name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', emoji: 'üá∏üá¶' },
      { code: 'th', name: '‡πÑ‡∏ó‡∏¢', emoji: 'üáπüá≠' },
      { code: 'zh', name: '‰∏≠Êñá', emoji: 'üá®üá≥' },
      { code: 'ja', name: 'Êó•Êú¨Ë™û', emoji: 'üáØüáµ' },
      { code: 'pt', name: 'Portugu√™s', emoji: 'üáµüáπ' },
      { code: 'fr', name: 'Fran√ßais', emoji: 'üá´üá∑' },
      { code: 'de', name: 'Deutsch', emoji: 'üá©üá™' },
      { code: 'ru', name: '–†—É—Å—Å–∫–∏–π', emoji: 'üá∑üá∫' },
      { code: 'vi', name: 'Ti·∫øng Vi·ªát', emoji: 'üáªüá≥' }
    ];

    // Helper function til a√∞ kalla √° OpenAI √≠ gegnum Netlify function
    async function callOpenAI(messages, max_tokens = 50, model = 'gpt-4o-mini', temperature = 0.3) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages, max_tokens, model, temperature })
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const FlashcardsGame = () => {
      const [gameStarted, setGameStarted] = useState(false);
      const [userLanguage, setUserLanguage] = useState('');
      const [languageInput, setLanguageInput] = useState('');
      const [currentCardIndex, setCurrentCardIndex] = useState(0);
      const [isFlipped, setIsFlipped] = useState(false);
      const [translation, setTranslation] = useState('');
      const [isLoadingTranslation, setIsLoadingTranslation] = useState(false);
      const [cardsLearned, setCardsLearned] = useState([]);
      const [shuffledVocab, setShuffledVocab] = useState([]);

      useEffect(() => {
        if (gameStarted && shuffledVocab.length === 0) {
          const shuffled = [...VOCABULARY].sort(() => Math.random() - 0.5);
          setShuffledVocab(shuffled);
        }
      }, [gameStarted]);

      const startGame = () => {
        if (languageInput.trim().length < 2) {
          alert('Vinsamlegast skrifa√∞u m√≥√∞urm√°li√∞ √æitt!');
          return;
        }
        setUserLanguage(languageInput.trim());
        setGameStarted(true);
      };

      const getTranslation = async (icelandicWord, targetLang) => {
        setIsLoadingTranslation(true);
        try {
          const translatedWord = await callOpenAI([
            {
              role: 'user',
              content: `Translate this Icelandic word to ${targetLang}: "${icelandicWord}". Reply with ONLY the translation, nothing else. No explanations, no extra text. If it's an adjective, give the most common form.`
            }
          ], 30, 'gpt-4o-mini', 0.3);
          
          setTranslation(translatedWord.trim());
        } catch (error) {
          console.error('Translation error:', error);
          setTranslation('(√æ√Ω√∞ing mist√≥kst)');
        } finally {
          setIsLoadingTranslation(false);
        }
      };

      const handleCardClick = async () => {
        if (!isFlipped) {
          setIsFlipped(true);
          if (!translation) {
            await getTranslation(shuffledVocab[currentCardIndex], userLanguage);
          }
        } else {
          setIsFlipped(false);
        }
      };

      const markAsLearned = () => {
        const currentWord = shuffledVocab[currentCardIndex];
        if (!cardsLearned.includes(currentWord)) {
          setCardsLearned([...cardsLearned, currentWord]);
        }
        nextCard();
      };

      const nextCard = () => {
        if (currentCardIndex < shuffledVocab.length - 1) {
          setCurrentCardIndex(currentCardIndex + 1);
          setIsFlipped(false);
          setTranslation('');
        }
      };

      const previousCard = () => {
        if (currentCardIndex > 0) {
          setCurrentCardIndex(currentCardIndex - 1);
          setIsFlipped(false);
          setTranslation('');
        }
      };

      const resetGame = () => {
        setCurrentCardIndex(0);
        setIsFlipped(false);
        setTranslation('');
        setCardsLearned([]);
        const shuffled = [...VOCABULARY].sort(() => Math.random() - 0.5);
        setShuffledVocab(shuffled);
      };

      // Language selection skj√°r
      if (!gameStarted) {
        return (
          <div className="min-h-screen pb-12">
            <header className="bg-white shadow-sm border-b border-gray-200">
              <div className="max-w-4xl mx-auto px-6 py-8">
                <button 
                  onClick={() => window.history.back()} 
                  className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
                >
                  ‚Üê Til baka
                </button>
                <h1 className="text-3xl font-light text-gray-800 mb-2">üÉè Flashcards</h1>
                <p className="text-gray-500 text-sm font-light">Kafli 5 - Esjan er falleg ¬∑ A1-A2</p>
              </div>
            </header>

            <main className="max-w-4xl mx-auto px-6 mt-8">
              
              {/* Instructions */}
              <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                <h2 className="text-xl font-normal text-gray-800 mb-3">üìù Hva√∞ er √æetta?</h2>
                <ul className="space-y-2 text-gray-700 font-light mb-4">
                  <li>‚Ä¢ √û√∫ munt sj√° {VOCABULARY.length} or√∞ √∫r kafla 5</li>
                  <li>‚Ä¢ Or√∞in eru √° √≠slensku</li>
                  <li>‚Ä¢ Smelltu √° spjaldi√∞ til a√∞ sj√° √æ√Ω√∞ingu √° √æ√≠nu tungum√°li</li>
                  <li>‚Ä¢ Merktu vi√∞ or√∞ sem √æ√∫ hefur l√¶rt!</li>
                </ul>
              </div>

              {/* Language input */}
              <div className="name-input bg-white rounded-lg shadow-xl p-12">
                <div className="text-6xl mb-6 text-center">üåç</div>
                <h2 className="text-3xl font-light text-gray-800 mb-4 text-center">
                  Hvert er m√≥√∞urm√°l √æitt?
                </h2>
                <p className="text-gray-600 font-light mb-8 text-center">
                  Skrifa√∞u nafn tungum√°lsins √æ√≠ns (t.d. English, Polski, ÿßŸÑÿπÿ±ÿ®Ÿäÿ©, ‡πÑ‡∏ó‡∏¢, ‰∏≠Êñá)
                </p>
                
                <input
                  type="text"
                  value={languageInput}
                  onChange={(e) => setLanguageInput(e.target.value)}
                  onKeyPress={(e) => {
                    if (e.key === 'Enter') {
                      startGame();
                    }
                  }}
                  placeholder="M√≥√∞urm√°l √æitt..."
                  className="w-full max-w-md mx-auto block px-6 py-4 text-xl border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 mb-6 text-center"
                  autoFocus
                />
                
                <div className="text-center">
                  <button
                    onClick={startGame}
                    className="bg-blue-600 text-white px-8 py-4 rounded-lg text-xl font-normal hover:bg-blue-700 transition-colors"
                  >
                    ‚ú® Byrja a√∞ l√¶ra
                  </button>
                </div>

                {/* D√¶mi */}
                <div className="mt-8 text-center">
                  <p className="text-sm text-gray-500 font-light mb-2">üí° D√¶mi:</p>
                  <div className="flex flex-wrap gap-2 justify-center">
                    {['English', 'Espa√±ol', 'Polski', 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', '‡πÑ‡∏ó‡∏¢', '‰∏≠Êñá', 'Portugu√™s'].map((lang) => (
                      <button
                        key={lang}
                        onClick={() => setLanguageInput(lang)}
                        className="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm transition-colors"
                      >
                        {lang}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

            </main>
          </div>
        );
      }

      // Finished skj√°r
      if (currentCardIndex >= shuffledVocab.length) {
        return (
          <div className="min-h-screen pb-12">
            <header className="bg-white shadow-sm border-b border-gray-200">
              <div className="max-w-4xl mx-auto px-6 py-8">
                <h1 className="text-3xl font-light text-gray-800 mb-2">üÉè Flashcards</h1>
                <p className="text-gray-500 text-sm font-light">Kafli 5 - Esjan er falleg ¬∑ A1-A2</p>
              </div>
            </header>

            <main className="max-w-4xl mx-auto px-6 mt-8">
              <div className="bg-white rounded-lg shadow-xl p-12 text-center">
                <div className="text-6xl mb-6">üéâ</div>
                <h2 className="text-3xl font-light text-gray-800 mb-4">
                  Til hamingju!
                </h2>
                <p className="text-xl text-gray-600 font-light mb-8">
                  √û√∫ hefur s√©√∞ √∂ll {shuffledVocab.length} or√∞in!
                </p>
                <div className="text-5xl font-bold text-blue-600 mb-8">
                  {cardsLearned.length} / {shuffledVocab.length} l√¶r√∞
                </div>
                <div className="flex gap-4 justify-center">
                  <button
                    onClick={resetGame}
                    className="bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-normal hover:bg-blue-700 transition-colors"
                  >
                    üîÑ Byrja aftur
                  </button>
                  <button
                    onClick={() => {
                      setGameStarted(false);
                      setUserLanguage('');
                      setLanguageInput('');
                      setCurrentCardIndex(0);
                      setCardsLearned([]);
                      setShuffledVocab([]);
                    }}
                    className="bg-gray-200 text-gray-700 px-8 py-4 rounded-lg text-lg font-normal hover:bg-gray-300 transition-colors"
                  >
                    üåç Breyta tungum√°li
                  </button>
                </div>
              </div>
            </main>
          </div>
        );
      }

      const currentWord = shuffledVocab[currentCardIndex];
      const progress = ((currentCardIndex + 1) / shuffledVocab.length) * 100;
      const isLearned = cardsLearned.includes(currentWord);

      // Flashcard skj√°r
      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <div className="flex items-center justify-between mb-4">
                <div>
                  <h1 className="text-2xl font-light text-gray-800">üÉè Flashcards</h1>
                  <p className="text-gray-500 text-sm font-light">
                    üåç {userLanguage}
                  </p>
                </div>
                <div className="text-right">
                  <div className="text-sm text-gray-500 font-light">L√¶r√∞ or√∞</div>
                  <div className="text-2xl font-bold text-blue-600">
                    {cardsLearned.length} / {shuffledVocab.length}
                  </div>
                </div>
              </div>
              
              {/* Progress bar */}
              <div className="w-full bg-gray-200 rounded-full h-3">
                <div 
                  className="progress-bar bg-blue-600 h-3 rounded-full"
                  style={{ width: `${progress}%` }}
                ></div>
              </div>
              <p className="text-xs text-gray-500 font-light mt-2 text-center">
                Or√∞ {currentCardIndex + 1} af {shuffledVocab.length}
              </p>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8">
            
            {/* Instructions */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-center">
              <p className="text-blue-800 font-light">
                üí° <strong>Smelltu √° spjaldi√∞</strong> til a√∞ sn√∫a √æv√≠ og sj√° √æ√Ω√∞ingu
              </p>
            </div>

            {/* Flashcard */}
            <div 
              className={`flashcard card-enter mb-6 ${isFlipped ? 'flipped' : ''}`}
              onClick={handleCardClick}
              style={{ height: '400px' }}
            >
              <div className="flashcard-inner">
                
                {/* Front - Icelandic */}
                <div className="flashcard-front shadow-2xl">
                  <div className="text-7xl font-bold mb-4">{currentWord}</div>
                  <div className="text-xl font-light opacity-80">√≠slenska</div>
                  {isLearned && (
                    <div className="absolute top-4 right-4 text-4xl">‚úÖ</div>
                  )}
                </div>

                {/* Back - Translation */}
                <div className="flashcard-back shadow-2xl">
                  {isLoadingTranslation ? (
                    <div>
                      <div className="text-4xl mb-4">‚è≥</div>
                      <div className="text-xl font-light">√û√Ω√∞i...</div>
                    </div>
                  ) : (
                    <div>
                      <div className="text-7xl font-bold mb-4">{translation}</div>
                      <div className="text-xl font-light opacity-80">
                        {userLanguage}
                      </div>
                    </div>
                  )}
                  {isLearned && (
                    <div className="absolute top-4 right-4 text-4xl">‚úÖ</div>
                  )}
                </div>

              </div>
            </div>

            {/* Controls */}
            <div className="flex gap-4 justify-center mb-6">
              <button
                onClick={previousCard}
                disabled={currentCardIndex === 0}
                className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-normal hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                ‚Üê Fyrra or√∞
              </button>
              
              <button
                onClick={markAsLearned}
                className={`px-8 py-3 rounded-lg font-normal transition-colors ${
                  isLearned
                    ? 'bg-green-600 text-white hover:bg-green-700'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                {isLearned ? '‚úÖ L√¶rt!' : '‚úì Merkja sem l√¶rt'}
              </button>

              <button
                onClick={nextCard}
                disabled={currentCardIndex === shuffledVocab.length - 1}
                className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-normal hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                N√¶sta or√∞ ‚Üí
              </button>
            </div>

            {/* Hint */}
            <div className="text-center">
              <p className="text-sm text-gray-500 font-light">
                ‚å®Ô∏è √û√∫ getur l√≠ka nota√∞ √∂rvatakkana til a√∞ fara √° milli or√∞a
              </p>
            </div>

          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<FlashcardsGame />);
  </script>
</body>
</html>
