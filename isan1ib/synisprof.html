<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pr√≥f 3 ‚Äì S√Ωnishorn</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.4s ease both; }
    @keyframes pulse-ring {
      0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.4); }
      70% { box-shadow: 0 0 0 10px rgba(34,197,94,0); }
      100% { box-shadow: 0 0 0 0 rgba(34,197,94,0); }
    }
    .speaking-pulse { animation: pulse-ring 1.2s infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ========== AI TENGINGAR ==========
    async function callOpenAI(messages, max_tokens = 300, model = 'gpt-4o-mini', temperature = 0.3) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages, max_tokens, model, temperature })
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    async function playAudio(text, onEnd) {
      try {
        const r = await fetch('/.netlify/functions/speak', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text_to_speak: text })
        });
        const data = await r.json();
        if (!r.ok || data.error || !data.audio_base64) { onEnd && onEnd(); return; }
        const audio = new Audio(`data:audio/mp3;base64,${data.audio_base64}`);
        audio.onended = () => onEnd && onEnd();
        audio.onerror = () => onEnd && onEnd();
        await audio.play().catch(() => onEnd && onEnd());
        return audio;
      } catch (e) {
        console.error(e);
        onEnd && onEnd();
      }
    }

    // ========== HJ√ÅLPAREININGAR ==========
    const ProgressBar = ({ current, total }) => (
      <div className="flex items-center gap-3 mb-6">
        {Array.from({ length: total }).map((_, i) => (
          <div key={i} className={`h-1.5 flex-1 rounded-full transition-all duration-500 ${i < current ? 'bg-green-500' : i === current ? 'bg-blue-400' : 'bg-gray-200'}`} />
        ))}
        <span className="text-xs text-gray-400 font-light whitespace-nowrap">{current}/{total}</span>
      </div>
    );

    const SectionHeader = ({ number, title, subtitle }) => (
      <div className="mb-6 fade-in">
        <div className="flex items-center gap-3 mb-1">
          <span className="w-7 h-7 rounded-full bg-blue-600 text-white text-sm flex items-center justify-center font-medium">{number}</span>
          <h2 className="text-lg font-medium text-gray-800">{title}</h2>
        </div>
        {subtitle && <p className="text-sm text-gray-500 font-light ml-10">{subtitle}</p>}
      </div>
    );

    const FeedbackBadge = ({ correct, score, message }) => {
      const color = correct === null ? 'blue' : correct ? 'green' : 'amber';
      const colors = {
        blue: 'bg-blue-50 border-blue-200 text-blue-700',
        green: 'bg-green-50 border-green-200 text-green-700',
        amber: 'bg-amber-50 border-amber-200 text-amber-700'
      };
      return (
        <div className={`mt-3 p-3 rounded-lg border ${colors[color]} fade-in`}>
          {score !== undefined && <div className="font-medium text-sm mb-1">Stig: {score}/5</div>}
          <p className="text-sm font-light">{message}</p>
        </div>
      );
    };

    const SpeakButton = ({ onClick, speaking, label }) => (
      <button
        onClick={onClick}
        className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-xl text-sm border transition-all ${speaking ? 'bg-green-50 text-green-700 border-green-200 speaking-pulse' : 'bg-gray-100 text-gray-600 border-gray-200 hover:bg-gray-200'}`}
      >
        <span className="opacity-70">üéß</span>
        <span className="font-light">{label || 'Hlusta√∞u'}</span>
        <span className={`text-green-600 ${speaking ? 'animate-pulse' : ''}`}>üîä</span>
      </button>
    );

    const NextButton = ({ onClick, disabled, last }) => (
      <button
        onClick={onClick}
        disabled={disabled}
        className="mt-6 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-sm"
      >
        {last ? '‚úì Lj√∫ka pr√≥fi' : 'N√¶sti li√∞ur ‚Üí'}
      </button>
    );

    // ========== LI√êUR 1: T√ñLUR ==========
    const TolurSection = ({ onComplete }) => {
      const [number] = useState(() => Math.floor(Math.random() * 200) + 1);
      const [speaking, setSpeaking] = useState(false);
      const [answer, setAnswer] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [feedback, setFeedback] = useState(null);

      const handleSpeak = async () => {
        setSpeaking(true);
        const words = numberToIcelandic(number);
        await playAudio(words, () => setSpeaking(false));
      };

      const handleSubmit = () => {
        const parsed = parseInt(answer.trim(), 10);
        const correct = parsed === number;
        setFeedback({
          correct,
          message: correct
            ? `R√©tt! Talan var ${number}.`
            : `Rangt. Talan var ${number}. √û√∫ skrifa√∞ir ${answer.trim()}.`
        });
        setSubmitted(true);
        onComplete(correct ? 5 : 0, number);
      };

      return (
        <div className="fade-in">
          <SectionHeader number="1" title="T√∂lur" subtitle="Hlusta√∞u √° t√∂luna og skrifa√∞u hana √≠ t√∂lust√∂fum." />

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div className="mb-5">
              <SpeakButton onClick={handleSpeak} speaking={speaking} label="Hlusta √° t√∂luna" />
              <p className="text-xs text-gray-400 font-light mt-2">√ùttu √° hnappinn til a√∞ heyra t√∂luna.</p>
            </div>

            <div className="flex gap-3 items-end">
              <div className="flex-1">
                <label className="block text-sm text-gray-600 font-light mb-1">Svari√∞ √æitt (√≠ t√∂lust√∂fum):</label>
                <input
                  type="number"
                  value={answer}
                  onChange={e => setAnswer(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && !submitted && answer && handleSubmit()}
                  disabled={submitted}
                  placeholder="t.d. 47"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-400 font-light text-lg disabled:bg-gray-50"
                />
              </div>
              {!submitted && (
                <button
                  onClick={handleSubmit}
                  disabled={!answer}
                  className="px-5 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light"
                >
                  Sta√∞festa
                </button>
              )}
            </div>

            {feedback && <FeedbackBadge correct={feedback.correct} message={feedback.message} />}
          </div>
        </div>
      );
    };

    // Tala √≠ √≠slenskar or√∞ (simplified)
    function numberToIcelandic(n) {
      const ones = ['', 'einn', 'tveir', '√ær√≠r', 'fj√≥rir', 'fimm', 'sex', 'sj√∂', '√°tta', 'n√≠u',
        't√≠u', 'ellefu', 't√≥lf', '√ærett√°n', 'fj√≥rt√°n', 'fimmt√°n', 'sext√°n', 'sautj√°n', '√°tj√°n', 'n√≠tj√°n'];
      const tens = ['', '', 'tuttugu', '√ærj√°t√≠u', 'fj√∂rut√≠u', 'fimmt√≠u', 'sext√≠u', 'sj√∂t√≠u', '√°ttat√≠u', 'n√≠ut√≠u'];
      if (n <= 19) return ones[n];
      if (n < 100) {
        const t = Math.floor(n / 10);
        const o = n % 10;
        return o === 0 ? tens[t] : `${tens[t]} og ${ones[o]}`;
      }
      if (n < 200) {
        const rest = n - 100;
        if (rest === 0) return 'eitt hundra√∞';
        return `eitt hundra√∞ og ${numberToIcelandic(rest)}`;
      }
      return `${n}`; // fallback
    }

    // ========== LI√êUR 2: STA√êIR ==========
    const Sta√∞irSection = ({ onComplete }) => {
      const [answer, setAnswer] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [feedback, setFeedback] = useState(null);
      const [loading, setLoading] = useState(false);

      const handleSubmit = async () => {
        if (!answer.trim()) return;
        setLoading(true);
        setSubmitted(true);
        try {
          const prompt = `√û√∫ ert √≠slenskukennari. Nemandinn var spur√∞ur: "Hva√∞ er h√¶gt a√∞ gera √≠ sk√≥la?" og svara√∞i: "${answer.trim()}"

Mettu svari√∞ √° kvar√∞anum 0-5:
- 5: Fr√°b√¶rt! R√©tt svar og skiljanlegt (t.d. "a√∞ l√¶ra", "a√∞ lesa", "a√∞ hlusta", "a√∞ skrifa", "a√∞ tala vi√∞ vini", "a√∞ bor√∞a √≠ matsal" osfrv.)
- 3-4: Gott svar, sm√° villa √≠ m√°lfr√¶√∞i e√∞a stafasetningu en skiljanlegt
- 1-2: Reyndi en svari√∞ er ekki mj√∂g r√©tt e√∞a skiljanlegt
- 0: Svara√∞i ekki e√∞a alveg rangt

Svar √° √≠slensku. Svara√∞u EINUNGIS √° √æessu formi:
STIG: [tala 0-5]
ENDURGJ√ñF: [ein setning, vinaleg og hvetjandi]`;

          const result = await callOpenAI([{ role: 'user', content: prompt }], 100, 'gpt-4o-mini', 0.2);
          const stigMatch = result.match(/STIG:\s*(\d)/);
          const endurgjofMatch = result.match(/ENDURGJ√ñF:\s*(.+)/);
          const score = stigMatch ? parseInt(stigMatch[1]) : 3;
          const msg = endurgjofMatch ? endurgjofMatch[1].trim() : result.trim();
          setFeedback({ score, message: msg });
          onComplete(score, answer.trim());
        } catch (e) {
          setFeedback({ score: 0, message: 'Villa vi√∞ mat. Reyndu aftur.' });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <SectionHeader number="2" title="Sta√∞ir" subtitle="Svara√∞u spurningunni me√∞ fullri setningu e√∞a or√∞um." />

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div className="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-5">
              <p className="text-blue-800 font-medium text-lg text-center">Hva√∞ er h√¶gt a√∞ gera √≠ sk√≥la?</p>
            </div>

            <label className="block text-sm text-gray-600 font-light mb-1">Svari√∞ √æitt:</label>
            <textarea
              value={answer}
              onChange={e => setAnswer(e.target.value)}
              disabled={submitted}
              placeholder=""
              rows={3}
              className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-400 font-light resize-none disabled:bg-gray-50"
            />

            {!submitted && (
              <button
                onClick={handleSubmit}
                disabled={!answer.trim() || loading}
                className="mt-3 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-sm"
              >
                {loading ? 'Mat...' : 'Sta√∞festa'}
              </button>
            )}

            {loading && (
              <div className="mt-3 text-sm text-gray-400 font-light animate-pulse">OpenAI er a√∞ meta svari√∞...</div>
            )}

            {feedback && !loading && (
              <FeedbackBadge correct={feedback.score >= 3} score={feedback.score} message={feedback.message} />
            )}
          </div>
        </div>
      );
    };

    // ========== LI√êUR 3: LITUR OG HLUTUR ==========
    const LiturSection = ({ onComplete }) => {
      const [answer, setAnswer] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [feedback, setFeedback] = useState(null);
      const [loading, setLoading] = useState(false);

      const handleSubmit = async () => {
        if (!answer.trim()) return;
        setLoading(true);
        setSubmitted(true);
        try {
          const prompt = `√û√∫ ert √≠slenskukennari sem pr√≥f ar kynbeygingu √≠ √≠slensku. Nemandinn s√©r mynd af guli peysu.

R√âTT SVAR ER N√ÅKV√ÜMLEGA: "gul peysa"
- Peysa er kvenkynsor√∞ ‚Üí litaror√∞i√∞ √° a√∞ vera √≠ kvenkyni: "gul" (ekki "gulur" sem er karlkyn, ekki "gult" sem er hvorugkyn)

Nemandinn svara√∞i: "${answer.trim()}"

Mettu svari√∞ STRANGLEGA:
- 5: B√¶√∞i or√∞in r√©tt OG kynbeyg√∞ r√©tt: "gul peysa" e√∞a "peysan er gul" (kvenkynsform)
- 3: Hluturinn (peysa) er r√©tt en liturinn er √≠ r√∂ngu kyni (t.d. "gulur peysa" e√∞a "gult peysa")
- 2: Liturinn er r√©tt beyg√∞ur (gul) en hluturinn er rangt (t.d. "gul skyrta")
- 0: B√¶√∞i rangt e√∞a √≥skiljanleg sv√∂r

MIKILV√ÜGT: Kyn skiptir m√°li h√©r. "gulur" og "gult" eru RANGAR kynbeygingarnar fyrir peysu.

Svar √° √≠slensku. Svara√∞u EINUNGIS √° √æessu formi:
STIG: [tala 0-5]
ENDURGJ√ñF: [ein setning sem √∫tsk√Ωrir hvort kynbeyg√≠ng var r√©tt]`;

          const result = await callOpenAI([{ role: 'user', content: prompt }], 80, 'gpt-4o-mini', 0.1);
          const stigMatch = result.match(/STIG:\s*(\d)/);
          const endurgjofMatch = result.match(/ENDURGJ√ñF:\s*(.+)/);
          const score = stigMatch ? parseInt(stigMatch[1]) : 2;
          const msg = endurgjofMatch ? endurgjofMatch[1].trim() : result.trim();
          setFeedback({ score, message: msg });
          onComplete(score, answer.trim());
        } catch (e) {
          setFeedback({ score: 0, message: 'Villa vi√∞ mat.' });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <SectionHeader number="3" title="Litur og hlutur" subtitle="Nefndu lit og hlut sem √æ√∫ s√©r√∞ √° myndinni." />

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div className="mb-5 rounded-lg overflow-hidden border border-gray-100 mx-auto" style={{ maxWidth: '280px' }}>
              <img
                src="media/gulpeysa.jpg"
                alt="Mynd til a√∞ l√Ωsa"
                className="w-full h-auto object-cover"
              />
            </div>

            <label className="block text-sm text-gray-600 font-light mb-1">L√Ωstu myndinni (litur + hlutur):</label>
            <input
              type="text"
              value={answer}
              onChange={e => setAnswer(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && !submitted && answer && handleSubmit()}
              disabled={submitted}
              placeholder="litur + hlutur"
              className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-400 font-light disabled:bg-gray-50"
            />

            {!submitted && (
              <button
                onClick={handleSubmit}
                disabled={!answer.trim() || loading}
                className="mt-3 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-sm"
              >
                Sta√∞festa
              </button>
            )}

            {loading && <div className="mt-3 text-sm text-gray-400 font-light animate-pulse">Mat...</div>}
            {feedback && !loading && (
              <FeedbackBadge correct={feedback.score >= 3} score={feedback.score} message={feedback.message} />
            )}
          </div>
        </div>
      );
    };

    // ========== LI√êUR 4: ANDST√Ü√êUR ==========
    const Andst√¶√∞urSection = ({ onComplete }) => {
      const [word1, setWord1] = useState('');
      const [word2, setWord2] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [feedback, setFeedback] = useState(null);
      const [loading, setLoading] = useState(false);

      const handleSubmit = async () => {
        if (!word1.trim() || !word2.trim()) return;
        setLoading(true);
        setSubmitted(true);
        try {
          const prompt = `√û√∫ ert √≠slenskukennari. Nemandinn √° a√∞ skrifa tv√¶r andst√¶√∞ur √° √≠slensku.
Nemandinn skrifa√∞i: "${word1.trim()}" og "${word2.trim()}"

Mettu hvort √æetta s√©u andst√¶√∞ur:
- 5: J√°, √æetta eru andst√¶√∞ur (t.d. heitur/kaldur, st√≥r/l√≠till, j√°/nei, dagur/n√≥tt) - kyn skiptir ekki m√°li, sm√°v√¶gilegar stafsetningarvillur eru √≠ lagi
- 3: N√°nast andst√¶√∞ur e√∞a tengd hugt√∂k
- 0: √ûetta eru ekki andst√¶√∞ur

Svar √° √≠slensku. Svara√∞u EINUNGIS √° √æessu formi:
STIG: [tala 0-5]
ENDURGJ√ñF: [ein setning, vinaleg]`;

          const result = await callOpenAI([{ role: 'user', content: prompt }], 80, 'gpt-4o-mini', 0.1);
          const stigMatch = result.match(/STIG:\s*(\d)/);
          const endurgjofMatch = result.match(/ENDURGJ√ñF:\s*(.+)/);
          const score = stigMatch ? parseInt(stigMatch[1]) : 2;
          const msg = endurgjofMatch ? endurgjofMatch[1].trim() : result.trim();
          setFeedback({ score, message: msg });
          onComplete(score, `${word1.trim()} ‚Äì ${word2.trim()}`);
        } catch (e) {
          setFeedback({ score: 0, message: 'Villa vi√∞ mat.' });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <SectionHeader number="4" title="Andst√¶√∞ur" subtitle="Skrifa√∞u tv√¶r andst√¶√∞ur √° √≠slensku √≠ reitina." />

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div className="bg-purple-50 border border-purple-100 rounded-lg p-4 mb-5 text-center">
              <p className="text-purple-800 font-medium">Nefndu andst√¶√∞ur</p>
            </div>

            <div className="flex gap-2 items-center">
              <input
                type="text"
                value={word1}
                onChange={e => setWord1(e.target.value)}
                disabled={submitted}
                placeholder=""
                className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-400 font-light disabled:bg-gray-50 text-center"
              />
              <div className="flex flex-col items-center justify-center text-gray-300 text-xl leading-none select-none px-1">
                <span>‚áê</span>
                <span>‚áí</span>
              </div>
              <input
                type="text"
                value={word2}
                onChange={e => setWord2(e.target.value)}
                onKeyDown={e => e.key === 'Enter' && !submitted && word1 && word2 && handleSubmit()}
                disabled={submitted}
                placeholder=""
                className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-400 font-light disabled:bg-gray-50 text-center"
              />
            </div>

            {!submitted && (
              <button
                onClick={handleSubmit}
                disabled={!word1.trim() || !word2.trim() || loading}
                className="mt-4 px-5 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-sm"
              >
                Sta√∞festa
              </button>
            )}

            {loading && <div className="mt-3 text-sm text-gray-400 font-light animate-pulse">Mat...</div>}
            {feedback && !loading && (
              <FeedbackBadge correct={feedback.score >= 3} score={feedback.score} message={feedback.message} />
            )}
          </div>
        </div>
      );
    };


    // ========== LI√êUR 5: OR√êAFOR√êI ==========
    const EldhusSection = ({ onComplete }) => {
      const [answer, setAnswer] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [feedback, setFeedback] = useState(null);
      const [loading, setLoading] = useState(false);

      const handleSubmit = async () => {
        if (!answer.trim()) return;
        setLoading(true);
        setSubmitted(true);
        try {
          const prompt = `√û√∫ ert √≠slenskukennari. Nemandinn s√©r mynd af eldh√∫si og er spur√∞ur: "Hva√∞a herbergi er √æetta?"
Nemandinn svara√∞i: "${answer.trim()}"

Mettu svari√∞:
- 5: Svari√∞ er "eldh√∫s" e√∞a n√°l√¶gt (sm√°v√¶gilegar stafsetningarvillur eru √≠ lagi, t.d. "eldhus", "eldh√πs")
- 0: Rangt herbergi e√∞a √≥skiljanleg sv√∂r

Svar √° √≠slensku. Svara√∞u EINUNGIS √° √æessu formi:
STIG: [tala 0-5]
ENDURGJ√ñF: [ein setning]`;

          const result = await callOpenAI([{ role: 'user', content: prompt }], 80, 'gpt-4o-mini', 0.1);
          const stigMatch = result.match(/STIG:\s*(\d)/);
          const endurgjofMatch = result.match(/ENDURGJ√ñF:\s*(.+)/);
          const score = stigMatch ? parseInt(stigMatch[1]) : 0;
          const msg = endurgjofMatch ? endurgjofMatch[1].trim() : result.trim();
          setFeedback({ score, message: msg });
          onComplete(score, answer.trim());
        } catch (e) {
          setFeedback({ score: 0, message: 'Villa vi√∞ mat.' });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <SectionHeader number="5" title="Or√∞afor√∞i" subtitle="Svara√∞u spurningunni um myndina." />

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div className="mb-5 rounded-lg overflow-hidden border border-gray-100 mx-auto" style={{ maxWidth: '320px' }}>
              <img
                src="media/eldhus.png"
                alt="Mynd af herbergi"
                className="w-full h-auto object-cover"
              />
            </div>

            <div className="bg-green-50 border border-green-100 rounded-lg p-4 mb-5 text-center">
              <p className="text-green-800 font-medium">Hva√∞a herbergi er √æetta?</p>
            </div>

            <label className="block text-sm text-gray-600 font-light mb-1">Svari√∞ √æitt:</label>
            <input
              type="text"
              value={answer}
              onChange={e => setAnswer(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && !submitted && answer && handleSubmit()}
              disabled={submitted}
              placeholder=""
              className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-400 font-light disabled:bg-gray-50"
            />

            {!submitted && (
              <button
                onClick={handleSubmit}
                disabled={!answer.trim() || loading}
                className="mt-3 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-sm"
              >
                Sta√∞festa
              </button>
            )}

            {loading && <div className="mt-3 text-sm text-gray-400 font-light animate-pulse">Mat...</div>}
            {feedback && !loading && (
              <FeedbackBadge correct={feedback.score >= 3} score={feedback.score} message={feedback.message} />
            )}
          </div>
        </div>
      );
    };

    // ========== NI√êURST√ñ√êUR ==========
    const Results = ({ scores, answers }) => {
      const total = scores.reduce((a, b) => a + b, 0);
      const max = scores.length * 5;
      const pct = Math.round((total / max) * 100);
      const labels = ['T√∂lur', 'Sta√∞ir', 'Litur og hlutur', 'Andst√¶√∞ur', 'Or√∞afor√∞i'];

      return (
        <div className="fade-in">
          <div className="text-center mb-8">
            <div className="text-6xl mb-3">{pct >= 80 ? 'üéâ' : pct >= 50 ? 'üëè' : 'üí™'}</div>
            <h2 className="text-2xl font-light text-gray-800 mb-1">Pr√≥fi loki√∞!</h2>
            <div className="text-4xl font-medium text-blue-600">{total}/{max}</div>
            <p className="text-gray-500 font-light mt-1">{pct}%</p>
          </div>

          <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-4">
            {labels.map((label, i) => (
              <div key={i} className="flex items-center gap-4">
                <div className="w-32 text-sm text-gray-600 font-light">{label}</div>
                <div className="flex-1 bg-gray-100 rounded-full h-2">
                  <div
                    className={`h-2 rounded-full transition-all duration-700 ${scores[i] >= 4 ? 'bg-green-500' : scores[i] >= 2 ? 'bg-amber-400' : 'bg-red-400'}`}
                    style={{ width: `${(scores[i] / 5) * 100}%` }}
                  />
                </div>
                <div className="text-sm text-gray-600 font-light w-10 text-right">{scores[i]}/5</div>
              </div>
            ))}
          </div>

          <div className="mt-6 bg-white rounded-xl shadow-sm border border-gray-100 p-5">
            <h3 className="text-sm font-medium text-gray-600 mb-3">Sv√∂r √æ√≠n</h3>
            {labels.map((label, i) => (
              <div key={i} className="flex gap-3 text-sm py-1.5 border-b border-gray-50 last:border-0">
                <span className="text-gray-400 font-light w-32">{label}</span>
                <span className="text-gray-700 font-light">{answers[i] || '‚Äî'}</span>
              </div>
            ))}
          </div>

          <div className="mt-6 text-center">
            <button
              onClick={() => window.location.reload()}
              className="px-6 py-3 border-2 border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors font-light text-sm"
            >
              ‚Ü∫ Reyna aftur
            </button>
          </div>
        </div>
      );
    };

    // ========== A√êALFORRIT ==========
    const ProfApp = () => {
      const [section, setSection] = useState(0); // 0=t√∂lur,1=sta√∞ir,2=litur,3=andst√¶√∞ur,4=or√∞afor√∞i,5=ni√∞ursta√∞a
      const [scores, setScores] = useState([0, 0, 0, 0, 0]);
      const [answers, setAnswers] = useState(['', '', '', '', '']);
      const [sectionDone, setSectionDone] = useState(false);

      const handleComplete = (score, answer) => {
        const newScores = [...scores];
        const newAnswers = [...answers];
        newScores[section] = score;
        newAnswers[section] = answer;
        setScores(newScores);
        setAnswers(newAnswers);
        setSectionDone(true);
      };

      const goNext = () => {
        setSectionDone(false);
        if (section + 1 >= 5) { setSection(5); } else { setSection(s => s + 1); }
      };

      const sections = [
        <TolurSection onComplete={handleComplete} />,
        <Sta√∞irSection onComplete={handleComplete} />,
        <LiturSection onComplete={handleComplete} />,
        <Andst√¶√∞urSection onComplete={handleComplete} />,
        <EldhusSection onComplete={handleComplete} />,
      ];

      return (
        <div className="min-h-screen pb-16">
          {/* Header */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-2xl mx-auto px-6 py-8">
              <button onClick={() => window.history.back()} className="text-sm text-gray-400 hover:text-gray-600 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-1">Pr√≥f 3 ‚Äì S√Ωnishorn</h1>
              <p className="text-gray-400 text-sm font-light">M√°lst√∂√∞in ‚Ä¢ S√Ωnishorn</p>
            </div>
          </header>

          <main className="max-w-2xl mx-auto px-6 mt-8">
            {section < 5 && <ProgressBar current={section} total={5} />}

            {section < 5 ? (
              <div>
                {sections[section]}

                {sectionDone && (
                  <NextButton
                    onClick={goNext}
                    disabled={false}
                    last={section === 4}
                  />
                )}
              </div>
            ) : (
              <Results scores={scores} answers={answers} />
            )}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<ProfApp />);
  </script>
</body>
</html>
