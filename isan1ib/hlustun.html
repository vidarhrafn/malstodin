<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéß Hlusta√∞u og pakka√∞u</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    
    .item-card {
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: grab;
      user-select: none;
    }
    
    .item-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .item-card.correct {
      background: #dcfce7 !important;
      border-color: #22c55e !important;
    }
    
    .item-card.wrong {
      background: #fee2e2 !important;
      border-color: #ef4444 !important;
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    .backpack {
      min-height: 180px;
      transition: background-color 0.3s;
    }
    
    .backpack.drag-over {
      background-color: #dbeafe !important;
      border-color: #3b82f6 !important;
    }

    .audio-button {
      transition: all 0.3s;
    }

    .audio-button.playing {
      animation: pulse-audio 1.5s infinite;
    }

    @keyframes pulse-audio {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Azure TTS function
    async function playAudio(text, setIsPlaying) {
      setIsPlaying(true);
      try {
        const r = await fetch('/.netlify/functions/speak', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text_to_speak: text })
        });
        const data = await r.json();
        
        if (!r.ok || data.error || !data.audio_base64) {
          console.error('Villa √≠ hlj√≥√∞kalli:', data?.error);
          setIsPlaying(false);
          return;
        }
        
        const audio = new Audio(`data:audio/mp3;base64,${data.audio_base64}`);
        audio.onended = () => setIsPlaying(false);
        audio.onerror = () => setIsPlaying(false);
        await audio.play().catch(() => setIsPlaying(false));
      } catch (e) {
        console.error('Tenging mist√≥kst:', e);
        setIsPlaying(false);
      }
    }

    const SCENARIOS = [
      {
        id: 1,
        title: 'üèîÔ∏è Fjallganga √° Esju',
        text: 'Hall√≥! √âg heiti Anna. √ç dag √¶tla √©g √≠ fjallg√∂ngu √° Esju. Ve√∞ri√∞ er gott, √æa√∞ er s√≥lskin. √âg √æarf a√∞ taka me√∞ m√©r bakpoka, g√∂ngusk√≥, vatnsfl√∂sku og nesti. √ûetta ver√∞ur skemmtilegt!',
        correctItems: ['fjall', 'bakpoki', 'g√∂ngusk√≥r', 'vatnsflaska', 'nesti', 's√≥l'],
        allItems: ['fjall', 'bakpoki', 'g√∂ngusk√≥r', 'vatnsflaska', 'nesti', 's√≥l', 'tjald', 'ferja', 'rigning', 'snj√≥r', 'b√°tur', 'b√≠ll']
      },
      {
        id: 2,
        title: '‚õ∫ Tjalda√∞ √≠ √û√≥rsm√∂rk',
        text: 'G√≥√∞an daginn. √âg heiti J√≥n. Um helgina √¶tla √©g a√∞ tjalda √≠ √û√≥rsm√∂rk. √âg √æarf tjald, bakpoka, g√∂ngusk√≥ og g√∂ngustafi. √âg tek l√≠ka me√∞ nesti og vatnsfl√∂sku. √âg hlakka til!',
        correctItems: ['tjald', 'bakpoki', 'g√∂ngusk√≥r', 'g√∂ngustafir', 'nesti', 'vatnsflaska'],
        allItems: ['tjald', 'bakpoki', 'g√∂ngusk√≥r', 'g√∂ngustafir', 'nesti', 'vatnsflaska', 'ferja', 'b√≠ll', 'r√∫ta', 'snj√≥r', 'rigning', '√æoka']
      },
      {
        id: 3,
        title: '‚õ¥Ô∏è Fer√∞ til Vestmannaeyja',
        text: 'H√¶! √âg √¶tla a√∞ fara til Vestmannaeyja. √âg tek ferju til eyjarinnar. √ûar vona √©g a√∞ sj√° seli vi√∞ h√∂fnina. Ve√∞ri√∞ er gott, √æa√∞ er logn √≠ dag.',
        correctItems: ['ferja', 'eyja', 'h√∂fn', 'selur', 'logn'],
        allItems: ['ferja', 'eyja', 'h√∂fn', 'selur', 'logn', 'tjald', 'snj√≥r', 'fjall', 'g√∂ngusk√≥r', 'bakpoki', 'vindur', 'rok']
      },
      {
        id: 4,
        title: 'üåßÔ∏è Heims√≥kn a√∞ Gullfossi',
        text: '√âg √¶tla a√∞ heims√¶kja Gullfoss √≠ dag. Ve√∞ri√∞ er ekki gott. √ûa√∞ er rigning og rok. En √©g vil sj√° √æennan fallega foss. √âg tek bakpoka og vatnsfl√∂sku me√∞.',
        correctItems: ['foss', 'rigning', 'rok', 'bakpoki', 'vatnsflaska'],
        allItems: ['foss', 'rigning', 'rok', 'bakpoki', 'vatnsflaska', 's√≥l', 'logn', 'tjald', 'g√∂ngusk√≥r', 'ferja', 'snj√≥r', 'eyja']
      },
      {
        id: 5,
        title: 'üèûÔ∏è Ganga √≠ Kjarnask√≥g',
        text: '√ç dag fer √©g √≠ g√∂ngufer√∞ √≠ Kjarnask√≥g. √ûar eru falleg tr√© og gr√¶nt gras. Ve√∞ri√∞ er fr√°b√¶rt, √æa√∞ er s√≥lskin og logn. √âg tek g√∂ngusk√≥ og nesti me√∞.',
        correctItems: ['sk√≥gur', 'tr√©', 'gras', 's√≥l', 'logn', 'g√∂ngusk√≥r', 'nesti'],
        allItems: ['sk√≥gur', 'tr√©', 'gras', 's√≥l', 'logn', 'g√∂ngusk√≥r', 'nesti', 'foss', 'fjall', 'ferja', 'tjald', 'rigning']
      },
      {
        id: 6,
        title: '‚ùÑÔ∏è B√≠lt√∫r um h√°lendi√∞',
        text: 'Um helgina √¶tla √©g a√∞ keyra um h√°lendi√∞ √≠ b√≠lnum m√≠num. √ûa√∞ er mikill snj√≥r √æar. √ûa√∞ er l√≠ka snj√≥koma √≠ ve√∞ursp√°nni. √âg tek bakpoka og vatnsfl√∂sku me√∞.',
        correctItems: ['b√≠ll', 'snj√≥r', 'snj√≥koma', 'bakpoki', 'vatnsflaska'],
        allItems: ['b√≠ll', 'snj√≥r', 'snj√≥koma', 'bakpoki', 'vatnsflaska', 's√≥l', 'ferja', 'g√∂ngusk√≥r', 'tjald', 'rigning', 'b√°tur', 'logn']
      },
      {
        id: 7,
        title: 'üåà Eftir rigninguna',
        text: '√ûa√∞ var a√∞ rigna en n√∫na er komi√∞ s√≥lskin. √âg √¶tla a√∞ ganga a√∞ fossi. Kannski s√© √©g regnboga! Vatni√∞ vi√∞ fossinn er fallegt. √âg tek g√∂ngusk√≥ me√∞.',
        correctItems: ['rigning', 's√≥l', 'foss', 'regnbogi', 'vatn', 'g√∂ngusk√≥r'],
        allItems: ['rigning', 's√≥l', 'foss', 'regnbogi', 'vatn', 'g√∂ngusk√≥r', 'snj√≥r', 'tjald', 'ferja', 'b√≠ll', '√æoka', 'rok']
      },
      {
        id: 8,
        title: 'üå´Ô∏è Morgunn vi√∞ fj√∂r√∞inn',
        text: 'Snemma √° morgnana er mikil √æoka vi√∞ fj√∂r√∞inn. √ûegar √æa√∞ er logn er vatni√∞ mj√∂g fallegt. Stundum s√© √©g b√°t sigla √° fj√∂r√∞inum.',
        correctItems: ['√æoka', 'fj√∂r√∞ur', 'logn', 'vatn', 'b√°tur'],
        allItems: ['√æoka', 'fj√∂r√∞ur', 'logn', 'vatn', 'b√°tur', 's√≥l', 'vindur', 'rok', 'tjald', 'g√∂ngusk√≥r', 'ferja', 'snj√≥r']
      }
    ];

    const ALL_ITEMS = [
      { id: 'fjall', name: 'fjall', emoji: '‚õ∞Ô∏è' },
      { id: 'foss', name: 'foss', emoji: 'üíß' },
      { id: 'vatn', name: 'vatn', emoji: 'üí¶' },
      { id: 'sk√≥gur', name: 'sk√≥gur', emoji: 'üå≤' },
      { id: 'tr√©', name: 'tr√©', emoji: 'üå≥' },
      { id: 'gras', name: 'gras', emoji: 'üå±' },
      { id: 'snj√≥r', name: 'snj√≥r', emoji: '‚ùÑÔ∏è' },
      { id: 's√≥l', name: 's√≥l', emoji: '‚òÄÔ∏è' },
      { id: 'vindur', name: 'vindur', emoji: 'üí®' },
      { id: 'rigning', name: 'rigning', emoji: 'üåßÔ∏è' },
      { id: 'snj√≥koma', name: 'snj√≥koma', emoji: 'üå®Ô∏è' },
      { id: 'tjald', name: 'tjald', emoji: '‚õ∫' },
      { id: 'bakpoki', name: 'bakpoki', emoji: 'üéí' },
      { id: 'r√∫ta', name: 'r√∫ta', emoji: 'üöå' },
      { id: 'b√≠ll', name: 'b√≠ll', emoji: 'üöó' },
      { id: 'b√°tur', name: 'b√°tur', emoji: '‚õµ' },
      { id: 'ferja', name: 'ferja', emoji: '‚õ¥Ô∏è' },
      { id: 'g√∂ngusk√≥r', name: 'g√∂ngusk√≥r', emoji: 'üëü' },
      { id: 'vatnsflaska', name: 'vatnsflaska', emoji: 'üßÉ' },
      { id: 'nesti', name: 'nesti', emoji: 'ü•™' },
      { id: 'rok', name: 'rok', emoji: 'üå¨Ô∏è' },
      { id: '√æoka', name: '√æoka', emoji: 'üå´Ô∏è' },
      { id: 'logn', name: 'logn', emoji: 'üòå' },
      { id: 'regnbogi', name: 'regnbogi', emoji: 'üåà' },
      { id: 'eyja', name: 'eyja', emoji: 'üèùÔ∏è' },
      { id: 'fj√∂r√∞ur', name: 'fj√∂r√∞ur', emoji: 'üåä' },
      { id: 'h√∂fn', name: 'h√∂fn', emoji: '‚öì' },
      { id: 'g√∂ngustafir', name: 'g√∂ngustafir', emoji: 'ü•¢' },
      { id: 'selur', name: 'selur', emoji: 'ü¶≠' }
    ];

    const ListeningGame = () => {
      const [currentScenario, setCurrentScenario] = useState(0);
      const [selectedItems, setSelectedItems] = useState([]);
      const [availableItems, setAvailableItems] = useState([]);
      const [showResult, setShowResult] = useState(false);
      const [score, setScore] = useState(0);
      const [feedback, setFeedback] = useState({ correct: [], wrong: [], missing: [] });
      const [gameFinished, setGameFinished] = useState(false);
      const [isPlaying, setIsPlaying] = useState(false);
      const [showTranscript, setShowTranscript] = useState(false);
      const [hasPlayedOnce, setHasPlayedOnce] = useState(false);

      useEffect(() => {
        loadScenario();
      }, [currentScenario]);

      const loadScenario = () => {
        const scenario = SCENARIOS[currentScenario];
        const shuffled = scenario.allItems
          .map(itemId => ALL_ITEMS.find(item => item.id === itemId))
          .filter(Boolean)
          .sort(() => Math.random() - 0.5);
        
        setAvailableItems(shuffled);
        setSelectedItems([]);
        setShowResult(false);
        setShowTranscript(false);
        setHasPlayedOnce(false);
        setFeedback({ correct: [], wrong: [], missing: [] });
      };

      const handlePlayAudio = async () => {
        const scenario = SCENARIOS[currentScenario];
        setHasPlayedOnce(true);
        await playAudio(scenario.text, setIsPlaying);
      };

      const handleDragStart = (e, item) => {
        e.dataTransfer.setData('itemId', item.id);
      };

      const handleDrop = (e) => {
        e.preventDefault();
        const itemId = e.dataTransfer.getData('itemId');
        const item = availableItems.find(i => i.id === itemId);
        
        if (item && !selectedItems.find(i => i.id === itemId)) {
          setSelectedItems([...selectedItems, item]);
        }
        
        e.currentTarget.classList.remove('drag-over');
      };

      const handleDragOver = (e) => {
        e.preventDefault();
        e.currentTarget.classList.add('drag-over');
      };

      const handleDragLeave = (e) => {
        e.currentTarget.classList.remove('drag-over');
      };

      const removeItem = (itemId) => {
        setSelectedItems(selectedItems.filter(i => i.id !== itemId));
      };

      const checkAnswer = () => {
        const scenario = SCENARIOS[currentScenario];
        const selectedIds = selectedItems.map(i => i.id);
        
        const correct = selectedIds.filter(id => scenario.correctItems.includes(id));
        const wrong = selectedIds.filter(id => !scenario.correctItems.includes(id));
        const missing = scenario.correctItems.filter(id => !selectedIds.includes(id));
        
        setFeedback({ correct, wrong, missing });
        setShowResult(true);
        
        if (wrong.length === 0 && missing.length === 0) {
          setScore(score + 1);
        }
      };

      const nextScenario = () => {
        if (currentScenario < SCENARIOS.length - 1) {
          setCurrentScenario(currentScenario + 1);
        } else {
          setGameFinished(true);
        }
      };

      const resetGame = () => {
        setCurrentScenario(0);
        setScore(0);
        setGameFinished(false);
        loadScenario();
      };

      const scenario = SCENARIOS[currentScenario];

      if (gameFinished) {
        return (
          <div className="min-h-screen pb-12">
            <header className="bg-white shadow-sm border-b border-gray-200">
              <div className="max-w-4xl mx-auto px-6 py-8">
                <h1 className="text-3xl font-light text-gray-800 mb-2">üéß Hlusta√∞u og pakka√∞u</h1>
                <p className="text-gray-500 text-sm font-light">Kafli 5 - Esjan er falleg ¬∑ A1-A2</p>
              </div>
            </header>

            <main className="max-w-4xl mx-auto px-6 mt-8">
              <div className="bg-white rounded-lg shadow-xl p-12 text-center">
                <div className="text-6xl mb-6">üéâ</div>
                <h2 className="text-3xl font-light text-gray-800 mb-4">Til hamingju!</h2>
                <p className="text-xl text-gray-600 font-light mb-8">
                  √û√∫ kl√°ra√∞ir allar {SCENARIOS.length} hlustanir!
                </p>
                <div className="text-5xl font-bold text-blue-600 mb-8">
                  {score} / {SCENARIOS.length}
                </div>
                <button
                  onClick={resetGame}
                  className="bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-normal hover:bg-blue-700 transition-colors"
                >
                  üîÑ Spila aftur
                </button>
              </div>
            </main>
          </div>
        );
      }

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button 
                onClick={() => window.history.back()} 
                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
              >
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">üéß Hlusta√∞u og pakka√∞u</h1>
              <p className="text-gray-500 text-sm font-light">Kafli 5 - Esjan er falleg ¬∑ A1-A2</p>
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-6 mt-8">
            
            {/* Progress */}
            <div className="bg-white rounded-lg shadow-sm p-4 mb-6">
              <div className="flex justify-between items-center">
                <span className="text-gray-600 font-light">
                  Hlustun {currentScenario + 1} af {SCENARIOS.length}
                </span>
                <span className="text-gray-600 font-light">
                  Stig: <span className="font-normal text-blue-600">{score}</span> / {SCENARIOS.length}
                </span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2 mt-3">
                <div 
                  className="bg-blue-600 h-2 rounded-full transition-all duration-500"
                  style={{ width: `${((currentScenario + 1) / SCENARIOS.length) * 100}%` }}
                ></div>
              </div>
            </div>

            {/* Lei√∞beiningar */}
            {currentScenario === 0 && !hasPlayedOnce && (
              <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                <h2 className="text-xl font-normal text-gray-800 mb-3">üìù Hvernig √° a√∞ spila</h2>
                <ul className="space-y-2 text-gray-700 font-light">
                  <li>‚Ä¢ Smelltu √° üîä takkann til a√∞ hlusta</li>
                  <li>‚Ä¢ Hlusta√∞u vel √° textann</li>
                  <li>‚Ä¢ Drag√∞u or√∞in sem √æ√∫ heyrir √≠ bakpokann</li>
                  <li>‚Ä¢ √û√∫ getur hlusta√∞ oft og lesi√∞ textann ef √æ√∫ vilt</li>
                  <li>‚Ä¢ Smelltu √° "Athuga svar" √æegar √æ√∫ ert tilb√∫inn</li>
                </ul>
              </div>
            )}

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Vinstri hli√∞ - Hlustun og bakpoki */}
              <div>
                {/* Audio Card */}
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h2 className="text-2xl font-normal text-gray-800 mb-4">{scenario.title}</h2>
                  
                  {/* Audio Button */}
                  <button
                    onClick={handlePlayAudio}
                    disabled={isPlaying || showResult}
                    className={`audio-button w-full bg-blue-600 text-white py-6 rounded-lg text-xl font-normal hover:bg-blue-700 transition-colors mb-4 ${isPlaying ? 'playing' : ''} ${(isPlaying || showResult) ? 'opacity-50 cursor-not-allowed' : ''}`}
                  >
                    {isPlaying ? 'üîä Spilar...' : 'üîä Hlusta √° textann'}
                  </button>

                  {/* Show Transcript Button */}
                  {hasPlayedOnce && !showResult && (
                    <button
                      onClick={() => setShowTranscript(!showTranscript)}
                      className="w-full bg-gray-100 text-gray-700 py-3 rounded-lg text-sm font-normal hover:bg-gray-200 transition-colors"
                    >
                      {showTranscript ? 'üëÅÔ∏è Fela texta' : 'üëÅÔ∏è S√Ωna texta'}
                    </button>
                  )}

                  {/* Transcript */}
                  {showTranscript && !showResult && (
                    <div className="mt-4 p-4 bg-gray-50 border-2 border-gray-200 rounded-lg">
                      <p className="text-gray-700 font-light leading-relaxed">
                        {scenario.text}
                      </p>
                    </div>
                  )}
                </div>

                {/* Backpack */}
                <div 
                  className="backpack bg-gradient-to-br from-amber-50 to-orange-50 border-4 border-amber-300 rounded-2xl p-6"
                  onDrop={handleDrop}
                  onDragOver={handleDragOver}
                  onDragLeave={handleDragLeave}
                >
                  <h3 className="text-xl font-normal text-gray-800 mb-4 text-center">
                    üéí Or√∞in sem √æ√∫ heyr√∞ir
                  </h3>
                  
                  {selectedItems.length === 0 && !showResult && (
                    <div className="text-center py-8 text-gray-400 font-light">
                      {hasPlayedOnce ? 'Drag√∞u or√∞in hinga√∞ ‚Üí' : 'Byrja√∞u me√∞ a√∞ hlusta!'}
                    </div>
                  )}
                  
                  <div className="grid grid-cols-3 gap-3">
                    {selectedItems.map(item => {
                      let className = "item-card bg-white border-2 border-gray-300 rounded-lg p-3 text-center";
                      
                      if (showResult) {
                        if (feedback.correct.includes(item.id)) {
                          className += " correct";
                        } else if (feedback.wrong.includes(item.id)) {
                          className += " wrong";
                        }
                      }
                      
                      return (
                        <div key={item.id} className={className}>
                          <div className="text-2xl mb-1">{item.emoji}</div>
                          <div className="text-xs font-normal text-gray-800">{item.name}</div>
                          {!showResult && (
                            <button
                              onClick={() => removeItem(item.id)}
                              className="mt-1 text-xs text-red-600 hover:text-red-700"
                            >
                              ‚úï
                            </button>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Action Button */}
                <div className="mt-6">
                  {!showResult ? (
                    <button
                      onClick={checkAnswer}
                      disabled={selectedItems.length === 0 || !hasPlayedOnce}
                      className={`w-full py-4 rounded-lg text-lg font-normal transition-colors ${
                        selectedItems.length === 0 || !hasPlayedOnce
                          ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                          : 'bg-green-600 text-white hover:bg-green-700'
                      }`}
                    >
                      ‚úì Athuga svar
                    </button>
                  ) : (
                    <button
                      onClick={nextScenario}
                      className="w-full bg-blue-600 text-white py-4 rounded-lg text-lg font-normal hover:bg-blue-700 transition-colors"
                    >
                      ‚Üí N√¶sta hlustun
                    </button>
                  )}
                </div>
              </div>

              {/* H√¶gri hli√∞ - Tilt√¶k or√∞ */}
              <div>
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h3 className="text-xl font-normal text-gray-800 mb-4">üì¶ Veldu or√∞</h3>
                  <div className="grid grid-cols-3 gap-3">
                    {availableItems.map(item => {
                      const isSelected = selectedItems.find(i => i.id === item.id);
                      
                      return (
                        <div
                          key={item.id}
                          draggable={!isSelected && !showResult && hasPlayedOnce}
                          onDragStart={(e) => handleDragStart(e, item)}
                          className={`item-card border-2 rounded-lg p-3 text-center ${
                            isSelected 
                              ? 'bg-gray-100 border-gray-200 opacity-50' 
                              : hasPlayedOnce ? 'bg-white border-gray-300' : 'bg-gray-50 border-gray-200 opacity-60'
                          }`}
                          style={{ cursor: isSelected || showResult || !hasPlayedOnce ? 'not-allowed' : 'grab' }}
                        >
                          <div className="text-2xl mb-1">{item.emoji}</div>
                          <div className="text-xs font-normal text-gray-800">{item.name}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Feedback */}
                {showResult && (
                  <div className="mt-6 bg-white rounded-lg shadow-lg p-6">
                    <h3 className="text-xl font-normal text-gray-800 mb-4">üìä Ni√∞ursta√∞a</h3>
                    
                    {feedback.wrong.length === 0 && feedback.missing.length === 0 ? (
                      <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4 mb-4">
                        <p className="text-green-800 font-normal text-center text-lg">
                          üéâ Fr√°b√¶rt! √û√∫ heyr√∞ir allt!
                        </p>
                      </div>
                    ) : (
                      <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-4">
                        <p className="text-yellow-800 font-normal text-center">
                          üí™ Hlusta√∞u aftur!
                        </p>
                      </div>
                    )}

                    {feedback.correct.length > 0 && (
                      <div className="mb-3">
                        <p className="text-sm font-normal text-green-700 mb-2">‚úì R√©tt:</p>
                        <div className="flex flex-wrap gap-2">
                          {feedback.correct.map(id => {
                            const item = ALL_ITEMS.find(i => i.id === id);
                            return (
                              <span key={id} className="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">
                                {item.emoji} {item.name}
                              </span>
                            );
                          })}
                        </div>
                      </div>
                    )}

                    {feedback.wrong.length > 0 && (
                      <div className="mb-3">
                        <p className="text-sm font-normal text-red-700 mb-2">‚úó Ekki √≠ textanum:</p>
                        <div className="flex flex-wrap gap-2">
                          {feedback.wrong.map(id => {
                            const item = ALL_ITEMS.find(i => i.id === id);
                            return (
                              <span key={id} className="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs">
                                {item.emoji} {item.name}
                              </span>
                            );
                          })}
                        </div>
                      </div>
                    )}

                    {feedback.missing.length > 0 && (
                      <div className="mb-3">
                        <p className="text-sm font-normal text-orange-700 mb-2">‚ö† Vantar:</p>
                        <div className="flex flex-wrap gap-2">
                          {feedback.missing.map(id => {
                            const item = ALL_ITEMS.find(i => i.id === id);
                            return (
                              <span key={id} className="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs">
                                {item.emoji} {item.name}
                              </span>
                            );
                          })}
                        </div>
                      </div>
                    )}

                    {/* Show full transcript after checking */}
                    <div className="mt-4 pt-4 border-t border-gray-200">
                      <p className="text-sm font-normal text-gray-700 mb-2">üìù Textinn:</p>
                      <p className="text-sm text-gray-600 font-light italic leading-relaxed">
                        {scenario.text}
                      </p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<ListeningGame />);
  </script>
</body>
</html>
