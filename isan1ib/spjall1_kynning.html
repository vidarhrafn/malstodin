<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spjall me√∞ Sari - √çSAN1√çA</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .feedback {
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
        }

        .feedback.ai-feedback {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #004085;
        }

        .question-block {
            opacity: 0.5;
            pointer-events: none;
        }

        .question-block.active {
            opacity: 1;
            pointer-events: auto;
        }

        .play-btn {
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-btn {
            transition: all 0.2s ease;
        }

        .input-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto max-w-4xl px-4 py-8">
        
        <!-- Profile Section -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8 text-center">
            <div class="mb-6">
                <img src="media/sari.png" alt="Sari" class="w-48 h-48 rounded-full mx-auto object-cover border-4 border-blue-500 shadow-lg">
            </div>
            <p class="text-xl text-gray-700 mb-4">√âg er l√≠ka a√∞ l√¶ra √≠slensku</p>
            <p class="text-md text-gray-500 italic">üéß Svara√∞u me√∞ a√∞ tala e√∞a skrifa</p>
        </div>

        <!-- Part 1: Sari asks questions -->
        <div id="part1" class="space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üó£Ô∏è Sari spyr √æig</h2>

            <!-- Question 1: Nafn -->
            <div class="question-block active bg-white rounded-lg shadow-md p-6" data-question="1">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(1, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 1</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(1)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(1)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput1" class="hidden">
                        <input type="text" id="answer1" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(1)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording1" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(1)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback1" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 2: Aldur -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="2">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(2, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 2</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(2)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(2)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput2" class="hidden">
                        <input type="text" id="answer2" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(2)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording2" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(2)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback2" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 3: Hva√∞an -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="3">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(3, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 3</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(3)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(3)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput3" class="hidden">
                        <input type="text" id="answer3" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(3)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording3" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(3)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback3" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 4: B√∫seta -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="4">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(4, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 4</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(4)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(4)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput4" class="hidden">
                        <input type="text" id="answer4" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(4)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording4" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(4)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback4" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 5: Hven√¶r komst til √çslands -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="5">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(5, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 5</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(5)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(5)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput5" class="hidden">
                        <input type="text" id="answer5" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(5)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording5" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(5)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback5" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 6: Fj√∂lskylda -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="6">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(6, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 6</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(6)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(6)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput6" class="hidden">
                        <input type="text" id="answer6" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(6)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording6" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(6)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback6" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 7: Hva√∞a dagur er √≠ dag -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="7">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(7, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 7</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(7)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(7)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput7" class="hidden">
                        <input type="text" id="answer7" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(7)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording7" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(7)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback7" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 8: Afm√¶lism√°nu√∞ur -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="8">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(8, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 8</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(8)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(8)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput8" class="hidden">
                        <input type="text" id="answer8" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(8)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording8" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(8)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback8" class="feedback ai-feedback hidden"></div>
            </div>

            <!-- Question 9: √Åhugam√°l -->
            <div class="question-block bg-white rounded-lg shadow-md p-6" data-question="9">
                <div class="flex items-center gap-4 mb-4">
                    <button class="play-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-full text-2xl" onclick="playQuestion(9, this)">
                        ‚ñ∂Ô∏è
                    </button>
                    <p class="text-lg font-semibold text-gray-700">Spurning 9</p>
                </div>
                
                <div class="mt-4">
                    <div class="flex gap-2 mb-3">
                        <button onclick="startRecording(9)" class="input-btn flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showTextInput(9)" class="input-btn flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="textInput9" class="hidden">
                        <input type="text" id="answer9" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa svar √æitt h√©r...">
                        <button onclick="submitAnswer(9)" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda svar
                        </button>
                    </div>
                    
                    <div id="recording9" class="hidden text-center py-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi...</p>
                        <button onclick="stopRecording(9)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                </div>

                <div id="feedback9" class="feedback ai-feedback hidden"></div>
            </div>
        </div>

        <!-- Part 2: Student asks Sari -->
        <div id="part2" class="hidden space-y-6 mt-12">
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg shadow-lg p-8 text-center text-white">
                <h2 class="text-3xl font-bold mb-4">üîÑ N√∫ er √æitt a√∞ spyrja!</h2>
                <button class="play-btn bg-white text-purple-600 px-8 py-4 rounded-full text-xl font-bold hover:bg-gray-100" onclick="playFlipIntro(this)">
                    ‚ñ∂Ô∏è Heyra √≠ Sari
                </button>
            </div>

            <!-- Student questions to Sari -->
            <div id="flipQuestions" class="hidden space-y-6">
                <p class="text-lg text-gray-700 text-center mb-6">Spyr√∞u Sari spurningar. H√∫n mun svara √æ√©r! üòä</p>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <p class="text-gray-600 mb-4 text-center">Nota√∞u radduppt√∂ku e√∞a skrifa√∞u spurninguna √æ√≠na:</p>
                    
                    <div class="flex gap-2 mb-4">
                        <button onclick="startFlipRecording()" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold">
                            üé§ Tala
                        </button>
                        <button onclick="showFlipTextInput()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-semibold">
                            ‚å®Ô∏è Skrifa
                        </button>
                    </div>
                    
                    <div id="flipRecording" class="hidden text-center py-4 mb-4">
                        <p class="text-red-600 font-semibold mb-2">üî¥ Upptaka √≠ gangi... Spur√∞u Sari!</p>
                        <button onclick="stopFlipRecording()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                            ‚èπÔ∏è St√∂√∞va uppt√∂ku
                        </button>
                    </div>
                    
                    <div id="flipTextInput" class="hidden mb-4">
                        <input type="text" id="flipQuestionText" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-2" placeholder="Skrifa√∞u spurningu √æ√≠na h√©r...">
                        <button onclick="submitFlipQuestion()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold">
                            Senda spurningu
                        </button>
                    </div>
                    
                    <div id="studentQuestionFeedback" class="feedback ai-feedback hidden mt-4"></div>
                    
                    <div class="mt-4 text-center">
                        <button onclick="askAnotherQuestion()" class="hidden bg-purple-500 hover:bg-purple-600 text-white py-2 px-6 rounded-lg font-semibold" id="askAnotherBtn">
                            Spyrja aftur
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Questions and Azure TTS texts
        const questions = {
            1: {
                text: "H√¶! Hva√∞ heitir √æ√∫?",
                azureText: "H√¶! Hva√∞ heitir √æ√∫?"
            },
            2: {
                text: "Hva√∞ ert √æ√∫ g√∂mul e√∞a gamall?",
                azureText: "Hva√∞ ert √æ√∫ g√∂mul e√∞a gamall?"
            },
            3: {
                text: "Hva√∞an ert √æ√∫? Fr√° hva√∞a landi ert √æ√∫?",
                azureText: "Hva√∞an ert √æ√∫? Fr√° hva√∞a landi ert √æ√∫?"
            },
            4: {
                text: "Hvar b√Ωr√∞ √æ√∫ n√∫na?",
                azureText: "Hvar b√Ωr√∞ √æ√∫ n√∫na?"
            },
            5: {
                text: "Hven√¶r komst √æ√∫ til √çslands?",
                azureText: "Hven√¶r komst √æ√∫ til √çslands?"
            },
            6: {
                text: "Hva√∞ heitir mamma √æ√≠n og pabbi √æinn?",
                azureText: "Hva√∞ heitir mamma √æ√≠n og pabbi √æinn?"
            },
            7: {
                text: "Hva√∞a dagur er √≠ dag?",
                azureText: "Hva√∞a dagur er √≠ dag?"
            },
            8: {
                text: "√ç hva√∞a m√°nu√∞i √°tt √æ√∫ afm√¶li?",
                azureText: "√ç hva√∞a m√°nu√∞i √°tt √æ√∫ afm√¶li?"
            },
            9: {
                text: "Finnst √æ√©r gaman a√∞ hlusta √° t√≥nlist?",
                azureText: "Finnst √æ√©r gaman a√∞ hlusta √° t√≥nlist?"
            }
        };

        const flipIntroText = "Fr√°b√¶rt! N√∫na vilt √æ√∫ spyrja mig?";

        // Store user context for adaptive questioning
        let userContext = {
            name: '',
            gender: 'unknown', // 'male', 'female', or 'unknown'
            answers: []
        };

        // Sari's consistent facts - AI always reads this
        const SARI_FACTS = `
STA√êREYNDIR UM SARI (Mundu √æetta alltaf):
- Nafn: Sari
- Aldur: 18 √°ra
- Fr√°: Ind√≥nes√≠u (h√∂fu√∞borg: Jakarta)
- B√∫seta: V√∂llum √≠ Hafnarfir√∞i, √çsland
- T√≠mi √° √çslandi: 8 m√°nu√∞i
- Foreldrar: Mamma heitir Dewi (45 √°ra), Pabbi heitir Budi (47 √°ra)
- Systkini: ENGIN systkini - Sari er einbirni
- Afm√¶lism√°nu√∞ur: J√∫l√≠ (15. j√∫l√≠)
- √Åhugam√°l: Hlusta √° t√≥nlist (K-pop og √≠slenska t√≥nlist), lesa b√¶kur (fantasy), fara √≠ sund
- Sk√≥li: √ç MH (Menntask√≥linn vi√∞ Hamrahl√≠√∞), a√∞ l√¶ra √≠slensku
- Upp√°haldsmatur: Nasi Goreng (ind√≥nes√≠skur r√©ttur) og √≠slenskar p√∂nnuk√∂kur
- Upp√°haldslitir: Bl√°r og fj√≥lubl√°r
- G√¶lud√Ωr: Engin g√¶lud√Ωr n√∫na, en haf√∞i k√∂tt √° Ind√≥nes√≠u sem h√©t Kiki

MIKILV√ÜGT: √ûetta eru √ìBREYTANLEGAR sta√∞reyndir. Svara√∞u ALLTAF √≠ samr√¶mi vi√∞ √æetta.
        `.trim();

        // Speech recognition setup
        let recognition;
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'is-IS';
            recognition.continuous = false;
            recognition.interimResults = false;
        }

        let currentRecordingQuestion = null;

        // Play Azure TTS audio
        async function playQuestion(questionNum, buttonElement) {
            const question = questions[questionNum];
            let textToSpeak = question.azureText;
            
            // Adapt question 2 based on context from question 1
            if (questionNum === 2 && userContext.answers[1]) {
                // Extract name from answer
                const nameMatch = userContext.answers[1].match(/√©g heiti (\w+)/i) || 
                                 userContext.answers[1].match(/(\w+)/);
                const name = nameMatch ? nameMatch[1] : '';
                
                // Ask AI to determine appropriate form
                try {
                    const genderCheckMessages = [
                        { 
                            role: 'system', 
                            content: '√û√∫ ert √≠slenskukennari. Svara√∞u A√êEINS me√∞ "gamall" e√∞a "g√∂mul" byggt √° nafninu.' 
                        },
                        { 
                            role: 'user', 
                            content: `Nemandinn sag√∞i: "${userContext.answers[1]}". Er √æetta karlmannsnafn (svara√∞u "gamall") e√∞a kvennafn (svara√∞u "g√∂mul")?` 
                        }
                    ];
                    
                    const genderResponse = await fetch('/.netlify/functions/openai', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: genderCheckMessages,
                            max_tokens: 10,
                            temperature: 0.3
                        })
                    });
                    
                    const genderData = await genderResponse.json();
                    if (genderData.content) {
                        const form = genderData.content.toLowerCase().includes('g√∂mul') ? 'g√∂mul' : 'gamall';
                        textToSpeak = name ? `H√¶ ${name}, hva√∞ ert √æ√∫ ${form}?` : `Hva√∞ ert √æ√∫ ${form}?`;
                    }
                } catch (e) {
                    console.log('Could not adapt question, using default');
                }
            }
            
            const playBtn = buttonElement;
            playBtn.disabled = true;
            
            try {
                const r = await fetch('/.netlify/functions/speak', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text_to_speak: textToSpeak }),
                });

                const data = await r.json();
                
                if (!r.ok || data.error || !data.audio_base64) {
                    console.error("Villa √≠ hlj√≥√∞kalli:", data.error);
                    playBtn.disabled = false;
                    return;
                }

                const audioUrl = `data:audio/mp3;base64,${data.audio_base64}`;
                const audio = new Audio(audioUrl);
                
                audio.onended = () => {
                    playBtn.disabled = false;
                };
                audio.onerror = () => {
                    playBtn.disabled = false;
                };
                
                await audio.play();
                
            } catch (e) {
                console.error("Tenging mist√≥kst:", e);
                playBtn.disabled = false;
            }
        }

        // Play flip intro
        async function playFlipIntro(buttonElement) {
            const playBtn = buttonElement;
            playBtn.disabled = true;
            
            try {
                const r = await fetch('/.netlify/functions/speak', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text_to_speak: flipIntroText }),
                });

                const data = await r.json();
                
                if (!r.ok || data.error || !data.audio_base64) {
                    console.error("Villa √≠ hlj√≥√∞kalli:", data.error);
                    playBtn.disabled = false;
                    return;
                }

                const audioUrl = `data:audio/mp3;base64,${data.audio_base64}`;
                const audio = new Audio(audioUrl);
                
                audio.onended = () => {
                    playBtn.disabled = false;
                    document.getElementById('flipQuestions').classList.remove('hidden');
                };
                audio.onerror = () => {
                    playBtn.disabled = false;
                };
                
                await audio.play();
                
            } catch (e) {
                console.error("Tenging mist√≥kst:", e);
                playBtn.disabled = false;
            }
        }

        // Show text input
        function showTextInput(questionNum) {
            document.getElementById(`textInput${questionNum}`).classList.remove('hidden');
        }

        // Start recording
        function startRecording(questionNum) {
            if (!recognition) {
                alert('Raddupptaka er ekki studd √≠ √æessum vafra. Nota√∞u Chrome e√∞a Edge.');
                return;
            }

            currentRecordingQuestion = questionNum;
            document.getElementById(`recording${questionNum}`).classList.remove('hidden');

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById(`recording${questionNum}`).classList.add('hidden');
                
                // Show text input with recognized text so user can edit
                const textInput = document.getElementById(`textInput${questionNum}`);
                const answerInput = document.getElementById(`answer${questionNum}`);
                textInput.classList.remove('hidden');
                answerInput.value = transcript;
                answerInput.focus();
                
                // Don't submit automatically - let user review and edit
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById(`recording${questionNum}`).classList.add('hidden');
                alert('Villa kom upp √≠ radduppt√∂ku. Reyndu aftur.');
            };

            recognition.start();
        }

        // Stop recording
        function stopRecording(questionNum) {
            if (recognition) {
                recognition.stop();
            }
            document.getElementById(`recording${questionNum}`).classList.add('hidden');
        }

        // Submit answer from text input
        function submitAnswer(questionNum) {
            const answer = document.getElementById(`answer${questionNum}`).value.trim();
            if (!answer) {
                alert('Vinsamlegast skrifa√∞u svar!');
                return;
            }
            submitAnswerText(questionNum, answer);
        }

        // Submit answer text (from either typing or speech)
        async function submitAnswerText(questionNum, answerText) {
            // Show what user said/wrote in the input field
            const textInput = document.getElementById(`textInput${questionNum}`);
            const answerInput = document.getElementById(`answer${questionNum}`);
            if (answerInput) {
                answerInput.value = answerText;
            }
            if (!textInput.classList.contains('hidden')) {
                // Input was already visible, keep it
            } else {
                // Show it so user can see what they said
                textInput.classList.remove('hidden');
                answerInput.value = answerText;
            }
            
            const feedbackDiv = document.getElementById(`feedback${questionNum}`);
            feedbackDiv.innerHTML = '<p class="text-gray-600">‚è≥ Sari er a√∞ hugsa...</p>';
            feedbackDiv.classList.remove('hidden');

            try {
                const feedback = await getAIFeedback(answerText, questionNum);
                feedbackDiv.innerHTML = `<p>${feedback}</p>`;
                
                // Activate next question
                setTimeout(() => {
                    if (questionNum < 9) {
                        activateNextQuestion(questionNum + 1);
                    } else {
                        // All questions done, show part 2
                        showPart2();
                    }
                }, 2000);
            } catch (error) {
                console.error('Error getting feedback:', error);
                feedbackDiv.innerHTML = '<p>Fr√°b√¶rt! Haltu √°fram! üòä</p>';
            }
        }

        // Get AI feedback from Claude via Netlify function
        async function getAIFeedback(userAnswer, questionNum) {
            const questionText = questions[questionNum].text;
            
            // Store answer
            userContext.answers[questionNum] = userAnswer;
            
            // For question 1 (name), try to infer gender
            if (questionNum === 1) {
                userContext.name = userAnswer;
            }
            
            const systemPrompt = `√û√∫ ert Sari, 18 √°ra stelpa fr√° Ind√≥nes√≠u sem er a√∞ l√¶ra √≠slensku. √û√∫ ert vingjarnleg og feimin en mj√∂g hl√Ω √≠ hugsun.

Gef√∞u stutta, n√°tt√∫rulega og hvetjandi endurgj√∂f √° √≠slensku (2-3 setningar):
- Vi√∞urkenndu svar nemandans
- Commenta√∞u √° √æa√∞ sem hann/h√∫n sag√∞i (ekki bara "r√©tt" e√∞a "rangt")
- Vertu vingjarnleg og hvetjandi
- Ef m√°lfr√¶√∞ivilla er, benda √° √æa√∞ √° mj√∫kan h√°tt
- Ef svari√∞ er mj√∂g stutt, hvettu til a√∞ segja meira

MIKILV√ÜGT: 
- EKKI spyrja spurninga √≠ endurgj√∂finni
- A√êEINS commenta og hr√≥sa
- Nemandinn getur ekki svara√∞ spurningum √≠ endurgj√∂finni

${questionNum === 1 ? `
MIKILV√ÜGT fyrir spurning um nafn: 
- Reyndu a√∞ greina hvort nafni√∞ er karlmannsnafn e√∞a kvennafn
- Ef √æ√∫ heldur a√∞ √æa√∞ s√© karlmannsnafn, seg√∞u "gamall" √≠ n√¶stu spurningu
- Ef √æ√∫ heldur a√∞ √æa√∞ s√© kvennafn, seg√∞u "g√∂mul" √≠ n√¶stu spurningu
- Ef √≥v√≠st, nota√∞u "gamall e√∞a g√∂mul"
` : ''}

D√¶mi um g√≥√∞a endurgj√∂f (ATH: ENGAR SPURNINGAR):
- "Fr√°b√¶rt! √û√∫ heitir [nafn]. √ûa√∞ er fallegt nafn! M√©r finnst gaman a√∞ kynnast √æ√©r."
- "Gott! √û√∫ ert [aldur] √°ra, vi√∞ erum n√¶stum √æv√≠ jafngamlar! √âg er 18 √°ra."
- "√Åhugavert! √û√∫ ert fr√° [land]. √âg er fr√° Ind√≥nes√≠u. √ûa√∞ er langt a√∞ fer√∞ast!"

MIKILV√ÜGT: Svara√∞u A√êEINS me√∞ endurgj√∂finni √° √≠slensku. Engin √∫tsk√Ωring, meta-commentary, e√∞a spurningar.`;

            const userPrompt = `√û√∫ spur√∞ir: "${questionText}"

Nemandinn svara√∞i: "${userAnswer}"

${questionNum === 1 ? 'Greindu hvort nafni√∞ vir√∞ist karlmannsnafn e√∞a kvennafn og gef√∞u vi√∞eigandi endurgj√∂f √ÅN √æess a√∞ spyrja spurninga.' : 'Gef√∞u endurgj√∂f √ÅN √æess a√∞ spyrja spurninga:'}`;

            const messages = [
                { role: 'system', content: systemPrompt },
                { role: 'user', content: userPrompt }
            ];

            const response = await fetch('/.netlify/functions/openai', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: messages,
                    max_tokens: 200,
                    temperature: 0.7
                })
            });

            const data = await response.json();
            if (!response.ok || data.error) {
                throw new Error(data.error || 'API villa');
            }
            
            // Try to detect gender from AI response for question 1
            if (questionNum === 1) {
                const feedback = data.content;
                // Store feedback to potentially parse gender hint
                userContext.lastFeedback = feedback;
            }
            
            return data.content;
        }

        // Activate next question
        function activateNextQuestion(questionNum) {
            const nextBlock = document.querySelector(`[data-question="${questionNum}"]`);
            if (nextBlock) {
                nextBlock.classList.add('active');
                nextBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Show part 2 (flip section)
        function showPart2() {
            document.getElementById('part1').style.opacity = '0.5';
            document.getElementById('part2').classList.remove('hidden');
            document.getElementById('part2').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Student asks Sari - FLIP section functions
        function showFlipTextInput() {
            document.getElementById('flipTextInput').classList.remove('hidden');
            document.getElementById('flipQuestionText').focus();
        }

        function startFlipRecording() {
            if (!recognition) {
                alert('Raddupptaka er ekki studd √≠ √æessum vafra. Nota√∞u Chrome e√∞a Edge.');
                return;
            }

            const feedbackDiv = document.getElementById('studentQuestionFeedback');
            document.getElementById('flipRecording').classList.remove('hidden');
            feedbackDiv.classList.add('hidden');

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('flipRecording').classList.add('hidden');
                
                // Show recognized text in text input for editing
                document.getElementById('flipTextInput').classList.remove('hidden');
                document.getElementById('flipQuestionText').value = transcript;
                document.getElementById('flipQuestionText').focus();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('flipRecording').classList.add('hidden');
                feedbackDiv.innerHTML = '<p class="text-red-600">Villa √≠ uppt√∂ku. Reyndu aftur!</p>';
                feedbackDiv.classList.remove('hidden');
            };

            recognition.start();
        }

        function stopFlipRecording() {
            if (recognition) {
                recognition.stop();
            }
            document.getElementById('flipRecording').classList.add('hidden');
        }

        async function submitFlipQuestion() {
            const questionText = document.getElementById('flipQuestionText').value.trim();
            if (!questionText) {
                alert('Vinsamlegast skrifa√∞u spurningu!');
                return;
            }

            const feedbackDiv = document.getElementById('studentQuestionFeedback');
            feedbackDiv.innerHTML = '<p class="text-gray-600">‚è≥ Sari er a√∞ svara...</p>';
            feedbackDiv.classList.remove('hidden');

            try {
                const response = await getSariResponse(questionText);
                feedbackDiv.innerHTML = `<p><strong>√û√∫ spur√∞ir:</strong> "${questionText}"</p><p class="mt-2"><strong>Sari svarar:</strong> ${response}</p>`;
                
                // Show "ask another" button
                document.getElementById('askAnotherBtn').classList.remove('hidden');
                
                // Read Sari's response aloud with Azure TTS
                try {
                    const r = await fetch('/.netlify/functions/speak', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text_to_speak: response }),
                    });

                    const data = await r.json();
                    
                    if (r.ok && !data.error && data.audio_base64) {
                        const audioUrl = `data:audio/mp3;base64,${data.audio_base64}`;
                        const audio = new Audio(audioUrl);
                        await audio.play();
                    }
                } catch (audioError) {
                    console.error("Villa vi√∞ hlj√≥√∞:", audioError);
                }
                
                // Clear input
                document.getElementById('flipQuestionText').value = '';
                
            } catch (error) {
                console.error('Error:', error);
                feedbackDiv.innerHTML = '<p>Sari gat ekki svara√∞. Reyndu aftur!</p>';
            }
        }

        function askAnotherQuestion() {
            // Hide feedback and ask another button
            document.getElementById('studentQuestionFeedback').classList.add('hidden');
            document.getElementById('askAnotherBtn').classList.add('hidden');
            document.getElementById('flipTextInput').classList.add('hidden');
            document.getElementById('flipQuestionText').value = '';
        }

        // Legacy function - keep for compatibility
        function startStudentQuestion() {
            startFlipRecording();
        }

        // Get Sari's response to student question
        async function getSariResponse(studentQuestion) {
            const systemPrompt = `√û√∫ ert Sari, 18 √°ra stelpa fr√° Ind√≥nes√≠u. 

${SARI_FACTS}

Svara√∞u spurningunni √° √≠slensku eins og Sari myndi gera. Nota√∞u uppl√Ωsingarnar a√∞ ofan og vertu n√°tt√∫ruleg og vingjarnleg.

Svara√∞u n√°tt√∫rulega og stuttlega (1-2 setningar). A√êEINS svari√∞, ekkert anna√∞.`;

            const messages = [
                { role: 'system', content: systemPrompt },
                { role: 'user', content: studentQuestion }
            ];

            const response = await fetch('/.netlify/functions/openai', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: messages,
                    max_tokens: 150,
                    temperature: 0.5
                })
            });

            const data = await response.json();
            if (!response.ok || data.error) {
                throw new Error(data.error || 'API villa');
            }
            return data.content;
        }
    </script>
</body>
</html>
