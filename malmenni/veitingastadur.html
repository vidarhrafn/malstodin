<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>üçΩÔ∏è Veitingasta√∞urinn - Hlutverkaleikur</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
            min-height: 100vh;
        }
        .recording {
            animation: pulse 1.5s ease-in-out infinite;
        }
        .speaking {
            animation: speakPulse 0.8s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .sound-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 40px;
        }
        .sound-bar {
            width: 4px;
            background: #3b82f6;
            border-radius: 2px;
            animation: soundWave 0.8s ease-in-out infinite;
        }
        .sound-bar:nth-child(1) { animation-delay: 0s; height: 20px; }
        .sound-bar:nth-child(2) { animation-delay: 0.1s; height: 30px; }
        .sound-bar:nth-child(3) { animation-delay: 0.2s; height: 40px; }
        .sound-bar:nth-child(4) { animation-delay: 0.3s; height: 30px; }
        .sound-bar:nth-child(5) { animation-delay: 0.4s; height: 20px; }
        @keyframes soundWave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===== ICONS =====
        const SendIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const MicIcon = ({ isRecording }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill={isRecording ? "currentColor" : "none"}
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={`w-6 h-6 ${isRecording ? 'recording text-red-500' : ''}`}
            >
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
        );

        const HelpIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        const SpeakerIcon = ({ isSpeaking }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={`w-16 h-16 ${isSpeaking ? 'speaking text-blue-500' : 'text-gray-400'}`}
            >
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                {isSpeaking && (
                    <>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                    </>
                )}
            </svg>
        );

        // ===== SOUND WAVE COMPONENT =====
        const SoundWave = () => (
            <div className="sound-wave">
                <div className="sound-bar"></div>
                <div className="sound-bar"></div>
                <div className="sound-bar"></div>
                <div className="sound-bar"></div>
                <div className="sound-bar"></div>
            </div>
        );

        // ===== API FUNCTIONS =====
        async function callOpenAI(messages, max_tokens = 500, model = 'gpt-4o-mini', temperature = 0.4) {
            const r = await fetch('/.netlify/functions/openai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: model,
                    messages: messages,
                    max_tokens: max_tokens,
                    temperature: temperature
                }),
            });
            const data = await r.json();
            if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
            return data.content;
        }

        async function playAudio(text) {
            return new Promise(async (resolve, reject) => {
                try {
                    const r = await fetch('/.netlify/functions/speak', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text_to_speak: text }),
                    });

                    const data = await r.json();
                    
                    if (!r.ok || data.error || !data.audio_base64) {
                        console.error("Villa √≠ hlj√≥√∞kalli:", data.error);
                        reject(new Error(data.error || 'Audio error'));
                        return;
                    }

                    const audioUrl = `data:audio/mp3;base64,${data.audio_base64}`;
                    const audio = new Audio(audioUrl);
                    
                    audio.onended = () => resolve();
                    audio.onerror = (e) => reject(e);
                    
                    audio.play().catch(e => reject(e));
                    
                } catch (e) {
                    console.error("Tenging mist√≥kst:", e);
                    reject(e);
                }
            });
        }

        // ===== SYSTEM PROMPT =====
        const WAITER_SYSTEM_PROMPT = `
√û√∫ ert vingjarnlegur og √æolinm√≥√∞ur √æj√≥nn √° veitingasta√∞ √° √çslandi. √û√∫ talar vi√∞ nemendur sem eru a√∞ l√¶ra √≠slensku √° A1-A2 stigi.

## TUNGUM√ÅL
- Tala√∞u EINUNGIS √≠slensku (nema √æegar nemandi bi√∞ur um hj√°lp - sj√° ne√∞ar)
- Nota√∞u stuttar og sk√Ωrar setningar
- Vertu √æolinm√≥√∞ur ef nemandi gerir m√°lfr√¶√∞ivillur
- Lei√∞r√©ttu √≥beint me√∞ √æv√≠ a√∞ endurtaka r√©tt (t.d. ef nemandi segir "√âg vil fiska" svara√∞u "Fr√°b√¶rt, √æ√∫ pantar fiskinn")

## EF NEMANDI TALAR ANNA√ê TUNGUM√ÅL
Ef nemandi skrifar √° √∂√∞ru tungum√°li en √≠slensku (og bi√∞ur EKKI um hj√°lp), svara√∞u:
"Afsaki√∞, √©g skil ekki. Getur√∞u sagt √æetta √° √≠slensku?"
Og hj√°lpa√∞u me√∞ a√∞ gefa d√¶mi um hvernig √° a√∞ segja √æa√∞.

## HJ√ÅLP
Ef nemandi bi√∞ur um hj√°lp (t.d. "How do I say...", "Jak powiedzieƒá...", "Comment dire..."):
1. Svara√∞u √° SAMA tungum√°li og nemandinn spur√∞i √°
2. Gef√∞u √≠slenska setninguna/or√∞i√∞
3. Haltu s√≠√∞an √°fram me√∞ samtali√∞ √° √≠slensku

## SAMTALSFERLI√ê

### 1. BYRJUN (fyrsta skilabo√∞)
- Heilsa√∞u og bj√≥ddu velkominn
- Spyr√∞u hvort nemandi hafi panta√∞ bor√∞

### 2. BOR√êP√ñNTUN
- Ef ekki panta√∞: "Ekkert m√°l! Fyrir hve marga?"
- √ûegar b√∫i√∞: "Komdu me√∞ m√©r" / "H√©r er bor√∞i√∞"

### 3. MATSE√êILL OG DRYKKIR
- Bj√≥ddu matse√∞ilinn
- Spyr√∞u hva√∞ vi√∞skiptavinur vill drekka

### 4. MATARP√ñNTUN
- Spyr√∞u hvort tilb√∫i√∞ a√∞ panta
- Ef nemandi spyr um r√°√∞leggingar: m√¶ltu me√∞ einhverju
- Spyr√∞u um forr√©tt/eftirr√©tt

### 5. OFN√ÜMI
- Spyr√∞u alltaf: "Ert √æ√∫ me√∞ ofn√¶mi fyrir einhverju?"
- Ef j√°: "√âg skal athuga hj√° kokknum til √∂ryggis"

### 6. B√ç√ê OG MATUR
- Seg√∞u a√∞ maturinn komi eftir 15 m√≠n√∫tur
- √ûegar "maturinn er kominn": "Gj√∂ri√∞ svo vel! Nj√≥ti√∞ vel!"
- Spyr√∞u hvort maturinn brag√∞ist vel

### 7. REIKNINGUR
- Reikna√∞u heildarver√∞ mi√∞a√∞ vi√∞ p√∂ntun
- Spyr√∞u hvort borga saman e√∞a sitt √≠ hvoru lagi
- Bj√≥ddu kvittun
- √ûakka√∞u fyrir komuna

## VER√êLISTI
FORR√âTTUR: S√∫pa og brau√∞ 1.400kr, Salat 1.600kr
A√êALR√âTTUR: Fiskur dagsins 3.200kr, Lambahryggur 3.800kr, Kj√∫klingavefja 2.800kr, Hamborgari og franskar 2.400kr, Gr√¶nmetisr√©ttur (fyllt paprika) 2.600kr
EFTIRR√âTTUR: S√∫kkula√∞ikaka 1.300kr, √çs 900kr, √Åvextir 1.000kr
DRYKKIR: Vatn 0kr, Gos 500kr, Kaffi/Te 400kr, √Åvaxtasafi 600kr

## √ûEGAR SAMTALI L√ùKUR
Eftir a√∞ nemandi hefur borga√∞ og √æ√∫ hefur √æakka√∞ fyrir komuna, b√¶ttu vi√∞ N√ÅKV√ÜMLEGA √æessu √≠ lok skilabo√∞anna:
[SAMTALI LOKI√ê]

√û√° mun kerfi√∞ s√Ωna hr√≥s til nemandans.

## MIKILV√ÜGT
- Haltu sv√∂rum STUTTUM (1-3 setningar)
- Vertu n√°tt√∫rulegur og vingjarnlegur
- Lei√∞beindu samtalinu ef nemandi er √≥viss
`.trim();

        const FEEDBACK_SYSTEM_PROMPT = `
√û√∫ ert √≠slenskukennari sem gefur nemanda hr√≥s eftir hlutverkaleik √° veitingasta√∞.

√û√∫ f√¶r√∞ samtal milli nemanda og √æj√≥ns. Gef√∞u √≠tarlegt hr√≥s:

1. FYRST √° √≠slensku:
- Hr√≥sa√∞u almennt
- Nefndu 2-3 setningar e√∞a or√∞ sem nemandinn nota√∞i vel
- Vertu hvetjandi

2. S√ç√êAN √° m√≥√∞urm√°li nemandans (√æ√∫ √æarft a√∞ greina √æa√∞ √∫r samtalinu):
- √û√Ωddu hr√≥si√∞
- Nefndu s√∂mu d√¶mi
- Gef√∞u 1-2 r√°√∞ til a√∞ b√¶ta sig

Haf√∞u hr√≥si√∞ hl√Ωlegt og hvetjandi. Nemandinn er √° A1-A2 stigi.
`.trim();

        // ===== MAIN COMPONENT =====
        const Veitingastadur = () => {
            const [conversationHistory, setConversationHistory] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [isRecording, setIsRecording] = useState(false);
            const [recognition, setRecognition] = useState(null);
            const [status, setStatus] = useState('starting'); // starting, listening, thinking, speaking, waiting, finished
            const [showHelp, setShowHelp] = useState(false);
            const [helpInput, setHelpInput] = useState('');
            const [helpResponse, setHelpResponse] = useState('');
            const [helpLoading, setHelpLoading] = useState(false);
            const [feedback, setFeedback] = useState('');
            const [conversationStarted, setConversationStarted] = useState(false);
            const inputRef = useRef(null);

            // Initialize speech recognition
            useEffect(() => {
                if (typeof window !== 'undefined' && 'webkitSpeechRecognition' in window) {
                    const recognitionInstance = new window.webkitSpeechRecognition();
                    recognitionInstance.lang = 'is-IS';
                    recognitionInstance.continuous = false;
                    recognitionInstance.interimResults = false;

                    recognitionInstance.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setInput(transcript);
                        setIsRecording(false);
                        setStatus('waiting');
                    };

                    recognitionInstance.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        setIsRecording(false);
                        setStatus('waiting');
                    };

                    recognitionInstance.onend = () => {
                        setIsRecording(false);
                    };

                    setRecognition(recognitionInstance);
                }
            }, []);

            // Start conversation
            const startConversation = async () => {
                setConversationStarted(true);
                setStatus('thinking');
                setLoading(true);

                try {
                    const messages = [
                        { role: 'system', content: WAITER_SYSTEM_PROMPT },
                        { role: 'user', content: '[Nemandi kemur inn √° veitingasta√∞inn]' }
                    ];

                    const response = await callOpenAI(messages);
                    
                    setConversationHistory([
                        { role: 'user', content: '[Kemur inn]', hidden: true },
                        { role: 'assistant', content: response }
                    ]);

                    setStatus('speaking');
                    setIsSpeaking(true);
                    
                    await playAudio(response);
                    
                    setIsSpeaking(false);
                    setStatus('waiting');

                } catch (error) {
                    console.error('Error starting conversation:', error);
                    setStatus('waiting');
                } finally {
                    setLoading(false);
                }
            };

            // Send message
            const sendMessage = async () => {
                if (!input.trim() || loading) return;

                const userMessage = input.trim();
                setInput('');
                setStatus('thinking');
                setLoading(true);

                const newHistory = [...conversationHistory, { role: 'user', content: userMessage }];
                setConversationHistory(newHistory);

                try {
                    const messagesForAPI = [
                        { role: 'system', content: WAITER_SYSTEM_PROMPT },
                        ...newHistory.filter(m => !m.hidden).map(m => ({ role: m.role, content: m.content }))
                    ];

                    const response = await callOpenAI(messagesForAPI);
                    
                    const updatedHistory = [...newHistory, { role: 'assistant', content: response }];
                    setConversationHistory(updatedHistory);

                    // Check if conversation ended
                    if (response.includes('[SAMTALI LOKI√ê]')) {
                        const cleanResponse = response.replace('[SAMTALI LOKI√ê]', '').trim();
                        
                        setStatus('speaking');
                        setIsSpeaking(true);
                        await playAudio(cleanResponse);
                        setIsSpeaking(false);
                        
                        // Generate feedback
                        setStatus('thinking');
                        const feedbackMessages = [
                            { role: 'system', content: FEEDBACK_SYSTEM_PROMPT },
                            { role: 'user', content: `H√©r er samtali√∞:\n\n${updatedHistory.filter(m => !m.hidden).map(m => `${m.role === 'user' ? 'Nemandi' : '√ûj√≥nn'}: ${m.content}`).join('\n\n')}` }
                        ];
                        
                        const feedbackResponse = await callOpenAI(feedbackMessages, 600);
                        setFeedback(feedbackResponse);
                        
                        setStatus('speaking');
                        setIsSpeaking(true);
                        await playAudio(feedbackResponse);
                        setIsSpeaking(false);
                        
                        setStatus('finished');
                    } else {
                        setStatus('speaking');
                        setIsSpeaking(true);
                        await playAudio(response);
                        setIsSpeaking(false);
                        setStatus('waiting');
                    }

                } catch (error) {
                    console.error('Error:', error);
                    setStatus('waiting');
                } finally {
                    setLoading(false);
                }
            };

            // Toggle recording
            const toggleRecording = () => {
                if (!recognition) {
                    alert('Talgreining er ekki studd √≠ √æessum vafra. Pr√≥fa√∞u Chrome.');
                    return;
                }

                if (isRecording) {
                    recognition.stop();
                    setIsRecording(false);
                    setStatus('waiting');
                } else {
                    setInput('');
                    recognition.start();
                    setIsRecording(true);
                    setStatus('listening');
                }
            };

            // Handle help request
            const askForHelp = async () => {
                if (!helpInput.trim() || helpLoading) return;

                setHelpLoading(true);
                
                try {
                    const helpMessages = [
                        { 
                            role: 'system', 
                            content: `√û√∫ ert hj√°lpari fyrir √≠slenskunema. Nemandinn er √≠ hlutverkaleik √° veitingasta√∞ og √æarf hj√°lp.
                            
Svara√∞u √° SAMA tungum√°li og nemandinn skrifar √°.
Gef√∞u stutta og sk√Ωra hj√°lp - √≠slenska setninguna/or√∞i√∞ sem nemandinn √æarf.
Gef√∞u l√≠ka d√¶mi um hvernig √° a√∞ nota √æa√∞ √≠ samhengi.

Or√∞afor√∞i sem g√¶ti hj√°lpa√∞:
- Panta bor√∞, matse√∞ill, r√©ttur dagsins
- Forr√©ttur, a√∞alr√©ttur, eftirr√©ttur  
- Ofn√¶mi, sleppa (einhverju)
- Reikningur, kvittun, borga
- "Hva√∞ m√° bj√≥√∞a √æ√©r?", "Hverju m√¶lir √æ√∫ me√∞?", "M√° √©g f√° reikninginn?"` 
                        },
                        { role: 'user', content: helpInput }
                    ];

                    const response = await callOpenAI(helpMessages, 300);
                    setHelpResponse(response);
                    
                } catch (error) {
                    console.error('Help error:', error);
                    setHelpResponse('Villa kom upp. Reyndu aftur.');
                } finally {
                    setHelpLoading(false);
                }
            };

            // Handle key press
            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            const handleHelpKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    askForHelp();
                }
            };

            // Get status text
            const getStatusText = () => {
                switch (status) {
                    case 'starting': return 'Smelltu √° hnappinn til a√∞ byrja';
                    case 'listening': return 'üé§ Hlustar... tala√∞u n√∫na!';
                    case 'thinking': return 'ü§î √ûj√≥nninn hugsar...';
                    case 'speaking': return 'üîä √ûj√≥nninn talar...';
                    case 'waiting': return 'üí¨ √û√∫ √°tt a√∞ svara';
                    case 'finished': return 'üéâ Vel gert!';
                    default: return '';
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="bg-white shadow-sm py-4 px-6">
                        <div className="max-w-2xl mx-auto">
                            <button 
                                onClick={() => window.history.back()} 
                                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
                            >
                                ‚Üê Til baka
                            </button>
                            <h1 className="text-2xl font-light text-gray-800">üçΩÔ∏è Veitingasta√∞urinn</h1>
                            <p className="text-sm text-gray-600 font-light mt-1">Hlutverkaleikur ¬∑ A1-A2</p>
                        </div>
                    </header>

                    {/* Main content */}
                    <main className="flex-1 max-w-2xl w-full mx-auto p-4 flex flex-col">
                        
                        {/* Start button (before conversation starts) */}
                        {!conversationStarted && (
                            <div className="flex-1 flex flex-col items-center justify-center">
                                <div className="text-center mb-8">
                                    <div className="text-6xl mb-4">üçΩÔ∏è</div>
                                    <h2 className="text-xl font-light text-gray-800 mb-2">Velkomin √° veitingasta√∞inn!</h2>
                                    <p className="text-gray-600 font-light">√û√∫ ert vi√∞skiptavinur og √¶tlar a√∞ bor√∞a √° veitingasta√∞.</p>
                                    <p className="text-gray-600 font-light">√ûj√≥nninn mun tala vi√∞ √æig √° √≠slensku.</p>
                                </div>
                                <button
                                    onClick={startConversation}
                                    className="px-8 py-4 bg-blue-500 text-white text-lg rounded-xl hover:bg-blue-600 transition-colors font-light shadow-lg"
                                >
                                    Byrja samtal
                                </button>
                            </div>
                        )}

                        {/* Conversation area */}
                        {conversationStarted && status !== 'finished' && (
                            <>
                                {/* Speaker area */}
                                <div className="flex-1 flex flex-col items-center justify-center bg-white rounded-2xl shadow-sm p-8 mb-4">
                                    <div className="mb-6">
                                        <SpeakerIcon isSpeaking={isSpeaking} />
                                    </div>
                                    
                                    {isSpeaking && <SoundWave />}
                                    
                                    <p className={`text-lg font-light mt-4 ${
                                        status === 'waiting' ? 'text-green-600' : 
                                        status === 'speaking' ? 'text-blue-600' :
                                        status === 'listening' ? 'text-red-500' :
                                        'text-gray-600'
                                    }`}>
                                        {getStatusText()}
                                    </p>
                                </div>

                                {/* Input area */}
                                <div className="bg-white rounded-xl shadow-sm p-4">
                                    <div className="flex gap-2 mb-3">
                                        <button
                                            onClick={toggleRecording}
                                            disabled={loading || isSpeaking}
                                            className={`p-4 rounded-xl transition-colors ${
                                                isRecording 
                                                    ? 'bg-red-500 text-white' 
                                                    : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                                            } disabled:opacity-50`}
                                        >
                                            <MicIcon isRecording={isRecording} />
                                        </button>
                                        <input
                                            ref={inputRef}
                                            type="text"
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            disabled={loading || isSpeaking}
                                            placeholder={isRecording ? "Hlustar..." : "E√∞a skrifa√∞u h√©r..."}
                                            className="flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 font-light disabled:bg-gray-50"
                                        />
                                        <button
                                            onClick={sendMessage}
                                            disabled={!input.trim() || loading || isSpeaking}
                                            className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                        >
                                            <SendIcon />
                                        </button>
                                    </div>
                                    
                                    {/* Help button */}
                                    <button
                                        onClick={() => setShowHelp(!showHelp)}
                                        className="flex items-center gap-2 text-sm text-gray-500 hover:text-gray-700 font-light"
                                    >
                                        <HelpIcon />
                                        <span>√ûarftu hj√°lp? Spur√∞u √° √æ√≠nu m√°li</span>
                                    </button>

                                    {/* Help panel */}
                                    {showHelp && (
                                        <div className="mt-4 p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                                            <p className="text-sm text-gray-700 font-light mb-3">
                                                Skrifa√∞u spurningu √° √æ√≠nu m√≥√∞urm√°li (t.d. "How do I say I want fish?")
                                            </p>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={helpInput}
                                                    onChange={(e) => setHelpInput(e.target.value)}
                                                    onKeyPress={handleHelpKeyPress}
                                                    placeholder="Ask in your language..."
                                                    className="flex-1 px-3 py-2 border border-yellow-300 rounded-lg focus:outline-none focus:border-yellow-500 font-light text-sm"
                                                />
                                                <button
                                                    onClick={askForHelp}
                                                    disabled={!helpInput.trim() || helpLoading}
                                                    className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:bg-gray-300 text-sm"
                                                >
                                                    {helpLoading ? '...' : '?'}
                                                </button>
                                            </div>
                                            {helpResponse && (
                                                <div className="mt-3 p-3 bg-white rounded-lg text-sm font-light text-gray-700">
                                                    {helpResponse}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {/* Finished state */}
                        {status === 'finished' && (
                            <div className="flex-1 flex flex-col items-center justify-center">
                                <div className="bg-white rounded-2xl shadow-sm p-8 text-center max-w-lg">
                                    <div className="text-6xl mb-4">üéâ</div>
                                    <h2 className="text-2xl font-light text-gray-800 mb-4">Vel gert!</h2>
                                    <div className="text-left bg-green-50 rounded-xl p-4 mb-6">
                                        <p className="text-gray-700 font-light whitespace-pre-wrap">{feedback}</p>
                                    </div>
                                    <button
                                        onClick={() => window.location.reload()}
                                        className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors font-light"
                                    >
                                        Reyna aftur
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<Veitingastadur />);
    </script>
</body>
</html>
