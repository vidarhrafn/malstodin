<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun 12: Sumarvinnan ‚Äì √çSAT1√çA</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-top {
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 1rem;
    }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .tab-btn {
      transition: all 0.2s;
      position: relative;
    }
    .tab-btn.active {
      background: white;
      border-bottom: 3px solid #3b82f6;
      color: #2563eb;
    }
    .tab-btn:not(.active):hover {
      background: #f3f4f6;
    }
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // ========== AI ==========
    async function callOpenAI(messages, max_tokens = 300, model = 'gpt-4o', temperature = 0.3) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages, max_tokens, model, temperature })
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    // ========== DATA ==========
    const LISTENING_TEXT = `Bjarki er a√∞ velta fyrir s√©r sumarvinnu.

"Hvar langar √æig a√∞ vinna?" spyr Anna.

‚ÄûMig langar a√∞ vinna √≠ t√∂lvub√∫√∞. Kannski Elko," segir Bjarki.

‚ÄûG√≥√∞ hugmynd! Hefur√∞u b√∫i√∞ til ferilskr√° √≠ sk√≥lanum?" spyr Sigur√∞ur.

‚ÄûNei, √©g veit ekki alveg hvernig √©g √° a√∞ gera √æa√∞," segir Bjarki.

‚Äû√ûa√∞ er ekkert m√°l. √âg hj√°lpa √æ√©r," segir Sigur√∞ur. ‚Äû√û√∫ √æarft a√∞ skrifa um menntun √æ√≠na og reynslu."

‚ÄûEn √©g hef enga reynslu enn √æ√°, nema bara √∫r vinnusk√≥lanum. Telst √æa√∞ me√∞?" spyr Bjarki.

‚ÄûJ√° algerlega! √û√∫ getur l√≠ka skrifa√∞ um sk√≥lann √æinn og √°hugam√°lin √æ√≠n," √∫tsk√Ωrir Anna.

‚ÄûHva√∞ vannst √æ√∫ √≠ fyrstu sumarvinnunni √æinni, pabbi?" spyr Bjarki.

‚Äû√âg vann √≠ b√∫√∞. √âg var √° vakt fr√° n√≠u til fimm. √ûa√∞ var erfitt til a√∞ byrja me√∞, en √©g l√¶r√∞i miki√∞," svarar Sigur√∞ur.

‚ÄûOg √©g vann √° b√≥kasafni," segir Anna. ‚ÄûFyrsta daginn var √©g √≥tr√∫lega stressu√∞ en allt f√≥lki√∞ var mj√∂g vingjarnlegt."

‚ÄûHven√¶r √¶tti √©g a√∞ senda ums√≥knina?" spyr Bjarki.

‚Äû√ûv√≠ fyrr √æv√≠ betra! √ûa√∞ eru mj√∂g margir sem vilja f√° sumarvinnu," segir Sigur√∞ur.

‚ÄûJ√°, og gleymdu ekki a√∞ setja me√∞m√¶lendur √° ferilskr√°na. Kannski getur kennari √∫r sk√≥lanum skrifa√∞ fyrir √æig?" segir Anna.

‚ÄûG√≥√∞ hugmynd! √âg √¶tla a√∞ bi√∞ja st√¶r√∞fr√¶√∞ikennarann minn," segir Bjarki. "Getur √æ√∫ a√∞sto√∞a√∞ mig me√∞ ferilskr√° √≠ kv√∂ld pabbi?"

‚ÄûJ√° au√∞vita√∞! Vi√∞ gerum √æa√∞ saman eftir matinn," svarar Sigur√∞ur.`;

    const VOCAB = [
      { w: "sumarvinna (kvk)", hint: "vinna sem √æ√∫ vinnur √° sumrin" },
      { w: "a√∞ s√¶kja um", hint: "a√∞ bi√∞ja um vinnu, a√∞ senda ums√≥kn" },
      { w: "ferilskr√° (kvk)", hint: "skjal me√∞ uppl√Ωsingum um menntun og vinnu √æ√≠na" },
      { w: "ums√≥kn (kvk)", hint: "√æa√∞ sem √æ√∫ sendir √æegar √æ√∫ s√¶kir um vinnu" },
      { w: "vakt (kvk)", hint: "t√≠mi √æegar √æ√∫ vinnur, t.d. fr√° n√≠u til fimm" },
      { w: "reynsla (kvk)", hint: "√æa√∞ sem √æ√∫ l√¶rir af √æv√≠ a√∞ vinna e√∞a gera eitthva√∞" },
      { w: "menntun (kvk)", hint: "√æa√∞ sem √æ√∫ l√¶rir √≠ sk√≥la e√∞a annars sta√∞ar" },
      { w: "me√∞m√¶lendur (kk ft)", hint: "f√≥lk sem segir a√∞ √æ√∫ s√©rt duglegur/dugleg og g√≥√∞ur/g√≥√∞" }
    ];

    const TRANSLATIONS = [
      { word: 'a√∞ velta fyrir s√©r' },
      { word: 'vingjarnlegur' }
    ];

    const MULTIPLE_CHOICE = [
      { question: 'Hvar langar Bjarka a√∞ vinna?', options: ['√ç b√≥kab√∫√∞', '√ç t√∂lvub√∫√∞', '√Å veitingasta√∞', '√Å b√≥kasafni'], correct: 1 },
      { question: 'Hva√∞an hefur Bjarki reynslu?', options: ['Af b√≥kasafni', '√ör b√∫√∞', '√ör vinnusk√≥lanum', '√ör t√∂lvub√∫√∞'], correct: 2 },
      { question: 'Hvar vann Sigur√∞ur √≠ fyrstu sumarvinnunni?', options: ['√Å b√≥kasafni', '√ç b√∫√∞', 'Hj√° tannl√¶kni', '√Å veitingasta√∞'], correct: 1 },
      { question: 'Hvernig var Anna fyrsta daginn √≠ vinnunni?', options: ['H√∫n var gl√∂√∞', 'H√∫n var stressu√∞', 'H√∫n var rei√∞', 'H√∫n var √æreytt'], correct: 1 },
      { question: 'Hvern √¶tlar Bjarki a√∞ bi√∞ja um a√∞ vera me√∞m√¶landi?', options: ['√ç√ær√≥ttakennarann', 'St√¶r√∞fr√¶√∞ikennarann', '√çslenskukennarann', 'Enskukennarann'], correct: 1 }
    ];

    const OPEN_QUESTIONS = [
      { question: 'Hva√∞ segir Sigur√∞ur a√∞ Bjarki √æurfi a√∞ skrifa √° ferilskr√°na?', expectedContent: ['menntun', 'reynslu', 'sk√≥lann', '√°hugam√°l'] },
      { question: 'Hvernig var fyrsta vinna Sigur√∞ar og hva√∞ l√¶r√∞i hann?', expectedContent: ['erfitt', 'til a√∞ byrja me√∞', 'l√¶r√∞i miki√∞', 'b√∫√∞', 'vakt'] },
      { question: 'Hvers vegna √° Bjarki a√∞ senda ums√≥knina flj√≥tt?', expectedContent: ['√æv√≠ fyrr √æv√≠ betra', 'margir vilja f√°', 'st√∂√∞ur fyllast', 'hratt'] }
    ];

    const TRUE_FALSE = [
      { statement: 'Bjarki vill vinna √≠ Elko.', correct: true },
      { statement: 'Bjarki hefur b√∫i√∞ til ferilskr√° √≠ sk√≥lanum.', correct: false },
      { statement: 'Sigur√∞ur vann √° b√≥kasafni √≠ fyrstu sumarvinnunni.', correct: false },
      { statement: 'Anna var stressu√∞ fyrsta daginn √≠ vinnunni.', correct: true },
      { statement: 'Bjarki √¶tlar a√∞ bi√∞ja √≠slenskukennarann um a√∞ vera me√∞m√¶landi.', correct: false }
    ];

    const MATCHING = [
      { left: 'Bjarki', right: 'Vill vinna √≠ Elko' },
      { left: 'Sigur√∞ur', right: 'Vann √≠ b√∫√∞ √° vakt fr√° n√≠u til fimm' },
      { left: 'Anna', right: 'Vann √° b√≥kasafni og var stressu√∞ fyrsta daginn' },
      { left: 'Ferilskr√°', right: 'Skjal me√∞ uppl√Ωsingum um menntun og reynslu' }
    ];

    const TABS = [
      { id: 'thyding', label: '√û√Ω√∞ing', icon: 'üåê' },
      { id: 'krossar', label: 'Krossar', icon: '‚úì' },
      { id: 'opnar', label: 'Opnar', icon: 'üìù' },
      { id: 'rettrangt', label: 'R√©tt/Rangt', icon: '‚öñÔ∏è' },
      { id: 'para', label: 'Para√∞u saman', icon: 'üîó' }
    ];

    // ========== APP ==========
    const HlustunApp = () => {
      const [activeTab, setActiveTab] = useState('thyding');
      const [showVocab, setShowVocab] = useState(true);
      const [isPlaying, setIsPlaying] = useState(false);
      const [playbackRate, setPlaybackRate] = useState(1);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);
      const audioRef = useRef(null);

      // Translation
      const [translationAnswers, setTranslationAnswers] = useState(['', '']);
      const [translationFeedback, setTranslationFeedback] = useState([null, null]);
      const [translationLoading, setTranslationLoading] = useState([false, false]);

      // MC
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);
      const shuffledMC = useMemo(() => {
        return MULTIPLE_CHOICE.map(q => {
          const optionsWithIndex = q.options.map((opt, idx) => ({ text: opt, originalIndex: idx }));
          for (let i = optionsWithIndex.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];
          }
          return { question: q.question, options: optionsWithIndex, correctOriginalIndex: q.correct };
        });
      }, []);

      // Open
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // T/F
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Matching
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);
      const rightOptions = useMemo(() => {
        const options = MATCHING.map(m => m.right);
        for (let i = options.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }
        return options;
      }, []);

      const [showTextModal, setShowTextModal] = useState(false);

      useEffect(() => {
        if (audioRef.current) audioRef.current.playbackRate = playbackRate;
      }, [playbackRate]);

      // Completion checks
      const isThydingComplete = translationFeedback.every(f => f !== null);
      const isKrossarComplete = mcChecked;
      const isOpnarComplete = openFeedback.every(f => f !== null);
      const isRettRangtComplete = tfChecked;
      const isParaComplete = matchingChecked;
      const allCompleted = isThydingComplete && isKrossarComplete && isOpnarComplete && isRettRangtComplete && isParaComplete;

      const completionMap = {
        thyding: isThydingComplete,
        krossar: isKrossarComplete,
        opnar: isOpnarComplete,
        rettrangt: isRettRangtComplete,
        para: isParaComplete
      };

      const completedCount = Object.values(completionMap).filter(Boolean).length;

      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) { audioRef.current.pause(); } else { audioRef.current.play(); }
        setIsPlaying(!isPlaying);
      };

      // Translation handlers
      const checkTranslation = async (index) => {
        const answer = translationAnswers[index].trim();
        if (!answer) return;
        setTranslationLoading(prev => { const n = [...prev]; n[index] = true; return n; });
        try {
          const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.
√çSLENSKA OR√êI√ê: "${TRANSLATIONS[index].word}"
SVAR NEMANDA: "${answer}"
VERKEFNI:
1. Greina sj√°lfkrafa hva√∞a tungum√°l nemandinn nota√∞i
2. Meta hvort √æ√Ω√∞ingin s√© r√©tt
3. Skila stuttri, j√°kv√¶√∞ri endurgj√∂f
SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{"correct":boolean,"detected_language":"nafn tungum√°lsins","feedback_is":"Endurgj√∂f √° √≠slensku","feedback_native":"Endurgj√∂f √° greinda tungum√°linu","correct_translation":"G√≥√∞ √æ√Ω√∞ing ef rangt, annars null"}`;
          const result = await callOpenAI([{ role: 'system', content: sys }, { role: 'user', content: answer }], 200, 'gpt-4o', 0.2);
          const feedback = JSON.parse(result);
          setTranslationFeedback(prev => { const n = [...prev]; n[index] = feedback; return n; });
        } catch (e) { console.error(e); }
        finally { setTranslationLoading(prev => { const n = [...prev]; n[index] = false; return n; }); }
      };

      const resetTranslation = (index) => {
        setTranslationAnswers(prev => { const n = [...prev]; n[index] = ''; return n; });
        setTranslationFeedback(prev => { const n = [...prev]; n[index] = null; return n; });
      };

      // MC handlers
      const handleMcAnswer = (qIndex, shuffledIndex) => {
        if (mcChecked) return;
        const n = [...mcAnswers]; n[qIndex] = shuffledIndex; setMcAnswers(n);
      };
      const checkMC = () => { if (shuffledMC.every((_, i) => Number.isInteger(mcAnswers[i]))) setMcChecked(true); };
      const resetMC = () => { setMcAnswers([]); setMcChecked(false); };

      // Open handlers
      const checkOpenQuestion = async (index) => {
        const answer = openAnswers[index].trim();
        if (!answer) return;
        setOpenLoading(prev => { const n = [...prev]; n[index] = true; return n; });
        try {
          const q = OPEN_QUESTIONS[index];
          const sys = `√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ opnum spurningum.
SPURNINGIN: "${q.question}"
SVAR NEMANDA: "${answer}"
LYKILATRI√êI: ${q.expectedContent.join(', ')}
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ INNIHALD (hunsa sm√°v√¶gilegar villur).
SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{"correct":boolean,"feedback":"Stutt og hvetjandi endurgj√∂f √° √≠slensku"}`;
          const result = await callOpenAI([{ role: 'system', content: sys }, { role: 'user', content: answer }], 150, 'gpt-4o', 0.2);
          const feedback = JSON.parse(result);
          setOpenFeedback(prev => { const n = [...prev]; n[index] = feedback; return n; });
        } catch (e) { console.error(e); }
        finally { setOpenLoading(prev => { const n = [...prev]; n[index] = false; return n; }); }
      };

      const resetOpenQuestion = (index) => {
        setOpenAnswers(prev => { const n = [...prev]; n[index] = ''; return n; });
        setOpenFeedback(prev => { const n = [...prev]; n[index] = null; return n; });
      };

      // T/F handlers
      const checkTF = () => setTfChecked(true);
      const resetTF = () => { setTfAnswers([]); setTfChecked(false); };

      // Matching handlers
      const checkMatching = () => setMatchingChecked(true);
      const resetMatching = () => { setMatchingAnswers(Array(MATCHING.length).fill('')); setMatchingChecked(false); };

      return (
        <div className="min-h-screen pb-16">
          {/* Header */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-6">
              <button onClick={() => window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-1">Hlustun 12: Sumarvinnan</h1>
              <p className="text-gray-500 text-sm font-light">Hlustunarverkefni ¬∑ A1‚ÄìA2</p>
            </div>
          </header>

          {/* Sticky top: player + vocab */}
          <div className="sticky-top bg-white shadow-md border-b border-gray-200">
            {/* Audio Player */}
            <div className="max-w-4xl mx-auto px-6 py-3">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-3 border-2 border-blue-200">
                <div className="flex items-center gap-3">
                  <button onClick={togglePlay}
                    className="bg-blue-500 text-white w-11 h-11 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors flex-shrink-0">
                    {isPlaying
                      ? <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                      : <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>}
                  </button>
                  <button onClick={() => { if (audioRef.current) audioRef.current.currentTime -= 10; }}
                    className="bg-white text-gray-700 w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors text-xs flex-shrink-0">‚èÆÔ∏è</button>

                  <div className="flex-1 min-w-0">
                    <div className="flex items-center justify-between mb-1">
                      <p className="text-sm font-normal text-gray-800">üéß Hlusta √° textann</p>
                      <span className="text-xs text-gray-600 font-mono">
                        {Math.floor(currentTime/60)}:{String(Math.floor(currentTime%60)).padStart(2,'0')} / {Math.floor(duration/60)}:{String(Math.floor(duration%60)).padStart(2,'0')}
                      </span>
                    </div>
                    <div className="w-full h-2 bg-white/60 rounded-full cursor-pointer relative overflow-hidden"
                      onClick={(e) => { if (!audioRef.current) return; const r = e.currentTarget.getBoundingClientRect(); audioRef.current.currentTime = ((e.clientX - r.left) / r.width) * duration; }}>
                      <div className="absolute top-0 left-0 h-full bg-blue-500 transition-all" style={{ width: `${duration ? (currentTime/duration)*100 : 0}%` }}/>
                    </div>
                    <audio ref={audioRef} src="media/hlustun12_sumarvinna.mp3" preload="metadata"
                      onEnded={() => setIsPlaying(false)} onPlay={() => setIsPlaying(true)} onPause={() => setIsPlaying(false)}
                      onTimeUpdate={() => setCurrentTime(audioRef.current?.currentTime || 0)}
                      onLoadedMetadata={() => setDuration(audioRef.current?.duration || 0)}/>
                  </div>

                  <button onClick={() => { if (audioRef.current) audioRef.current.currentTime += 10; }}
                    className="bg-white text-gray-700 w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors text-xs flex-shrink-0">‚è≠Ô∏è</button>

                  <div className="flex gap-1 flex-shrink-0">
                    {[0.75, 1, 1.25].map(r => (
                      <button key={r} onClick={() => setPlaybackRate(r)}
                        className={`px-2 py-1 rounded text-xs font-light transition-colors ${playbackRate === r ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>
                        {r}√ó
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            </div>

            {/* Vocabulary collapsible */}
            <div className="max-w-4xl mx-auto px-6 pb-2">
              <button onClick={() => setShowVocab(v => !v)}
                className="flex items-center gap-2 text-sm font-normal text-gray-600 hover:text-gray-800 transition-colors py-1">
                <span className="text-base">{showVocab ? '‚ñº' : '‚ñ∂'}</span>
                <span>üìò Lykilor√∞</span>
                {!showVocab && <span className="text-gray-400 font-light">({VOCAB.length} or√∞)</span>}
              </button>
              {showVocab && (
                <div className="vocab-grid pb-2">
                  {VOCAB.map((item, i) => (
                    <div key={i} className="rounded-lg border border-yellow-200 bg-yellow-50 px-3 py-2">
                      <div className="text-sm font-normal text-gray-900">{item.w}</div>
                      <div className="text-xs text-gray-600 font-light">{item.hint}</div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Tab bar */}
            <div className="max-w-4xl mx-auto px-6">
              <div className="flex border-b border-gray-200 overflow-x-auto">
                {TABS.map(tab => {
                  const done = completionMap[tab.id];
                  const isActive = activeTab === tab.id;
                  return (
                    <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                      className={`tab-btn flex items-center gap-1 px-4 py-3 text-sm font-normal whitespace-nowrap border-b-3 flex-shrink-0 ${isActive ? 'active text-blue-600 border-b-2' : 'text-gray-600'}`}>
                      <span>{tab.icon}</span>
                      <span>{tab.label}</span>
                      {done && <span className="ml-1 text-green-500 text-base">‚úì</span>}
                    </button>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Tab content */}
          <main className="max-w-4xl mx-auto px-6 mt-6">

            {/* √û√ù√êING */}
            {activeTab === 'thyding' && (
              <section className="bg-white rounded-xl shadow-md p-8 space-y-6">
                <h2 className="text-2xl font-light text-gray-800">üåê √û√Ω√∞ing</h2>
                {TRANSLATIONS.map((item, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">
                      √û√Ωddu or√∞i√∞ √° √æitt m√≥√∞urm√°l: <span className="font-semibold text-blue-600">{item.word}</span>
                    </p>
                    <textarea
                      value={translationAnswers[index]}
                      onChange={(e) => { const n = [...translationAnswers]; n[index] = e.target.value; setTranslationAnswers(n); }}
                      placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-light mb-3"
                      rows="2"
                      disabled={translationFeedback[index]?.correct}
                    />
                    {!translationFeedback[index] && (
                      <button onClick={() => checkTranslation(index)}
                        disabled={!translationAnswers[index].trim() || translationLoading[index]}
                        className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">
                        {translationLoading[index] ? 'Athuga...' : 'Athuga √æ√Ω√∞ingu'}
                      </button>
                    )}
                    {translationFeedback[index] && (
                      <div className={`mt-4 p-4 rounded-lg border-2 ${translationFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                        <p className="font-normal mb-1">üìö {translationFeedback[index].feedback_is}</p>
                        <p className="text-sm font-light italic">{translationFeedback[index].feedback_native}</p>
                        {translationFeedback[index].correct
                          ? <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                          : <>
                              <p className="mt-2 text-sm"><span className="font-normal">Betri √æ√Ω√∞ing:</span> {translationFeedback[index].correct_translation}</p>
                              <button onClick={() => resetTranslation(index)}
                                className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors">Reyna aftur</button>
                            </>}
                      </div>
                    )}
                  </div>
                ))}
                {isThydingComplete && (
                  <div className="text-center py-4">
                    <p className="text-green-600 font-normal text-lg">‚úÖ √û√Ω√∞ingum loki√∞!</p>
                    <button onClick={() => setActiveTab('krossar')}
                      className="mt-3 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-normal transition-colors">
                      √Åfram √≠ Krossaspurningar ‚Üí
                    </button>
                  </div>
                )}
              </section>
            )}

            {/* KROSSAR */}
            {activeTab === 'krossar' && (
              <section className="bg-white rounded-xl shadow-md p-8">
                <h2 className="text-2xl font-light text-gray-800 mb-6">‚úì Krossaspurningar</h2>
                <div className="space-y-6">
                  {shuffledMC.map((q, qIndex) => (
                    <div key={qIndex} className="border-2 border-gray-200 rounded-lg p-6">
                      <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                      <div className="space-y-2">
                        {q.options.map((option, shuffledIndex) => {
                          const isSelected = mcAnswers[qIndex] === shuffledIndex;
                          const isCorrect = option.originalIndex === q.correctOriginalIndex;
                          let cls = "w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-light ";
                          if (!mcChecked) {
                            cls += isSelected ? "border-blue-500 bg-blue-50" : "border-gray-300 hover:border-gray-400 bg-white";
                          } else {
                            if (isCorrect) cls += "border-green-500 bg-green-50 text-green-800";
                            else if (isSelected && !isCorrect) cls += "border-red-500 bg-red-50 text-red-800";
                            else cls += "border-gray-300 bg-gray-50";
                          }
                          return (
                            <button key={shuffledIndex} onClick={() => handleMcAnswer(qIndex, shuffledIndex)} className={cls} disabled={mcChecked}>
                              {option.text}
                              {mcChecked && isCorrect && " ‚úì"}
                              {mcChecked && isSelected && !isCorrect && " ‚úó"}
                            </button>
                          );
                        })}
                      </div>
                    </div>
                  ))}
                </div>
                <div className="flex gap-4 mt-6">
                  <button onClick={checkMC}
                    disabled={shuffledMC.some((_, i) => !Number.isInteger(mcAnswers[i])) || mcChecked}
                    className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">
                    Athuga sv√∂r
                  </button>
                  {mcChecked && (
                    <>
                      <button onClick={resetMC} className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
                      <button onClick={() => setActiveTab('opnar')} className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors">√Åfram ‚Üí</button>
                    </>
                  )}
                </div>
              </section>
            )}

            {/* OPNAR */}
            {activeTab === 'opnar' && (
              <section className="bg-white rounded-xl shadow-md p-8">
                <h2 className="text-2xl font-light text-gray-800 mb-6">üìù Opnar spurningar</h2>
                <div className="space-y-6">
                  {OPEN_QUESTIONS.map((q, index) => (
                    <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                      <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                      <textarea
                        value={openAnswers[index]}
                        onChange={(e) => { const n = [...openAnswers]; n[index] = e.target.value; setOpenAnswers(n); }}
                        placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-light mb-3"
                        rows="3"
                        disabled={openFeedback[index]?.correct}
                      />
                      {!openFeedback[index] && (
                        <button onClick={() => checkOpenQuestion(index)}
                          disabled={!openAnswers[index].trim() || openLoading[index]}
                          className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">
                          {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                        </button>
                      )}
                      {openFeedback[index] && (
                        <div className={`mt-4 p-4 rounded-lg border-2 ${openFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                          <p className="font-light">{openFeedback[index].feedback}</p>
                          {openFeedback[index].correct
                            ? <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                            : <button onClick={() => resetOpenQuestion(index)}
                                className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors">Reyna aftur</button>}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                {isOpnarComplete && (
                  <div className="mt-6">
                    <button onClick={() => setActiveTab('rettrangt')} className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors">√Åfram ‚Üí</button>
                  </div>
                )}
              </section>
            )}

            {/* R√âTT/RANGT */}
            {activeTab === 'rettrangt' && (
              <section className="bg-white rounded-xl shadow-md p-8">
                <h2 className="text-2xl font-light text-gray-800 mb-6">‚öñÔ∏è R√©tt e√∞a rangt?</h2>
                <div className="space-y-4">
                  {TRUE_FALSE.map((item, index) => (
                    <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                      <p className="text-lg font-light text-gray-800 mb-4">{item.statement}</p>
                      <div className="flex gap-4">
                        {[true, false].map((val) => {
                          const label = val ? 'R√©tt' : 'Rangt';
                          const isSelected = tfAnswers[index] === val;
                          const isCorrectChoice = item.correct === val;
                          let cls = "flex-1 px-6 py-3 rounded-lg border-2 font-normal transition-all ";
                          if (!tfChecked) {
                            cls += isSelected ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-gray-400 bg-white';
                          } else {
                            if (isSelected && isCorrectChoice) cls += 'border-green-500 bg-green-50 text-green-800';
                            else if (isSelected && !isCorrectChoice) cls += 'border-red-500 bg-red-50 text-red-800';
                            else if (!isSelected && isCorrectChoice) cls += 'border-green-500 bg-green-50 text-green-800';
                            else cls += 'border-gray-300 bg-gray-50';
                          }
                          return (
                            <button key={String(val)} onClick={() => { if (!tfChecked) { const n = [...tfAnswers]; n[index] = val; setTfAnswers(n); } }}
                              className={cls} disabled={tfChecked}>
                              {label}
                              {tfChecked && isSelected && isCorrectChoice && ' ‚úì'}
                              {tfChecked && isSelected && !isCorrectChoice && ' ‚úó'}
                              {tfChecked && !isSelected && isCorrectChoice && ' ‚úì'}
                            </button>
                          );
                        })}
                      </div>
                    </div>
                  ))}
                </div>
                <div className="flex gap-4 mt-6">
                  <button onClick={checkTF}
                    disabled={tfAnswers.length !== TRUE_FALSE.length || tfChecked}
                    className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">
                    Athuga sv√∂r
                  </button>
                  {tfChecked && (
                    <>
                      <button onClick={resetTF} className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
                      <button onClick={() => setActiveTab('para')} className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-normal transition-colors">√Åfram ‚Üí</button>
                    </>
                  )}
                </div>
              </section>
            )}

            {/* PARA√êU SAMAN */}
            {activeTab === 'para' && (
              <section className="bg-white rounded-xl shadow-md p-8">
                <h2 className="text-2xl font-light text-gray-800 mb-6">üîó Para√∞u saman</h2>
                <p className="text-gray-600 font-light mb-6">Para√∞u saman vinstri og h√¶gri hli√∞:</p>
                <div className="space-y-4">
                  {MATCHING.map((item, index) => {
                    const isCorrect = matchingAnswers[index] === item.right;
                    return (
                      <div key={index} className="flex flex-col md:flex-row gap-3 items-start md:items-center">
                        <div className="flex-1 font-normal text-gray-800 bg-blue-50 border-2 border-blue-200 rounded-lg px-4 py-3">
                          {item.left}
                        </div>
                        <div className="text-gray-400 text-xl hidden md:block">‚Üí</div>
                        <select
                          value={matchingAnswers[index]}
                          onChange={(e) => { const n = [...matchingAnswers]; n[index] = e.target.value; setMatchingAnswers(n); }}
                          disabled={matchingChecked}
                          className={`flex-1 px-4 py-3 rounded-lg border-2 font-light focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                            matchingChecked ? isCorrect ? 'border-green-500 bg-green-50 text-green-800' : 'border-red-500 bg-red-50 text-red-800' : 'border-gray-300 bg-white'
                          }`}>
                          <option value="">Veldu svar...</option>
                          {rightOptions.map((opt, i) => <option key={i} value={opt}>{opt}</option>)}
                        </select>
                        {matchingChecked && <div className="text-2xl">{isCorrect ? '‚úì' : '‚úó'}</div>}
                        {matchingChecked && !isCorrect && (
                          <div className="w-full md:w-auto text-sm text-gray-600 font-light italic">R√©tt: {item.right}</div>
                        )}
                      </div>
                    );
                  })}
                </div>
                <div className="flex gap-4 mt-6">
                  <button onClick={checkMatching}
                    disabled={matchingAnswers.includes('') || matchingChecked}
                    className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors">
                    Athuga sv√∂r
                  </button>
                  {matchingChecked && (
                    <button onClick={resetMatching} className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors">Endurstilla</button>
                  )}
                </div>
              </section>
            )}

            {/* Read text unlock */}
            {allCompleted && (
              <div className="text-center mt-8 p-8 bg-white rounded-xl shadow-md">
                <p className="text-2xl font-light text-gray-800 mb-2">üéâ Fr√°b√¶rlega unni√∞!</p>
                <p className="text-gray-500 font-light mb-4">√û√∫ hefur loki√∞ √∂llum verkefnum.</p>
                <button onClick={() => setShowTextModal(true)}
                  className="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 font-normal text-lg transition-colors">
                  üìñ Lesa hlustunartextann
                </button>
              </div>
            )}

            {/* Progress bar */}
            <div className="mt-6 bg-white rounded-xl shadow-md p-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm font-light text-gray-600">Framvinda</span>
                <span className="text-sm font-normal text-gray-800">{completedCount}/{TABS.length}</span>
              </div>
              <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                <div className="h-full bg-green-500 transition-all duration-500"
                  style={{ width: `${(completedCount / TABS.length) * 100}%` }}/>
              </div>
              <div className="flex mt-2 gap-1">
                {TABS.map(tab => (
                  <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                    className={`flex-1 py-1 px-1 rounded text-xs font-light transition-colors truncate ${
                      completionMap[tab.id] ? 'bg-green-100 text-green-700 border border-green-300' :
                      activeTab === tab.id ? 'bg-blue-100 text-blue-700 border border-blue-300' :
                      'bg-gray-100 text-gray-500 border border-gray-200'
                    }`}>
                    {completionMap[tab.id] ? '‚úì ' : ''}{tab.label}
                  </button>
                ))}
              </div>
            </div>
          </main>

          {/* Modal */}
          {showTextModal && (
            <div className="modal-overlay" onClick={() => setShowTextModal(false)}>
              <div className="modal-content" onClick={e => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex justify-between items-center">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Hlustunartextinn</h2>
                  <button onClick={() => setShowTextModal(false)} className="text-gray-500 hover:text-gray-700 text-3xl leading-none">√ó</button>
                </div>
                <div className="p-8">
                  {LISTENING_TEXT.split('\n\n').map((para, i) => (
                    <p key={i} className="mb-4 text-gray-700 font-light leading-relaxed">{para}</p>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunApp />);
  </script>
</body>
</html>
