<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun 4: Veitingasta√∞ur ‚Äì A2</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player { position: sticky; top: 0; z-index: 50; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .answer-option { border: 2px solid #e0e0e0; transition: all 0.2s; cursor: pointer; }
    .answer-option:hover:not(.disabled) { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.selected { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.correct { border-color:#4caf50; background:#e8f5e9; }
    .answer-option.incorrect { border-color:#f44336; background:#ffebee; }
    .answer-option.disabled { cursor: default; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // --- (valkv√¶tt) OpenAI gateway ef √æ√∫ ert me√∞ Netlify function ---
    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }
    function extractFirstJSON(text){
      const s = text.indexOf('{'); const e = text.lastIndexOf('}');
      if (s < 0 || e < 0 || e <= s) throw new Error('No JSON found');
      return JSON.parse(text.slice(s, e+1));
    }

    // --- Lykilor√∞ og grunnstillingar fyrir VEITINGASTA√ê ---
    const ORIGINAL_TEXT = "brag√∞ (hk)";

    const VOCAB = [
      { w: "veitingasta√∞ur (kk)", hint: "sta√∞ur √æar sem h√¶gt er a√∞ kaupa og bor√∞a mat" },
      { w: "h√°degishl√© (hk)", hint: "p√°sa um h√°degi til a√∞ bor√∞a/hv√≠la" },
      { w: "samloka (kvk)", hint: "brau√∞ me√∞ √°leggi √° milli" },
      { w: "krydd (hk)", hint: "t.d. k√≥r√≠ander, kanill, kardimomma" },
      { w: "brag√∞ (hk)", hint: "hvernig matur er √≠ munni" },
      { w: "milt (lo.)", hint: "ekki sterkt, mj√∫kt √° brag√∞i√∞. Til d√¶mis kart√∂flur" },
      { w: "sterkt (lo.)", hint: "miki√∞ krydda√∞. Til d√¶mis chilli." },
      { w: "a√∞ smakka / a√∞ pr√≥fa", hint: "a√∞ smakka n√Ωjan mat / reyna eitthva√∞ n√Ωtt" },
      { w: "a√∞ bj√≥√∞a (√≠ mat)", hint: "a√∞ bi√∞ja einhvern a√∞ koma og bor√∞a me√∞/hj√° manni" }
    ];

    // --- Spurningar bygg√∞ar √° textanum ---
    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞a dagur er √≠ textanum?',
        options: ['M√°nudagur', '√ûri√∞judagur', 'F√∂studagur', 'Laugardagur'],
        correct: 2
      },
      {
        question: 'Hver fer me√∞ Sigur√∞i √∫t a√∞ bor√∞a?',
        options: ['Anna', '√ìlafur', 'Bjarki', 'Lilja'],
        correct: 1
      },
      {
        question: 'Hva√∞ panta √æeir √° veitingasta√∞num?',
        options: ['S√∫pu', 'Samloku', 'Hamborgara', 'Pylsu'],
        correct: 1
      },
      {
        question: 'Hvernig l√Ωsir Sigur√∞ur brag√∞inu?',
        options: ['Bara s√¶tt', 'Bara s√∫rt', 'B√¶√∞i milt og svol√≠ti√∞ sterkt', 'Mj√∂g beiskt'],
        correct: 2
      },
      {
        question: 'Hva√∞ segir Anna um kv√∂ldi√∞?',
        options: ['‚ÄûVi√∞ eigum ekki a√∞ fara √æanga√∞."', '‚ÄûGerum √æetta heima √≠ kv√∂ld."', '‚Äû√û√∫ ver√∞ur a√∞ bj√≥√∞a okkur n√¶st."', '‚ÄûM√©r finnst v√≠etnamskur matur ekki g√≥√∞ur."'],
        correct: 2
      }
    ];

    const OPEN_QUESTIONS = [
      { question: 'Hvar vinnur Sigur√∞ur og hven√¶r fer hann √∫t a√∞ bor√∞a?', expectedContent: ['K√≥pavog', 'tannl√¶knastofu', 'h√°degishl√©'] },
      { question: 'Hvernig er lyktin inni √° veitingasta√∞num?', expectedContent: ['ilmar', 'krydd', 'ferskt', 'brau√∞', 'gr√¶nmeti'] },
      { question: 'Hva√∞ er √≠ samlokunni sem √æeir panta (nefndu a.m.k. 2 atri√∞i)?', expectedContent: ['kj√∫klingur', 'gr√¶nmeti', 'k√≥r√≠ander', 's√≥sa'] },
      { question: 'Hva√∞ vill Anna gera?', expectedContent: ['bj√≥√∞a', 'l√¶ra', 'elda', 'heima'] }
    ];

    const TRUE_FALSE = [
      { statement: 'Sigur√∞ur hefur oft smakka√∞ v√≠etnamskan mat √°√∞ur.', correct: false },
      { statement: 'Veitingasta√∞urinn er l√≠till og hl√Ωlegur.', correct: true },
      { statement: '√ûeir panta b√°√∞ir s√∫pu √≠ h√°deginu.', correct: false },
      { statement: 'Sigur√∞ur segir a√∞ maturinn s√© b√¶√∞i mildur og svol√≠ti√∞ sterkur.', correct: true },
      { statement: 'Anna vill ekki pr√≥fa √æennan mat.', correct: false }
    ];

    const MATCHING = [
      { left: 'Sigur√∞ur', right: 'Smakkar n√Ωjan mat og l√Ωsir brag√∞inu' },
      { left: '√ìlafur', right: 'Segir Sigur√∞i fr√° veitingasta√∞num' },
      { left: 'Bahn m√≠', right: 'L√∂ng samloka me√∞ kj√∫klingi, gr√¶nmeti, k√≥r√≠ander og s√≥su' },
      { left: 'Anna', right: 'Vill fara me√∞ n√¶st' }
    ];

    const HlustunVeitingastadur = () => {
      const [playbackRate, setPlaybackRate] = useState(1);
      const [isPlaying, setIsPlaying] = useState(false);
      const audioRef = useRef(null);

      // √û√Ω√∞ing
      const [translationAnswer, setTranslationAnswer] = useState('');
      const [translationFeedback, setTranslationFeedback] = useState(null);
      const [translationLoading, setTranslationLoading] = useState(false);

      // Krossaspurningar
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);

      // Opnar
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // R√©tt/Rangt
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Para
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);
      
      // Stokka valm√∂guleikana me√∞ Fisher-Yates
      const shuffleArray = (array) => {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      };
      
      const rightOptions = useMemo(
        () => shuffleArray(MATCHING.map(m => m.right)),
        []
      );

      // Endurstilla f√∂ll
      const resetTranslation = () => {
        setTranslationAnswer('');
        setTranslationFeedback(null);
      };
      const resetMC = () => { setMcAnswers([]); setMcChecked(false); };
      const resetOpen = () => {
        setOpenAnswers(Array(OPEN_QUESTIONS.length).fill(''));
        setOpenFeedback(Array(OPEN_QUESTIONS.length).fill(null));
      };
      const resetTF = () => { setTfAnswers([]); setTfChecked(false); };
      const resetMatching = () => { setMatchingAnswers(Array(MATCHING.length).fill('')); setMatchingChecked(false); };

      // Hlj√≥√∞spilari
      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) audioRef.current.pause();
        else audioRef.current.play();
      };
      useEffect(() => {
        const audio = audioRef.current;
        if (!audio) return;
        const onPlay = () => setIsPlaying(true);
        const onPause = () => setIsPlaying(false);
        audio.addEventListener('play', onPlay);
        audio.addEventListener('pause', onPause);
        return () => {
          audio.removeEventListener('play', onPlay);
          audio.removeEventListener('pause', onPause);
        };
      }, []);
      const handleRateChange = (e) => {
        const rate = parseFloat(e.target.value);
        setPlaybackRate(rate);
        if (audioRef.current) audioRef.current.playbackRate = rate;
      };

      // √û√Ω√∞ing
      const checkTranslation = async () => {
        if (!translationAnswer.trim()) {
          alert('Vinsamlegast skrifa√∞u √æ√Ω√∞ingu.');
          return;
        }
        setTranslationLoading(true);
        try {
          const content = await callOpenAI({
            model: 'gpt-4o-mini',
            temperature: 0.3,
            messages: [
              { role: 'system', content: 'You are a helpful Icelandic language tutor. Return only valid JSON.' },
              {
                role: 'user',
                content: `Nemandi √° a√∞ √æ√Ω√∞a √≠slensku or√∞i√∞ "${ORIGINAL_TEXT}" yfir √° sitt m√≥√∞urm√°l.
Nemandinn gaf √æ√Ω√∞inguna: "${translationAnswer}"

Greindu fyrst hva√∞a tungum√°l √æetta er (t.d. enska, sp√¶nska, p√≥lska).
S√≠√∞an athuga√∞u hvort √æ√Ω√∞ingin s√© r√©tt.

Ef √æ√Ω√∞ingin er r√©tt e√∞a mj√∂g l√≠k √≠ merkingu, svara√∞u:
{ "correct": true, "feedback": "Fr√°b√¶rt! √ûetta er r√©tt √æ√Ω√∞ing √° [tungum√°li√∞]." }

Ef √æ√Ω√∞ingin er r√∂ng, svara√∞u:
{ "correct": false, "feedback": "√ûetta er ekki alveg r√©tt. Or√∞i√∞ '${ORIGINAL_TEXT}' √æ√Ω√∞ir [stutt v√≠sbending] √° [tungum√°li√∞]." }

Svara√∞u EING√ñNGU me√∞ JSON, ekkert anna√∞.`
              }
            ]
          });
          const parsed = extractFirstJSON(content);
          setTranslationFeedback(parsed);
        } catch (err) {
          alert('Villa kom upp: ' + err.message);
        } finally {
          setTranslationLoading(false);
        }
      };

      // Krossaspurningar
      const handleMcAnswer = (qIndex, optIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = optIndex;
        setMcAnswers(newAnswers);
      };
      const checkMcAnswers = () => setMcChecked(true);

      // Opnar spurningar
      const handleOpenAnswer = (index, value) => {
        const newAnswers = [...openAnswers];
        newAnswers[index] = value;
        setOpenAnswers(newAnswers);
      };
      const checkOpenAnswer = async (index) => {
        const userAnswer = openAnswers[index].trim();
        if (!userAnswer) {
          alert('Vinsamlegast skrifa√∞u eitthva√∞ √°√∞ur en √æ√∫ athugar.');
          return;
        }
        const newLoading = [...openLoading];
        newLoading[index] = true;
        setOpenLoading(newLoading);
        try {
          const question = OPEN_QUESTIONS[index];
          const content = await callOpenAI({
            model: 'gpt-4o-mini',
            temperature: 0.3,
            messages: [
              { role: 'system', content: 'You are a helpful Icelandic language tutor. Return only valid JSON.' },
              {
                role: 'user',
                content: `Spurning: "${question.question}"
Svar nemanda: "${userAnswer}"
Lykilor√∞ sem √¶tlast er til: ${question.expectedContent.join(', ')}

Athuga√∞u svari√∞:
1. Ef svari√∞ inniheldur √ñLL e√∞a FLEST lykilor√∞in (e√∞a samsvarandi merkingu), √æ√° er √æa√∞ R√âTT.
2. Ef svari√∞ inniheldur HLUTA af lykilor√∞unum, √æ√° er √æa√∞ N√ÜSTUM R√âTT - sam√æykkja √æa√∞ en benda √° hva√∞ vantar.
3. Ef svari√∞ er rangt e√∞a missir af megin√æ√°ttunum, gef√∞u hj√°lplega √°bendingu.

Ef R√âTT e√∞a N√ÜSTUM R√âTT, svara√∞u:
{ "correct": true, "feedback": "Mj√∂g gott! [ef eitthva√∞ vantar: '√û√∫ g√¶tir l√≠ka nefnt...']" }

Ef √æa√∞ vantar mikilv√¶ga hluta, svara√∞u:
{ "correct": false, "feedback": "Gott byrja√∞! En reyndu l√≠ka a√∞ hugsa um [v√≠sbending √°n √æess a√∞ gefa alveg svari√∞]." }

Vertu V√ÜGUR √≠ d√≥mnum - ef nemandinn er √° r√©ttri lei√∞, sam√æykkja √æa√∞!

Svara√∞u EING√ñNGU me√∞ JSON, ekkert anna√∞.`
              }
            ]
          });
          const parsed = extractFirstJSON(content);
          const newFeedback = [...openFeedback];
          newFeedback[index] = parsed;
          setOpenFeedback(newFeedback);
        } catch (err) {
          alert('Villa: ' + err.message);
        } finally {
          const newLoading = [...openLoading];
          newLoading[index] = false;
          setOpenLoading(newLoading);
        }
      };

      // R√©tt/Rangt
      const handleTfAnswer = (index, value) => {
        if (tfChecked) return;
        const newAnswers = [...tfAnswers];
        newAnswers[index] = value;
        setTfAnswers(newAnswers);
      };
      const checkTfAnswers = () => setTfChecked(true);

      // Para
      const handleMatchingAnswer = (index, value) => {
        if (matchingChecked) return;
        const newAnswers = [...matchingAnswers];
        newAnswers[index] = value;
        setMatchingAnswers(newAnswers);
      };
      const checkMatching = () => setMatchingChecked(true);

      return (
        <div className="min-h-screen pb-20">
          {/* Haus */}
          <div className="bg-white border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-4 py-6">
              <a href="#" className="text-sm text-gray-600 hover:text-gray-900 font-light flex items-center gap-1 mb-3">
                ‚Üê Til baka
              </a>
              <h1 className="text-3xl font-light text-gray-900 mb-1">Hlustun: Veitingasta√∞ur</h1>
              <p className="text-sm text-gray-500 font-light">Hlustunar√¶fing ¬∑ A2</p>
            </div>
          </div>

          {/* Hlj√≥√∞spilari */}
          <div className="sticky-player p-4">
            <div className="max-w-4xl mx-auto">
              <audio ref={audioRef} src="hlustun4.mp3" preload="metadata" />
              <div className="flex items-center gap-3 bg-blue-50 rounded-full px-4 py-3 border-2 border-blue-100">
                <button onClick={togglePlay}
                  className="bg-blue-500 text-white w-10 h-10 rounded-full hover:bg-blue-600 transition-colors flex items-center justify-center text-xl">
                  {isPlaying ? '‚è∏' : '‚ñ∂'}
                </button>
                <span className="text-gray-600 font-light text-sm flex-1">üéß Hlusta √° textann</span>
                <button onClick={() => handleRateChange({target: {value: '0.75'}})}
                  className={`px-3 py-1.5 text-sm rounded-md border-2 transition-colors font-light ${
                    playbackRate === 0.75 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-blue-200 hover:bg-blue-50'
                  }`}>
                  0.75√ó
                </button>
                <button onClick={() => handleRateChange({target: {value: '1.25'}})}
                  className={`px-3 py-1.5 text-sm rounded-md border-2 transition-colors font-light ${
                    playbackRate === 1.25 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-blue-200 hover:bg-blue-50'
                  }`}>
                  1.25√ó
                </button>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto px-4 py-8 space-y-8">
            {/* Lei√∞beiningar */}
            <section className="bg-red-50 border-2 border-red-200 rounded-lg p-6">
              <h2 className="text-lg font-normal text-gray-800 mb-3 flex items-center gap-2">
                üìå Lei√∞beiningar
              </h2>
              <ul className="space-y-2 text-gray-700 font-light text-sm">
                <li>‚Ä¢ Hlusta√∞u √° textann 2-3 sinnum</li>
                <li>‚Ä¢ √û√∫ getur h√¶gt e√∞a hra√∞a√∞ √° hlustun √≠ hljo√∞spilaranum</li>
                <li>‚Ä¢ Svara√∞u spurningum um ber a√∞ nefna</li>
                <li>‚Ä¢ √û√∫ getur hlusta√∞ aftur oft og oft og vilt!</li>
              </ul>
            </section>

            {/* 1. √û√Ω√∞ing */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ing</h2>
              <p className="text-gray-700 font-light mb-4">Hva√∞ √æ√Ω√∞ir ‚Äû<strong>{ORIGINAL_TEXT}</strong>" √° √æ√≠nu m√≥√∞urm√°li?</p>
              {!translationFeedback ? (
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-light text-gray-600 mb-2">√û√Ω√∞ing √° ‚Äû{ORIGINAL_TEXT}":</label>
                    <input type="text" value={translationAnswer} onChange={(e) => setTranslationAnswer(e.target.value)}
                      placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..."
                      className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light" />
                  </div>
                  <button onClick={checkTranslation} disabled={translationLoading}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light disabled:bg-gray-400">
                    {translationLoading ? 'Athuga...' : 'Athuga svar'}
                  </button>
                </div>
              ) : (
                <div className={`border-2 rounded-lg p-6 ${translationFeedback.correct ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                  <p className={`font-light ${translationFeedback.correct ? 'text-green-800' : 'text-yellow-800'}`}>
                    {translationFeedback.correct ? '‚úì' : 'üí°'} {translationFeedback.feedback}
                  </p>
                  <button onClick={resetTranslation} className="mt-4 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* 2. Krossaspurningar */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ Krossaspurningar</h2>
              <p className="text-gray-600 font-light mb-6">Merktu vi√∞ eitt svar (A‚ÄìD).</p>
              <div className="space-y-6">
                {MULTIPLE_CHOICE.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-6">
                    <p className="font-normal text-gray-800 mb-4">{qIndex + 1}. {q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((opt, optIndex) => {
                        const isSelected = mcAnswers[qIndex] === optIndex;
                        const isCorrect = optIndex === q.correct;
                        const showAsCorrect = mcChecked && isCorrect;
                        const showAsIncorrect = mcChecked && isSelected && !isCorrect;
                        return (
                          <div key={optIndex} onClick={() => handleMcAnswer(qIndex, optIndex)}
                            className={`answer-option p-4 rounded-lg ${isSelected && !mcChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${mcChecked ? 'disabled' : ''}`}>
                            <div className="flex items-center gap-3">
                              <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !mcChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-2 h-2 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light">{String.fromCharCode(65 + optIndex)}. {opt}</span>
                              {showAsCorrect && <span className="ml-auto text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="ml-auto text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!mcChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMcAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMC} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {mcAnswers.filter((a, i) => a === MULTIPLE_CHOICE[i].correct).length} af {MULTIPLE_CHOICE.length} r√©tt!</p>
                  <button onClick={resetMC} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* 3. Opnar spurningar */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Opnar spurningar</h2>
              <p className="text-gray-600 font-light mb-6">Svara√∞u me√∞ √æ√≠num eigin or√∞um (1‚Äì3 setningar).</p>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                    <p className="font-normal text-gray-800 mb-3">{index + 1}. {q.question}</p>
                    {!openFeedback[index] ? (
                      <div className="space-y-3">
                        <textarea value={openAnswers[index]} onChange={(e) => handleOpenAnswer(index, e.target.value)}
                          rows="3" placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                          className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light resize-none" />
                        <button onClick={() => checkOpenAnswer(index)} disabled={openLoading[index]}
                          className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light disabled:bg-gray-400">
                          {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                        </button>
                      </div>
                    ) : (
                      <div className={`border-2 rounded-lg p-4 ${openFeedback[index].correct ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                        <p className={`text-sm font-light ${openFeedback[index].correct ? 'text-green-800' : 'text-yellow-800'}`}>
                          {openFeedback[index].correct ? '‚úì' : 'üí°'} {openFeedback[index].feedback}
                        </p>
                        <button onClick={()=>{ const nf=[...openFeedback]; nf[index]=null; setOpenFeedback(nf); const na=[...openAnswers]; na[index]=''; setOpenAnswers(na); }}
                          className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                          Reyna aftur
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
              <div className="mt-4">
                <button onClick={resetOpen} className="px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                  Endurstilla allar opnar spurningar
                </button>
              </div>
            </section>

            {/* 4. R√©tt e√∞a rangt */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-light text-gray-800 mb-3">{item.statement}</p>
                    <div className="flex gap-4">
                      {[true, false].map((answer) => {
                        const isSelected = tfAnswers[index] === answer;
                        const isCorrect = answer === item.correct;
                        const showAsCorrect = tfChecked && isCorrect;
                        const showAsIncorrect = tfChecked && isSelected && !isCorrect;
                        return (
                          <div
                            key={answer ? 'true' : 'false'}
                            onClick={() => handleTfAnswer(index, answer)}
                            className={`answer-option flex-1 p-3 rounded-lg ${isSelected && !tfChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${tfChecked ? 'disabled' : ''}`}
                          >
                            <div className="flex items-center justify-center gap-2">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !tfChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-1.5 h-1.5 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light text-sm">{answer ? 'R√©tt' : 'Rangt'}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!tfChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkTfAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetTF} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {tfAnswers.filter((a, i) => a === TRUE_FALSE[i].correct).length} af {TRUE_FALSE.length} r√©tt!</p>
                  <button onClick={resetTF} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* 5. Para√∞u saman */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ Para√∞u saman</h2>
              <div className="space-y-4">
                {MATCHING.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <div className="flex items-center gap-4">
                      <div className="flex-1"><span className="font-normal text-gray-800">{item.left}</span></div>
                      <div className="text-gray-400">‚Üí</div>
                      <div className="flex-1">
                        <select value={matchingAnswers[index]} onChange={(e) => handleMatchingAnswer(index, e.target.value)} disabled={matchingChecked}
                          className={`w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light ${
                            matchingChecked ? (matchingAnswers[index]===item.right ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-gray-300'}`}>
                          <option value="">Veldu...</option>
                          {rightOptions.map((opt, i) => (<option key={i} value={opt}>{opt}</option>))}
                        </select>
                      </div>
                      {matchingChecked && (<div className="w-8">{matchingAnswers[index]===item.right ? <span className="text-green-600 text-xl">‚úì</span> : <span className="text-red-600 text-xl">‚úó</span>}</div>)}
                    </div>
                    {matchingChecked && matchingAnswers[index]!==item.right && (
                      <p className="text-sm text-red-600 mt-2">‚úó R√©tt svar: {item.right}</p>
                    )}
                  </div>
                ))}
              </div>
              {!matchingChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMatching}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMatching} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {matchingAnswers.filter((v,i)=>v===MATCHING[i].right).length} af {MATCHING.length} r√©tt!</p>
                  <button onClick={resetMatching} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* Lykilor√∞ (or√∞afor√∞akassi) */}
            <section className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-4">üìò Lykilor√∞ √∫r hlustun</h2>
              <p className="text-gray-700 font-light mb-4">Lestu yfir or√∞in og reyndu a√∞ finna √æau aftur √≠ hlustuninni.</p>
              <div className="grid md:grid-cols-2 gap-3">
                {VOCAB.map((it, i) => (
                  <div key={i} className="rounded-lg border-2 border-yellow-200 bg-white/70 p-3">
                    <div className="font-normal text-gray-900">{it.w}</div>
                    <div className="text-sm text-gray-600 font-light">{it.hint}</div>
                  </div>
                ))}
              </div>
            </section>

            {/* Lok */}
            <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-8 text-center">
              <div className="text-6xl mb-4">üéâ</div>
              <h2 className="text-2xl font-light text-gray-800 mb-3">Vel gert!</h2>
              <p className="text-gray-600 font-light">√û√∫ hefur kl√°ra√∞ hlustunarverkefni√∞ um veitingasta√∞inn. Hlusta√∞u endilega aftur til a√∞ √¶fa!</p>
            </div>
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunVeitingastadur />);
  </script>
</body>
</html>
