<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun 11: Framt√≠√∞in ‚Äì √çSAT1√çA</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player {
      position: sticky;
      top: 0;
      z-index: 50;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .answer-option {
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
      cursor: pointer;
    }
    .answer-option:hover:not(.disabled) {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.selected {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }
    .answer-option.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }
    .answer-option.disabled {
      cursor: default;
    }
    .modal-overlay { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,0.5); 
      z-index: 100; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 1rem; 
    }
    .modal-content { 
      background: white; 
      border-radius: 1rem; 
      max-width: 48rem; 
      width: 100%; 
      max-height: 90vh; 
      overflow-y: auto; 
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); 
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // --- OpenAI gateway ---
    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }
    function extractFirstJSON(text){
      const s = text.indexOf('{'); const e = text.lastIndexOf('}');
      if (s < 0 || e < 0 || e <= s) throw new Error('No JSON found');
      return JSON.parse(text.slice(s, e+1));
    }

    // --- Grunnstillingar ---
    const LISTENING_TEXT = `Sigur√∞ur og Anna eru a√∞ bor√∞a kv√∂ldmat me√∞ b√∂rnum s√≠num, Bjarka og Lilju. √ûau tala um framt√≠√∞ina.

‚ÄûErt √æ√∫ enn √æ√° a√∞ sp√° √≠ a√∞ l√¶ra verkfr√¶√∞i, Bjarki?" spyr Sigur√∞ur.

‚ÄûM√©r finnst mj√∂g gaman √≠ st√¶r√∞fr√¶√∞i. √âg veit ekki alveg en mig langar kannski a√∞ ver√∞a forritari e√∞a verkfr√¶√∞ingur," svarar Bjarki.

‚Äû√ûa√∞ er mikil st√¶r√∞fr√¶√∞i √≠ b√°√∞um f√∂gum," segir Anna. ‚ÄûTil a√∞ ver√∞a verkfr√¶√∞ingur √æarftu a√∞ taka st√∫dentspr√≥f og fara √≠ h√°sk√≥la √≠ fimm √°r."

‚ÄûEn forritun?" spyr Bjarki.

‚Äû√ûa√∞ er h√¶gt a√∞ fara √° t√∂lvubraut, til d√¶mis √≠ T√¶knisk√≥lanum. Forritun er l√≠ka kennd √≠ h√°sk√≥la. √ûa√∞ tekur um √ærj√∫ til fj√∂gur √°r a√∞ l√¶ra t√∂lvunarfr√¶√∞i," svarar Sigur√∞ur.

‚ÄûOg √æ√∫ Lilja? Hva√∞ vilt √æ√∫ ver√∞a?" spyr Anna.

‚Äû√âg elska a√∞ teikna og hanna hluti. Mig langar a√∞ ver√∞a arkitekt!" segir Lilja spennt.

‚ÄûArkitekt! √û√° getur √æ√∫ hanna√∞ h√∫s og byggingar," segir Sigur√∞ur og brosir. ‚Äû√ûa√∞ er mj√∂g √°hugavert starf."

‚Äû√ûarf √©g a√∞ fara √≠ h√°sk√≥la fyrir √æa√∞?" spyr Lilja.

‚ÄûJ√°, arkitekt√∫r er fimm √°ra n√°m √≠ Listah√°sk√≥lanum. √û√∫ l√¶rir a√∞ teikna, hanna og skipuleggja byggingar," √∫tsk√Ωrir Anna.

‚Äû√ûa√∞ hlj√≥mar vel! En hva√∞ ef √©g skipti um sko√∞un?" spyr Lilja.

‚Äû√ûa√∞ er alveg √≠ lagi! Margir breyta um √°hugam√°l √æegar √æeir ver√∞a eldri," segir Sigur√∞ur.

‚ÄûJ√°, og √æa√∞ er l√≠ka h√¶gt a√∞ l√¶ra m√∂rg st√∂rf. Til d√¶mis er fr√¶nka ykkar Mar√≠a b√¶√∞i h√°rgrei√∞slukona og rafvirki," segir Anna.

‚ÄûHva√∞ vann √æ√∫ √°√∞ur en √æ√∫ var√∞st tannl√¶knir, pabbi?" spyr Bjarki.

‚Äû√âg vann √≠ b√∫√∞ √° me√∞an √©g var √≠ h√°sk√≥la."

‚ÄûOg √©g vann √° b√≥kasafni me√∞ sk√≥lanum," b√¶tir Anna vi√∞. ‚ÄûSumarvinna er g√≥√∞ reynsla."

‚ÄûEru√∞ √æi√∞ √°n√¶g√∞ me√∞ st√∂rfin ykkar n√∫na?" spyr Lilja.

‚ÄûJ√°, mj√∂g √°n√¶g√∞!" svarar Anna. ‚Äû√âg elska a√∞ vinna √° b√≥kasafni. √ûa√∞ er mj√∂g fj√∂lbreytt starf."

‚ÄûOg m√©r finnst gaman a√∞ vinna sem tannl√¶knir. √ûa√∞ er mikilv√¶gt a√∞ velja starf sem √æ√©r finnst √°hugavert," segir Sigur√∞ur.`;

    const VOCAB = [
      { w: "framt√≠√∞ (kvk)", hint: "t√≠minn sem kemur, √æa√∞ sem gerist s√≠√∞ar" },
      { w: "a√∞ sp√° √≠", hint: "a√∞ hugsa um, a√∞ √≠huga" },
      { w: "forritari (kk)", hint: "einhver sem skrifar t√∂lvuforrit" },
      { w: "verkfr√¶√∞ingur (kk)", hint: "einhver sem hannar og byggir hluti me√∞ st√¶r√∞fr√¶√∞i" },
      { w: "arkitekt (kk)", hint: "einhver sem hannar h√∫s og byggingar" },
      { w: "a√∞ hanna", hint: "a√∞ b√∫a til h√∂nnun, a√∞ teikna √°√¶tlun" },
      { w: "starf (hk)", hint: "vinna, √æa√∞ sem √æ√∫ gerir til a√∞ afla tekna" }
    ];

    // --- √û√Ω√∞ingarspurningar ---
    const TRANSLATION_WORDS = [
      { word: "a√∞ skipuleggja", hint: "a√∞ √°√¶tla, a√∞ skipuleggja" },
      { word: "reynsla", hint: "√æa√∞ sem √æ√∫ l√¶rir af √æv√≠ a√∞ gera eitthva√∞" }
    ];

    // --- Krossaspurningar ---
    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞ vill Bjarki kannski ver√∞a?',
        options: ['Arkitekt e√∞a tannl√¶knir', 'Forritari e√∞a verkfr√¶√∞ingur', 'Kennari e√∞a b√≥kav√∂r√∞ur', 'H√°rgrei√∞slukona e√∞a rafvirki'],
        correct: 1
      },
      {
        question: 'Hva√∞ vill Lilja ver√∞a?',
        options: ['Forritari', 'Arkitekt', 'Tannl√¶knir', 'Kennari'],
        correct: 2
      },
      {
        question: 'Hversu langan t√≠ma tekur √æa√∞ a√∞ l√¶ra arkitekt√∫r?',
        options: ['√ûrj√∫ √°r', 'Fj√∂gur √°r', 'Fimm √°r', 'Sex √°r'],
        correct: 2
      },
      {
        question: 'Hva√∞ er Mar√≠a?',
        options: ['Tannl√¶knir og b√≥kav√∂r√∞ur', 'Arkitekt og kennari', 'H√°rgrei√∞slukona og rafvirki', 'Forritari og verkfr√¶√∞ingur'],
        correct: 2
      },
      {
        question: 'Hvar vann Sigur√∞ur √° me√∞an hann var √≠ h√°sk√≥la?',
        options: ['√Å b√≥kasafni', '√ç b√∫√∞', 'Sem tannl√¶knir', '√ç T√¶knisk√≥lanum'],
        correct: 1
      }
    ];

    // --- Opnar spurningar ---
    const OPEN_QUESTIONS = [
      { 
        question: 'Hvers vegna passar vel fyrir Bjarka a√∞ l√¶ra verkfr√¶√∞i e√∞a forritun?',
        expectedContent: ['st√¶r√∞fr√¶√∞i', 'g√≥√∞ur √≠ st√¶r√∞fr√¶√∞i', 'gaman √≠ st√¶r√∞fr√¶√∞i', 'mikil st√¶r√∞fr√¶√∞i', 'finnst gaman']
      },
      { 
        question: 'Hvers vegna vill Lilja ver√∞a arkitekt?',
        expectedContent: ['teikna', 'hanna', 'elska', 'h√∫s', 'byggingar']
      },
      { 
        question: 'Hvers vegna er sumarvinna g√≥√∞ samkv√¶mt √ñnnu?',
        expectedContent: ['reynsla', 'g√≥√∞ reynsla']
      }
    ];

    // --- R√©tt/Rangt ---
    const TRUE_FALSE = [
      { statement: 'Bjarki vill kannski ver√∞a forritari e√∞a verkfr√¶√∞ingur.', correct: true },
      { statement: 'Lilja vill ver√∞a tannl√¶knir eins og pabbi hennar.', correct: false },
      { statement: 'Arkitekt√∫r er √æriggja √°ra n√°m.', correct: false },
      { statement: 'Mar√≠a er b√¶√∞i h√°rgrei√∞slukona og rafvirki.', correct: true },
      { statement: 'Anna er √°n√¶g√∞ me√∞ starf sitt √° b√≥kasafni.', correct: true }
    ];

    // --- P√∂run ---
    const MATCHING = [
      { left: 'Bjarki', right: 'Vill kannski ver√∞a forritari e√∞a verkfr√¶√∞ingur' },
      { left: 'Lilja', right: 'Vill ver√∞a arkitekt' },
      { left: 'Sigur√∞ur', right: 'Vann √≠ b√∫√∞ √° me√∞an hann var √≠ h√°sk√≥la' },
      { left: 'Anna', right: 'Vann √° b√≥kasafni me√∞ sk√≥lanum' }
    ];

    const HlustunFramtidin = () => {
      const [playbackRate, setPlaybackRate] = useState(1);
      const [isPlaying, setIsPlaying] = useState(false);
      const audioRef = useRef(null);
      const [showTextModal, setShowTextModal] = useState(false);

      // √û√Ω√∞ingar
      const [translationAnswers, setTranslationAnswers] = useState(['', '']);
      const [translationFeedback, setTranslationFeedback] = useState([null, null]);
      const [translationLoading, setTranslationLoading] = useState([false, false]);

      // Krossaspurningar
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);
      
      // Randomize options for each question
      const shuffledMC = useMemo(() => {
        return MULTIPLE_CHOICE.map(q => {
          const optionsWithIndex = q.options.map((opt, idx) => ({ text: opt, originalIndex: idx }));
          // Shuffle
          for (let i = optionsWithIndex.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];
          }
          return {
            question: q.question,
            options: optionsWithIndex,
            correctOriginalIndex: q.correct
          };
        });
      }, []);

      // Opnar
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // R√©tt/Rangt
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Para
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);
      const rightOptions = useMemo(
        () => MATCHING.map(m => m.right).sort(() => Math.random() - 0.5),
        []
      );

      // Endurstilla f√∂ll
      const resetTranslations = () => {
        setTranslationAnswers(['', '']);
        setTranslationFeedback([null, null]);
        setTranslationLoading([false, false]);
      };
      const resetMC = () => { setMcAnswers([]); setMcChecked(false); };
      const resetOpen = () => {
        setOpenAnswers(Array(OPEN_QUESTIONS.length).fill(''));
        setOpenFeedback(Array(OPEN_QUESTIONS.length).fill(null));
        setOpenLoading(Array(OPEN_QUESTIONS.length).fill(false));
      };
      const resetTF = () => { setTfAnswers([]); setTfChecked(false); };
      const resetMatching = () => { setMatchingAnswers(Array(MATCHING.length).fill('')); setMatchingChecked(false); };

      useEffect(() => {
        if (audioRef.current) audioRef.current.playbackRate = playbackRate;
      }, [playbackRate]);

      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) audioRef.current.pause(); else audioRef.current.play();
        setIsPlaying(!isPlaying);
      };

      // √û√Ω√∞ing
      const checkTranslation = async (index) => {
        const answer = translationAnswers[index].trim();
        if (answer.length < 2) { alert('Vinsamlegast skrifa√∞u √æ√Ω√∞ingu!'); return; }
        
        const newLoading = [...translationLoading];
        newLoading[index] = true;
        setTranslationLoading(newLoading);

        try {
          const word = TRANSLATION_WORDS[index].word;
          const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.

√çSLENSKA OR√êI√ê: "${word}"
SVAR NEMANDA: "${answer}"

VERKEFNI:
1. Greina sj√°lfkrafa hva√∞a tungum√°l nemandinn nota√∞i
2. Meta hvort √æ√Ω√∞ingin s√© r√©tt
3. Skila stuttri, j√°kv√¶√∞ri endurgj√∂f

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "detected_language": "nafn tungum√°lsins (t.d. enska, p√≥lska, sp√¶nska)",
  "feedback_is": "Endurgj√∂f √° √≠slensku",
  "feedback_native": "Endurgj√∂f √° greinda tungum√°linu",
  "correct_translation": "G√≥√∞ √æ√Ω√∞ing ef rangt, annars null"
}`;
          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 300,
            messages: [{ role: 'system', content: sys }, { role: 'user', content: 'Meta √æ√Ω√∞ingu' }]
          });
          const data = extractFirstJSON(response);
          const newFeedback = [...translationFeedback];
          newFeedback[index] = data;
          setTranslationFeedback(newFeedback);
        } catch (e) {
          console.error(e);
          alert('Villa vi√∞ a√∞ meta √æ√Ω√∞ingu. Reyndu aftur.');
        } finally {
          const newLoading2 = [...translationLoading];
          newLoading2[index] = false;
          setTranslationLoading(newLoading2);
        }
      };

      // Krossar
      const handleMcAnswer = (qIndex, shuffledIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = shuffledIndex;
        setMcAnswers(newAnswers);
      };
      const checkMcAnswers = () => {
        const allAnswered = shuffledMC.every((_, i) => Number.isInteger(mcAnswers[i]));
        if (!allAnswered) { alert('Vinsamlegast svara√∞u √∂llum spurningum!'); return; }
        setMcChecked(true);
      };

      // Opnar
      const handleOpenAnswer = (index, value) => {
        const newAnswers = [...openAnswers]; newAnswers[index] = value; setOpenAnswers(newAnswers);
      };
      const checkOpenAnswer = async (index) => {
        if (openAnswers[index].trim().length < 3) { alert('Vinsamlegast skrifa√∞u svar!'); return; }
        const newLoading = [...openLoading]; newLoading[index] = true; setOpenLoading(newLoading);
        try {
          const question = OPEN_QUESTIONS[index];
          const userAnswer = openAnswers[index];
          const sys = `√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ opnum spurningum.

SPURNINGIN:
"${question.question}"

SVAR NEMANDA:
"${userAnswer}"

LYKILATRI√êI SEM EIGA A√ê KOMA FRAM:
${question.expectedContent.join(', ')}

VERKEFNI:
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ INNIHALD (hunsa sm√°v√¶gilegar villur). Skila stuttri hvetjandi endurgj√∂f.

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "feedback": "Stutt og hvetjandi endurgj√∂f √° √≠slensku"
}`;
          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 200,
            messages: [{ role: 'system', content: sys }, { role: 'user', content: 'Meta svar' }]
          });
          const data = extractFirstJSON(response);
          const newFeedback = [...openFeedback]; newFeedback[index] = data; setOpenFeedback(newFeedback);
        } catch (e) {
          console.error(e);
          alert('Villa vi√∞ a√∞ meta svar. Reyndu aftur.');
        } finally {
          const newLoading2 = [...openLoading]; newLoading2[index] = false; setOpenLoading(newLoading2);
        }
      };

      // R√©tt/Rangt
      const handleTfAnswer = (index, answer) => {
        if (tfChecked) return;
        const newAnswers = [...tfAnswers]; newAnswers[index] = answer; setTfAnswers(newAnswers);
      };
      const checkTfAnswers = () => {
        const allAnswered = TRUE_FALSE.every((_, i) => typeof tfAnswers[i] === 'boolean');
        if (!allAnswered) { alert('Vinsamlegast svara√∞u √∂llum spurningum!'); return; }
        setTfChecked(true);
      };

      // Para
      const handleMatchingAnswer = (index, value) => {
        if (matchingChecked) return;
        const newAnswers = [...matchingAnswers]; newAnswers[index] = value; setMatchingAnswers(newAnswers);
      };
      const checkMatching = () => {
        const allAnswered = matchingAnswers.every(v => !!v);
        if (!allAnswered) { alert('Vinsamlegast svara√∞u √∂llum spurningum!'); return; }
        setMatchingChecked(true);
      };

      return (
        <div className="min-h-screen pb-12">
          {/* Haus */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button onClick={() => window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <div className="flex items-center gap-6">
                <div className="flex-1">
                  <h1 className="text-3xl font-light text-gray-800 mb-2">Hlustun 11: Framt√≠√∞in</h1>
                  <p className="text-gray-500 text-sm font-light">Hlustunarverkefni ¬∑ A1‚ÄìA2</p>
                </div>
              </div>
            </div>
          </header>

          {/* Sticky Audio Player */}
          <div className="sticky-player">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
                <div className="flex items-center gap-4">
                  <button
                    onClick={togglePlay}
                    className="bg-blue-500 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors flex-shrink-0"
                    aria-label={isPlaying ? 'P√°sa' : 'Spila'}
                  >
                    {isPlaying ? (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg>
                    ) : (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3" /></svg>
                    )}
                  </button>

                  <div className="flex-1">
                    <p className="text-sm font-normal text-gray-800 mb-1">üéß Hlusta √° textann</p>
                    <audio
                      ref={audioRef}
                      src="media/hlustun11_framtid.mp3"
                      preload="none"
                      onEnded={() => setIsPlaying(false)}
                      onPlay={() => setIsPlaying(true)}
                      onPause={() => setIsPlaying(false)}
                    />
                  </div>

                  <div className="flex gap-2">
                    <button onClick={() => setPlaybackRate(0.75)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 0.75 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>0.75√ó</button>
                    <button onClick={() => setPlaybackRate(1)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1√ó</button>
                    <button onClick={() => setPlaybackRate(1.25)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1.25 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1.25√ó</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-8">
            {/* Lei√∞beiningar */}
            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
              <h2 className="text-xl font-normal text-gray-800 mb-3">üìù Lei√∞beiningar</h2>
              <ul className="space-y-2 text-gray-700 font-light">
                <li>‚Ä¢ Lestu lykilor√∞in h√©r a√∞ ne√∞an fyrst</li>
                <li>‚Ä¢ Hlusta√∞u √° textann 2‚Äì3 sinnum</li>
                <li>‚Ä¢ √û√∫ getur h√¶gt e√∞a hra√∞a√∞ √° hlj√≥√∞inu</li>
                <li>‚Ä¢ Svara√∞u √∂llum spurningunum</li>
                <li>‚Ä¢ √ûegar √æ√∫ hefur loki√∞ √∂llum spurningum getur√∞u lesi√∞ textann</li>
              </ul>
            </div>

            {/* Lykilor√∞ */}
            <section className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-4">üìò Lykilor√∞</h2>
              <p className="text-gray-700 font-light mb-4">Lestu yfir or√∞in √°√∞ur en √æ√∫ hlustar.</p>
              <div className="grid md:grid-cols-2 gap-3">
                {VOCAB.map((it, i) => (
                  <div key={i} className="rounded-lg border-2 border-yellow-200 bg-white/70 p-3">
                    <div className="font-normal text-gray-900">{it.w}</div>
                    <div className="text-sm text-gray-600 font-light">{it.hint}</div>
                  </div>
                ))}
              </div>
            </section>

            {/* 1. √û√Ω√∞ing */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ing</h2>
              {TRANSLATION_WORDS.map((item, idx) => (
                <div key={idx} className="border-2 border-gray-100 rounded-lg p-4 mb-4">
                  <p className="font-normal text-gray-800 mb-4">Hva√∞ √æ√Ω√∞ir <strong>‚Äû{item.word}"</strong> √° √æ√≠nu m√≥√∞urm√°li?</p>
                  <textarea 
                    value={translationAnswers[idx]} 
                    onChange={(e) => {
                      const newAnswers = [...translationAnswers];
                      newAnswers[idx] = e.target.value;
                      setTranslationAnswers(newAnswers);
                    }}
                    disabled={translationFeedback[idx] !== null} 
                    className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light"
                    rows="3" 
                    placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r...">
                  </textarea>
                  {!translationFeedback[idx] ? (
                    <div className="flex gap-3 mt-3">
                      <button 
                        onClick={() => checkTranslation(idx)} 
                        disabled={translationLoading[idx]}
                        className="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 transition-colors font-light text-sm">
                        {translationLoading[idx] ? 'Athuga...' : 'Athuga √æ√Ω√∞ingu'}
                      </button>
                      <button 
                        onClick={() => {
                          const newAnswers = [...translationAnswers];
                          newAnswers[idx] = '';
                          setTranslationAnswers(newAnswers);
                          const newFeedback = [...translationFeedback];
                          newFeedback[idx] = null;
                          setTranslationFeedback(newFeedback);
                        }}
                        className="px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                        Endurstilla
                      </button>
                    </div>
                  ) : (
                    <div className={`mt-3 p-4 rounded-lg ${translationFeedback[idx].correct ? 'bg-green-50 border-2 border-green-200' : 'bg-yellow-50 border-2 border-yellow-200'}`}>
                      <p className={`font-light mb-2 ${translationFeedback[idx].correct ? 'text-green-800' : 'text-yellow-800'}`}>
                        {translationFeedback[idx].correct ? '‚úì' : 'üí°'} {translationFeedback[idx].feedback_is}
                      </p>
                      <p className={`text-sm font-light ${translationFeedback[idx].correct ? 'text-green-700' : 'text-yellow-700'}`}>{translationFeedback[idx].feedback_native}</p>
                      {translationFeedback[idx].correct_translation && (
                        <p className="text-sm text-gray-600 mt-2 font-light"><strong>D√¶mi um g√≥√∞a √æ√Ω√∞ingu:</strong> {translationFeedback[idx].correct_translation}</p>
                      )}
                      <button 
                        onClick={() => {
                          const newAnswers = [...translationAnswers];
                          newAnswers[idx] = '';
                          setTranslationAnswers(newAnswers);
                          const newFeedback = [...translationFeedback];
                          newFeedback[idx] = null;
                          setTranslationFeedback(newFeedback);
                        }}
                        className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                        Reyna aftur
                      </button>
                    </div>
                  )}
                </div>
              ))}
              <button onClick={resetTranslations} className="mt-4 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                Endurstilla allar √æ√Ω√∞ingar
              </button>
            </section>

            {/* 2. Krossaspurningar */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ Krossaspurningar</h2>
              <div className="space-y-6">
                {shuffledMC.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-normal text-gray-800 mb-4">{q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((option, shuffledIndex) => {
                        const isSelected = mcAnswers[qIndex] === shuffledIndex;
                        const isCorrect = option.originalIndex === q.correctOriginalIndex;
                        const showAsCorrect = mcChecked && isCorrect;
                        const showAsIncorrect = mcChecked && isSelected && !isCorrect;
                        return (
                          <div
                            key={shuffledIndex}
                            onClick={() => handleMcAnswer(qIndex, shuffledIndex)}
                            className={`answer-option p-3 rounded-lg ${isSelected && !mcChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${mcChecked ? 'disabled' : ''}`}
                          >
                            <div className="flex items-center gap-3">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !mcChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-1.5 h-1.5 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light flex-1">{option.text}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!mcChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMcAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMC}
                    className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">
                    ‚úì √û√∫ f√©kkst {mcAnswers.filter((shuffledIdx, qIdx) => {
                      const selectedOption = shuffledMC[qIdx].options[shuffledIdx];
                      return selectedOption.originalIndex === shuffledMC[qIdx].correctOriginalIndex;
                    }).length} af {shuffledMC.length} r√©tt!
                  </p>
                  <button onClick={resetMC} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* 3. Opnar spurningar */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Opnar spurningar</h2>
              <p className="text-gray-600 font-light mb-6">Svara√∞u spurningunum me√∞ √æ√≠num eigin or√∞um.</p>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-normal text-gray-800 mb-3">{index + 1}. {q.question}</p>
                    <textarea value={openAnswers[index]} onChange={(e) => handleOpenAnswer(index, e.target.value)}
                      disabled={openFeedback[index] !== null}
                      className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light"
                      rows="3" placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."></textarea>
                    {!openFeedback[index] ? (
                      <div className="flex gap-3 mt-3">
                        <button onClick={() => checkOpenAnswer(index)} disabled={openLoading[index]}
                          className="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 transition-colors font-light text-sm">
                          {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                        </button>
                        <button onClick={()=>{ const na=[...openAnswers]; na[index]=''; setOpenAnswers(na); }}
                          className="px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                          Hreinsa
                        </button>
                      </div>
                    ) : (
                      <div className={`mt-3 p-3 rounded-lg ${openFeedback[index].correct ? 'bg-green-50 border-2 border-green-200' : 'bg-yellow-50 border-2 border-yellow-200'}`}>
                        <p className={`text-sm font-light ${openFeedback[index].correct ? 'text-green-800' : 'text-yellow-800'}`}>
                          {openFeedback[index].correct ? '‚úì' : 'üí°'} {openFeedback[index].feedback}
                        </p>
                        <button onClick={()=>{ const nf=[...openFeedback]; nf[index]=null; setOpenFeedback(nf); const na=[...openAnswers]; na[index]=''; setOpenAnswers(na); }}
                          className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                          Reyna aftur
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
              <div className="mt-4">
                <button onClick={resetOpen} className="px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                  Endurstilla allar opnar spurningar
                </button>
              </div>
            </section>

            {/* 4. R√©tt e√∞a rangt */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-light text-gray-800 mb-3">{item.statement}</p>
                    <div className="flex gap-4">
                      {[true, false].map((answer) => {
                        const isSelected = tfAnswers[index] === answer;
                        const isCorrect = answer === item.correct;
                        const showAsCorrect = tfChecked && isCorrect;
                        const showAsIncorrect = tfChecked && isSelected && !isCorrect;
                        return (
                          <div
                            key={answer ? 'true' : 'false'}
                            onClick={() => handleTfAnswer(index, answer)}
                            className={`answer-option flex-1 p-3 rounded-lg ${isSelected && !tfChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${tfChecked ? 'disabled' : ''}`}
                          >
                            <div className="flex items-center justify-center gap-2">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !tfChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-1.5 h-1.5 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light text-sm">{answer ? 'R√©tt' : 'Rangt'}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!tfChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkTfAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetTF} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {tfAnswers.filter((a, i) => a === TRUE_FALSE[i].correct).length} af {TRUE_FALSE.length} r√©tt!</p>
                  <button onClick={resetTF} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* 5. Para√∞u saman */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ Para√∞u saman</h2>
              <div className="space-y-4">
                {MATCHING.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <div className="flex items-center gap-4">
                      <div className="flex-1"><span className="font-normal text-gray-800">{item.left}</span></div>
                      <div className="text-gray-400">‚Üí</div>
                      <div className="flex-1">
                        <select value={matchingAnswers[index]} onChange={(e) => handleMatchingAnswer(index, e.target.value)} disabled={matchingChecked}
                          className={`w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light ${
                            matchingChecked ? (matchingAnswers[index]===item.right ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-gray-300'}`}>
                          <option value="">Veldu...</option>
                          {rightOptions.map((opt, i) => (<option key={i} value={opt}>{opt}</option>))}
                        </select>
                      </div>
                      {matchingChecked && (<div className="w-8">{matchingAnswers[index]===item.right ? <span className="text-green-600 text-xl">‚úì</span> : <span className="text-red-600 text-xl">‚úó</span>}</div>)}
                    </div>
                    {matchingChecked && matchingAnswers[index]!==item.right && (
                      <p className="text-sm text-red-600 mt-2">‚úó R√©tt svar: {item.right}</p>
                    )}
                  </div>
                ))}
              </div>
              {!matchingChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMatching}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMatching} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {matchingAnswers.filter((v,i)=>v===MATCHING[i].right).length} af {MATCHING.length} r√©tt!</p>
                  <button onClick={resetMatching} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            {/* Lok + hnappur til a√∞ lesa textann */}
            <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-8 text-center">
              <div className="text-6xl mb-4">üéâ</div>
              <h2 className="text-2xl font-light text-gray-800 mb-3">Vel gert!</h2>
              <p className="text-gray-600 font-light mb-6">√û√∫ hefur kl√°ra√∞ hlustunarverkefni√∞ um framt√≠√∞ina. Hlusta√∞u endilega aftur til a√∞ √¶fa!</p>
              
              {(mcChecked && tfChecked && matchingChecked && openFeedback.every(f => f !== null) && translationFeedback.every(f => f !== null)) && (
                <button 
                  onClick={() => setShowTextModal(true)}
                  className="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors font-light text-lg shadow-lg">
                  üìñ Lesa textann
                </button>
              )}
            </div>
          </main>

          {/* Modal gluggi me√∞ textanum */}
          {showTextModal && (
            <div className="modal-overlay" onClick={() => setShowTextModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex items-center justify-between">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Hlustunartextinn</h2>
                  <button 
                    onClick={() => setShowTextModal(false)}
                    className="text-gray-500 hover:text-gray-700 text-3xl leading-none"
                    aria-label="Loka">
                    √ó
                  </button>
                </div>
                <div className="p-8">
                  <div className="prose prose-lg max-w-none">
                    {LISTENING_TEXT.split('\n\n').map((paragraph, i) => (
                      <p key={i} className="mb-4 text-gray-700 font-light leading-relaxed">
                        {paragraph}
                      </p>
                    ))}
                  </div>
                  <div className="mt-8 text-center">
                    <button 
                      onClick={() => setShowTextModal(false)}
                      className="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors font-light">
                      Loka
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunFramtidin />);
  </script>
</body>
</html>
