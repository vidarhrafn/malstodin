<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hlustun 10: Upp√°haldsfag</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player {
      position: sticky;
      top: 0;
      z-index: 50;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 1rem;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // ========== AI FUNCTIONS ==========
    async function callOpenAI(messages, max_tokens = 300, model = 'gpt-4o-mini', temperature = 0.3) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages, max_tokens, model, temperature })
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    // ========== DATA ==========
    const LISTENING_TEXT = `Bjarki og Dan√≠el eru vinir. √ûeir eru √≠ fr√≠m√≠n√∫tum √≠ sk√≥lanum og tala um upp√°haldsf√∂gin s√≠n.

Bjarki og Dan√≠el eru vinir. √ûeir eru √≠ fr√≠m√≠n√∫tum √≠ sk√≥lanum og tala um hva√∞ √æeim finnst skemmtilegast a√∞ l√¶ra.
‚ÄûHvert er upp√°haldsfagi√∞ √æitt?" spyr Bjarki.
‚Äû√ç√ær√≥ttir! M√©r finnst mj√∂g gaman √≠ √≠√ær√≥ttum," svarar Dan√≠el. ‚ÄûHva√∞ me√∞ √æig?"
‚Äû√âg er bestur √≠ st√¶r√∞fr√¶√∞i," segir Bjarki.
Dan√≠el hristir h√∂fu√∞i√∞: ‚ÄûSt√¶r√∞fr√¶√∞i? En h√∫n er svo erfi√∞!"
‚ÄûNei, h√∫n er au√∞veld! M√©r finnst gaman a√∞ reikna. √âg elska a√∞ leggja saman og draga fr√°. Pl√∫s og m√≠nus er ekkert m√°l." segir Bjarki.
‚Äû√âg skil √æa√∞ ekki. √âg er bara betri √≠ a√∞ hlaupa og spila me√∞ bolta," segir Dan√≠el.
‚ÄûHva√∞a √≠√ær√≥tt finnst √æ√©r skemmtilegust?" spyr Bjarki.
‚ÄûHandbolti! √âg √¶fi me√∞ Haukum og vi√∞ eigum leik √° laugardaginn," svarar Dan√≠el spenntur.
‚ÄûSkemmtilegt! Heldur√∞u a√∞ √æi√∞ vinni√∞?" spyr Bjarki.
‚ÄûJ√°, √©g vona √æa√∞. A√∞ vinna er alltaf gaman! En ma√∞ur √æarf l√≠ka a√∞ kunna a√∞ tapa. Vi√∞ √¶fum miki√∞ og li√∞i√∞ okkar er gott," segir Dan√≠el.
‚ÄûM√° √©g koma a√∞ horfa √° leikinn?" spyr Bjarki.
‚ÄûJ√° au√∞vita√∞! √ûa√∞ v√¶ri gaman," svarar Dan√≠el.
Sk√≥labjallan hringir og fr√≠m√≠n√∫turnar eru b√∫nar. Str√°karnir fara aftur √≠ t√≠ma.
‚ÄûVi√∞ sj√°umst √° laugardaginn!" segir Bjarki.
‚ÄûJ√°, sj√°umst!" svarar Dan√≠el.
    const VOCAB = [
      { w: "upp√°haldsfag (hk)", hint: "√æa√∞ fag sem √æ√©r finnst skemmtilegast √≠ sk√≥lanum" },
      { w: "fr√≠m√≠n√∫tur (kvk ft)", hint: "p√°sa milli kennslustunda" },
      { w: "a√∞ reikna", hint: "a√∞ finna sv√∂r vi√∞ st√¶r√∞fr√¶√∞id√¶mum" },
      { w: "a√∞ leggja saman", hint: "pl√∫s, t.d. 2+3=5" },
      { w: "a√∞ draga fr√°", hint: "m√≠nus, t.d. 5-2=3" },
      { w: "handbolti (kk)", hint: "√≠√ær√≥tt √æar sem √æ√∫ kastar bolta √≠ mark" },
      { w: "a√∞ √¶fa", hint: "a√∞ √æj√°lfa sig, a√∞ ver√∞a betri" }
    ];

    const TRANSLATIONS = [
      { word: 'a√∞ reikna' },
      { word: 'a√∞ √¶fa' }
    ];

    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞ er upp√°haldsfag Bjarka?',
        options: ['√ç√ær√≥ttir', 'St√¶r√∞fr√¶√∞i', '√çslenska', 'Myndlist'],
        correct: 1
      },
      {
        question: 'Hva√∞ er upp√°haldsfag Dan√≠els?',
        options: ['St√¶r√∞fr√¶√∞i', '√ç√ær√≥ttir', 'T√≥nlist', 'Sm√≠√∞i'],
        correct: 1
      },
      {
        question: 'Hva√∞a √≠√ær√≥tt √¶fir Dan√≠el?',
        options: ['F√≥tbolta', 'K√∂rfubolta', 'Handbolta', 'Sund'],
        correct: 2
      },
      {
        question: 'Hven√¶r √° li√∞i√∞ leik?',
        options: ['√Å fimmtudaginn', '√Å f√∂studaginn', '√Å laugardaginn', '√Å sunnudaginn'],
        correct: 2
      },
      {
        question: 'Hj√° hva√∞a li√∞i √¶fir Dan√≠el?',
        options: ['KR', 'Haukum', 'FH', 'Fram'],
        correct: 1
      }
    ];

    const OPEN_QUESTIONS = [
      {
        question: 'Hvers vegna finnst Bjarka gaman √≠ st√¶r√∞fr√¶√∞i?',
        expectedContent: ['reikna', 'leggja saman', 'draga fr√°', 'au√∞veld', 'pl√∫s', 'm√≠nus']
      },
      {
        question: 'Hva√∞ finnst Dan√≠el um st√¶r√∞fr√¶√∞i?',
        expectedContent: ['erfi√∞', 'erfitt', 'skilur ekki', 'skil √æa√∞ ekki']
      },
      {
        question: 'Hva√∞ segir Dan√≠el um a√∞ vinna og tapa?',
        expectedContent: ['vinna', 'gaman', 'tapa', 'kunna a√∞ tapa', 'hluti', 'leikur']
      },
      {
        question: 'Hva√∞ √¶tlar Bjarki a√∞ gera √° laugardaginn?',
        expectedContent: ['horfa', 'horfa √° leik', 'koma', 'leikinn', 'sj√° leik']
      }
    ];

    const TRUE_FALSE = [
      { statement: 'Str√°karnir tala um upp√°haldsf√∂gin s√≠n √≠ fr√≠m√≠n√∫tum.', correct: true },
      { statement: 'Bjarka finnst st√¶r√∞fr√¶√∞i erfi√∞.', correct: false },
      { statement: 'Dan√≠el √¶fir me√∞ Haukum.', correct: true },
      { statement: 'Leikurinn er √° sunnudaginn.', correct: false },
      { statement: 'Bjarki √¶tlar a√∞ koma √° leikinn.', correct: true }
    ];

    const MATCHING = [
      { left: 'Bjarki', right: 'Finnst gaman √≠ st√¶r√∞fr√¶√∞i' },
      { left: 'Dan√≠el', right: '√Üfir me√∞ Haukum' },
      { left: 'Handbolti', right: '√ç√ær√≥tt √æar sem √æ√∫ kastar bolta √≠ mark' },
      { left: 'Fr√≠m√≠n√∫tur', right: 'P√°sa milli kennslustunda' }
    ];

    // ========== MAIN COMPONENT ==========
    const HlustunApp = () => {
      const [isPlaying, setIsPlaying] = useState(false);
      const [playbackRate, setPlaybackRate] = useState(1);
      const audioRef = useRef(null);

      // Translation states
      const [translationAnswers, setTranslationAnswers] = useState(['', '']);
      const [translationFeedback, setTranslationFeedback] = useState([null, null]);
      const [translationLoading, setTranslationLoading] = useState([false, false]);

      // Multiple choice states
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);
      
      // Randomize options for each question
      const shuffledMC = useMemo(() => {
        return MULTIPLE_CHOICE.map(q => {
          const optionsWithIndex = q.options.map((opt, idx) => ({ text: opt, originalIndex: idx }));
          // Shuffle
          for (let i = optionsWithIndex.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];
          }
          return {
            question: q.question,
            options: optionsWithIndex,
            correctOriginalIndex: q.correct
          };
        });
      }, []);

      // Open questions states
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // True/False states
      const [tfAnswers, setTfAnswers] = useState(Array(TRUE_FALSE.length).fill(null));
      const [tfChecked, setTfChecked] = useState(false);

      // Matching states
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);
      const rightOptions = useMemo(() => {
        const options = MATCHING.map(m => m.right);
        for (let i = options.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }
        return options;
      }, []);

      // Modal state
      const [showTextModal, setShowTextModal] = useState(false);

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.playbackRate = playbackRate;
        }
      }, [playbackRate]);

      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) {
          audioRef.current.pause();
        } else {
          audioRef.current.play();
        }
        setIsPlaying(!isPlaying);
      };

      // ========== TRANSLATION HANDLERS ==========
      const checkTranslation = async (index) => {
        const answer = translationAnswers[index].trim();
        if (!answer) return;

        setTranslationLoading(prev => {
          const newLoading = [...prev];
          newLoading[index] = true;
          return newLoading;
        });

        try {
          const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.

√çSLENSKA OR√êI√ê: "${TRANSLATIONS[index].word}"
SVAR NEMANDA: "${answer}"

VERKEFNI:
1. Greina sj√°lfkrafa hva√∞a tungum√°l nemandinn nota√∞i
2. Meta hvort √æ√Ω√∞ingin s√© r√©tt
3. Skila stuttri, j√°kv√¶√∞ri endurgj√∂f

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "detected_language": "nafn tungum√°lsins (t.d. enska, p√≥lska, sp√¶nska)",
  "feedback_is": "Endurgj√∂f √° √≠slensku",
  "feedback_native": "Endurgj√∂f √° greinda tungum√°linu",
  "correct_translation": "G√≥√∞ √æ√Ω√∞ing ef rangt, annars null"
}`;

          const result = await callOpenAI([
            { role: 'system', content: sys },
            { role: 'user', content: answer }
          ], 200, 'gpt-4o', 0.2);

          const feedback = JSON.parse(result);
          setTranslationFeedback(prev => {
            const newFeedback = [...prev];
            newFeedback[index] = feedback;
            return newFeedback;
          });
        } catch (error) {
          console.error('Villa vi√∞ a√∞ athuga √æ√Ω√∞ingu:', error);
        } finally {
          setTranslationLoading(prev => {
            const newLoading = [...prev];
            newLoading[index] = false;
            return newLoading;
          });
        }
      };

      const resetTranslation = (index) => {
        setTranslationAnswers(prev => {
          const newAnswers = [...prev];
          newAnswers[index] = '';
          return newAnswers;
        });
        setTranslationFeedback(prev => {
          const newFeedback = [...prev];
          newFeedback[index] = null;
          return newFeedback;
        });
      };

      // ========== MULTIPLE CHOICE HANDLERS ==========
      const handleMcAnswer = (qIndex, shuffledIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = shuffledIndex;
        setMcAnswers(newAnswers);
      };

      const checkMC = () => {
        const allAnswered = shuffledMC.every((_, i) => Number.isInteger(mcAnswers[i]));
        if (!allAnswered) return;
        setMcChecked(true);
      };

      const resetMC = () => {
        setMcAnswers([]);
        setMcChecked(false);
      };

      // ========== OPEN QUESTIONS HANDLERS ==========
      const checkOpenQuestion = async (index) => {
        const answer = openAnswers[index].trim();
        if (!answer) return;

        setOpenLoading(prev => {
          const newLoading = [...prev];
          newLoading[index] = true;
          return newLoading;
        });

        try {
          const question = OPEN_QUESTIONS[index];
          const sys = `√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ opnum spurningum.

SPURNINGIN:
"${question.question}"

SVAR NEMANDA:
"${answer}"

LYKILATRI√êI SEM EIGA A√ê KOMA FRAM:
${question.expectedContent.join(', ')}

VERKEFNI:
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ INNIHALD (hunsa sm√°v√¶gilegar villur). 
Skila stuttri hvetjandi endurgj√∂f.

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "feedback": "Stutt og hvetjandi endurgj√∂f √° √≠slensku"
}`;

          const result = await callOpenAI([
            { role: 'system', content: sys },
            { role: 'user', content: answer }
          ], 150, 'gpt-4o', 0.2);

          const feedback = JSON.parse(result);
          setOpenFeedback(prev => {
            const newFeedback = [...prev];
            newFeedback[index] = feedback;
            return newFeedback;
          });
        } catch (error) {
          console.error('Villa vi√∞ a√∞ athuga svar:', error);
        } finally {
          setOpenLoading(prev => {
            const newLoading = [...prev];
            newLoading[index] = false;
            return newLoading;
          });
        }
      };

      const resetOpenQuestion = (index) => {
        setOpenAnswers(prev => {
          const newAnswers = [...prev];
          newAnswers[index] = '';
          return newAnswers;
        });
        setOpenFeedback(prev => {
          const newFeedback = [...prev];
          newFeedback[index] = null;
          return newFeedback;
        });
      };

      // ========== TRUE/FALSE HANDLERS ==========
      const checkTF = () => {
        setTfChecked(true);
      };

      const resetTF = () => {
        setTfAnswers(Array(TRUE_FALSE.length).fill(null));
        setTfChecked(false);
      };

      // ========== MATCHING HANDLERS ==========
      const checkMatching = () => {
        setMatchingChecked(true);
      };

      const resetMatching = () => {
        setMatchingAnswers(Array(MATCHING.length).fill(''));
        setMatchingChecked(false);
      };

      const allCompleted = mcChecked && tfChecked && matchingChecked && 
        openFeedback.every(f => f !== null) && 
        translationFeedback.every(f => f !== null);

      return (
        <div className="min-h-screen pb-12">
          {/* Header */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button onClick={() => window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">
                Hlustun 10: Bjarki og Dan√≠el √≠ fr√≠m√≠n√∫tum
              </h1>
              <p className="text-gray-500 text-sm font-light">
                Hlustunarverkefni ¬∑ A1‚ÄìA2
              </p>
            </div>
          </header>

          {/* Sticky Audio Player */}
          <div className="sticky-player">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
                <div className="flex items-center gap-4 flex-wrap">
                  <button onClick={togglePlay} className="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl transition-colors">
                    {isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                  </button>
                  <p className="text-sm font-normal text-gray-800">üéß Hlusta √° textann</p>
                  <audio ref={audioRef} src="media/hlustun10_uppahaldsfag.mp3" onEnded={() => setIsPlaying(false)} />
                  <div className="flex gap-2 ml-auto">
                    <button onClick={() => setPlaybackRate(0.75)} className={`px-3 py-1 rounded-md text-sm transition-colors ${playbackRate === 0.75 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>
                      0.75√ó
                    </button>
                    <button onClick={() => setPlaybackRate(1)} className={`px-3 py-1 rounded-md text-sm transition-colors ${playbackRate === 1 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>
                      1√ó
                    </button>
                    <button onClick={() => setPlaybackRate(1.25)} className={`px-3 py-1 rounded-md text-sm transition-colors ${playbackRate === 1.25 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>
                      1.25√ó
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-8">
            {/* Vocabulary Section */}
            <section className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-4">üìò Lykilor√∞</h2>
              <p className="text-gray-700 font-light mb-4">
                Lestu yfir or√∞in √°√∞ur en √æ√∫ hlustar.
              </p>
              <div className="grid md:grid-cols-2 gap-3">
                {VOCAB.map((item, i) => (
                  <div key={i} className="rounded-lg border-2 border-yellow-200 bg-white/70 p-3">
                    <div className="font-normal text-gray-900">{item.w}</div>
                    <div className="text-sm text-gray-600 font-light">{item.hint}</div>
                  </div>
                ))}
              </div>
            </section>

            {/* Translation Questions */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ingarspurningar</h2>
              <div className="space-y-6">
                {TRANSLATIONS.map((item, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">
                      √û√Ωddu or√∞i√∞: <span className="font-semibold text-blue-600">{item.word}</span>
                    </p>
                    
                    <textarea
                      value={translationAnswers[index]}
                      onChange={(e) => {
                        const newAnswers = [...translationAnswers];
                        newAnswers[index] = e.target.value;
                        setTranslationAnswers(newAnswers);
                      }}
                      placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-light mb-3"
                      rows="2"
                      disabled={translationFeedback[index]?.correct}
                    />

                    {!translationFeedback[index] && (
                      <button
                        onClick={() => checkTranslation(index)}
                        disabled={!translationAnswers[index].trim() || translationLoading[index]}
                        className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                      >
                        {translationLoading[index] ? 'Athuga...' : 'Athuga √æ√Ω√∞ingu'}
                      </button>
                    )}

                    {translationFeedback[index] && (
                      <div className={`mt-4 p-4 rounded-lg border-2 ${translationFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                        <p className="font-normal mb-2">üìö {translationFeedback[index].feedback_is}</p>
                        <p className="text-sm font-light italic">{translationFeedback[index].feedback_native}</p>
                        {translationFeedback[index].correct ? (
                          <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                        ) : (
                          <>
                            <p className="mt-2 text-sm">
                              <span className="font-normal">Betri √æ√Ω√∞ing:</span> {translationFeedback[index].correct_translation}
                            </p>
                            <button
                              onClick={() => resetTranslation(index)}
                              className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors"
                            >
                              Reyna aftur
                            </button>
                          </>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </section>

            {/* Multiple Choice */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ Krossaspurningar</h2>
              <div className="space-y-6">
                {shuffledMC.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((option, shuffledIndex) => {
                        const isSelected = mcAnswers[qIndex] === shuffledIndex;
                        const isCorrect = option.originalIndex === q.correctOriginalIndex;
                        const showResult = mcChecked;
                        
                        let className = "w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-light ";
                        if (!showResult) {
                          className += isSelected 
                            ? "border-blue-500 bg-blue-50" 
                            : "border-gray-300 hover:border-gray-400 bg-white";
                        } else {
                          if (isCorrect) {
                            className += "border-green-500 bg-green-50 text-green-800";
                          } else if (isSelected && !isCorrect) {
                            className += "border-red-500 bg-red-50 text-red-800";
                          } else {
                            className += "border-gray-300 bg-gray-50";
                          }
                        }

                        return (
                          <button
                            key={shuffledIndex}
                            onClick={() => handleMcAnswer(qIndex, shuffledIndex)}
                            className={className}
                            disabled={mcChecked}
                          >
                            {option.text}
                            {showResult && isCorrect && " ‚úì"}
                            {showResult && isSelected && !isCorrect && " ‚úó"}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkMC}
                  disabled={shuffledMC.some((_, i) => !Number.isInteger(mcAnswers[i])) || mcChecked}
                  className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {mcChecked && (
                  <button
                    onClick={resetMC}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Open Questions */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Opnar spurningar</h2>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                    
                    <textarea
                      value={openAnswers[index]}
                      onChange={(e) => {
                        const newAnswers = [...openAnswers];
                        newAnswers[index] = e.target.value;
                        setOpenAnswers(newAnswers);
                      }}
                      placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-light mb-3"
                      rows="3"
                      disabled={openFeedback[index]?.correct}
                    />

                    {!openFeedback[index] && (
                      <button
                        onClick={() => checkOpenQuestion(index)}
                        disabled={!openAnswers[index].trim() || openLoading[index]}
                        className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                      >
                        {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                      </button>
                    )}

                    {openFeedback[index] && (
                      <div className={`mt-4 p-4 rounded-lg border-2 ${openFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                        <p className="font-light">{openFeedback[index].feedback}</p>
                        {openFeedback[index].correct ? (
                          <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                        ) : (
                          <button
                            onClick={() => resetOpenQuestion(index)}
                            className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors"
                          >
                            Reyna aftur
                          </button>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </section>

            {/* True/False */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-light text-gray-800 mb-4">{item.statement}</p>
                    <div className="flex gap-4">
                      <button
                        onClick={() => {
                          if (!tfChecked) {
                            const newAnswers = [...tfAnswers];
                            newAnswers[index] = true;
                            setTfAnswers(newAnswers);
                          }
                        }}
                        className={`flex-1 px-6 py-3 rounded-lg border-2 font-normal transition-all ${
                          !tfChecked
                            ? tfAnswers[index] === true
                              ? 'border-blue-500 bg-blue-50'
                              : 'border-gray-300 hover:border-gray-400 bg-white'
                            : tfAnswers[index] === true
                            ? item.correct
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : item.correct
                            ? 'border-green-500 bg-green-50 text-green-800'
                            : 'border-gray-300 bg-gray-50'
                        }`}
                        disabled={tfChecked}
                      >
                        R√©tt {tfChecked && item.correct && tfAnswers[index] === true && '‚úì'}
                        {tfChecked && !item.correct && tfAnswers[index] === true && '‚úó'}
                      </button>
                      <button
                        onClick={() => {
                          if (!tfChecked) {
                            const newAnswers = [...tfAnswers];
                            newAnswers[index] = false;
                            setTfAnswers(newAnswers);
                          }
                        }}
                        className={`flex-1 px-6 py-3 rounded-lg border-2 font-normal transition-all ${
                          !tfChecked
                            ? tfAnswers[index] === false
                              ? 'border-blue-500 bg-blue-50'
                              : 'border-gray-300 hover:border-gray-400 bg-white'
                            : tfAnswers[index] === false
                            ? !item.correct
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : !item.correct
                            ? 'border-green-500 bg-green-50 text-green-800'
                            : 'border-gray-300 bg-gray-50'
                        }`}
                        disabled={tfChecked}
                      >
                        Rangt {tfChecked && !item.correct && tfAnswers[index] === false && '‚úì'}
                        {tfChecked && item.correct && tfAnswers[index] === false && '‚úó'}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkTF}
                  disabled={tfAnswers.includes(null) || tfChecked}
                  className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {tfChecked && (
                  <button
                    onClick={resetTF}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Matching */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ P√∂run</h2>
              <p className="text-gray-600 font-light mb-6">Para√∞u saman vinstri og h√¶gri hli√∞:</p>
              <div className="space-y-4">
                {MATCHING.map((item, index) => {
                  const isCorrect = matchingAnswers[index] === item.right;
                  const showResult = matchingChecked;

                  return (
                    <div key={index} className="flex flex-col md:flex-row gap-4 items-start md:items-center">
                      <div className="flex-1 font-normal text-gray-800 bg-blue-50 border-2 border-blue-200 rounded-lg px-4 py-3">
                        {item.left}
                      </div>
                      <div className="text-gray-400 text-2xl hidden md:block">‚Üí</div>
                      <select
                        value={matchingAnswers[index]}
                        onChange={(e) => {
                          const newAnswers = [...matchingAnswers];
                          newAnswers[index] = e.target.value;
                          setMatchingAnswers(newAnswers);
                        }}
                        disabled={matchingChecked}
                        className={`flex-1 px-4 py-3 rounded-lg border-2 font-light focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                          showResult
                            ? isCorrect
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : 'border-gray-300 bg-white'
                        }`}
                      >
                        <option value="">Veldu svar...</option>
                        {rightOptions.map((option, i) => (
                          <option key={i} value={option}>{option}</option>
                        ))}
                      </select>
                      {showResult && (
                        <div className="text-2xl">
                          {isCorrect ? '‚úì' : '‚úó'}
                        </div>
                      )}
                      {showResult && !isCorrect && (
                        <div className="w-full md:w-auto text-sm text-gray-600 font-light italic">
                          R√©tt svar: {item.right}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkMatching}
                  disabled={matchingAnswers.includes('') || matchingChecked}
                  className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {matchingChecked && (
                  <button
                    onClick={resetMatching}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Read Text Button */}
            {allCompleted && (
              <div className="text-center">
                <button
                  onClick={() => setShowTextModal(true)}
                  className="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 font-normal text-lg transition-colors"
                >
                  üìñ Lesa textann
                </button>
              </div>
            )}
          </main>

          {/* Text Modal */}
          {showTextModal && (
            <div className="modal-overlay" onClick={() => setShowTextModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex justify-between items-center">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Hlustunartextinn</h2>
                  <button
                    onClick={() => setShowTextModal(false)}
                    className="text-gray-500 hover:text-gray-700 text-3xl leading-none"
                  >
                    √ó
                  </button>
                </div>
                <div className="p-8">
                  {LISTENING_TEXT.split('\n\n').map((paragraph, i) => (
                    <p key={i} className="mb-4 text-gray-700 font-light leading-relaxed">
                      {paragraph}
                    </p>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunApp />);
  </script>
</body>
</html>
