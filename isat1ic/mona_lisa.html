<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun: Mona Lisa ‚Äì √çSAT1√çC</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player {
      position: sticky;
      top: 0;
      z-index: 50;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 1rem;
    }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    // ========== AI FUNCTIONS ==========
    async function callOpenAI(messages, max_tokens = 300, model = 'gpt-4o', temperature = 0.3) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages, max_tokens, model, temperature })
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    // ========== DATA ==========
    const LISTENING_TEXT = `Klara situr vi√∞ eldh√∫sbor√∞i√∞ og vinnur √≠ t√∂lvu. H√∫n er a√∞ skipuleggja heimsreisuna s√≠na.

‚ÄûHva√∞ ertu a√∞ sko√∞a?" spyr Brynd√≠s.

‚Äû√âg er a√∞ sko√∞a Louvre safni√∞ √≠ Par√≠s," segir Klara. ‚Äû√âg hlakka svo miki√∞ til a√∞ sj√° Monu L√≠su!"

‚ÄûAh, Mona Lisa! √ûa√∞ er fr√¶gasta m√°lverk √≠ heimi," segir Bao. ‚Äû√âg s√° √æa√∞ √æegar √©g var ungur. Brosi√∞ √° henni er svo dularfullt."

‚ÄûVissu√∞ √æi√∞ a√∞ m√°lverkinu var stoli√∞ √°ri√∞ 1911?" spyr Klara. ‚Äû√ûj√≥furinn var √≠talskur ma√∞ur og hann faldi m√°lverki√∞ √≠ tv√∂ √°r."

‚ÄûNei, √æa√∞ vissi √©g ekki!" segir H√≥lmfr√≠√∞ur. ‚ÄûHvernig fannst √æa√∞ aftur?"

‚Äû√ûj√≥furinn reyndi a√∞ selja √æa√∞ og var handtekinn," √∫tsk√Ωrir Klara. ‚ÄûM√°lverki√∞ f√≥r aftur til Louvre."

‚ÄûHversu lengi √¶tlar √æ√∫ a√∞ vera √≠ Par√≠s?" spyr Brynd√≠s.

‚Äû√ûrj√° daga. √âg √¶tla l√≠ka a√∞ sj√° Eiffelturninn og ganga um Champs-√âlys√©es," segir Klara. ‚ÄûS√≠√∞an fer √©g til Sp√°nar a√∞ bor√∞a tapas, √æa√∞ eru margir sm√°ir r√©ttir en ekki einn st√≥r a√∞alr√©ttur eins og h√©r heima."

‚Äû√ûa√∞ hlj√≥mar eins og √¶vint√Ωri," segir Bao og brosir. ‚Äû√ûetta ver√∞a √≥gleymanlegar minningar."`;

    const VOCAB = [
      { w: "heimsreisa (kvk)", hint: "fer√∞alag um heiminn" },
      { w: "m√°lverk (hk)", hint: "mynd sem listama√∞ur m√°lar" },
      { w: "listasafn (hk)", hint: "safn √æar sem m√°lverk og listaverk eru s√Ωnd" },
      { w: "dularfullur (lo)", hint: "leyndard√≥msfullur, erfitt a√∞ skilja" },
      { w: "a√∞ stela (so)", hint: "a√∞ taka eitthva√∞ sem er ekki √æitt" },
      { w: "√æj√≥fur (kk)", hint: "ma√∞ur sem stelur" },
      { w: "handtekinn (lo)", hint: "√æegar l√∂greglan tekur mann fasta" },
      { w: "tapas (hk ft)", hint: "margir sm√°ir r√©ttir fr√° Sp√°ni" },
      { w: "√¶vint√Ωri (hk)", hint: "spennandi upplifun" }
    ];

    const TRANSLATIONS = [
      { word: 'dularfullur' },
      { word: '√≥gleymanlegar minningar' }
    ];

    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞ er Klara a√∞ skipuleggja?',
        options: ['Afm√¶lisveislu', 'Heimsreisu', 'Br√∫√∞kaupsfer√∞alag', 'Sumarb√∫sta√∞afer√∞'],
        correct: 1
      },
      {
        question: 'Hvar er Mona Lisa til s√Ωnis?',
        options: ['√ç British Museum √≠ London', '√ç Louvre safninu √≠ Par√≠s', '√ç Prado safninu √≠ Madrid', '√ç Listasafni √çslands'],
        correct: 1
      },
      {
        question: 'Hva√∞ segir Bao um bros Monu L√≠su?',
        options: ['√ûa√∞ er sorglegt', '√ûa√∞ er dularfullt', '√ûa√∞ er hl√¶gilegt', '√ûa√∞ er reitt'],
        correct: 1
      },
      {
        question: 'Hva√∞ ger√∞i √æj√≥furinn me√∞ m√°lverki√∞?',
        options: ['Hann brenndi √æa√∞', 'Hann faldi √æa√∞ √≠ tv√∂ √°r', 'Hann gaf √æa√∞ syni s√≠num', 'Hann sendi √æa√∞ til Bandar√≠kjanna'],
        correct: 1
      },
      {
        question: 'Hva√∞ √¶tlar Klara a√∞ gera √° Sp√°ni?',
        options: ['Fara √° listasafn', 'L√¶ra sp√¶nsku', 'Bor√∞a sm√°r√©tti', 'Heims√¶kja vini'],
        correct: 2
      }
    ];

    const OPEN_QUESTIONS = [
      {
        question: 'Hvers vegna hlakkar Klara til a√∞ fara til Par√≠sar?',
        expectedContent: ['Mona Lisa', 'Monu L√≠su', 'Louvre', 'listasafn', 'm√°lverk', 'sj√°']
      },
      {
        question: 'Hva√∞ ger√∞ist √°ri√∞ 1911 og hvernig fannst m√°lverki√∞ aftur?',
        expectedContent: ['stoli√∞', '√æj√≥fur', '√≠talskur', 'faldi', 'tv√∂ √°r', 'selja', 'handtekinn']
      },
      {
        question: 'Hva√∞ √¶tlar Klara a√∞ gera √≠ Par√≠s fyrir utan a√∞ fara √° Louvre?',
        expectedContent: ['Eiffelturninn', 'Champs-√âlys√©es', 'ganga', 'sj√°']
      }
    ];

    const TRUE_FALSE = [
      { statement: 'Klara √¶tlar a√∞ fara til London.', correct: false },
      { statement: 'Bao hefur s√©√∞ Monu L√≠su.', correct: true },
      { statement: '√ûj√≥furinn var franskur.', correct: false },
      { statement: 'Klara √¶tlar a√∞ vera fimm daga √≠ Par√≠s.', correct: false },
      { statement: 'Klara √¶tlar a√∞ bor√∞a tapas √° Sp√°ni.', correct: true }
    ];

    const MATCHING = [
      { left: 'Klara', right: '√Ütlar a√∞ sj√° Monu L√≠su' },
      { left: 'Bao', right: 'Hefur s√©√∞ Monu L√≠su' },
      { left: 'H√≥lmfr√≠√∞ur', right: 'Spur√∞i hvernig m√°lverki√∞ fannst' },
      { left: 'Louvre', right: 'Listasafn √≠ Par√≠s' }
    ];

    // ========== MAIN COMPONENT ==========
    const HlustunApp = () => {
      const [isPlaying, setIsPlaying] = useState(false);
      const [playbackRate, setPlaybackRate] = useState(1);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);
      const audioRef = useRef(null);

      // Translation states
      const [translationAnswers, setTranslationAnswers] = useState(['', '']);
      const [translationFeedback, setTranslationFeedback] = useState([null, null]);
      const [translationLoading, setTranslationLoading] = useState([false, false]);

      // Multiple choice states
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);
      
      // Randomize options for each question
      const shuffledMC = useMemo(() => {
        return MULTIPLE_CHOICE.map(q => {
          const optionsWithIndex = q.options.map((opt, idx) => ({ text: opt, originalIndex: idx }));
          for (let i = optionsWithIndex.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];
          }
          return {
            question: q.question,
            options: optionsWithIndex,
            correctOriginalIndex: q.correct
          };
        });
      }, []);

      // Open questions states
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // True/False states
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Matching states
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);
      const rightOptions = useMemo(() => {
        const options = MATCHING.map(m => m.right);
        for (let i = options.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }
        return options;
      }, []);

      // Modal state
      const [showTextModal, setShowTextModal] = useState(false);

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.playbackRate = playbackRate;
        }
      }, [playbackRate]);

      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) {
          audioRef.current.pause();
        } else {
          audioRef.current.play();
        }
        setIsPlaying(!isPlaying);
      };

      // ========== TRANSLATION HANDLERS ==========
      const checkTranslation = async (index) => {
        const answer = translationAnswers[index].trim();
        if (!answer) return;

        setTranslationLoading(prev => {
          const newLoading = [...prev];
          newLoading[index] = true;
          return newLoading;
        });

        try {
          const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.

√çSLENSKA OR√êI√ê: "${TRANSLATIONS[index].word}"
SVAR NEMANDA: "${answer}"

VERKEFNI:
1. Greina sj√°lfkrafa hva√∞a tungum√°l nemandinn nota√∞i
2. Meta hvort √æ√Ω√∞ingin s√© r√©tt
3. Skila stuttri, j√°kv√¶√∞ri endurgj√∂f

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "detected_language": "nafn tungum√°lsins (t.d. enska, p√≥lska, sp√¶nska)",
  "feedback_is": "Endurgj√∂f √° √≠slensku",
  "feedback_native": "Endurgj√∂f √° greinda tungum√°linu",
  "correct_translation": "G√≥√∞ √æ√Ω√∞ing ef rangt, annars null"
}`;

          const result = await callOpenAI([
            { role: 'system', content: sys },
            { role: 'user', content: answer }
          ], 200, 'gpt-4o', 0.2);

          const feedback = JSON.parse(result);
          setTranslationFeedback(prev => {
            const newFeedback = [...prev];
            newFeedback[index] = feedback;
            return newFeedback;
          });
        } catch (error) {
          console.error('Villa vi√∞ a√∞ athuga √æ√Ω√∞ingu:', error);
        } finally {
          setTranslationLoading(prev => {
            const newLoading = [...prev];
            newLoading[index] = false;
            return newLoading;
          });
        }
      };

      const resetTranslation = (index) => {
        setTranslationAnswers(prev => {
          const newAnswers = [...prev];
          newAnswers[index] = '';
          return newAnswers;
        });
        setTranslationFeedback(prev => {
          const newFeedback = [...prev];
          newFeedback[index] = null;
          return newFeedback;
        });
      };

      // ========== MULTIPLE CHOICE HANDLERS ==========
      const handleMcAnswer = (qIndex, shuffledIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = shuffledIndex;
        setMcAnswers(newAnswers);
      };

      const checkMC = () => {
        const allAnswered = shuffledMC.every((_, i) => Number.isInteger(mcAnswers[i]));
        if (!allAnswered) return;
        setMcChecked(true);
      };

      const resetMC = () => {
        setMcAnswers([]);
        setMcChecked(false);
      };

      // ========== OPEN QUESTIONS HANDLERS ==========
      const checkOpenQuestion = async (index) => {
        const answer = openAnswers[index].trim();
        if (!answer) return;

        setOpenLoading(prev => {
          const newLoading = [...prev];
          newLoading[index] = true;
          return newLoading;
        });

        try {
          const question = OPEN_QUESTIONS[index];
          const sys = `√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ opnum spurningum.

SPURNINGIN:
"${question.question}"

SVAR NEMANDA:
"${answer}"

LYKILATRI√êI SEM EIGA A√ê KOMA FRAM:
${question.expectedContent.join(', ')}

VERKEFNI:
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ INNIHALD (hunsa sm√°v√¶gilegar villur). 
Skila stuttri hvetjandi endurgj√∂f.

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "feedback": "Stutt og hvetjandi endurgj√∂f √° √≠slensku"
}`;

          const result = await callOpenAI([
            { role: 'system', content: sys },
            { role: 'user', content: answer }
          ], 150, 'gpt-4o', 0.2);

          const feedback = JSON.parse(result);
          setOpenFeedback(prev => {
            const newFeedback = [...prev];
            newFeedback[index] = feedback;
            return newFeedback;
          });
        } catch (error) {
          console.error('Villa vi√∞ a√∞ athuga svar:', error);
        } finally {
          setOpenLoading(prev => {
            const newLoading = [...prev];
            newLoading[index] = false;
            return newLoading;
          });
        }
      };

      const resetOpenQuestion = (index) => {
        setOpenAnswers(prev => {
          const newAnswers = [...prev];
          newAnswers[index] = '';
          return newAnswers;
        });
        setOpenFeedback(prev => {
          const newFeedback = [...prev];
          newFeedback[index] = null;
          return newFeedback;
        });
      };

      // ========== TRUE/FALSE HANDLERS ==========
      const checkTF = () => {
        setTfChecked(true);
      };

      const resetTF = () => {
        setTfAnswers([]);
        setTfChecked(false);
      };

      // ========== MATCHING HANDLERS ==========
      const checkMatching = () => {
        setMatchingChecked(true);
      };

      const resetMatching = () => {
        setMatchingAnswers(Array(MATCHING.length).fill(''));
        setMatchingChecked(false);
      };

      const allCompleted = mcChecked && tfChecked && matchingChecked && 
        openFeedback.every(f => f !== null) && 
        translationFeedback.every(f => f !== null);

      return (
        <div className="min-h-screen pb-12">
          {/* Header */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button onClick={() => window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">
                üé® Hlustun: Mona Lisa
              </h1>
              <p className="text-gray-500 text-sm font-light">
                Hlustunarverkefni ¬∑ A2
              </p>
            </div>
          </header>

          {/* Sticky Audio Player */}
          <div className="sticky-player">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <div className="bg-gradient-to-r from-amber-50 to-amber-100 rounded-lg p-4 border-2 border-amber-200">
                <div className="flex items-center gap-4 mb-3">
                  <button
                    onClick={togglePlay}
                    className="bg-amber-500 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-amber-600 transition-colors flex-shrink-0"
                    aria-label={isPlaying ? 'P√°sa' : 'Spila'}
                  >
                    {isPlaying ? (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg>
                    ) : (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3" /></svg>
                    )}
                  </button>

                  <button
                    onClick={() => { if (audioRef.current) audioRef.current.currentTime -= 10; }}
                    className="bg-white text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors text-sm"
                    aria-label="10 sek√∫ndur til baka"
                  >
                    ‚èÆÔ∏è
                  </button>

                  <div className="flex-1">
                    <div className="flex items-center justify-between mb-1">
                      <p className="text-sm font-normal text-gray-800">üéß Hlusta √° textann</p>
                      <span className="text-xs text-gray-600 font-mono">
                        {Math.floor(currentTime / 60)}:{String(Math.floor(currentTime % 60)).padStart(2, '0')} / {Math.floor(duration / 60)}:{String(Math.floor(duration % 60)).padStart(2, '0')}
                      </span>
                    </div>
                    
                    {/* Progress bar */}
                    <div 
                      className="w-full h-2 bg-white/50 rounded-full cursor-pointer relative overflow-hidden"
                      onClick={(e) => {
                        if (!audioRef.current) return;
                        const rect = e.currentTarget.getBoundingClientRect();
                        const percent = (e.clientX - rect.left) / rect.width;
                        audioRef.current.currentTime = percent * duration;
                      }}
                    >
                      <div 
                        className="absolute top-0 left-0 h-full bg-amber-500 transition-all"
                        style={{ width: `${(currentTime / duration) * 100}%` }}
                      />
                    </div>

                    <audio
                      ref={audioRef}
                      src="media/hlustun_mona_lisa.mp3"
                      preload="metadata"
                      onEnded={() => setIsPlaying(false)}
                      onPlay={() => setIsPlaying(true)}
                      onPause={() => setIsPlaying(false)}
                      onTimeUpdate={() => setCurrentTime(audioRef.current?.currentTime || 0)}
                      onLoadedMetadata={() => setDuration(audioRef.current?.duration || 0)}
                    />
                  </div>

                  <button
                    onClick={() => { if (audioRef.current) audioRef.current.currentTime += 10; }}
                    className="bg-white text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors text-sm"
                    aria-label="10 sek√∫ndur √°fram"
                  >
                    ‚è≠Ô∏è
                  </button>

                  <div className="flex gap-2">
                    <button onClick={() => setPlaybackRate(0.75)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 0.75 ? 'bg-amber-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>0.75√ó</button>
                    <button onClick={() => setPlaybackRate(1)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1 ? 'bg-amber-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1√ó</button>
                    <button onClick={() => setPlaybackRate(1.25)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1.25 ? 'bg-amber-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1.25√ó</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-8">
            {/* Vocabulary Section */}
            <section className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-4">üìò Lykilor√∞</h2>
              <p className="text-gray-700 font-light mb-4">
                Lestu yfir or√∞in √°√∞ur en √æ√∫ hlustar.
              </p>
              <div className="grid md:grid-cols-2 gap-3">
                {VOCAB.map((item, i) => (
                  <div key={i} className="rounded-lg border-2 border-yellow-200 bg-white/70 p-3">
                    <div className="font-normal text-gray-900">{item.w}</div>
                    <div className="text-sm text-gray-600 font-light">{item.hint}</div>
                  </div>
                ))}
              </div>
            </section>

            {/* Translation Questions */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ing</h2>
              <div className="space-y-6">
                {TRANSLATIONS.map((item, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">
                      √û√Ωddu or√∞i√∞ √° √æitt m√≥√∞urm√°l: <span className="font-semibold text-amber-600">{item.word}</span>
                    </p>
                    
                    <textarea
                      value={translationAnswers[index]}
                      onChange={(e) => {
                        const newAnswers = [...translationAnswers];
                        newAnswers[index] = e.target.value;
                        setTranslationAnswers(newAnswers);
                      }}
                      placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 font-light mb-3"
                      rows="2"
                      disabled={translationFeedback[index]?.correct}
                    />

                    {!translationFeedback[index] && (
                      <button
                        onClick={() => checkTranslation(index)}
                        disabled={!translationAnswers[index].trim() || translationLoading[index]}
                        className="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                      >
                        {translationLoading[index] ? 'Athuga...' : 'Athuga √æ√Ω√∞ingu'}
                      </button>
                    )}

                    {translationFeedback[index] && (
                      <div className={`mt-4 p-4 rounded-lg border-2 ${translationFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                        <p className="font-normal mb-2">üìö {translationFeedback[index].feedback_is}</p>
                        <p className="text-sm font-light italic">{translationFeedback[index].feedback_native}</p>
                        {translationFeedback[index].correct ? (
                          <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                        ) : (
                          <>
                            <p className="mt-2 text-sm">
                              <span className="font-normal">Betri √æ√Ω√∞ing:</span> {translationFeedback[index].correct_translation}
                            </p>
                            <button
                              onClick={() => resetTranslation(index)}
                              className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors"
                            >
                              Reyna aftur
                            </button>
                          </>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </section>

            {/* Multiple Choice */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ Krossaspurningar</h2>
              <div className="space-y-6">
                {shuffledMC.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((option, shuffledIndex) => {
                        const isSelected = mcAnswers[qIndex] === shuffledIndex;
                        const isCorrect = option.originalIndex === q.correctOriginalIndex;
                        const showResult = mcChecked;
                        
                        let className = "w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-light ";
                        if (!showResult) {
                          className += isSelected 
                            ? "border-amber-500 bg-amber-50" 
                            : "border-gray-300 hover:border-gray-400 bg-white";
                        } else {
                          if (isCorrect) {
                            className += "border-green-500 bg-green-50 text-green-800";
                          } else if (isSelected && !isCorrect) {
                            className += "border-red-500 bg-red-50 text-red-800";
                          } else {
                            className += "border-gray-300 bg-gray-50";
                          }
                        }

                        return (
                          <button
                            key={shuffledIndex}
                            onClick={() => handleMcAnswer(qIndex, shuffledIndex)}
                            className={className}
                            disabled={mcChecked}
                          >
                            {option.text}
                            {showResult && isCorrect && " ‚úì"}
                            {showResult && isSelected && !isCorrect && " ‚úó"}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkMC}
                  disabled={shuffledMC.some((_, i) => !Number.isInteger(mcAnswers[i])) || mcChecked}
                  className="bg-amber-600 text-white px-8 py-3 rounded-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {mcChecked && (
                  <button
                    onClick={resetMC}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Open Questions */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Opnar spurningar</h2>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-normal text-gray-800 mb-4">{q.question}</p>
                    
                    <textarea
                      value={openAnswers[index]}
                      onChange={(e) => {
                        const newAnswers = [...openAnswers];
                        newAnswers[index] = e.target.value;
                        setOpenAnswers(newAnswers);
                      }}
                      placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 font-light mb-3"
                      rows="3"
                      disabled={openFeedback[index]?.correct}
                    />

                    {!openFeedback[index] && (
                      <button
                        onClick={() => checkOpenQuestion(index)}
                        disabled={!openAnswers[index].trim() || openLoading[index]}
                        className="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                      >
                        {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                      </button>
                    )}

                    {openFeedback[index] && (
                      <div className={`mt-4 p-4 rounded-lg border-2 ${openFeedback[index].correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-yellow-50 border-yellow-200 text-yellow-800'}`}>
                        <p className="font-light">{openFeedback[index].feedback}</p>
                        {openFeedback[index].correct ? (
                          <p className="mt-2 text-sm font-semibold">‚úÖ R√©tt!</p>
                        ) : (
                          <button
                            onClick={() => resetOpenQuestion(index)}
                            className="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 font-normal text-sm transition-colors"
                          >
                            Reyna aftur
                          </button>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </section>

            {/* True/False */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-200 rounded-lg p-6">
                    <p className="text-lg font-light text-gray-800 mb-4">{item.statement}</p>
                    <div className="flex gap-4">
                      <button
                        onClick={() => {
                          if (!tfChecked) {
                            const newAnswers = [...tfAnswers];
                            newAnswers[index] = true;
                            setTfAnswers(newAnswers);
                          }
                        }}
                        className={`flex-1 px-6 py-3 rounded-lg border-2 font-normal transition-all ${
                          !tfChecked
                            ? tfAnswers[index] === true
                              ? 'border-amber-500 bg-amber-50'
                              : 'border-gray-300 hover:border-gray-400 bg-white'
                            : tfAnswers[index] === true
                            ? item.correct
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : item.correct
                            ? 'border-green-500 bg-green-50 text-green-800'
                            : 'border-gray-300 bg-gray-50'
                        }`}
                        disabled={tfChecked}
                      >
                        R√©tt {tfChecked && item.correct && tfAnswers[index] === true && '‚úì'}
                        {tfChecked && !item.correct && tfAnswers[index] === true && '‚úó'}
                      </button>
                      <button
                        onClick={() => {
                          if (!tfChecked) {
                            const newAnswers = [...tfAnswers];
                            newAnswers[index] = false;
                            setTfAnswers(newAnswers);
                          }
                        }}
                        className={`flex-1 px-6 py-3 rounded-lg border-2 font-normal transition-all ${
                          !tfChecked
                            ? tfAnswers[index] === false
                              ? 'border-amber-500 bg-amber-50'
                              : 'border-gray-300 hover:border-gray-400 bg-white'
                            : tfAnswers[index] === false
                            ? !item.correct
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : !item.correct
                            ? 'border-green-500 bg-green-50 text-green-800'
                            : 'border-gray-300 bg-gray-50'
                        }`}
                        disabled={tfChecked}
                      >
                        Rangt {tfChecked && !item.correct && tfAnswers[index] === false && '‚úì'}
                        {tfChecked && item.correct && tfAnswers[index] === false && '‚úó'}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkTF}
                  disabled={tfAnswers.length !== TRUE_FALSE.length || tfChecked}
                  className="bg-amber-600 text-white px-8 py-3 rounded-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {tfChecked && (
                  <button
                    onClick={resetTF}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Matching */}
            <section className="bg-white rounded-lg shadow-md p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ Para√∞u saman</h2>
              <p className="text-gray-600 font-light mb-6">Para√∞u saman vinstri og h√¶gri hli√∞:</p>
              <div className="space-y-4">
                {MATCHING.map((item, index) => {
                  const isCorrect = matchingAnswers[index] === item.right;
                  const showResult = matchingChecked;

                  return (
                    <div key={index} className="flex flex-col md:flex-row gap-4 items-start md:items-center">
                      <div className="flex-1 font-normal text-gray-800 bg-amber-50 border-2 border-amber-200 rounded-lg px-4 py-3">
                        {item.left}
                      </div>
                      <div className="text-gray-400 text-2xl hidden md:block">‚Üí</div>
                      <select
                        value={matchingAnswers[index]}
                        onChange={(e) => {
                          const newAnswers = [...matchingAnswers];
                          newAnswers[index] = e.target.value;
                          setMatchingAnswers(newAnswers);
                        }}
                        disabled={matchingChecked}
                        className={`flex-1 px-4 py-3 rounded-lg border-2 font-light focus:outline-none focus:ring-2 focus:ring-amber-500 ${
                          showResult
                            ? isCorrect
                              ? 'border-green-500 bg-green-50 text-green-800'
                              : 'border-red-500 bg-red-50 text-red-800'
                            : 'border-gray-300 bg-white'
                        }`}
                      >
                        <option value="">Veldu svar...</option>
                        {rightOptions.map((option, i) => (
                          <option key={i} value={option}>{option}</option>
                        ))}
                      </select>
                      {showResult && (
                        <div className="text-2xl">
                          {isCorrect ? '‚úì' : '‚úó'}
                        </div>
                      )}
                      {showResult && !isCorrect && (
                        <div className="w-full md:w-auto text-sm text-gray-600 font-light italic">
                          R√©tt svar: {item.right}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
              <div className="flex gap-4 mt-6">
                <button
                  onClick={checkMatching}
                  disabled={matchingAnswers.includes('') || matchingChecked}
                  className="bg-amber-600 text-white px-8 py-3 rounded-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-normal transition-colors"
                >
                  Athuga sv√∂r
                </button>
                {matchingChecked && (
                  <button
                    onClick={resetMatching}
                    className="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 font-normal transition-colors"
                  >
                    Endurstilla
                  </button>
                )}
              </div>
            </section>

            {/* Read Text Button */}
            {allCompleted && (
              <div className="text-center">
                <button
                  onClick={() => setShowTextModal(true)}
                  className="bg-amber-500 text-white px-8 py-3 rounded-lg hover:bg-amber-600 font-normal text-lg transition-colors"
                >
                  üìñ Lesa textann
                </button>
              </div>
            )}
          </main>

          {/* Text Modal */}
          {showTextModal && (
            <div className="modal-overlay" onClick={() => setShowTextModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex justify-between items-center">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Hlustunartextinn</h2>
                  <button
                    onClick={() => setShowTextModal(false)}
                    className="text-gray-500 hover:text-gray-700 text-3xl leading-none"
                  >
                    √ó
                  </button>
                </div>
                <div className="p-8">
                  {LISTENING_TEXT.split('\n\n').map((paragraph, i) => (
                    <p key={i} className="mb-4 text-gray-700 font-light leading-relaxed">
                      {paragraph}
                    </p>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunApp />);
  </script>
</body>
</html>
