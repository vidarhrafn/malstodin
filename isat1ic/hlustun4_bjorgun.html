<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun: √ötkall √≠ bj√∂rgunarsveit ‚Äì M√°lst√∂√∞in</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/isat1ic/auth.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player { position: sticky; top: 0; z-index: 50; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .answer-option { border: 2px solid #e0e0e0; transition: all 0.2s; cursor: pointer; }
    .answer-option:hover:not(.disabled) { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.selected { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.correct { border-color:#4caf50; background:#e8f5e9; }
    .answer-option.incorrect { border-color:#f44336; background:#ffebee; }
    .answer-option.disabled { cursor: default; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const SOURCE_TEXT = `
√âg er √≠ bj√∂rgunarsveit. Vi√∞ erum h√≥pur sj√°lfbo√∞ali√∞a sem √¶fir reglulega og hj√°lpar f√≥lki √≠ ney√∞.
Flest √∫tk√∂ll eru √æegar f√≥lk villist √≠ fj√∂llum e√∞a festist √≠ snj√≥num.
Eitt kv√∂ldi√∞ √≠ febr√∫ar f√©kk √©g s√≠mtal. √ûa√∞ var √∫tkall ‚Äì tveir fer√∞amenn voru fastir √° fjallvegi √≠ miklum stormi.
Vi√∞ m√¶ttum strax √≠ bj√∂rgunarsveitarh√∫si√∞ og t√≥kum me√∞ b√∫na√∞inn okkar: talst√∂√∞var, kort, lj√≥s og sk√≥flur til a√∞ moka. √ûa√∞ var dimmt og ve√∞ri√∞ mj√∂g sl√¶mt ‚Äì snj√≥r, vindur og frost.
Vi√∞ √≥kum h√¶gt upp fjallveginn. √âg var √≠ snj√≥b√≠l me√∞ tveimur f√©l√∂gum m√≠num. Vi√∞ t√∂lu√∞um saman √≠ talst√∂√∞ og reyndum a√∞ finna b√≠linn.
Eftir klukkut√≠ma s√°um vi√∞ lj√≥s ‚Äì √æar voru fer√∞amennirnir, kaldir en heilir √° h√∫fi.
Vi√∞ hj√°lpu√∞um √æeim a√∞ koma √≠ b√≠linn okkar og keyr√∞um ni√∞ur √≠ b√¶. √ûeir s√∂g√∞ust hafa veri√∞ hr√¶ddir en mj√∂g √æakkl√°tir.
√âg hugsa oft um √æa√∞ eftir √° hva√∞ √æa√∞ er mikilv√¶gt a√∞ vera tilb√∫inn, vinna saman og hj√°lpa √∂√∞rum. √ûess vegna er √©g √≠ bj√∂rgunarsveit ‚Äì √æv√≠ √æa√∞ l√≠√∞ur m√©r vel √æegar √©g get gert gagn.
    `;

    const TRUE_FALSE = [
      { statement: 'S√∂guma√∞urinn vinnur √≠ bj√∂rgunarsveit.', correct: false },
      { statement: 'Hann f√©kk √∫tkall √° sumardegi √≠ j√∫l√≠.', correct: false },
      { statement: 'Tveir fer√∞amenn voru fastir √≠ stormi.', correct: true },
      { statement: 'Bj√∂rgunarsveitin t√≥k me√∞ sk√≥flur, kort og lj√≥s.', correct: true },
      { statement: 'Fer√∞amennirnir voru s√¶r√∞ir √æegar bj√∂rgunarsveitin fann √æ√°.', correct: false },
      { statement: 'S√∂gumanninum finnst gott a√∞ hj√°lpa √∂√∞rum.', correct: true }
    ];

    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞ gerir bj√∂rgunarsveitin?',
        options: ['Selur b√∫na√∞', 'Hj√°lpar f√≥lki √≠ ney√∞', '√Üfir √≠ √≠√ær√≥ttah√∫si'],
        correct: 1
      },
      {
        question: 'Hvernig var ve√∞ri√∞ √æegar √∫tkalli√∞ kom?',
        options: ['Gott og hl√Ωtt', 'Frost, stormur og snj√≥r', 'Mikil s√≥l og stilla'],
        correct: 1
      },
      {
        question: '√ç hvernig b√≠l var s√∂guma√∞urinn √æegar hann f√≥r √≠ √∫tkalli√∞?',
        options: ['Leigub√≠l', 'Snj√≥b√≠l', 'Jeppa'],
        correct: 1
      },
      {
        question: 'Hvernig var f√≥lki√∞ sem var bjarga√∞?',
        options: ['Blautt og kalt en heilt √° h√∫fi', 'Meitt og slasa√∞', 'Hreint og hl√Ωtt'],
        correct: 0
      }
    ];

    const SHORT_QUESTIONS = [
      {
        question: 'Hva√∞ t√≥k bj√∂rgunarsveitin me√∞ s√©r √≠ √∫tkalli√∞?',
        expectedContent: ['talst√∂√∞','talst√∂√∞var','kort','lj√≥s','hl√Ω f√∂t','b√∫na√∞ur','sk√≥fla','sk√≥flur','moka']
      },
      {
        question: 'Hva√∞ √æ√Ω√∞ir a√∞ vera ‚Äûheill √° h√∫fi‚Äú?',
        expectedContent: ['√≥slasa√∞ur','ekki meiddur','allur heill','heil √° h√∫fi','heill √° h√∫fi']
      },
      {
        question: 'Hvernig lei√∞ s√∂gumanni eftir √∫tkalli√∞?',
        expectedContent: ['gott','√æakkl√°tir','l√≠√∞ur vel','gagn','hj√°lpa √∂√∞rum']
      }
    ];

    const GLOSSARY = [
      { w: 'bj√∂rgunarsveit (kvk)', d: 'h√≥pur f√≥lks sem hj√°lpar √≠ ney√∞' },
      { w: 'sj√°lfbo√∞ali√∞i (kk)', d: 'manneskja sem vinnur √°n launa (ekki launavinna)' },
      { w: '√∫tkall (hk)', d: '√æegar bj√∂rgunarsveit fer a√∞ hj√°lpa f√≥lki' },
      { w: 'b√∫na√∞ur (kk)', d: 't√¶ki og f√∂t sem √æarf til a√∞ hj√°lpa' },
      { w: 'talst√∂√∞ (kvk)', d: 't√¶ki til a√∞ tala saman √° fjalli' },
      { w: 'snj√≥b√≠ll (kk)', d: 'b√≠ll sem getur keyrt √≠ snj√≥' },
      { w: 'heill √° h√∫fi', d: '√≥slasa√∞ur, ekki meiddur' },
      { w: 'a√∞ hj√°lpa √∂√∞rum', d: 'a√∞ bjarga e√∞a sty√∞ja f√≥lk' },
      { w: 'a√∞ vinna saman', d: 'a√∞ s√Ωna samvinnu' },
      { w: 'a√∞ vera tilb√∫inn', d: 'a√∞ hafa √¶ft og vera me√∞ allt kl√°rt' }
    ];

    const AUDIO_SRC = 'media/hlustun_latur.mp3';

    const HlustunUtKall = () => {
      const [playbackRate, setPlaybackRate] = useState(1);
      const [isPlaying, setIsPlaying] = useState(false);
      const audioRef = useRef(null);

      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);
      const [shortAnswers, setShortAnswers] = useState(Array(SHORT_QUESTIONS.length).fill(''));
      const [shortFeedback, setShortFeedback] = useState(Array(SHORT_QUESTIONS.length).fill(null));
      const [shortLoading, setShortLoading] = useState(Array(SHORT_QUESTIONS.length).fill(false));

      useEffect(() => { if (audioRef.current) audioRef.current.playbackRate = playbackRate; }, [playbackRate]);
      const togglePlay = () => { if (!audioRef.current) return; isPlaying ? audioRef.current.pause() : audioRef.current.play(); setIsPlaying(!isPlaying); };

      const handleTfAnswer = (i,v)=>{if(tfChecked)return;const n=[...tfAnswers];n[i]=v;setTfAnswers(n);};
      const checkTfAnswers=()=>{if(tfAnswers.length<TRUE_FALSE.length){alert('Vinsamlegast svara√∞u √∂llum spurningum!');return;}setTfChecked(true);};
      const handleMcAnswer=(q,o)=>{if(mcChecked)return;const n=[...mcAnswers];n[q]=o;setMcAnswers(n);};
      const checkMcAnswers=()=>{if(mcAnswers.length<MULTIPLE_CHOICE.length){alert('Vinsamlegast svara√∞u √∂llum spurningum!');return;}setMcChecked(true);};

      const handleShortAnswer=(i,v)=>{const n=[...shortAnswers];n[i]=v;setShortAnswers(n);};
      const checkShortAnswer=async(i)=>{if(shortAnswers[i].trim().length<3){alert('Vinsamlegast skrifa√∞u svar!');return;}
        const nl=[...shortLoading];nl[i]=true;setShortLoading(nl);
        try{
          const q=SHORT_QUESTIONS[i];const a=shortAnswers[i];
          const sys=`√û√∫ ert √≠slenskukennari sem metur stutt sv√∂r nemenda vi√∞ hlustunartexta.
TEXTI:
${SOURCE_TEXT}
SPURNING: ${q.question}
SVAR NEMANDA: ${a}
LYKILATRI√êI: ${q.expectedContent.join(', ')}
META INNIHALD, ekki stafsetningu.
SKILA√êU BARA JSON:
{"correct": boolean, "feedback": "stutt endurgj√∂f √° √≠slensku"}`
          const r=await callOpenAI({model:'gpt-4o',temperature:0.3,max_tokens:200,messages:[{role:'system',content:sys},{role:'user',content:'Meta svar'}]});
          const data=JSON.parse(r.replace(/```json|```/g,'').trim());
          const nf=[...shortFeedback];nf[i]=data;setShortFeedback(nf);
        }catch(e){console.error(e);alert('Villa vi√∞ a√∞ meta svar. Reyndu aftur.');}
        const nl2=[...shortLoading];nl2[i]=false;setShortLoading(nl2);
      };

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button onClick={()=>window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">‚Üê Til baka</button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">Hlustun: √ötkall √≠ bj√∂rgunarsveit</h1>
              <p className="text-gray-500 text-sm font-light">Hlustunarverkefni ¬∑ A1‚ÄìA2</p>
            </div>
          </header>

          <div className="sticky-player">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
                <div className="flex items-center gap-4">
                  <button onClick={togglePlay} className="bg-blue-500 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors flex-shrink-0">
                    {isPlaying?<svg width=\"24\" height=\"24\" fill=\"currentColor\"><rect x=\"6\" y=\"4\" width=\"4\" height=\"16\"/><rect x=\"14\" y=\"4\" width=\"4\" height=\"16\"/></svg>:
                    <svg width=\"24\" height=\"24\" fill=\"currentColor\"><polygon points=\"5 3 19 12 5 21 5 3\"/></svg>}
                  </button>
                  <div className=\"flex-1\">
                    <p className=\"text-sm font-normal text-gray-800 mb-1\">üéß Hlusta √° textann</p>
                    <audio ref={audioRef} src={AUDIO_SRC} preload=\"none\" onEnded={()=>setIsPlaying(false)} onPlay={()=>setIsPlaying(true)} onPause={()=>setIsPlaying(false)}/>
                  </div>
                  <div className=\"flex gap-2\">
                    {[0.75,1,1.25].map(r=>(
                      <button key={r} onClick={()=>setPlaybackRate(r)} className={`px-3 py-1 rounded-md text-sm font-light ${playbackRate===r?'bg-blue-500 text-white':'bg-white text-gray-700 hover:bg-gray-100'}`}>{r}√ó</button>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className=\"max-w-4xl mx-auto px-6 mt-8 space-y-8\">
            <div className=\"bg-blue-50 border-2 border-blue-200 rounded-lg p-6\">
              <h2 className=\"text-xl font-normal text-gray-800 mb-3\">üìù Lei√∞beiningar</h2>
              <ul className=\"space-y-2 text-gray-700 font-light\">
                <li>‚Ä¢ Hlusta√∞u √° textann 2‚Äì3 sinnum</li>
                <li>‚Ä¢ √û√∫ getur h√¶gt e√∞a hra√∞a√∞ √° hlj√≥√∞inu</li>
                <li>‚Ä¢ Svara√∞u spurningunum h√©r a√∞ ne√∞an</li>
                <li>‚Ä¢ √û√∫ m√°tt hlusta eins oft og √æ√∫ vilt</li>
              </ul>
            </div>

            <section className=\"bg-white rounded-lg shadow-sm p-8\">
              <h2 className=\"text-2xl font-light text-gray-800 mb-6\">1Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className=\"space-y-4\">
                {TRUE_FALSE.map((it,i)=>(
                  <div key={i} className=\"border-2 border-gray-100 rounded-lg p-4\">
                    <p className=\"font-light text-gray-800 mb-3\">{it.statement}</p>
                    <div className=\"flex gap-4\">
                      {[true,false].map(ans=>{
                        const sel=tfAnswers[i]===ans;const cor=ans===it.correct;const ok=tfChecked&&cor;const nok=tfChecked&&sel&&!cor;
                        return (
                          <div key={ans?1:0} onClick={()=>!tfChecked&&handleTfAnswer(i,ans)} className={`answer-option flex-1 p-3 rounded-lg ${sel&&!tfChecked?'selected':''} ${ok?'correct':''} ${nok?'incorrect':''} ${tfChecked?'disabled':''}`}>
                            <div className=\"flex items-center justify-center gap-2\">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${sel&&!tfChecked?'border-blue-500 bg-blue-500':ok?'border-green-500 bg-green-500':nok?'border-red-500 bg-red-500':'border-gray-300'}`}></div>
                              <span className=\"font-light text-sm\">{ans?'R√©tt':'Rangt'}</span>
                              {ok&&<span className=\"text-green-600\">‚úì</span>}
                              {nok&&<span className=\"text-red-600\">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!tfChecked?
                <button onClick={checkTfAnswers} className=\"mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light\">Athuga sv√∂r</button>:
                <div className=\"mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4 text-green-800 font-light\">‚úì √û√∫ f√©kkst {tfAnswers.filter((a,i)=>a===TRUE_FALSE[i].correct).length} af {TRUE_FALSE.length} r√©tt!</div>}
            </section>

            <section className=\"bg-white rounded-lg shadow-sm p-8\">
              <h2 className=\"text-2xl font-light text-gray-800 mb-6\">2Ô∏è‚É£ Krossaspurningar</h2>
              <div className=\"space-y-6\">
                {MULTIPLE_CHOICE.map((q,qi)=>(
                  <div key={qi} className=\"border-2 border-gray-100 rounded-lg p-4\">
                    <p className=\"font-normal text-gray-800 mb-4\">{q.question}</p>
                    <div className=\"space-y-2\">
                      {q.options.map((o,oi)=>{
                        const sel=mcAnswers[qi]===oi;const cor=oi===q.correct;const ok=mcChecked&&cor;
