<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üé∏ A√∞ spila √° hljodfaeri ‚Äì M√°lst√∂√∞in</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/isat1ic/auth.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .answer-option {
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
      cursor: pointer;
    }
    .answer-option:hover:not(.disabled) {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.selected {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }
    .answer-option.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }
    .answer-option.disabled {
      cursor: default;
    }
    .chat-container {
      max-height: 500px;
      overflow-y: auto;
    }
    .chat-container::-webkit-scrollbar {
      width: 6px;
    }
    .chat-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .chat-container::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      overflow-y: auto;
    }
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .modal-content::-webkit-scrollbar {
      width: 8px;
    }
    .modal-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .modal-content::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    /* Sticky text button */
    .sticky-text-btn {
      position: sticky;
      top: 0;
      z-index: 100;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    // Shuffle function
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // Save progress to Supabase (me√∞ writing_score og translation_score)
    async function saveProgress(exerciseId, completed, score = null, quizScore = null, writingScore = null, translationScore = null) {
      const user = getCurrentUser();
      if (!user) return;

      try {
        const payload = {
          action: 'saveProgress',
          user_id: user.id,
          exercise_id: exerciseId,
          completed: completed
        };
        
        // B√¶ta vi√∞ einkunnir ef til
        if (score !== null) payload.score = score;
        if (quizScore !== null) payload.quiz_score = quizScore;
        if (writingScore !== null) payload.writing_score = writingScore;
        if (translationScore !== null) payload.translation_score = translationScore;

        const response = await fetch('/.netlify/functions/supabase', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          console.log('‚úÖ Framvinda vistu√∞:', exerciseId, payload);
        }
      } catch (error) {
        console.error('‚ùå Villa vi√∞ a√∞ vista framvindu:', error);
      }
    }

    const READING_TEXT = `Margt f√≥lk hefur √°huga √° t√≥nlist og vill l√¶ra a√∞ spila √° hlj√≥√∞f√¶ri e√∞a syngja.
Sumir spila √° g√≠tar, p√≠an√≥ e√∞a fi√∞lu, en a√∞rir velja trommur e√∞a flautu.
√ûa√∞ tekur t√≠ma a√∞ l√¶ra, en √æa√∞ er mj√∂g gaman.
√ûegar ma√∞ur byrjar a√∞ spila √° hlj√≥√∞f√¶ri √æarf ma√∞ur a√∞ √¶fa sig reglulega.
Margir √¶fa sig nokkrum sinnum √≠ viku, kannski h√°lft√≠ma e√∞a klukkut√≠ma √≠ einu.
√ûegar ma√∞ur √¶fir sig oft, ver√∞ur ma√∞ur betri og betri.
√ûa√∞ er gott a√∞ vera √æolinm√≥√∞ur og ekki gefast upp √æ√≥ a√∞ √æa√∞ gangi h√¶gt √≠ byrjun.
Sumir l√¶ra √≠ t√≥nlistarsk√≥la e√∞a taka einkat√≠ma, en a√∞rir l√¶ra sj√°lfir me√∞ myndb√∂ndum √° netinu.
√ûa√∞ √æarf ekki alltaf a√∞ eiga d√Ωrt hlj√≥√∞f√¶ri ‚Äî stundum er h√¶gt a√∞ kaupa nota√∞ e√∞a f√° l√°na√∞.
A√∞ spila √° hlj√≥√∞f√¶ri getur veri√∞ b√¶√∞i r√≥andi og spennandi.
F√≥lk getur spila√∞ eitt e√∞a me√∞ √∂√∞rum, til d√¶mis √≠ hlj√≥msveit.
√ûa√∞ er l√≠ka skemmtilegt a√∞ spila √° t√≥nleikum e√∞a fyrir fj√∂lskylduna heima.
T√≥nlist tengir f√≥lk saman og hj√°lpar m√∂rgum a√∞ tj√° sig og vera skapandi.
√âg spila sj√°lfur √° g√≠tar og finnst √æa√∞ fr√°b√¶rt √°hugam√°l.
√ûa√∞ hj√°lpar m√©r a√∞ slaka √° eftir langan dag og gle√∞ja a√∞ra.
√ûa√∞ er yndislegt √æegar ma√∞ur getur spila√∞ upp√°haldslagi√∞ sitt og sungi√∞ me√∞.`;

    const MULTIPLE_CHOICE_ORIGINAL = [
      {
        question: 'Hva√∞ √æarf ma√∞ur a√∞ gera til a√∞ ver√∞a betri √≠ a√∞ spila √° hlj√≥√∞f√¶ri?',
        options: [
          'Kaupa n√Ωtt hlj√≥√∞f√¶ri √° hverju √°ri.',
          '√Üfa sig reglulega og vera √æolinm√≥√∞ur.',
          'Hlusta √° t√≥nlist allan daginn.',
          'Fara oft √° t√≥nleika.'
        ],
        correct: 1
      },
      {
        question: 'Hvar l√¶ra sumir a√∞ spila √° hlj√≥√∞f√¶ri samkv√¶mt textanum?',
        options: [
          '√ç b√≥kasafni e√∞a √≠√ær√≥ttah√∫si.',
          '√ç t√≥nlistarsk√≥la e√∞a me√∞ myndb√∂ndum √° netinu.',
          '√ç vinnunni e√∞a √≠ sundlauginni.',
          'Heima me√∞ fj√∂lskyldunni.'
        ],
        correct: 1
      },
      {
        question: 'Hvers vegna finnst m√∂rgum gott a√∞ spila √° hlj√≥√∞f√¶ri?',
        options: [
          '√ûa√∞ hj√°lpar √æeim a√∞ sofa betur.',
          '√ûa√∞ hj√°lpar √æeim a√∞ slaka √° og vera skapandi.',
          '√ûa√∞ hj√°lpar √æeim a√∞ ver√∞a sterkari.',
          '√ûa√∞ hj√°lpar √æeim a√∞ bor√∞a hollt.'
        ],
        correct: 1
      }
    ];

    const TRUE_FALSE = [
      {
        statement: '√ûa√∞ er flj√≥tlegt og au√∞velt a√∞ l√¶ra a√∞ spila √° hlj√≥√∞f√¶ri.',
        correct: false
      },
      {
        statement: 'Margir √¶fa sig nokkrum sinnum √≠ viku.',
        correct: true
      },
      {
        statement: 'Sumir l√¶ra a√∞ spila me√∞ myndb√∂ndum √° netinu.',
        correct: true
      },
      {
        statement: '√ûa√∞ er mikilv√¶gt a√∞ vera √æolinm√≥√∞ur √æegar ma√∞ur l√¶rir.',
        correct: true
      },
      {
        statement: '√ûa√∞ er lei√∞inlegt a√∞ spila fyrir fj√∂lskylduna heima.',
        correct: false
      },
      {
        statement: 'T√≥nlist getur tengt f√≥lk saman.',
        correct: true
      }
    ];

    const SHORT_OPEN_QUESTIONS = [
      'Hva√∞ √æarf ma√∞ur til a√∞ byrja a√∞ spila √° hlj√≥√∞f√¶ri?',
      'Hvernig getur f√≥lk l√¶rt a√∞ spila ‚Äì nefndu tv√¶r lei√∞ir.',
      'Af hverju √æarf a√∞ √¶fa sig reglulega?',
      'Hvernig hj√°lpar t√≥nlist f√≥lki samkv√¶mt textanum?',
      'Hva√∞ spilar s√∂guma√∞urinn √°?'
    ];

    const TRANSLATION_WORDS = [
      { icelandic: 'hlj√≥√∞f√¶ri', translation: '' },
      { icelandic: '√æolinm√≥√∞ur', translation: '' }
    ];

    const Hlj√≥√∞f√¶ri = () => {
      const [stage, setStage] = useState('multiplechoice');
      const [showModal, setShowModal] = useState(false);
      const [mcAnswers, setMcAnswers] = useState([]);
      const [showMcFeedback, setShowMcFeedback] = useState(false);
      const [shuffledQuestions, setShuffledQuestions] = useState([]);
      
      const [tfAnswers, setTfAnswers] = useState([]);
      const [showTfFeedback, setShowTfFeedback] = useState(false);
      
      const [shortAnswers, setShortAnswers] = useState(['', '', '', '', '']);
      const [shortFeedback, setShortFeedback] = useState([null, null, null, null, null]);
      const [shortScores, setShortScores] = useState([null, null, null, null, null]);
      const [shortLoading, setShortLoading] = useState([false, false, false, false, false]);
      
      const [translations, setTranslations] = useState(['', '']);
      const [translationFeedback, setTranslationFeedback] = useState([null, null]);
      const [translationScores, setTranslationScores] = useState([null, null]);
      const [translationLoading, setTranslationLoading] = useState([false, false]);

      // Shuffle questions when component mounts
      useEffect(() => {
        const shuffled = MULTIPLE_CHOICE_ORIGINAL.map(q => {
          const correctAnswer = q.options[q.correct];
          const shuffledOptions = shuffleArray(q.options);
          const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
          
          return {
            question: q.question,
            options: shuffledOptions,
            correct: newCorrectIndex
          };
        });
        setShuffledQuestions(shuffled);
      }, []);

      const handleMcAnswer = (questionIndex, optionIndex) => {
        if (showMcFeedback) return;
        const newAnswers = [...mcAnswers];
        newAnswers[questionIndex] = optionIndex;
        setMcAnswers(newAnswers);
      };

      const checkMcAnswers = () => {
        if (mcAnswers.length < shuffledQuestions.length) {
          alert('Vinsamlegast svara√∞u √∂llum spurningum!');
          return;
        }
        
        // Telja r√©tt sv√∂r
        const correctCount = mcAnswers.filter((ans, idx) => ans === shuffledQuestions[idx].correct).length;
        const mcScore = Math.round((correctCount / shuffledQuestions.length) * 100);
        
        // Vista MC framvindu
        saveProgress('hljodfaeri', false, null, mcScore, null, null);
        
        setShowMcFeedback(true);
      };

      const continueToTrueFalse = () => {
        setStage('truefalse');
      };

      const handleTfAnswer = (questionIndex, answer) => {
        if (showTfFeedback) return;
        const newAnswers = [...tfAnswers];
        newAnswers[questionIndex] = answer;
        setTfAnswers(newAnswers);
      };

      const checkTfAnswers = () => {
        if (tfAnswers.length < TRUE_FALSE.length) {
          alert('Vinsamlegast svara√∞u √∂llum spurningum!');
          return;
        }
        
        // Telja r√©tt sv√∂r √≠ T/F
        const correctTfCount = tfAnswers.filter((ans, idx) => ans === TRUE_FALSE[idx].correct).length;
        const tfScore = Math.round((correctTfCount / TRUE_FALSE.length) * 100);
        
        // Vista TF framvindu
        saveProgress('hljodfaeri', false, tfScore, null, null, null);
        
        setShowTfFeedback(true);
      };

      const continueToShortQuestions = () => {
        setStage('short');
      };

      const handleShortAnswerChange = (index, value) => {
        const newAnswers = [...shortAnswers];
        newAnswers[index] = value;
        setShortAnswers(newAnswers);
      };

      const getShortFeedback = async (questionIndex) => {
        const question = SHORT_OPEN_QUESTIONS[questionIndex];
        const answer = shortAnswers[questionIndex];

        if (!answer.trim() || answer.trim().length < 3) {
          alert('Vinsamlegast skrifa√∞u eitthva√∞ lengra svar!');
          return;
        }

        const newLoading = [...shortLoading];
        newLoading[questionIndex] = true;
        setShortLoading(newLoading);

        try {
          const feedback = await callOpenAI({
            model: 'gpt-4o-mini',
            messages: [
              {
                role: 'system',
                content: `√û√∫ ert √≠slensku kennari. Nemandinn las texta um a√∞ spila √° hlj√≥√∞f√¶ri og svarar n√∫ stuttri spurningu. 

Gef√∞u endurgj√∂f me√∞ √æessu sni√∞i:
EINKUNN: [0-100]
ENDURGJ√ñF: [2-3 l√≠nur af hvetjandi endurgj√∂f √° √≠slensku]

Einkunnin √° a√∞ byggjast √°:
- M√°lfr√¶√∞ilegri r√©ttm√¶ti (40%)
- Innihaldi og svari vi√∞ spurningunni (40%)
- Or√∞afor√∞a og framsetningu (20%)

Spurningin var: "${question}"

Textinn var:
"${READING_TEXT}"`
              },
              {
                role: 'user',
                content: answer
              }
            ],
            temperature: 0.7,
            max_tokens: 250
          });

          // Vinna √∫r svari og draga √∫t einkunn
          const scoreMatch = feedback.match(/EINKUNN:\s*(\d+)/);
          const score = scoreMatch ? parseInt(scoreMatch[1]) : 50;
          const feedbackText = feedback.replace(/EINKUNN:\s*\d+\s*\n?/, '').replace(/ENDURGJ√ñF:\s*/, '').trim();

          const newFeedback = [...shortFeedback];
          newFeedback[questionIndex] = feedbackText;
          setShortFeedback(newFeedback);

          const newScores = [...shortScores];
          newScores[questionIndex] = score;
          setShortScores(newScores);

          // Athuga hvort allar spurningar s√©u svara√∞ar og vista framvindu
          const allAnswered = newScores.every(s => s !== null);
          if (allAnswered) {
            const avgScore = Math.round(newScores.reduce((a, b) => a + b, 0) / newScores.length);
            saveProgress('hljodfaeri', false, null, null, avgScore, null);
          }
        } catch (error) {
          alert('Villa kom upp. Reyndu aftur.');
          console.error(error);
        } finally {
          const newLoading = [...shortLoading];
          newLoading[questionIndex] = false;
          setShortLoading(newLoading);
        }
      };

      const handleTranslationChange = (index, value) => {
        const newTranslations = [...translations];
        newTranslations[index] = value;
        setTranslations(newTranslations);
      };

      const getTranslationFeedback = async (wordIndex) => {
        const word = TRANSLATION_WORDS[wordIndex];
        const translation = translations[wordIndex];

        if (!translation.trim() || translation.trim().length < 1) {
          alert('Vinsamlegast skrifa√∞u √æ√Ω√∞ingu!');
          return;
        }

        const newLoading = [...translationLoading];
        newLoading[wordIndex] = true;
        setTranslationLoading(newLoading);

        try {
          const feedback = await callOpenAI({
            model: 'gpt-4o-mini',
            messages: [
              {
                role: 'system',
                content: `√û√∫ ert √≠slensku kennari. Nemandinn er a√∞ √æ√Ω√∞a √≠slensk or√∞ √° sitt m√≥√∞urm√°l. 

Gef√∞u endurgj√∂f me√∞ √æessu sni√∞i:
EINKUNN: [0-100]
ENDURGJ√ñF: [1-2 l√≠nur af hvetjandi endurgj√∂f √° √≠slensku]

Einkunnin:
- 100 = R√©tt e√∞a mj√∂g n√°l√¶gt
- 50 = A√∞ hluta r√©tt
- 0 = Rangt

Ef √æ√Ω√∞ingin er r√©tt, hvettu nemandann. Ef r√∂ng, gef√∞u r√©tta √æ√Ω√∞ingu √° ensku.

√çslenska or√∞i√∞ er: "${word.icelandic}"
Nemandinn √æ√Ωddi: "${translation}"`
              },
              {
                role: 'user',
                content: 'Er √æessi √æ√Ω√∞ing r√©tt?'
              }
            ],
            temperature: 0.7,
            max_tokens: 150
          });

          // Vinna √∫r svari og draga √∫t einkunn
          const scoreMatch = feedback.match(/EINKUNN:\s*(\d+)/);
          const score = scoreMatch ? parseInt(scoreMatch[1]) : 50;
          const feedbackText = feedback.replace(/EINKUNN:\s*\d+\s*\n?/, '').replace(/ENDURGJ√ñF:\s*/, '').trim();

          const newFeedback = [...translationFeedback];
          newFeedback[wordIndex] = feedbackText;
          setTranslationFeedback(newFeedback);

          const newScores = [...translationScores];
          newScores[wordIndex] = score;
          setTranslationScores(newScores);

          // Athuga hvort allar √æ√Ω√∞ingar s√©u komnar og vista framvindu
          const allDone = newScores.every(s => s !== null);
          if (allDone) {
            const avgScore = Math.round(newScores.reduce((a, b) => a + b, 0) / newScores.length);
            saveProgress('hljodfaeri', true, null, null, null, avgScore);
          }
        } catch (error) {
          alert('Villa kom upp. Reyndu aftur.');
          console.error(error);
        } finally {
          const newLoading = [...translationLoading];
          newLoading[wordIndex] = false;
          setTranslationLoading(newLoading);
        }
      };

      const allShortQuestionsAnswered = shortFeedback.every(f => f !== null);

      const mcScore = mcAnswers.filter((ans, idx) => ans === shuffledQuestions[idx]?.correct).length;
      const tfScore = tfAnswers.filter((ans, idx) => ans === TRUE_FALSE[idx].correct).length;

      return (
        <div className="min-h-screen py-8 px-4">
          <header className="text-center mb-8">
            <h1 className="text-5xl font-light text-gray-800 mb-2">üé∏ A√∞ spila √° hlj√≥√∞f√¶ri</h1>
            <p className="text-gray-600 font-light text-lg">M√°lst√∂√∞in ‚Äì Lesskilningur</p>
          </header>

          {/* Modal fyrir texta */}
          <div className={`modal ${showModal ? 'active' : ''}`} onClick={() => setShowModal(false)}>
            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
              <div className="p-8">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Textinn</h2>
                  <button
                    onClick={() => setShowModal(false)}
                    className="text-gray-500 hover:text-gray-700 text-3xl leading-none"
                  >
                    √ó
                  </button>
                </div>
                <div className="prose prose-lg max-w-none">
                  <div className="text-gray-800 font-light leading-relaxed space-y-4 text-lg">
                    {READING_TEXT.split('\n').map((paragraph, idx) => (
                      paragraph.trim() && <p key={idx}>{paragraph}</p>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto">
            {/* Sticky hnappur til a√∞ sko√∞a textann */}
            <div className="sticky-text-btn mb-6 p-4 rounded-lg">
              <button
                onClick={() => setShowModal(true)}
                className="w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors font-light text-lg"
              >
                üìñ Sko√∞a textann
              </button>
            </div>

            {stage === 'multiplechoice' && shuffledQuestions.length > 0 && (
              <div className="bg-white rounded-lg shadow-sm p-8">
                <div className="text-center mb-8">
                  <div className="text-6xl mb-4">üü¶</div>
                  <h2 className="text-2xl font-light text-gray-800 mb-4">Fj√∂lvalsspurningar</h2>
                  <p className="text-gray-600 font-light">
                    Veldu r√©tt svar vi√∞ hverri spurningu
                  </p>
                </div>

                <div className="space-y-8">
                  {shuffledQuestions.map((q, qIndex) => (
                    <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-6">
                      <p className="font-normal text-gray-800 mb-4 text-lg">
                        {qIndex + 1}. {q.question}
                      </p>
                      <div className="space-y-3">
                        {q.options.map((option, oIndex) => {
                          const isSelected = mcAnswers[qIndex] === oIndex;
                          const isCorrect = oIndex === q.correct;
                          let optionClass = 'answer-option p-4 rounded-lg';
                          
                          if (showMcFeedback) {
                            optionClass += ' disabled';
                            if (isCorrect) {
                              optionClass += ' correct';
                            } else if (isSelected && !isCorrect) {
                              optionClass += ' incorrect';
                            }
                          } else if (isSelected) {
                            optionClass += ' selected';
                          }

                          return (
                            <div
                              key={oIndex}
                              onClick={() => handleMcAnswer(qIndex, oIndex)}
                              className={optionClass}
                            >
                              <div className="flex items-center gap-3">
                                <span className="text-xl">
                                  {showMcFeedback && isCorrect ? '‚úì' : String.fromCharCode(65 + oIndex)}
                                </span>
                                <span className="font-light text-gray-800">{option}</span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  ))}
                </div>

                <div className="mt-8">
                  {!showMcFeedback ? (
                    <div className="text-center">
                      <button
                        onClick={checkMcAnswers}
                        disabled={mcAnswers.length < shuffledQuestions.length}
                        className="bg-blue-600 text-white px-8 py-3 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-lg"
                      >
                        Athuga sv√∂r
                      </button>
                    </div>
                  ) : (
                    <div>
                      <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                        <div className="text-center">
                          <div className="text-4xl mb-2">
                            {mcScore === shuffledQuestions.length ? 'üéâ' : mcScore >= 2 ? 'üëç' : 'üí™'}
                          </div>
                          <p className="text-xl font-normal text-gray-800 mb-2">
                            √û√∫ f√©kkst {mcScore} af {shuffledQuestions.length} r√©tt!
                          </p>
                          <p className="text-gray-600 font-light">
                            {mcScore === shuffledQuestions.length 
                              ? 'Fr√°b√¶r vinna! √û√∫ skilur textann mj√∂g vel.' 
                              : mcScore >= 2 
                              ? 'Vel gert! √û√∫ ert a√∞ gera g√≥√∞a framfarir.'
                              : 'Haltu √°fram a√∞ √¶fa, √æ√∫ ert a√∞ l√¶ra!'}
                          </p>
                        </div>
                      </div>
                      <div className="text-center">
                        <button
                          onClick={continueToTrueFalse}
                          className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-md hover:from-blue-600 hover:to-blue-700 transition-all font-light text-lg"
                        >
                          Halda √°fram ‚Üí
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {stage === 'truefalse' && (
              <div className="bg-white rounded-lg shadow-sm p-8">
                <div className="text-center mb-8">
                  <div className="text-6xl mb-4">üü©</div>
                  <h2 className="text-2xl font-light text-gray-800 mb-4">Satt e√∞a √≥satt</h2>
                  <p className="text-gray-600 font-light">
                    Veldu hvort setningin er s√∂nn (S) e√∞a √≥s√∂nn (√ì)
                  </p>
                </div>

                <div className="space-y-6">
                  {TRUE_FALSE.map((item, index) => {
                    const userAnswer = tfAnswers[index];
                    const isCorrect = item.correct;
                    
                    return (
                      <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                        <p className="font-normal text-gray-800 mb-4 text-lg">
                          {index + 1}. {item.statement}
                        </p>
                        <div className="flex gap-4 justify-center">
                          <button
                            onClick={() => handleTfAnswer(index, true)}
                            disabled={showTfFeedback}
                            className={`px-8 py-3 rounded-lg font-light text-lg transition-all ${
                              showTfFeedback
                                ? isCorrect
                                  ? 'bg-green-100 border-2 border-green-500 text-green-800'
                                  : userAnswer === true
                                  ? 'bg-red-100 border-2 border-red-500 text-red-800'
                                  : 'bg-gray-100 text-gray-500'
                                : userAnswer === true
                                ? 'bg-blue-100 border-2 border-blue-500 text-blue-800'
                                : 'bg-gray-100 border-2 border-gray-300 hover:border-blue-400'
                            } disabled:cursor-default`}
                          >
                            {showTfFeedback && isCorrect ? '‚úì ' : ''}Satt (S)
                          </button>
                          <button
                            onClick={() => handleTfAnswer(index, false)}
                            disabled={showTfFeedback}
                            className={`px-8 py-3 rounded-lg font-light text-lg transition-all ${
                              showTfFeedback
                                ? !isCorrect
                                  ? 'bg-green-100 border-2 border-green-500 text-green-800'
                                  : userAnswer === false
                                  ? 'bg-red-100 border-2 border-red-500 text-red-800'
                                  : 'bg-gray-100 text-gray-500'
                                : userAnswer === false
                                ? 'bg-blue-100 border-2 border-blue-500 text-blue-800'
                                : 'bg-gray-100 border-2 border-gray-300 hover:border-blue-400'
                            } disabled:cursor-default`}
                          >
                            {showTfFeedback && !isCorrect ? '‚úì ' : ''}√ìsatt (√ì)
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>

                <div className="mt-8">
                  {!showTfFeedback ? (
                    <div className="text-center">
                      <button
                        onClick={checkTfAnswers}
                        disabled={tfAnswers.length < TRUE_FALSE.length}
                        className="bg-blue-600 text-white px-8 py-3 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light text-lg"
                      >
                        Athuga sv√∂r
                      </button>
                    </div>
                  ) : (
                    <div>
                      <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                        <div className="text-center">
                          <div className="text-4xl mb-2">
                            {tfScore === TRUE_FALSE.length ? 'üéâ' : tfScore >= 4 ? 'üëç' : 'üí™'}
                          </div>
                          <p className="text-xl font-normal text-gray-800 mb-2">
                            √û√∫ f√©kkst {tfScore} af {TRUE_FALSE.length} r√©tt!
                          </p>
                          <p className="text-gray-600 font-light">
                            {tfScore === TRUE_FALSE.length 
                              ? 'Fullkomi√∞! √û√∫ skilur allt mj√∂g vel.' 
                              : tfScore >= 4 
                              ? 'Mj√∂g vel gert! √û√∫ ert a√∞ l√¶ra vel.'
                              : 'Ekki sl√¶mt! Haltu √°fram a√∞ √¶fa.'}
                          </p>
                        </div>
                      </div>
                      <div className="text-center">
                        <button
                          onClick={continueToShortQuestions}
                          className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-md hover:from-blue-600 hover:to-blue-700 transition-all font-light text-lg"
                        >
                          Halda √°fram ‚Üí
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {stage === 'short' && (
              <div className="space-y-6">
                <div className="bg-white rounded-lg shadow-sm p-8">
                  <div className="text-center mb-8">
                    <div className="text-6xl mb-4">üìù</div>
                    <h2 className="text-2xl font-light text-gray-800 mb-4">Stuttar spurningar</h2>
                    <p className="text-gray-600 font-light">
                      Svara√∞u spurningunum √∫t fr√° textanum
                    </p>
                  </div>

                  <div className="space-y-8">
                    {SHORT_OPEN_QUESTIONS.map((question, index) => (
                      <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                        <p className="font-normal text-gray-800 mb-4 text-lg">
                          {index + 1}. {question}
                        </p>
                        <textarea
                          value={shortAnswers[index]}
                          onChange={(e) => handleShortAnswerChange(index, e.target.value)}
                          disabled={shortFeedback[index] !== null}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none font-light text-base mb-4 disabled:bg-gray-50"
                          rows="3"
                          placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                        />

                        {!shortFeedback[index] ? (
                          <button
                            onClick={() => getShortFeedback(index)}
                            disabled={shortLoading[index] || shortAnswers[index].trim().length < 3}
                            className="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light"
                          >
                            {shortLoading[index] ? 'B√≠√∞...' : 'F√° endurgj√∂f'}
                          </button>
                        ) : (
                          <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                            <div className="flex items-start gap-3">
                              <span className="text-2xl">‚ú®</span>
                              <div className="flex-1">
                                <p className="text-gray-800 font-light leading-relaxed">
                                  {shortFeedback[index]}
                                </p>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>

                {allShortQuestionsAnswered && (
                  <div className="bg-white rounded-lg shadow-sm p-8">
                    <div className="text-center mb-6">
                      <div className="text-6xl mb-4">üü®</div>
                      <h2 className="text-2xl font-light text-gray-800 mb-4">√û√Ω√∞ingar</h2>
                      <p className="text-gray-600 font-light">
                        √û√Ωddu or√∞in √° √æitt m√≥√∞urm√°l
                      </p>
                    </div>

                    <div className="max-w-2xl mx-auto space-y-6">
                      {TRANSLATION_WORDS.map((word, index) => (
                        <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                          <div className="mb-4">
                            <p className="font-normal text-gray-800 text-lg mb-2">
                              √û√Ωddu or√∞i√∞: <span className="font-semibold">{word.icelandic}</span>
                            </p>
                          </div>
                          
                          <input
                            type="text"
                            value={translations[index]}
                            onChange={(e) => handleTranslationChange(index, e.target.value)}
                            disabled={translationFeedback[index] !== null}
                            className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none font-light text-base mb-4 disabled:bg-gray-50"
                            placeholder="Skrifa√∞u √æ√Ω√∞ingu h√©r..."
                          />

                          {!translationFeedback[index] ? (
                            <button
                              onClick={() => getTranslationFeedback(index)}
                              disabled={translationLoading[index] || translations[index].trim().length < 1}
                              className="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light"
                            >
                              {translationLoading[index] ? 'B√≠√∞...' : 'F√° endurgj√∂f'}
                            </button>
                          ) : (
                            <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                              <div className="flex items-start gap-3">
                                <span className="text-2xl">‚ú®</span>
                                <div className="flex-1">
                                  <p className="text-gray-800 font-light leading-relaxed">
                                    {translationFeedback[index]}
                                  </p>
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>

                    <div className="text-center mt-8">
                      <button
                        onClick={() => window.location.href = '../index.html'}
                        className="bg-gray-800 text-white px-8 py-3 rounded-md hover:bg-gray-700 transition-colors font-light text-lg"
                      >
                        ‚Üê Til baka
                      </button>
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<Hlj√≥√∞f√¶ri />);
  </script>
</body>
</html>
