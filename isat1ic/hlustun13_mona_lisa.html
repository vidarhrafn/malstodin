<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun: Mona Lisa</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'DM Sans', sans-serif; background: #faf9f6; min-height: 100vh; }
    .sticky-top { position: sticky; top: 0; z-index: 50; }
    .tab-btn {
      transition: all 0.18s;
      border-bottom: 3px solid transparent;
      padding: 0.75rem 1.1rem;
      font-size: 0.875rem;
      color: #6b7280;
      background: transparent;
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      border-top: none; border-left: none; border-right: none;
    }
    .tab-btn:hover { background: #f9fafb; color: #374151; }
    .tab-active { border-bottom-color: #b45309 !important; color: #b45309 !important; font-weight: 500; }
    .done-dot {
      width: 16px; height: 16px; border-radius: 50%;
      background: #16a34a; color: white; font-size: 9px;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .vocab-wrap { overflow: hidden; transition: max-height 0.35s ease, opacity 0.3s; }
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 1rem; }
    .modal-box { background: white; border-radius: 1rem; max-width: 760px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
    .btn-primary { background: #b45309; color: white; padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem; transition: background 0.15s; cursor: pointer; border: none; }
    .btn-primary:hover { background: #92400e; }
    .btn-primary:disabled { background: #d1d5db; cursor: not-allowed; }
    .btn-secondary { background: #6b7280; color: white; padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 400; font-size: 0.9rem; cursor: pointer; border: none; }
    .btn-secondary:hover { background: #4b5563; }
    textarea, select { width: 100%; border: 2px solid #e5e7eb; border-radius: 8px; padding: 0.75rem 1rem; font-family: 'DM Sans', sans-serif; font-size: 0.95rem; transition: border-color 0.15s; box-sizing: border-box; }
    textarea:focus, select:focus { outline: none; border-color: #b45309; }
    .prog-seg { height: 6px; border-radius: 3px; background: #e5e7eb; flex: 1; overflow: hidden; }
    .prog-fill { height: 100%; background: #16a34a; border-radius: 3px; transition: width 0.4s; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
  const { useState, useRef, useEffect, useMemo } = React;

  async function callOpenAI(messages, max_tokens = 300, model = 'gpt-4o', temperature = 0.3) {
    const r = await fetch('/.netlify/functions/openai', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages, max_tokens, model, temperature })
    });
    const data = await r.json();
    if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
    return data.content;
  }

  const LISTENING_TEXT = `Klara situr vi√∞ eldh√∫sbor√∞i√∞ og vinnur √≠ t√∂lvu. H√∫n er a√∞ skipuleggja heimsreisuna s√≠na.

‚ÄûHva√∞ ertu a√∞ sko√∞a?" spyr Brynd√≠s.

‚Äû√âg er a√∞ sko√∞a Louvre safni√∞ √≠ Par√≠s," segir Klara. ‚Äû√âg hlakka svo miki√∞ til a√∞ sj√° Monu L√≠su!"

‚ÄûAh, Mona Lisa! √ûa√∞ er fr√¶gasta m√°lverk √≠ heimi," segir Bao. ‚Äû√âg s√° √æa√∞ √æegar √©g var ungur. Brosi√∞ √° henni er svo dularfullt."

‚ÄûVissu√∞ √æi√∞ a√∞ m√°lverkinu var stoli√∞ √°ri√∞ 1911?" spyr Klara. ‚Äû√ûj√≥furinn var √≠talskur ma√∞ur og hann faldi m√°lverki√∞ √≠ tv√∂ √°r."

‚ÄûNei, √æa√∞ vissi √©g ekki!" segir H√≥lmfr√≠√∞ur. ‚ÄûHvernig fannst √æa√∞ aftur?"

‚Äû√ûj√≥furinn reyndi a√∞ selja √æa√∞ og var handtekinn," √∫tsk√Ωrir Klara. ‚ÄûM√°lverki√∞ f√≥r aftur til Louvre."

‚ÄûHversu lengi √¶tlar √æ√∫ a√∞ vera √≠ Par√≠s?" spyr Brynd√≠s.

‚Äû√ûrj√° daga. √âg √¶tla l√≠ka a√∞ sj√° Eiffelturninn og ganga um Champs-√âlys√©es," segir Klara. ‚ÄûS√≠√∞an fer √©g til Sp√°nar a√∞ bor√∞a tapas, √æa√∞ eru margir sm√°ir r√©ttir en ekki einn st√≥r a√∞alr√©ttur eins og h√©r heima."

‚Äû√ûa√∞ hlj√≥mar eins og √¶vint√Ωri," segir Bao og brosir. ‚Äû√ûetta ver√∞a √≥gleymanlegar minningar."`;

  const VOCAB = [
    { w: "heimsreisa (kvk)", hint: "fer√∞alag um heiminn" },
    { w: "m√°lverk (hk)", hint: "mynd sem listama√∞ur m√°lar" },
    { w: "listasafn (hk)", hint: "safn √æar sem m√°lverk og listaverk eru s√Ωnd" },
    { w: "dularfullur (lo)", hint: "leyndard√≥msfullur, erfitt a√∞ skilja" },
    { w: "a√∞ stela (so)", hint: "a√∞ taka eitthva√∞ sem er ekki √æitt" },
    { w: "√æj√≥fur (kk)", hint: "ma√∞ur sem stelur" },
    { w: "handtekinn (lo)", hint: "√æegar l√∂greglan tekur mann fasta" },
    { w: "tapas (hk ft)", hint: "margir sm√°ir r√©ttir fr√° Sp√°ni" },
    { w: "√¶vint√Ωri (hk)", hint: "spennandi upplifun" }
  ];

  const TRANSLATIONS = [
    { word: 'dularfullur' },
    { word: '√≥gleymanlegar minningar' }
  ];

  const MULTIPLE_CHOICE = [
    { question: 'Hva√∞ er Klara a√∞ skipuleggja?', options: ['Afm√¶lisveislu','Heimsreisu','Br√∫√∞kaupsfer√∞alag','Sumarb√∫sta√∞afer√∞'], correct: 1 },
    { question: 'Hvar er Mona Lisa til s√Ωnis?', options: ['√ç British Museum √≠ London','√ç Louvre safninu √≠ Par√≠s','√ç Prado safninu √≠ Madrid','√ç Listasafni √çslands'], correct: 1 },
    { question: 'Hva√∞ segir Bao um bros Monu L√≠su?', options: ['√ûa√∞ er sorglegt','√ûa√∞ er dularfullt','√ûa√∞ er hl√¶gilegt','√ûa√∞ er reitt'], correct: 1 },
    { question: 'Hva√∞ ger√∞i √æj√≥furinn me√∞ m√°lverki√∞?', options: ['Hann brenndi √æa√∞','Hann faldi √æa√∞ √≠ tv√∂ √°r','Hann gaf √æa√∞ syni s√≠num','Hann sendi √æa√∞ til Bandar√≠kjanna'], correct: 1 },
    { question: 'Hva√∞ √¶tlar Klara a√∞ gera √° Sp√°ni?', options: ['Fara √° listasafn','L√¶ra sp√¶nsku','Bor√∞a sm√°r√©tti','Heims√¶kja vini'], correct: 2 }
  ];

  const OPEN_QUESTIONS = [
    { question: 'Hvers vegna hlakkar Klara til a√∞ fara til Par√≠sar?', expectedContent: ['Mona Lisa','Monu L√≠su','Louvre','listasafn','m√°lverk','sj√°'] },
    { question: 'Hva√∞ ger√∞ist √°ri√∞ 1911 og hvernig fannst m√°lverki√∞ aftur?', expectedContent: ['stoli√∞','√æj√≥fur','√≠talskur','faldi','tv√∂ √°r','selja','handtekinn'] },
    { question: 'Hva√∞ √¶tlar Klara a√∞ gera √≠ Par√≠s fyrir utan a√∞ fara √° Louvre?', expectedContent: ['Eiffelturninn','Champs-√âlys√©es','ganga','sj√°'] }
  ];

  const TRUE_FALSE = [
    { statement: 'Klara √¶tlar a√∞ fara til London.', correct: false },
    { statement: 'Bao hefur s√©√∞ Monu L√≠su.', correct: true },
    { statement: '√ûj√≥furinn var franskur.', correct: false },
    { statement: 'Klara √¶tlar a√∞ vera fimm daga √≠ Par√≠s.', correct: false },
    { statement: 'Klara √¶tlar a√∞ bor√∞a tapas √° Sp√°ni.', correct: true }
  ];

  const MATCHING = [
    { left: 'Klara', right: '√Ütlar a√∞ sj√° Monu L√≠su' },
    { left: 'Bao', right: 'Hefur s√©√∞ Monu L√≠su' },
    { left: 'H√≥lmfr√≠√∞ur', right: 'Spur√∞i hvernig m√°lverki√∞ fannst' },
    { left: 'Louvre', right: 'Listasafn √≠ Par√≠s' }
  ];

  const TABS = [
    { id: 'thyding', label: '√û√Ω√∞ing', icon: 'üåç' },
    { id: 'krossar', label: 'Krossar', icon: '‚úì' },
    { id: 'opnar', label: 'Opnar', icon: 'üìù' },
    { id: 'reitrangt', label: 'R√©tt/Rangt', icon: '‚öñÔ∏è' },
    { id: 'parada', label: 'Para√∞u', icon: 'üîó' },
  ];

  const App = () => {
    const [isPlaying, setIsPlaying] = useState(false);
    const [playbackRate, setPlaybackRate] = useState(1);
    const [currentTime, setCurrentTime] = useState(0);
    const [duration, setDuration] = useState(0);
    const audioRef = useRef(null);

    const [activeTab, setActiveTab] = useState('thyding');
    const [showVocab, setShowVocab] = useState(true);
    const [showTextModal, setShowTextModal] = useState(false);

    useEffect(() => { if (audioRef.current) audioRef.current.playbackRate = playbackRate; }, [playbackRate]);

    // √û√Ω√∞ing
    const [transAnswers, setTransAnswers] = useState(['','']);
    const [transFeedback, setTransFeedback] = useState([null,null]);
    const [transLoading, setTransLoading] = useState([false,false]);

    const checkTranslation = async (idx) => {
      const answer = transAnswers[idx].trim(); if (!answer) return;
      setTransLoading(p => { const n=[...p]; n[idx]=true; return n; });
      try {
        const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.
√çSLENSKA OR√êI√ê: "${TRANSLATIONS[idx].word}" | SVAR: "${answer}"
SKILA√êU JSON (BARA JSON): {"correct":boolean,"detected_language":"tungum√°l","feedback_is":"endurgj√∂f √° √≠slensku","feedback_native":"endurgj√∂f √° m√≥√∞urm√°li","correct_translation":"ef rangt, annars null"}`;
        const result = await callOpenAI([{role:'system',content:sys},{role:'user',content:answer}],200,'gpt-4o',0.2);
        const fb = JSON.parse(result);
        setTransFeedback(p => { const n=[...p]; n[idx]=fb; return n; });
      } catch(e) { console.error(e); }
      finally { setTransLoading(p => { const n=[...p]; n[idx]=false; return n; }); }
    };
    const resetTrans = (idx) => {
      setTransAnswers(p => { const n=[...p]; n[idx]=''; return n; });
      setTransFeedback(p => { const n=[...p]; n[idx]=null; return n; });
    };
    const isThyingDone = transFeedback.every(f => f !== null);

    // Krossar
    const shuffledMC = useMemo(() => MULTIPLE_CHOICE.map(q => {
      const opts = q.options.map((o,i)=>({text:o,orig:i}));
      for(let i=opts.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[opts[i],opts[j]]=[opts[j],opts[i]];}
      return { question:q.question, options:opts, correctOrig:q.correct };
    }), []);
    const [mcAnswers, setMcAnswers] = useState([]);
    const [mcChecked, setMcChecked] = useState(false);
    const checkMC = () => { if(shuffledMC.every((_,i)=>Number.isInteger(mcAnswers[i]))) setMcChecked(true); };
    const resetMC = () => { setMcAnswers([]); setMcChecked(false); };

    // Opnar
    const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
    const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
    const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));
    const checkOpen = async (idx) => {
      const answer = openAnswers[idx].trim(); if(!answer) return;
      setOpenLoading(p=>{const n=[...p];n[idx]=true;return n;});
      try {
        const q = OPEN_QUESTIONS[idx];
        const sys = `√û√∫ ert √≠slenskukennari. Spurning: "${q.question}" | Svar: "${answer}" | Lykilatri√∞i: ${q.expectedContent.join(', ')}
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ innihald (hunsa sm√°v√¶gilegar villur). Stutt hvetjandi endurgj√∂f.
SKILA√êU JSON (BARA JSON): {"correct":boolean,"feedback":"endurgj√∂f √° √≠slensku"}`;
        const result = await callOpenAI([{role:'system',content:sys},{role:'user',content:answer}],150,'gpt-4o',0.2);
        const fb = JSON.parse(result);
        setOpenFeedback(p=>{const n=[...p];n[idx]=fb;return n;});
      } catch(e){console.error(e);}
      finally{setOpenLoading(p=>{const n=[...p];n[idx]=false;return n;});}
    };
    const resetOpen = (idx) => {
      setOpenAnswers(p=>{const n=[...p];n[idx]='';return n;});
      setOpenFeedback(p=>{const n=[...p];n[idx]=null;return n;});
    };
    const isOpnarDone = openFeedback.every(f=>f!==null);

    // R√©tt/Rangt
    const [tfAnswers, setTfAnswers] = useState([]);
    const [tfChecked, setTfChecked] = useState(false);
    const checkTF = () => { if(tfAnswers.length===TRUE_FALSE.length) setTfChecked(true); };
    const resetTF = () => { setTfAnswers([]); setTfChecked(false); };

    // Para√∞u
    const [matchAnswers, setMatchAnswers] = useState(Array(MATCHING.length).fill(''));
    const [matchChecked, setMatchChecked] = useState(false);
    const rightOpts = useMemo(()=>{
      const o=MATCHING.map(m=>m.right);
      for(let i=o.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[o[i],o[j]]=[o[j],o[i]];}
      return o;
    },[]);
    const checkMatch = () => { if(!matchAnswers.includes('')) setMatchChecked(true); };
    const resetMatch = () => { setMatchAnswers(Array(MATCHING.length).fill('')); setMatchChecked(false); };

    const tabDone = { thyding:isThyingDone, krossar:mcChecked, opnar:isOpnarDone, reitrangt:tfChecked, parada:matchChecked };
    const doneCount = Object.values(tabDone).filter(Boolean).length;
    const allDone = doneCount === 5;

    const togglePlay = () => {
      if(!audioRef.current) return;
      if(isPlaying) audioRef.current.pause(); else audioRef.current.play();
      setIsPlaying(!isPlaying);
    };

    return (
      <div style={{minHeight:'100vh', paddingBottom:'4rem'}}>

        {/* HEADER */}
        <header style={{background:'white', borderBottom:'1px solid #e5e7eb'}}>
          <div style={{maxWidth:'720px', margin:'0 auto', padding:'1.5rem 1rem'}}>
            <button onClick={()=>window.history.back()} style={{fontSize:'0.85rem',color:'#9ca3af',background:'none',border:'none',cursor:'pointer',marginBottom:'0.5rem',display:'block'}}>‚Üê Til baka</button>
            <h1 style={{fontFamily:'Lora,serif',fontSize:'1.75rem',fontWeight:400,color:'#1f2937',margin:'0 0 0.25rem'}}>üéß Hlustun: Mona Lisa</h1>
            <p style={{color:'#9ca3af',fontSize:'0.85rem',margin:0}}>Hlustunarverkefni ¬∑ A2</p>
          </div>
        </header>

        {/* STICKY PLAYER */}
        <div className="sticky-top" style={{background:'white',boxShadow:'0 2px 10px rgba(0,0,0,0.07)'}}>
          <div style={{maxWidth:'720px',margin:'0 auto',padding:'0.75rem 1rem'}}>
            <div style={{background:'linear-gradient(135deg,#fef3c7,#fde68a)',borderRadius:'10px',padding:'0.75rem 1rem',border:'1px solid #f59e0b'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.75rem'}}>
                <button onClick={togglePlay} style={{background:'#b45309',color:'white',width:'38px',height:'38px',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',border:'none',cursor:'pointer',flexShrink:0}}>
                  {isPlaying
                    ? <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                    : <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>}
                </button>
                <button onClick={()=>{if(audioRef.current)audioRef.current.currentTime-=10;}} style={{background:'rgba(255,255,255,0.6)',border:'none',borderRadius:'50%',width:'30px',height:'30px',cursor:'pointer',fontSize:'12px'}}>‚èÆ</button>
                <div style={{flex:1}}>
                  <div style={{display:'flex',justifyContent:'space-between',marginBottom:'4px'}}>
                    <span style={{fontSize:'0.8rem',color:'#92400e',fontWeight:500}}>üéß Hlusta</span>
                    <span style={{fontSize:'0.75rem',color:'#92400e',fontFamily:'monospace'}}>
                      {Math.floor(currentTime/60)}:{String(Math.floor(currentTime%60)).padStart(2,'0')} / {Math.floor(duration/60)}:{String(Math.floor(duration%60)).padStart(2,'0')}
                    </span>
                  </div>
                  <div style={{background:'rgba(255,255,255,0.5)',borderRadius:'4px',height:'5px',cursor:'pointer'}}
                    onClick={e=>{if(!audioRef.current)return;const r=e.currentTarget.getBoundingClientRect();audioRef.current.currentTime=((e.clientX-r.left)/r.width)*duration;}}>
                    <div style={{background:'#b45309',height:'100%',borderRadius:'4px',width:`${duration?(currentTime/duration)*100:0}%`,transition:'width 0.2s'}}/>
                  </div>
                  <audio ref={audioRef} src="media/hlustun_mona_lisa.mp3" preload="metadata"
                    onEnded={()=>setIsPlaying(false)} onPlay={()=>setIsPlaying(true)} onPause={()=>setIsPlaying(false)}
                    onTimeUpdate={()=>setCurrentTime(audioRef.current?.currentTime||0)}
                    onLoadedMetadata={()=>setDuration(audioRef.current?.duration||0)}/>
                </div>
                <button onClick={()=>{if(audioRef.current)audioRef.current.currentTime+=10;}} style={{background:'rgba(255,255,255,0.6)',border:'none',borderRadius:'50%',width:'30px',height:'30px',cursor:'pointer',fontSize:'12px'}}>‚è≠</button>
                <div style={{display:'flex',gap:'4px'}}>
                  {[0.75,1,1.25].map(r=>(
                    <button key={r} onClick={()=>setPlaybackRate(r)} style={{background:playbackRate===r?'#b45309':'rgba(255,255,255,0.7)',color:playbackRate===r?'white':'#92400e',border:'none',borderRadius:'6px',padding:'2px 7px',fontSize:'0.72rem',cursor:'pointer',fontWeight:playbackRate===r?500:400}}>
                      {r}√ó
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style={{maxWidth:'720px',margin:'0 auto',padding:'0 1rem'}}>

          {/* LYKILOR√ê */}
          <div style={{marginTop:'1rem',background:'#fffbeb',border:'1px solid #fde68a',borderRadius:'12px',overflow:'hidden'}}>
            <button onClick={()=>setShowVocab(v=>!v)} style={{width:'100%',display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.875rem 1.25rem',background:'none',border:'none',cursor:'pointer'}}>
              <span style={{fontFamily:'Lora,serif',fontSize:'1.05rem',color:'#78350f'}}>üìò Lykilor√∞</span>
              <span style={{color:'#b45309',fontSize:'0.8rem'}}>{showVocab?'‚ñ≤ Fela':'‚ñº S√Ωna'}</span>
            </button>
            <div className="vocab-wrap" style={{maxHeight:showVocab?'600px':'0',opacity:showVocab?1:0}}>
              <div style={{padding:'0 1.25rem 1.25rem'}}>
                <p style={{color:'#78350f',fontSize:'0.85rem',marginBottom:'0.75rem'}}>Lestu yfir or√∞in √°√∞ur en √æ√∫ hlustar.</p>
                <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(200px,1fr))',gap:'0.5rem'}}>
                  {VOCAB.map((item,i)=>(
                    <div key={i} style={{background:'white',border:'1px solid #fde68a',borderRadius:'8px',padding:'0.5rem 0.875rem'}}>
                      <div style={{fontWeight:500,color:'#1f2937',fontSize:'0.875rem'}}>{item.w}</div>
                      <div style={{color:'#6b7280',fontSize:'0.78rem',marginTop:'1px'}}>{item.hint}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* FLIPAR */}
          <div style={{marginTop:'1rem',background:'white',border:'1px solid #e5e7eb',borderRadius:'12px',overflow:'hidden'}}>
            {/* Tab bar */}
            <div style={{display:'flex',borderBottom:'1px solid #e5e7eb',overflowX:'auto',scrollbarWidth:'none'}}>
              {TABS.map(tab=>(
                <button key={tab.id} onClick={()=>setActiveTab(tab.id)}
                  className={`tab-btn ${activeTab===tab.id?'tab-active':''}`}>
                  <span>{tab.icon}</span>
                  <span>{tab.label}</span>
                  {tabDone[tab.id] && <span className="done-dot">‚úì</span>}
                </button>
              ))}
            </div>

            {/* Tab innihald */}
            <div style={{padding:'1.5rem'}}>

              {/* √û√ù√êING */}
              {activeTab==='thyding' && (
                <div>
                  <h2 style={{fontFamily:'Lora,serif',fontSize:'1.2rem',fontWeight:400,marginBottom:'1rem',color:'#1f2937'}}>üåç √û√Ω√∞ing</h2>
                  <div style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
                    {TRANSLATIONS.map((item,idx)=>(
                      <div key={idx} style={{border:'1px solid #e5e7eb',borderRadius:'10px',padding:'1.25rem'}}>
                        <p style={{marginBottom:'0.875rem',color:'#374151'}}>
                          √û√Ωddu √° √æitt m√≥√∞urm√°l: <strong style={{color:'#b45309'}}>{item.word}</strong>
                        </p>
                        <textarea value={transAnswers[idx]}
                          onChange={e=>{const n=[...transAnswers];n[idx]=e.target.value;setTransAnswers(n);}}
                          placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..." rows="2"
                          disabled={!!transFeedback[idx]?.correct}
                          style={{marginBottom:'0.75rem',resize:'vertical'}}/>
                        {!transFeedback[idx] && (
                          <button className="btn-primary" onClick={()=>checkTranslation(idx)}
                            disabled={!transAnswers[idx].trim()||transLoading[idx]}>
                            {transLoading[idx]?'Athuga...':'Athuga √æ√Ω√∞ingu'}
                          </button>
                        )}
                        {transFeedback[idx] && (
                          <div style={{marginTop:'0.75rem',padding:'1rem',borderRadius:'8px',border:`1px solid ${transFeedback[idx].correct?'#bbf7d0':'#fde68a'}`,background:transFeedback[idx].correct?'#f0fdf4':'#fffbeb'}}>
                            <p style={{color:transFeedback[idx].correct?'#15803d':'#92400e',fontWeight:500}}>üìö {transFeedback[idx].feedback_is}</p>
                            <p style={{color:'#6b7280',fontSize:'0.85rem',fontStyle:'italic',marginTop:'4px'}}>{transFeedback[idx].feedback_native}</p>
                            {transFeedback[idx].correct
                              ? <p style={{marginTop:'8px',color:'#15803d',fontWeight:600}}>‚úÖ R√©tt!</p>
                              : <div>
                                  <p style={{marginTop:'8px',fontSize:'0.875rem',color:'#92400e'}}><strong>Betri √æ√Ω√∞ing:</strong> {transFeedback[idx].correct_translation}</p>
                                  <button className="btn-primary" onClick={()=>resetTrans(idx)} style={{marginTop:'10px',fontSize:'0.85rem',padding:'0.4rem 1rem'}}>Reyna aftur</button>
                                </div>}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* KROSSAR */}
              {activeTab==='krossar' && (
                <div>
                  <h2 style={{fontFamily:'Lora,serif',fontSize:'1.2rem',fontWeight:400,marginBottom:'1rem',color:'#1f2937'}}>‚úì Krossaspurningar</h2>
                  <div style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
                    {shuffledMC.map((q,qi)=>(
                      <div key={qi} style={{border:'1px solid #e5e7eb',borderRadius:'10px',padding:'1.25rem'}}>
                        <p style={{fontWeight:500,marginBottom:'0.75rem',color:'#1f2937'}}>{q.question}</p>
                        <div style={{display:'flex',flexDirection:'column',gap:'0.5rem'}}>
                          {q.options.map((opt,si)=>{
                            const sel=mcAnswers[qi]===si;
                            const correct=opt.orig===q.correctOrig;
                            let bg='white',border='#e5e7eb',color='#374151';
                            if(!mcChecked){if(sel){bg='#fef3c7';border='#f59e0b';color='#92400e';}}
                            else{if(correct){bg='#f0fdf4';border='#86efac';color='#15803d';}else if(sel){bg='#fef2f2';border='#fca5a5';color='#b91c1c';}else{bg='#f9fafb';color='#9ca3af';}}
                            return(
                              <button key={si} onClick={()=>{if(!mcChecked){const n=[...mcAnswers];n[qi]=si;setMcAnswers(n);}}}
                                style={{textAlign:'left',padding:'0.625rem 1rem',borderRadius:'8px',border:`2px solid ${border}`,background:bg,color,cursor:mcChecked?'default':'pointer',transition:'all 0.15s',fontFamily:'DM Sans,sans-serif',fontSize:'0.9rem'}}>
                                {opt.text}{mcChecked&&correct?' ‚úì':''}{mcChecked&&sel&&!correct?' ‚úó':''}
                              </button>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                  <div style={{display:'flex',gap:'0.75rem',marginTop:'1.25rem'}}>
                    <button className="btn-primary" onClick={checkMC} disabled={shuffledMC.some((_,i)=>!Number.isInteger(mcAnswers[i]))||mcChecked}>Athuga sv√∂r</button>
                    {mcChecked&&<button className="btn-secondary" onClick={resetMC}>Endurstilla</button>}
                  </div>
                </div>
              )}

              {/* OPNAR */}
              {activeTab==='opnar' && (
                <div>
                  <h2 style={{fontFamily:'Lora,serif',fontSize:'1.2rem',fontWeight:400,marginBottom:'1rem',color:'#1f2937'}}>üìù Opnar spurningar</h2>
                  <div style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
                    {OPEN_QUESTIONS.map((q,idx)=>(
                      <div key={idx} style={{border:'1px solid #e5e7eb',borderRadius:'10px',padding:'1.25rem'}}>
                        <p style={{fontWeight:500,marginBottom:'0.75rem',color:'#1f2937'}}>{q.question}</p>
                        <textarea value={openAnswers[idx]}
                          onChange={e=>{const n=[...openAnswers];n[idx]=e.target.value;setOpenAnswers(n);}}
                          placeholder="Skrifa√∞u svari√∞ √æitt h√©r..." rows="3"
                          disabled={!!openFeedback[idx]?.correct}
                          style={{marginBottom:'0.75rem',resize:'vertical'}}/>
                        {!openFeedback[idx] && (
                          <button className="btn-primary" onClick={()=>checkOpen(idx)}
                            disabled={!openAnswers[idx].trim()||openLoading[idx]}>
                            {openLoading[idx]?'Athuga...':'Athuga svar'}
                          </button>
                        )}
                        {openFeedback[idx] && (
                          <div style={{marginTop:'0.75rem',padding:'1rem',borderRadius:'8px',border:`1px solid ${openFeedback[idx].correct?'#bbf7d0':'#fde68a'}`,background:openFeedback[idx].correct?'#f0fdf4':'#fffbeb'}}>
                            <p style={{color:openFeedback[idx].correct?'#15803d':'#92400e'}}>{openFeedback[idx].feedback}</p>
                            {openFeedback[idx].correct
                              ? <p style={{marginTop:'8px',color:'#15803d',fontWeight:600}}>‚úÖ R√©tt!</p>
                              : <button className="btn-primary" onClick={()=>resetOpen(idx)} style={{marginTop:'10px',fontSize:'0.85rem',padding:'0.4rem 1rem'}}>Reyna aftur</button>}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* R√âTT/RANGT */}
              {activeTab==='reitrangt' && (
                <div>
                  <h2 style={{fontFamily:'Lora,serif',fontSize:'1.2rem',fontWeight:400,marginBottom:'1rem',color:'#1f2937'}}>‚öñÔ∏è R√©tt e√∞a rangt?</h2>
                  <div style={{display:'flex',flexDirection:'column',gap:'0.875rem'}}>
                    {TRUE_FALSE.map((item,idx)=>(
                      <div key={idx} style={{border:'1px solid #e5e7eb',borderRadius:'10px',padding:'1.25rem'}}>
                        <p style={{marginBottom:'0.75rem',color:'#1f2937'}}>{item.statement}</p>
                        <div style={{display:'flex',gap:'0.75rem'}}>
                          {[true,false].map(val=>{
                            const sel=tfAnswers[idx]===val;
                            const label=val?'R√©tt':'Rangt';
                            const isThisCorrect=item.correct===val;
                            let bg='white',border='#e5e7eb',color='#374151';
                            if(!tfChecked){if(sel){bg='#fef3c7';border='#f59e0b';color='#92400e';}}
                            else{if(isThisCorrect){bg='#f0fdf4';border='#86efac';color='#15803d';}else if(sel&&!isThisCorrect){bg='#fef2f2';border='#fca5a5';color='#b91c1c';}else{bg='#f9fafb';color='#9ca3af';}}
                            return(
                              <button key={String(val)} onClick={()=>{if(!tfChecked){const n=[...tfAnswers];n[idx]=val;setTfAnswers(n);}}}
                                style={{flex:1,padding:'0.625rem',borderRadius:'8px',border:`2px solid ${border}`,background:bg,color,cursor:tfChecked?'default':'pointer',fontWeight:500,transition:'all 0.15s',fontFamily:'DM Sans,sans-serif'}}>
                                {label}{tfChecked&&isThisCorrect&&sel?' ‚úì':''}{tfChecked&&!isThisCorrect&&sel?' ‚úó':''}
                              </button>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                  <div style={{display:'flex',gap:'0.75rem',marginTop:'1.25rem'}}>
                    <button className="btn-primary" onClick={checkTF} disabled={tfAnswers.length!==TRUE_FALSE.length||tfChecked}>Athuga sv√∂r</button>
                    {tfChecked&&<button className="btn-secondary" onClick={resetTF}>Endurstilla</button>}
                  </div>
                </div>
              )}

              {/* PARA√êU */}
              {activeTab==='parada' && (
                <div>
                  <h2 style={{fontFamily:'Lora,serif',fontSize:'1.2rem',fontWeight:400,marginBottom:'0.5rem',color:'#1f2937'}}>üîó Para√∞u saman</h2>
                  <p style={{color:'#6b7280',fontSize:'0.875rem',marginBottom:'1rem'}}>Veldu r√©ttar l√Ωsingar fyrir hvern:</p>
                  <div style={{display:'flex',flexDirection:'column',gap:'0.75rem'}}>
                    {MATCHING.map((item,idx)=>{
                      const isCorrect=matchAnswers[idx]===item.right;
                      return(
                        <div key={idx} style={{display:'grid',gridTemplateColumns:'auto auto 1fr',alignItems:'center',gap:'0.75rem'}}>
                          <div style={{background:'#fef3c7',border:'1px solid #fde68a',borderRadius:'8px',padding:'0.5rem 0.875rem',fontWeight:500,color:'#92400e',fontSize:'0.875rem',whiteSpace:'nowrap'}}>
                            {item.left}
                          </div>
                          <span style={{color:'#9ca3af'}}>‚Üí</span>
                          <select value={matchAnswers[idx]}
                            onChange={e=>{const n=[...matchAnswers];n[idx]=e.target.value;setMatchAnswers(n);}}
                            disabled={matchChecked}
                            style={{border:`2px solid ${matchChecked?(isCorrect?'#86efac':'#fca5a5'):'#e5e7eb'}`,background:matchChecked?(isCorrect?'#f0fdf4':'#fef2f2'):'white',color:matchChecked?(isCorrect?'#15803d':'#b91c1c'):'#374151',fontSize:'0.875rem'}}>
                            <option value="">Veldu...</option>
                            {rightOpts.map((opt,i)=><option key={i} value={opt}>{opt}</option>)}
                          </select>
                        </div>
                      );
                    })}
                    {matchChecked && (
                      <div style={{marginTop:'0.5rem'}}>
                        {MATCHING.map((item,idx)=>matchAnswers[idx]!==item.right&&(
                          <p key={idx} style={{fontSize:'0.8rem',color:'#b91c1c',marginBottom:'4px'}}>
                            <strong>{item.left}</strong> ‚Üí r√©tt: {item.right}
                          </p>
                        ))}
                      </div>
                    )}
                  </div>
                  <div style={{display:'flex',gap:'0.75rem',marginTop:'1.25rem'}}>
                    <button className="btn-primary" onClick={checkMatch} disabled={matchAnswers.includes('')||matchChecked}>Athuga sv√∂r</button>
                    {matchChecked&&<button className="btn-secondary" onClick={resetMatch}>Endurstilla</button>}
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* FRAMVINDA */}
          <div style={{marginTop:'1rem',background:'white',border:'1px solid #e5e7eb',borderRadius:'10px',padding:'0.875rem 1.25rem'}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:'0.5rem'}}>
              <span style={{fontSize:'0.8rem',color:'#6b7280'}}>Framvinda</span>
              <span style={{fontSize:'0.8rem',color:'#6b7280',fontWeight:500}}>{doneCount}/5 loki√∞</span>
            </div>
            <div style={{display:'flex',gap:'4px'}}>
              {TABS.map(tab=>(
                <div key={tab.id} className="prog-seg">
                  <div className="prog-fill" style={{width:tabDone[tab.id]?'100%':'0'}}/>
                </div>
              ))}
            </div>
          </div>

          {/* TEXTI ‚Äì l√¶stur */}
          {allDone && (
            <div style={{textAlign:'center',marginTop:'1.5rem'}}>
              <button onClick={()=>setShowTextModal(true)}
                style={{background:'#b45309',color:'white',padding:'0.75rem 2rem',borderRadius:'10px',border:'none',fontSize:'1rem',fontFamily:'Lora,serif',cursor:'pointer',boxShadow:'0 4px 12px rgba(180,83,9,0.3)'}}>
                üìñ Lesa textann
              </button>
            </div>
          )}

        </div>

        {/* MODAL */}
        {showTextModal && (
          <div className="modal-bg" onClick={()=>setShowTextModal(false)}>
            <div className="modal-box" onClick={e=>e.stopPropagation()}>
              <div style={{position:'sticky',top:0,background:'white',borderBottom:'1px solid #e5e7eb',padding:'1.25rem 1.5rem',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <h2 style={{fontFamily:'Lora,serif',fontSize:'1.4rem',fontWeight:400,color:'#1f2937',margin:0}}>üìñ Hlustunartextinn</h2>
                <button onClick={()=>setShowTextModal(false)} style={{background:'none',border:'none',fontSize:'1.75rem',color:'#6b7280',cursor:'pointer',lineHeight:1}}>√ó</button>
              </div>
              <div style={{padding:'1.75rem'}}>
                {LISTENING_TEXT.split('\n\n').map((para,i)=>(
                  <p key={i} style={{marginBottom:'1rem',lineHeight:1.8,color:'#374151',fontFamily:'Lora,serif',fontSize:'1rem'}}>
                    {para}
                  </p>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
