<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun 5: J√≥lahef√∞ir √° √çslandi ‚Äì A1</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player { position: sticky; top: 0; z-index: 50; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .answer-option { border: 2px solid #e0e0e0; transition: all 0.2s; cursor: pointer; }
    .answer-option:hover:not(.disabled) { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.selected { border-color:#2196f3; background:#e3f2fd; }
    .answer-option.correct { border-color:#4caf50; background:#e8f5e9; }
    .answer-option.incorrect { border-color:#f44336; background:#ffebee; }
    .answer-option.disabled { cursor: default; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 1rem; }
    .modal-content { background: white; border-radius: 1rem; max-width: 48rem; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect, useMemo } = React;

    const LISTENING_TEXT = `√ûa√∞ er 23. desember og fj√∂lskyldan √≠ Hafnarfir√∞i er a√∞ undirb√∫a j√≥lin. Anna er √≠ eldh√∫sinu a√∞ baka sm√°k√∂kur og allt h√∫si√∞ ilmar af kanil og sykri. Sigur√∞ur hengir lj√≥s √≠ gluggana og kveikir √° kertum √° bor√∞inu. Bjarki hj√°lpar m√∂mmu a√∞ setja j√≥laskraut √° tr√©√∞ og Lilja setur stj√∂rnuna √° toppinn √° j√≥latr√©nu.

√Å kv√∂ldin horfa √æau saman √° j√≥lamynd og drekka heitt kak√≥ me√∞ rj√≥ma. Lilja f√¶r s√∫kkula√∞imola √∫r j√≥ladagatalinu s√≠nu og segir: ‚Äû√âg get ekki be√∞i√∞ eftir j√≥lasveininum √≠ kv√∂ld!"

√Å √ûorl√°ksmessu √¶tlar fj√∂lskyldan a√∞ fara ni√∞ur √≠ b√¶ og hitta vini. Sigur√∞ur vill f√° sk√∂tu, en Anna segir a√∞ h√∫n finni lyktina alla lei√∞ √∫t √° g√∂tu og vill ekki sj√≥√∞a sk√∂tu heima. √Å a√∞fangadag kl√¶√∞ir fj√∂lskyldan sig √≠ sparif√∂t og bor√∞ar hamborgarhrygg, kart√∂flur og rau√∞k√°l og drekkur malt og appels√≠n me√∞. Eftir matinn opna √æau gjafir og lesa svo j√≥lakortin sem fj√∂lskyldan f√©kk √≠ p√≥sti. K√∂tturinn M√°si liggur undir tr√©nu og leikur s√©r me√∞ j√≥lapapp√≠rinn. √ûa√∞ er snj√≥r √∫ti og Anna segir: ‚ÄûLoksins hv√≠t j√≥l!"`;

    const VOCAB = [
      { w: "j√≥lahef√∞ (kvk)", hint: "venja e√∞a si√∞ur um j√≥l" },
      { w: "sm√°kaka (kvk)", hint: "l√≠til kaka, oft b√∂ku√∞ fyrir j√≥l" },
      { w: "j√≥laskraut (hk)", hint: "hlutur sem f√≥lk setur √° tr√© e√∞a glugga til a√∞ skreyta" },
      { w: "j√≥lasveinn (kk)", hint: "ma√∞ur sem gefur b√∂rnum gjafir um j√≥lin" },
      { w: "j√≥ladagatal (hk)", hint: "dagatal me√∞ litlum gj√∂fum fyrir hvern dag √≠ desember" },
      { w: "√ûorl√°ksmessa (kvk)", hint: "dagurinn fyrir j√≥l, 23. desember" },
      { w: "a√∞fangadagur (kk)", hint: "kv√∂ldi√∞ fyrir j√≥ladag, 24. desember" },
      { w: "hv√≠t j√≥l", hint: "√æegar snj√≥r er √° j√∂r√∞inni um j√≥lin" }
    ];

    const TRANSLATION_WORDS = [
      { word: "j√≥lahef√∞", icelandic: "j√≥lahef√∞ (kvk)" },
      { word: "j√≥laskraut", icelandic: "j√≥laskraut (hk)" }
    ];

    const TRUE_FALSE = [
      { statement: 'Fj√∂lskyldan b√Ωr √≠ Hafnarfir√∞i.', correct: true },
      { statement: 'Anna er a√∞ baka j√≥lasm√°k√∂kur.', correct: true },
      { statement: 'Bjarki setur stj√∂rnuna efst √° j√≥latr√©√∞.', correct: false },
      { statement: 'Fj√∂lskyldan fer √≠ b√≠√≥ √° √ûorl√°ksmessu.', correct: false },
      { statement: '√Å a√∞fangadag bor√∞ar fj√∂lskyldan hamborgarhrygg.', correct: true }
    ];

    const MULTIPLE_CHOICE = [
      {
        question: 'Hva√∞ er Anna a√∞ gera √≠ eldh√∫sinu?',
        options: ['A√∞ elda sk√∂tu', 'A√∞ baka sm√°k√∂kur', 'A√∞ opna gjafir', 'A√∞ hengja lj√≥s'],
        correct: 1
      },
      {
        question: 'Hver setur stj√∂rnuna efst √° j√≥latr√©√∞?',
        options: ['Anna', 'Sigur√∞ur', 'Bjarki', 'Lilja'],
        correct: 3
      },
      {
        question: 'Hva√∞ langar Sigur√∞ a√∞ bor√∞a √° √ûorl√°ksmessu?',
        options: ['Hamborgarhrygg', 'Sm√°k√∂kur', 'Sk√∂tu', 'Kart√∂flur'],
        correct: 2
      },
      {
        question: 'Hva√∞ drekkur fj√∂lskyldan me√∞ j√≥lamatnum?',
        options: ['Kak√≥', 'Vatn', 'Malt og appels√≠n', 'Kaffi'],
        correct: 2
      },
      {
        question: 'Hva√∞ gerir k√∂tturinn M√°si √° a√∞fangadagskv√∂ld?',
        options: ['Drekkur mj√≥lk', 'Leikur s√©r me√∞ j√≥lapapp√≠rinn', 'Sofnar √≠ s√≥fa', 'Hleypur √∫t'],
        correct: 1
      }
    ];

    const OPEN_QUESTIONS = [
      { 
        question: 'Hvernig er ilmurinn √≠ eldh√∫sinu √æegar Anna bakar?', 
        expectedContent: ['kanil', 'sykur', 'sm√°k√∂kur'] 
      },
      { 
        question: 'Hva√∞ horfa √æau √° um kv√∂ldi√∞ og hva√∞ drekka √æau?', 
        expectedContent: ['j√≥lamynd', 'kak√≥', 'rj√≥ma', 'heitt'] 
      },
      { 
        question: 'Hva√∞ f√¶r Lilja √∫r j√≥ladagatalinu?', 
        expectedContent: ['s√∫kkula√∞imola', 'mola', 's√∫kkula√∞i'] 
      },
      { 
        question: 'Hva√∞ bor√∞ar fj√∂lskyldan √° a√∞fangadag?', 
        expectedContent: ['hamborgarhrygg', 'kart√∂flur', 'rau√∞k√°l'] 
      }
    ];

    const MATCHING = [
      { left: '√ûorl√°ksmessa', right: '23. desember' },
      { left: 'A√∞fangadagur', right: 'Kv√∂ldi√∞ fyrir j√≥ladag' },
      { left: 'J√≥laskraut', right: 'Hlutur sem setur √° tr√© til a√∞ skreyta' },
      { left: 'Hv√≠t j√≥l', right: '√ûegar snj√≥r er √° j√∂r√∞inni um j√≥lin' }
    ];

    const HlustunJol = () => {
      const [playbackRate, setPlaybackRate] = useState(1);
      const [isPlaying, setIsPlaying] = useState(false);
      const audioRef = useRef(null);
      const [showTextModal, setShowTextModal] = useState(false);

      // √û√Ω√∞ing
      const [translations, setTranslations] = useState({});
      const [translationFeedback, setTranslationFeedback] = useState({});
      const [translationLoading, setTranslationLoading] = useState({});

      // R√©tt/Rangt
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Krossaspurningar
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);

      // Opnar
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));

      // Para
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);

      const rightOptions = useMemo(
        () => {
          const shuffled = [...MATCHING.map(m => m.right)];
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
          return shuffled;
        },
        []
      );

      const allQuestionsAnswered = tfChecked && mcChecked && 
        openFeedback.every(f => f !== null) && matchingChecked &&
        Object.keys(translationFeedback).length === TRANSLATION_WORDS.length;

      const resetTF = () => { setTfAnswers([]); setTfChecked(false); };
      const resetMC = () => { setMcAnswers([]); setMcChecked(false); };
      const resetOpen = () => {
        setOpenAnswers(Array(OPEN_QUESTIONS.length).fill(''));
        setOpenFeedback(Array(OPEN_QUESTIONS.length).fill(null));
      };
      const resetMatching = () => { 
        setMatchingAnswers(Array(MATCHING.length).fill('')); 
        setMatchingChecked(false); 
      };
      const resetTranslations = () => {
        setTranslations({});
        setTranslationFeedback({});
      };

      const togglePlay = () => {
        if (!audioRef.current) return;
        if (isPlaying) audioRef.current.pause();
        else audioRef.current.play();
      };
      
      const changePlaybackRate = (rate) => {
        setPlaybackRate(rate);
        if (audioRef.current) audioRef.current.playbackRate = rate;
      };
      
      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.playbackRate = playbackRate;
        }
      }, [playbackRate]);

      const checkTranslation = (index) => {
        const answer = translations[index]?.trim();
        if (!answer) {
          alert('Vinsamlegast skrifa√∞u √æ√Ω√∞ingu.');
          return;
        }
        setTranslationLoading(prev => ({ ...prev, [index]: true }));
        
        setTimeout(() => {
          setTranslationFeedback(prev => ({
            ...prev,
            [index]: { correct: true, feedback: "Fr√°b√¶rt! √ûetta er r√©tt √æ√Ω√∞ing." }
          }));
          setTranslationLoading(prev => ({ ...prev, [index]: false }));
        }, 500);
      };

      const handleTfAnswer = (index, value) => {
        if (tfChecked) return;
        const newAnswers = [...tfAnswers];
        newAnswers[index] = value;
        setTfAnswers(newAnswers);
      };
      const checkTfAnswers = () => setTfChecked(true);

      const handleMcAnswer = (qIndex, optIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = optIndex;
        setMcAnswers(newAnswers);
      };
      const checkMcAnswers = () => setMcChecked(true);

      const handleOpenAnswer = (index, value) => {
        const newAnswers = [...openAnswers];
        newAnswers[index] = value;
        setOpenAnswers(newAnswers);
      };
      
      const checkOpenAnswer = (index) => {
        const userAnswer = openAnswers[index].trim().toLowerCase();
        if (!userAnswer) {
          alert('Vinsamlegast skrifa√∞u eitthva√∞ √°√∞ur en √æ√∫ athugar.');
          return;
        }
        
        const question = OPEN_QUESTIONS[index];
        const foundKeywords = question.expectedContent.filter(keyword => 
          userAnswer.includes(keyword.toLowerCase())
        );
        
        const newFeedback = [...openFeedback];
        if (foundKeywords.length >= Math.ceil(question.expectedContent.length / 2)) {
          newFeedback[index] = {
            correct: true,
            feedback: `Mj√∂g gott! √û√∫ nefndir: ${foundKeywords.join(', ')}`
          };
        } else if (foundKeywords.length > 0) {
          newFeedback[index] = {
            correct: true,
            feedback: `Gott byrja√∞! √û√∫ g√¶tir l√≠ka nefnt: ${question.expectedContent.filter(k => !foundKeywords.includes(k)).join(', ')}`
          };
        } else {
          newFeedback[index] = {
            correct: false,
            feedback: `Reyndu aftur! Hugsa√∞u um: ${question.expectedContent.slice(0, 2).join(', ')}`
          };
        }
        setOpenFeedback(newFeedback);
      };

      const handleMatchingAnswer = (index, value) => {
        if (matchingChecked) return;
        const newAnswers = [...matchingAnswers];
        newAnswers[index] = value;
        setMatchingAnswers(newAnswers);
      };
      const checkMatching = () => setMatchingChecked(true);

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button onClick={() => window.history.back()} className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light">
                ‚Üê Til baka
              </button>
              <div className="flex items-center gap-6">
                <div className="flex-1">
                  <h1 className="text-3xl font-light text-gray-800 mb-2">Hlustun 5: J√≥lahef√∞ir √° √çslandi</h1>
                  <p className="text-gray-500 text-sm font-light">Hlustunarverkefni ¬∑ A1</p>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-8">
            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
              <h2 className="text-xl font-normal text-gray-800 mb-3">üìù Lei√∞beiningar</h2>
              <ul className="space-y-2 text-gray-700 font-light">
                <li>‚Ä¢ Lestu lykilor√∞in h√©r a√∞ ne√∞an fyrst</li>
                <li>‚Ä¢ Hlusta√∞u √° textann 2‚Äì3 sinnum</li>
                <li>‚Ä¢ √û√∫ getur h√¶gt e√∞a hra√∞a√∞ √° hlj√≥√∞inu</li>
                <li>‚Ä¢ Svara√∞u √∂llum spurningunum</li>
                <li>‚Ä¢ √ûegar √æ√∫ hefur loki√∞ √∂llum spurningum getur√∞u lesi√∞ textann</li>
              </ul>
            </div>

            <section className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-4">üìò Lykilor√∞</h2>
              <p className="text-gray-700 font-light mb-4">Lestu yfir or√∞in √°√∞ur en √æ√∫ hlustar.</p>
              <div className="grid md:grid-cols-2 gap-3">
                {VOCAB.map((it, i) => (
                  <div key={i} className="rounded-lg border-2 border-yellow-200 bg-white/70 p-3">
                    <div className="font-normal text-gray-900">{it.w}</div>
                    <div className="text-sm text-gray-600 font-light">{it.hint}</div>
                  </div>
                ))}
              </div>
            </section>

            <div className="sticky-player">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
                <div className="flex items-center gap-4">
                  <button
                    onClick={togglePlay}
                    className="bg-blue-500 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors flex-shrink-0"
                    aria-label={isPlaying ? 'P√°sa' : 'Spila'}
                  >
                    {isPlaying ? (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg>
                    ) : (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3" /></svg>
                    )}
                  </button>

                  <div className="flex-1">
                    <p className="text-sm font-normal text-gray-800 mb-1">üéß Hlusta √° textann</p>
                    <audio
                      ref={audioRef}
                      src="media/hlustun5_jol.mp3"
                      preload="none"
                      onEnded={() => setIsPlaying(false)}
                      onPlay={() => setIsPlaying(true)}
                      onPause={() => setIsPlaying(false)}
                    />
                  </div>

                  <div className="flex gap-2">
                    <button onClick={() => changePlaybackRate(0.75)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 0.75 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>0.75√ó</button>
                    <button onClick={() => changePlaybackRate(1)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1√ó</button>
                    <button onClick={() => changePlaybackRate(1.25)} className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${playbackRate === 1.25 ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`}>1.25√ó</button>
                  </div>
                </div>
              </div>
            </div>

            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ing</h2>
              <div className="space-y-6">
                {TRANSLATION_WORDS.map((item, index) => (
                  <div key={index}>
                    <p className="text-gray-700 font-light mb-4">Hva√∞ √æ√Ω√∞ir ‚Äû<strong>{item.icelandic}</strong>" √° √æ√≠nu m√≥√∞urm√°li?</p>
                    {!translationFeedback[index] ? (
                      <div className="space-y-4">
                        <div>
                          <input 
                            type="text" 
                            value={translations[index] || ''} 
                            onChange={(e) => setTranslations(prev => ({ ...prev, [index]: e.target.value }))}
                            placeholder={`Skrifa√∞u √æ√Ω√∞inguna √° "${item.word}" h√©r...`}
                            className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light" 
                          />
                        </div>
                        <button 
                          onClick={() => checkTranslation(index)} 
                          disabled={translationLoading[index]}
                          className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light disabled:bg-gray-400"
                        >
                          {translationLoading[index] ? 'Athuga...' : 'Athuga svar'}
                        </button>
                      </div>
                    ) : (
                      <div className="border-2 rounded-lg p-6 bg-green-50 border-green-200">
                        <p className="font-light text-green-800">
                          ‚úì {translationFeedback[index].feedback}
                        </p>
                      </div>
                    )}
                    {index < TRANSLATION_WORDS.length - 1 && <hr className="my-6 border-gray-200" />}
                  </div>
                ))}
              </div>
              <button onClick={resetTranslations} className="mt-6 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                Endurstilla √æ√Ω√∞ingar
              </button>
            </section>

            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-light text-gray-800 mb-3">{item.statement}</p>
                    <div className="flex gap-4">
                      {[true, false].map((answer) => {
                        const isSelected = tfAnswers[index] === answer;
                        const isCorrect = answer === item.correct;
                        const showAsCorrect = tfChecked && isCorrect;
                        const showAsIncorrect = tfChecked && isSelected && !isCorrect;
                        return (
                          <div
                            key={answer ? 'true' : 'false'}
                            onClick={() => handleTfAnswer(index, answer)}
                            className={`answer-option flex-1 p-3 rounded-lg ${isSelected && !tfChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${tfChecked ? 'disabled' : ''}`}
                          >
                            <div className="flex items-center justify-center gap-2">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !tfChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-1.5 h-1.5 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light text-sm">{answer ? 'R√©tt' : 'Rangt'}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!tfChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkTfAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetTF} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {tfAnswers.filter((a, i) => a === TRUE_FALSE[i].correct).length} af {TRUE_FALSE.length} r√©tt!</p>
                  <button onClick={resetTF} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Krossaspurningar</h2>
              <p className="text-gray-600 font-light mb-6">Merktu vi√∞ eitt svar (A‚ÄìD).</p>
              <div className="space-y-6">
                {MULTIPLE_CHOICE.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-6">
                    <p className="font-normal text-gray-800 mb-4">{qIndex + 1}. {q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((opt, optIndex) => {
                        const isSelected = mcAnswers[qIndex] === optIndex;
                        const isCorrect = optIndex === q.correct;
                        const showAsCorrect = mcChecked && isCorrect;
                        const showAsIncorrect = mcChecked && isSelected && !isCorrect;
                        return (
                          <div key={optIndex} onClick={() => handleMcAnswer(qIndex, optIndex)}
                            className={`answer-option p-4 rounded-lg ${isSelected && !mcChecked ? 'selected' : ''} ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${mcChecked ? 'disabled' : ''}`}>
                            <div className="flex items-center gap-3">
                              <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !mcChecked ? 'border-blue-500 bg-blue-500' :
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' : 'border-gray-300'}`}>
                                {(isSelected || showAsCorrect) && (<div className="w-2 h-2 bg-white rounded-full"></div>)}
                              </div>
                              <span className="font-light">{String.fromCharCode(65 + optIndex)}. {opt}</span>
                              {showAsCorrect && <span className="ml-auto text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="ml-auto text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!mcChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMcAnswers}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMC} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {mcAnswers.filter((a, i) => a === MULTIPLE_CHOICE[i].correct).length} af {MULTIPLE_CHOICE.length} r√©tt!</p>
                  <button onClick={resetMC} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ Stuttar spurningar</h2>
              <p className="text-gray-600 font-light mb-6">Svara√∞u me√∞ √æ√≠num eigin or√∞um (1‚Äì2 setningar).</p>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                    <p className="font-normal text-gray-800 mb-3">{index + 1}. {q.question}</p>
                    {!openFeedback[index] ? (
                      <div className="space-y-3">
                        <textarea value={openAnswers[index]} onChange={(e) => handleOpenAnswer(index, e.target.value)}
                          rows="3" placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                          className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light resize-none" />
                        <button onClick={() => checkOpenAnswer(index)}
                          className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                          Athuga svar
                        </button>
                      </div>
                    ) : (
                      <div className={`border-2 rounded-lg p-4 ${openFeedback[index].correct ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                        <p className={`text-sm font-light ${openFeedback[index].correct ? 'text-green-800' : 'text-yellow-800'}`}>
                          {openFeedback[index].correct ? '‚úì' : 'üí°'} {openFeedback[index].feedback}
                        </p>
                        <button onClick={()=>{ const nf=[...openFeedback]; nf[index]=null; setOpenFeedback(nf); const na=[...openAnswers]; na[index]=''; setOpenAnswers(na); }}
                          className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                          Reyna aftur
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
              <div className="mt-4">
                <button onClick={resetOpen} className="px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                  Endurstilla allar spurningar
                </button>
              </div>
            </section>

            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ Para√∞u saman</h2>
              <div className="space-y-4">
                {MATCHING.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <div className="flex items-center gap-4">
                      <div className="flex-1"><span className="font-normal text-gray-800">{item.left}</span></div>
                      <div className="text-gray-400">‚Üí</div>
                      <div className="flex-1">
                        <select value={matchingAnswers[index]} onChange={(e) => handleMatchingAnswer(index, e.target.value)} disabled={matchingChecked}
                          className={`w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light ${
                            matchingChecked ? (matchingAnswers[index]===item.right ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-gray-300'}`}>
                          <option value="">Veldu...</option>
                          {rightOptions.map((opt, i) => (<option key={i} value={opt}>{opt}</option>))}
                        </select>
                      </div>
                      {matchingChecked && (<div className="w-8">{matchingAnswers[index]===item.right ? <span className="text-green-600 text-xl">‚úì</span> : <span className="text-red-600 text-xl">‚úó</span>}</div>)}
                    </div>
                    {matchingChecked && matchingAnswers[index]!==item.right && (
                      <p className="text-sm text-red-600 mt-2">‚úó R√©tt svar: {item.right}</p>
                    )}
                  </div>
                ))}
              </div>
              {!matchingChecked ? (
                <div className="mt-6 flex gap-3">
                  <button onClick={checkMatching}
                    className="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light">
                    Athuga sv√∂r
                  </button>
                  <button onClick={resetMatching} className="px-6 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light">
                    Endurstilla
                  </button>
                </div>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">‚úì √û√∫ f√©kkst {matchingAnswers.filter((v,i)=>v===MATCHING[i].right).length} af {MATCHING.length} r√©tt!</p>
                  <button onClick={resetMatching} className="mt-3 px-4 py-2 rounded-md border-2 border-gray-200 hover:bg-gray-50 font-light text-sm">
                    Reyna aftur
                  </button>
                </div>
              )}
            </section>

            <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-8 text-center">
              <div className="text-6xl mb-4">üéâ</div>
              <h2 className="text-2xl font-light text-gray-800 mb-3">Vel gert!</h2>
              <p className="text-gray-600 font-light mb-6">√û√∫ hefur kl√°ra√∞ hlustunarverkefni√∞ um j√≥lahef√∞ir √° √çslandi.</p>
              
              {allQuestionsAnswered && (
                <button 
                  onClick={() => setShowTextModal(true)}
                  className="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors font-light text-lg shadow-lg">
                  üìñ Lesa textann
                </button>
              )}
            </div>
          </main>

          {showTextModal && (
            <div className="modal-overlay" onClick={() => setShowTextModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex items-center justify-between">
                  <h2 className="text-2xl font-light text-gray-800">üìñ Hlustunartextinn</h2>
                  <button 
                    onClick={() => setShowTextModal(false)}
                    className="text-gray-500 hover:text-gray-700 text-3xl leading-none"
                    aria-label="Loka">
                    √ó
                  </button>
                </div>
                <div className="p-8">
                  <div className="prose prose-lg max-w-none">
                    {LISTENING_TEXT.split('\n\n').map((paragraph, i) => (
                      <p key={i} className="mb-4 text-gray-700 font-light leading-relaxed">
                        {paragraph}
                      </p>
                    ))}
                  </div>
                  <div className="mt-8 text-center">
                    <button 
                      onClick={() => setShowTextModal(false)}
                      className="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors font-light">
                      Loka
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunJol />);
  </script>
</body>
</html>
