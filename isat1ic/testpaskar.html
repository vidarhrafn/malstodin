<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìñ P√°skarnir √° √çslandi - Interactive Reading (B1‚ÜíA2)</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #fef3c7 0%, #fde68a 100%);
    }
    
    .selectable-text {
      user-select: text;
      cursor: text;
      line-height: 1.8;
    }
    
    .selectable-text::selection {
      background: #fde047;
      color: #000;
    }
    
    .translation-popup {
      position: fixed;
      background: white;
      border: 3px solid #eab308;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      z-index: 1000;
      max-width: 400px;
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .loading-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef } = React;

    const LANGUAGES = {
      en: { name: 'English', flag: 'üá¨üáß', nativeName: 'English' },
      pl: { name: 'Polish', flag: 'üáµüá±', nativeName: 'Polski' },
      vi: { name: 'Vietnamese', flag: 'üáªüá≥', nativeName: 'Ti·∫øng Vi·ªát' },
      zh: { name: 'Chinese', flag: 'üá®üá≥', nativeName: '‰∏≠Êñá' },
      es: { name: 'Spanish', flag: 'üá™üá∏', nativeName: 'Espa√±ol' },
      pt: { name: 'Portuguese', flag: 'üáµüáπ', nativeName: 'Portugu√™s' },
      ar: { name: 'Arabic', flag: 'üá∏üá¶', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' },
      ru: { name: 'Russian', flag: 'üá∑üá∫', nativeName: '–†—É—Å—Å–∫–∏–π' }
    };

    const TEXT = `P√°skarnir eru spennandi t√≠mi √° √çslandi. √ûetta er t√≠mi √æar sem vi√∞ f√°um fr√≠ fr√° sk√≥lanum og vinnu og vi√∞ getum veri√∞ me√∞ fj√∂lskyldunni okkar. P√°skarnir eru kristin tr√∫arh√°t√≠√∞. √û√° minnumst vi√∞ √æess a√∞ Jes√∫s var krossfestur √° f√∂studaginn langa, sem er mj√∂g sorglegur dagur √≠ kristinni tr√∫. √ûa√∞ er dagur √æar sem f√≥lk hugsar um f√≥rnir og √æj√°ningar. En p√°skarnir eru l√≠ka um von og n√Ωtt l√≠f, √æv√≠ √° p√°skadag reis Jes√∫s upp fr√° dau√∞um.

√Å√∞ur en p√°skarnir koma er dymbilvika, vikan √° undan p√°skum. √Å sk√≠rdag, fimmtudag √≠ dymbilviku, bor√∞a margir g√≥√∞an mat og margir hugsa um s√≠√∞ustu kv√∂ldm√°lt√≠√∞ina sem Jes√∫ √°tti me√∞ l√¶risveinum s√≠num. N√¶sta dag er f√∂studagurinn langi. √û√° minnumst vi√∞ √æess √æegar Jes√∫s var krossfestur. √Å √çslandi er allt loka√∞ √° f√∂studaginn langa og flestir eru heima hj√° s√©r a√∞ verja t√≠ma me√∞ fj√∂lskyldunni. N√¶sta sunnudag er svo p√°skadagur en √æ√° reis Jes√∫s upp fr√° dau√∞um. M√°nudagurinn eftir p√°skadag er kalla√∞ur annar √≠ p√°skum. √û√° er fr√≠ √≠ sk√≥la og vinnu.

Eitt af √æv√≠ sem b√∂rn eru spenntust fyrir er p√°skaeggi√∞! P√°skaegg eru st√≥r s√∫kkula√∞iegg full af nammi. Inni √≠ egginu er l√≠ka l√≠till mi√∞i me√∞ m√°lsh√¶tti e√∞a spakm√¶li. Einn m√°lsh√°ttur er til d√¶mis "Morgunstund gefur gull √≠ mund" en √æa√∞ √æ√Ω√∞ir a√∞ s√° sem vaknar snemma √° au√∞veldara me√∞ a√∞ eignast peninga. √ûa√∞ er alltaf spennandi a√∞ sj√° hva√∞ stendur √° mi√∞anum!

Fyrir marga er ferming l√≠ka mikilv√¶gur hluti af p√°skunum. Ferming er √æegar unglingar sta√∞festa tr√∫ s√≠na √≠ kristinni tr√∫. √ûeir l√¶ra um tr√∫ s√≠na √≠ fermingarfr√¶√∞slu og halda svo st√≥ra veislu me√∞ fj√∂lskyldu og vinum. √ûeir f√° l√≠ka gjafir, oft peninga e√∞a hluti sem √æeir √≥ska s√©r. √ûa√∞ er l√≠ka til borgaraleg ferming. √ûa√∞ er ekki tr√∫arleg ath√∂fn, heldur n√°mskei√∞ √æar sem unglingar l√¶ra um l√≠fi√∞, si√∞fer√∞i og mannr√©ttindi. √ûeir l√¶ra um mikilv√¶g m√°lefni eins og jafnr√©tti, umhverfisvernd og heimsspeki. Eftir n√°mskei√∞i√∞ er haldin veisla og √æeir f√° l√≠ka gjafir. Ferming er mikilv√¶gur √°fangi √≠ l√≠fi margra unglinga.

P√°skarnir eru t√≠mi til a√∞ vera saman, bor√∞a g√≥√∞an mat og nj√≥ta fr√≠sins. Margar fj√∂lskyldur fara √≠ fer√∞al√∂g um p√°skana, anna√∞ hvort innanlands e√∞a utan. A√∞rir kj√≥sa a√∞ vera heima og nj√≥ta samverunnar. Hvort sem √æ√∫ fagnar p√°skunum sem tr√∫arh√°t√≠√∞ e√∞a bara sem t√≠ma til a√∞ vera me√∞ fj√∂lskyldunni, √æ√° eru p√°skarnir alltaf s√©rstakir. Gle√∞ilega p√°ska!`;

    const InteractiveReading = () => {
      const [selectedLanguage, setSelectedLanguage] = useState('en');
      const [showPopup, setShowPopup] = useState(false);
      const [popupPosition, setPopupPosition] = useState({ x: 0, y: 0 });
      const [selectedText, setSelectedText] = useState('');
      const [translation, setTranslation] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const textRef = useRef(null);

      const handleTextSelection = () => {
        const selection = window.getSelection();
        const text = selection.toString().trim();
        
        if (text.length > 0) {
          const range = selection.getRangeAt(0);
          const rect = range.getBoundingClientRect();
          
          setSelectedText(text);
          setPopupPosition({
            x: rect.left + (rect.width / 2),
            y: rect.bottom + window.scrollY + 10
          });
          setShowPopup(true);
          setTranslation('');
        } else {
          setShowPopup(false);
        }
      };

      const translateText = () => {
        setIsLoading(true);
        
        const languageInfo = LANGUAGES[selectedLanguage];
        const prompt = 'You are a helpful language tutor. A student learning Icelandic (A2-B1 level) has selected this text and needs help understanding it in ' + languageInfo.name + '.\n\nSELECTED TEXT (Icelandic):\n"' + selectedText + '"\n\nPlease provide:\n1. Translation to ' + languageInfo.name + '\n2. A brief, simple explanation if needed (in ' + languageInfo.name + ')\n\nKeep it concise and helpful for a language learner. If it\'s a single word, give the translation. If it\'s a phrase or sentence, translate it and optionally add a short note if there\'s cultural context.\n\nRespond ONLY in ' + languageInfo.name + ' (not English, not Icelandic).';

        fetch('/.netlify/functions/openai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            messages: [
              { role: 'system', content: 'You are a helpful language learning assistant.' },
              { role: 'user', content: prompt }
            ]
          })
        })
        .then(function(response) {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(function(data) {
          const aiResponse = data.choices[0].message.content;
          setTranslation(aiResponse);
          setIsLoading(false);
        })
        .catch(function(error) {
          console.error('Translation error:', error);
          setTranslation('√öps! Villa kom upp. Reyndu aftur.');
          setIsLoading(false);
        });
      };

      const closePopup = () => {
        setShowPopup(false);
        setSelectedText('');
        setTranslation('');
        window.getSelection().removeAllRanges();
      };

      return (
        <div className="min-h-screen pb-12">
          {/* Header */}
          <header className="bg-white shadow-md border-b-4 border-yellow-400">
            <div className="max-w-4xl mx-auto px-6 py-6">
              <h1 className="text-3xl font-light text-gray-800 mb-2">üìñ P√°skarnir √° √çslandi</h1>
              <p className="text-gray-600 text-sm font-light">Interactive Reading ¬∑ B1 ‚Üí A2</p>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-6">
            {/* Language Selector */}
            <div className="bg-white rounded-xl shadow-sm border-2 border-yellow-300 p-6">
              <h2 className="text-xl font-normal text-gray-800 mb-4">üåê Veldu √æitt m√≥√∞urm√°l</h2>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {Object.entries(LANGUAGES).map(([code, lang]) => (
                  <button
                    key={code}
                    onClick={() => setSelectedLanguage(code)}
                    className={`p-3 rounded-lg border-2 transition-all font-light ${
                      selectedLanguage === code
                        ? 'border-yellow-500 bg-yellow-50 shadow-md'
                        : 'border-gray-200 hover:border-yellow-300 hover:bg-yellow-50'
                    }`}
                  >
                    <div className="text-2xl mb-1">{lang.flag}</div>
                    <div className="text-sm text-gray-700">{lang.nativeName}</div>
                  </button>
                ))}
              </div>
            </div>

            {/* Instructions */}
            <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
              <h2 className="text-xl font-normal text-gray-800 mb-3">üí° Hvernig virkar √æetta?</h2>
              <ol className="space-y-2 text-gray-700 font-light">
                <li>1Ô∏è‚É£ Veldu √æitt m√≥√∞urm√°l h√©r a√∞ ofan</li>
                <li>2Ô∏è‚É£ Lestu textann a√∞ ne√∞an</li>
                <li>3Ô∏è‚É£ <strong>Merktu</strong> or√∞ e√∞a setningu sem √æ√∫ skilur ekki</li>
                <li>4Ô∏è‚É£ Smelltu √° <strong>"√û√Ω√∞a"</strong> hnappinn</li>
                <li>5Ô∏è‚É£ F√°√∞u √æ√Ω√∞ingu √° √æ√≠nu m√°li! üéâ</li>
              </ol>
            </div>

            {/* Text Content */}
            <div className="bg-white rounded-xl shadow-sm border-2 border-yellow-300 p-8">
              <div
                ref={textRef}
                className="selectable-text text-gray-800 font-light text-lg leading-relaxed space-y-4"
                onMouseUp={handleTextSelection}
                onTouchEnd={handleTextSelection}
              >
                {TEXT.split('\n\n').map((paragraph, i) => (
                  <p key={i}>{paragraph}</p>
                ))}
              </div>
            </div>

            {/* Completion */}
            <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-8 text-center">
              <div className="text-6xl mb-4">üéâ</div>
              <h2 className="text-2xl font-light text-gray-800 mb-3">Vel gert!</h2>
              <p className="text-gray-600 font-light">
                √û√∫ getur lesi√∞ B1 texta me√∞ hj√°lp AI √æ√Ω√∞inganna!
              </p>
            </div>
          </main>

          {/* Translation Popup */}
          {showPopup && (
            <>
              <div 
                className="fixed inset-0 bg-black bg-opacity-20 z-50"
                onClick={closePopup}
              />
              <div
                className="translation-popup"
                style={{
                  left: `${Math.min(popupPosition.x, window.innerWidth - 220)}px`,
                  top: `${popupPosition.y}px`,
                  transform: 'translateX(-50%)'
                }}
              >
                <div className="flex items-start justify-between mb-3">
                  <div className="flex-1">
                    <div className="text-xs text-gray-500 mb-1">Vali√∞ texti:</div>
                    <div className="font-normal text-gray-800 text-sm mb-3 italic">
                      "{selectedText}"
                    </div>
                  </div>
                  <button
                    onClick={closePopup}
                    className="text-gray-400 hover:text-gray-600 text-2xl leading-none ml-2"
                  >
                    √ó
                  </button>
                </div>

                {!translation ? (
                  <button
                    onClick={translateText}
                    disabled={isLoading}
                    className="w-full bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 transition-colors font-light disabled:bg-gray-400"
                  >
                    {isLoading ? (
                      <span className="loading-dots">√û√Ω√∞i</span>
                    ) : (
                      `üåê √û√Ω√∞a √° ${LANGUAGES[selectedLanguage].nativeName}`
                    )}
                  </button>
                ) : (
                  <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                    <div className="text-xs text-gray-500 mb-2">
                      {LANGUAGES[selectedLanguage].flag} √û√Ω√∞ing:
                    </div>
                    <div className="font-light text-gray-800 whitespace-pre-wrap">
                      {translation}
                    </div>
                  </div>
                )}
              </div>
            </>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<InteractiveReading />);
  </script>
</body>
</html>
