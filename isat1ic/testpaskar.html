<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìñ P√°skarnir √° √çslandi - Interactive Reading (B1‚ÜíA2)</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    
    .selectable-text {
      user-select: text;
      -webkit-user-select: text;
      cursor: text;
      line-height: 1.8;
      -webkit-touch-callout: none;
    }
    
    .selectable-text::selection {
      background: #e3f2fd;
      color: #000;
    }
    
    .translation-popup {
      position: fixed;
      background: white;
      border: 3px solid #2196f3;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      z-index: 1000;
      max-width: 90vw;
      width: 400px;
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .loading-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const useState = React.useState;
    const useRef = React.useRef;

    const TEXT = 'P√°skarnir eru spennandi t√≠mi √° √çslandi. √ûetta er t√≠mi √æar sem vi√∞ f√°um fr√≠ fr√° sk√≥lanum og vinnu og vi√∞ getum veri√∞ me√∞ fj√∂lskyldunni okkar. P√°skarnir eru kristin tr√∫arh√°t√≠√∞. √û√° minnumst vi√∞ √æess a√∞ Jes√∫s var krossfestur √° f√∂studaginn langa, sem er mj√∂g sorglegur dagur √≠ kristinni tr√∫. √ûa√∞ er dagur √æar sem f√≥lk hugsar um f√≥rnir og √æj√°ningar. En p√°skarnir eru l√≠ka um von og n√Ωtt l√≠f, √æv√≠ √° p√°skadag reis Jes√∫s upp fr√° dau√∞um.\n\n√Å√∞ur en p√°skarnir koma er dymbilvika, vikan √° undan p√°skum. √Å sk√≠rdag, fimmtudag √≠ dymbilviku, bor√∞a margir g√≥√∞an mat og margir hugsa um s√≠√∞ustu kv√∂ldm√°lt√≠√∞ina sem Jes√∫ √°tti me√∞ l√¶risveinum s√≠num. N√¶sta dag er f√∂studagurinn langi. √û√° minnumst vi√∞ √æess √æegar Jes√∫s var krossfestur. √Å √çslandi er allt loka√∞ √° f√∂studaginn langa og flestir eru heima hj√° s√©r a√∞ verja t√≠ma me√∞ fj√∂lskyldunni. N√¶sta sunnudag er svo p√°skadagur en √æ√° reis Jes√∫s upp fr√° dau√∞um. M√°nudagurinn eftir p√°skadag er kalla√∞ur annar √≠ p√°skum. √û√° er fr√≠ √≠ sk√≥la og vinnu.\n\nEitt af √æv√≠ sem b√∂rn eru spenntust fyrir er p√°skaeggi√∞! P√°skaegg eru st√≥r s√∫kkula√∞iegg full af nammi. Inni √≠ egginu er l√≠ka l√≠till mi√∞i me√∞ m√°lsh√¶tti e√∞a spakm√¶li. Einn m√°lsh√°ttur er til d√¶mis "Morgunstund gefur gull √≠ mund" en √æa√∞ √æ√Ω√∞ir a√∞ s√° sem vaknar snemma √° au√∞veldara me√∞ a√∞ eignast peninga. √ûa√∞ er alltaf spennandi a√∞ sj√° hva√∞ stendur √° mi√∞anum!\n\nFyrir marga er ferming l√≠ka mikilv√¶gur hluti af p√°skunum. Ferming er √æegar unglingar sta√∞festa tr√∫ s√≠na √≠ kristinni tr√∫. √ûeir l√¶ra um tr√∫ s√≠na √≠ fermingarfr√¶√∞slu og halda svo st√≥ra veislu me√∞ fj√∂lskyldu og vinum. √ûeir f√° l√≠ka gjafir, oft peninga e√∞a hluti sem √æeir √≥ska s√©r. √ûa√∞ er l√≠ka til borgaraleg ferming. √ûa√∞ er ekki tr√∫arleg ath√∂fn, heldur n√°mskei√∞ √æar sem unglingar l√¶ra um l√≠fi√∞, si√∞fer√∞i og mannr√©ttindi. √ûeir l√¶ra um mikilv√¶g m√°lefni eins og jafnr√©tti, umhverfisvernd og heimsspeki. Eftir n√°mskei√∞i√∞ er haldin veisla og √æeir f√° l√≠ka gjafir. Ferming er mikilv√¶gur √°fangi √≠ l√≠fi margra unglinga.\n\nP√°skarnir eru t√≠mi til a√∞ vera saman, bor√∞a g√≥√∞an mat og nj√≥ta fr√≠sins. Margar fj√∂lskyldur fara √≠ fer√∞al√∂g um p√°skana, anna√∞ hvort innanlands e√∞a utan. A√∞rir kj√≥sa a√∞ vera heima og nj√≥ta samverunnar. Hvort sem √æ√∫ fagnar p√°skunum sem tr√∫arh√°t√≠√∞ e√∞a bara sem t√≠ma til a√∞ vera me√∞ fj√∂lskyldunni, √æ√° eru p√°skarnir alltaf s√©rstakir. Gle√∞ilega p√°ska!';

    const InteractiveReading = function() {
      const state1 = useState('');
      const userLanguageInput = state1[0];
      const setUserLanguageInput = state1[1];
      
      const state2 = useState('');
      const confirmedLanguage = state2[0];
      const setConfirmedLanguage = state2[1];
      
      const state3 = useState(false);
      const showPopup = state3[0];
      const setShowPopup = state3[1];
      
      const state4 = useState({ x: 0, y: 0 });
      const popupPosition = state4[0];
      const setPopupPosition = state4[1];
      
      const state5 = useState('');
      const selectedText = state5[0];
      const setSelectedText = state5[1];
      
      const state6 = useState('');
      const translation = state6[0];
      const setTranslation = state6[1];
      
      const state7 = useState(false);
      const isLoading = state7[0];
      const setIsLoading = state7[1];
      
      const textRef = useRef(null);

      const handleConfirmLanguage = function() {
        if (userLanguageInput.trim()) {
          setConfirmedLanguage(userLanguageInput.trim());
        }
      };

      const calculatePopupPosition = function(rect) {
        const popupWidth = 400;
        const popupHeight = 200; // √Å√¶tlu√∞ h√¶√∞
        const padding = 20;
        
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const scrollY = window.scrollY;
        
        // Reikna l√°r√©tta sta√∞setningu
        let x = rect.left + (rect.width / 2);
        
        // Passa a√∞ popup fari ekki √∫t fyrir h√¶gri br√∫n
        if (x + (popupWidth / 2) > viewportWidth - padding) {
          x = viewportWidth - (popupWidth / 2) - padding;
        }
        
        // Passa a√∞ popup fari ekki √∫t fyrir vinstri br√∫n
        if (x - (popupWidth / 2) < padding) {
          x = (popupWidth / 2) + padding;
        }
        
        // Reikna l√≥√∞r√©tta sta√∞setningu
        let y = rect.bottom + scrollY + 10;
        
        // Ef popup fer √∫t fyrir ne√∞ri br√∫n, setja √æa√∞ fyrir ofan textann
        if (rect.bottom + popupHeight > viewportHeight + scrollY) {
          y = rect.top + scrollY - popupHeight - 10;
        }
        
        return { x: x, y: y };
      };

      const handleTextSelection = function() {
        setTimeout(function() {
          const selection = window.getSelection();
          const text = selection.toString().trim();
          
          if (text.length > 0 && confirmedLanguage) {
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            setSelectedText(text);
            const newPos = calculatePopupPosition(rect);
            setPopupPosition(newPos);
            setShowPopup(true);
            setTranslation('');
          }
        }, 100);
      };

      const translateText = function() {
        setIsLoading(true);
        
        const systemPrompt = 'You are a helpful language learning assistant for Icelandic students.';
        const userPrompt = 'A student learning Icelandic (A2-B1 level) has selected this text and needs help understanding it in ' + confirmedLanguage + '.\n\nSELECTED TEXT (Icelandic):\n"' + selectedText + '"\n\nPlease provide:\n1. Translation to ' + confirmedLanguage + '\n2. A brief, simple explanation if needed (in ' + confirmedLanguage + ')\n\nKeep it concise and helpful for a language learner. If it is a single word, give the translation. If it is a phrase or sentence, translate it and optionally add a short note if there is cultural context.\n\nRespond ONLY in ' + confirmedLanguage + ' (not English, not Icelandic).';

        fetch('/.netlify/functions/openai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: [
              { role: 'system', content: systemPrompt },
              { role: 'user', content: userPrompt }
            ],
            max_tokens: 300,
            temperature: 0.3
          })
        })
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(function(data) {
          if (data.error) {
            throw new Error(data.error);
          }
          const aiResponse = data.content;
          setTranslation(aiResponse);
          setIsLoading(false);
        })
        .catch(function(error) {
          console.error('Translation error:', error);
          setTranslation('√öps! Villa kom upp. Reyndu aftur.');
          setIsLoading(false);
        });
      };

      const closePopup = function() {
        setShowPopup(false);
        setSelectedText('');
        setTranslation('');
        window.getSelection().removeAllRanges();
      };

      return (
        React.createElement('div', { className: 'min-h-screen pb-12' },
          React.createElement('header', { className: 'bg-white shadow-sm border-b border-gray-200' },
            React.createElement('div', { className: 'max-w-4xl mx-auto px-6 py-8' },
              React.createElement('h1', { className: 'text-3xl font-light text-gray-800 mb-2' }, 'üìñ P√°skarnir √° √çslandi'),
              React.createElement('p', { className: 'text-gray-500 text-sm font-light' }, 'Interactive Reading ¬∑ B1 ‚Üí A2')
            )
          ),

          React.createElement('main', { className: 'max-w-4xl mx-auto px-6 mt-8 space-y-8' },
            React.createElement('div', { className: 'bg-white rounded-lg shadow-sm p-6' },
              React.createElement('h2', { className: 'text-xl font-normal text-gray-800 mb-4' }, 'üåê M√≥√∞urm√°l'),
              
              !confirmedLanguage ? (
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('input', {
                    type: 'text',
                    value: userLanguageInput,
                    onChange: function(e) { setUserLanguageInput(e.target.value); },
                    onKeyPress: function(e) { if (e.key === 'Enter') { handleConfirmLanguage(); } },
                    placeholder: 'T.d. English, Polski, Ti·∫øng Vi·ªát, ‰∏≠Êñá, Espa√±ol...',
                    className: 'w-full p-4 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light text-lg'
                  }),
                  React.createElement('button', {
                    onClick: handleConfirmLanguage,
                    disabled: !userLanguageInput.trim(),
                    className: 'bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-light disabled:bg-gray-400 disabled:cursor-not-allowed'
                  }, '‚úì Sta√∞festa tungum√°l'),
                  React.createElement('p', { className: 'text-sm text-gray-600 font-light' },
                    'Skrifa√∞u nafn tungum√°lsins √æ√≠ns og smelltu √° "Sta√∞festa"'
                  )
                )
              ) : (
                React.createElement('div', { className: 'bg-green-50 border-2 border-green-200 rounded-lg p-4' },
                  React.createElement('p', { className: 'text-green-800 font-light mb-3' },
                    '‚úì Vali√∞ m√≥√∞urm√°l: ',
                    React.createElement('strong', null, confirmedLanguage)
                  ),
                  React.createElement('button', {
                    onClick: function() { setConfirmedLanguage(''); setUserLanguageInput(''); },
                    className: 'text-sm text-blue-600 hover:text-blue-800 font-light'
                  }, '‚Üª Breyta tungum√°li')
                )
              )
            ),

            React.createElement('div', { className: 'bg-blue-50 border-2 border-blue-200 rounded-lg p-6' },
              React.createElement('h2', { className: 'text-xl font-normal text-gray-800 mb-3' }, 'üí° Hvernig virkar √æetta?'),
              React.createElement('ul', { className: 'space-y-2 text-gray-700 font-light' },
                React.createElement('li', null, '1Ô∏è‚É£ Veldu og sta√∞festu m√≥√∞urm√°l √æitt h√©r a√∞ ofan'),
                React.createElement('li', null, '2Ô∏è‚É£ Lestu textann a√∞ ne√∞an'),
                React.createElement('li', null, '3Ô∏è‚É£ ', React.createElement('strong', null, 'Merktu'), ' or√∞ e√∞a setningu sem √æ√∫ skilur ekki'),
                React.createElement('li', null, '4Ô∏è‚É£ Smelltu √° ', React.createElement('strong', null, '"√û√Ω√∞a"'), ' hnappinn'),
                React.createElement('li', null, '5Ô∏è‚É£ F√°√∞u √æ√Ω√∞ingu √° √æ√≠nu m√°li! üéâ')
              )
            ),

            React.createElement('div', { className: 'bg-white rounded-lg shadow-sm p-8' },
              React.createElement('div', {
                ref: textRef,
                className: 'selectable-text text-gray-800 font-light text-lg leading-relaxed space-y-4' + (!confirmedLanguage ? ' opacity-40 pointer-events-none' : ''),
                onMouseUp: handleTextSelection,
                onTouchEnd: handleTextSelection
              },
                TEXT.split('\n\n').map(function(paragraph, i) {
                  return React.createElement('p', { key: i }, paragraph);
                })
              ),
              !confirmedLanguage && (
                React.createElement('div', { className: 'mt-4 text-center text-gray-500 font-light' },
                  '‚¨ÜÔ∏è Veldu m√≥√∞urm√°l √æitt fyrst'
                )
              )
            ),

            React.createElement('div', { className: 'bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-8 text-center' },
              React.createElement('div', { className: 'text-6xl mb-4' }, 'üéâ'),
              React.createElement('h2', { className: 'text-2xl font-light text-gray-800 mb-3' }, 'Vel gert!'),
              React.createElement('p', { className: 'text-gray-600 font-light' },
                '√û√∫ getur lesi√∞ B1 texta me√∞ hj√°lp AI √æ√Ω√∞inganna!'
              )
            )
          ),

          showPopup && (
            React.createElement(React.Fragment, null,
              React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-20 z-50',
                onClick: closePopup
              }),
              React.createElement('div', {
                className: 'translation-popup',
                style: {
                  left: popupPosition.x + 'px',
                  top: popupPosition.y + 'px',
                  transform: 'translateX(-50%)'
                }
              },
                React.createElement('div', { className: 'flex items-start justify-between mb-3' },
                  React.createElement('div', { className: 'flex-1' },
                    React.createElement('div', { className: 'text-xs text-gray-500 mb-1' }, 'Vali√∞ texti:'),
                    React.createElement('div', { className: 'font-normal text-gray-800 text-sm mb-3 italic' },
                      '"' + selectedText + '"'
                    )
                  ),
                  React.createElement('button', {
                    onClick: closePopup,
                    className: 'text-gray-400 hover:text-gray-600 text-2xl leading-none ml-2'
                  }, '√ó')
                ),

                !translation ? (
                  React.createElement('button', {
                    onClick: translateText,
                    disabled: isLoading,
                    className: 'w-full bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-light disabled:bg-gray-400'
                  },
                    isLoading ? (
                      React.createElement('span', { className: 'loading-dots' }, '√û√Ω√∞i')
                    ) : (
                      'üåê √û√Ω√∞a √° ' + confirmedLanguage
                    )
                  )
                ) : (
                  React.createElement('div', { className: 'bg-blue-50 border-2 border-blue-200 rounded-lg p-4' },
                    React.createElement('div', { className: 'text-xs text-gray-500 mb-2' }, 'üåê √û√Ω√∞ing:'),
                    React.createElement('div', { className: 'font-light text-gray-800 whitespace-pre-wrap' },
                      translation
                    )
                  )
                )
              )
            )
          )
        )
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(InteractiveReading));
  </script>
</body>
</html>
